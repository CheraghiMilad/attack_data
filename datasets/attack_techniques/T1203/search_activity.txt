Audit:[timestamp=06-03-2022 17:33:05.868, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654277580_952', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:33:00 2021', apiEndTime='Fri Jun  3 17:33:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:33:05.846, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654277580_951', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:33:00 2022', apiEndTime='Fri Jun  3 17:33:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:33:05.008, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277585.606768', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:33:05 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:33:04.799, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654277580_950', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:33:00 2022', apiEndTime='Fri Jun  3 17:33:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:33:04.450, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277584.606767', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Services normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:33:04 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:33:03.748, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654277580_949', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:33:00 2022', apiEndTime='Fri Jun  3 17:33:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:33:03.455, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277583.606766', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb26032d7500783b0 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:33:02.714, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277580_948', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:33:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:33:02.699, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654277580_947', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:33:00 2022', apiEndTime='Fri Jun  3 17:33:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:33:02.657, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654277580_946', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:33:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:33:02.651, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654277580_945', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:33:00 2021', apiEndTime='Fri Jun  3 17:33:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:33:02.600, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654277580_944', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:33:00 2022', apiEndTime='Fri Jun  3 17:33:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:33:02.577, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654277580_943', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Aut (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:33:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:32:54.163, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277520_942', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277562, api_et=1654273320.000000000, api_lt=1654276920.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273320.000000000, search_lt=1654276920.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:32:42.089, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277520_942', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:22:00 2022', apiEndTime='Fri Jun  3 17:22:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:32:24.183, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277520_941_1654277522.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.58, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654277522, api_et=N/A, api_lt=1654277520.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277520.000000000, is_realtime=0, savedsearch_name="", search_startup_time="65", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:32:24.180, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654277520_940', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277522, api_et=1646328720.000000000, api_lt=1654277520.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646328720.000000000, search_lt=1654277520.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]']
Audit:[timestamp=06-03-2022 17:32:24.174, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277520_941', has_error_warn=false, fully_completed_search=true, total_run_time=14.47, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277522, api_et=N/A, api_lt=1654277520.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277520.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1487", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:32:24.171, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277520_941_1654277523.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.14, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654277523, api_et=N/A, api_lt=1654277520.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277520.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:32:24.169, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654277520_937', has_error_warn=false, fully_completed_search=true, total_run_time=7.74, event_count=499, result_count=99, available_count=0, scan_count=938, drop_count=0, exec_time=1654277522, api_et=N/A, api_lt=1654277520.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277520.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_startup_time="1527", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename dest_bunit AS All_Changes.dest_bunit dest_category AS All_Changes.dest_category dest_priority AS All_Changes.dest_priority src_bunit AS All_Changes.src_bunit src_category AS All_Changes.src_category src_priority AS All_Changes.src_priority tag AS All_Changes.tag user_agent AS All_Changes.user_agent user_bunit AS All_Changes.user_bunit user_category AS All_Changes.user_category user_priority AS All_Changes.user_priority user_type AS All_Changes.user_type vendor_account AS All_Changes.vendor_account vendor_region AS All_Changes.vendor_region change_type AS All_Changes.change_type command AS All_Changes.command dest AS All_Changes.dest dvc AS All_Changes.dvc object AS All_Changes.object object_attrs AS All_Changes.object_attrs object_category AS All_Changes.object_category object_id AS All_Changes.object_id object_path AS All_Changes.object_path status AS All_Changes.status result AS All_Changes.result result_id AS All_Changes.result_id src AS All_Changes.src user AS All_Changes.user user_name AS All_Changes.user_name vendor_product AS All_Changes.vendor_product action AS All_Changes.action is_Auditing_Changes AS All_Changes.is_Auditing_Changes is_not_Auditing_Changes AS All_Changes.is_not_Auditing_Changes is_Endpoint_Changes AS All_Changes.is_Endpoint_Changes is_not_Endpoint_Changes AS All_Changes.is_not_Endpoint_Changes is_Network_Changes AS All_Changes.is_Network_Changes is_not_Network_Changes AS All_Changes.is_not_Network_Changes is_Account_Management AS All_Changes.is_Account_Management is_not_Account_Management AS All_Changes.is_not_Account_Management is_Instance_Changes AS All_Changes.is_Instance_Changes is_not_Instance_Changes AS All_Changes.is_not_Instance_Changes | fields nodename, _time, host, source, sourcetype, All_Changes.dest_bunit, All_Changes.dest_category, All_Changes.dest_priority, All_Changes.src_bunit, All_Changes.src_category, All_Changes.src_priority, All_Changes.tag, All_Changes.user_agent, All_Changes.user_bunit, All_Changes.user_category, All_Changes.user_priority, All_Changes.user_type, All_Changes.vendor_account, All_Changes.vendor_region, All_Changes.change_type, All_Changes.command, All_Changes.dest, All_Changes.dvc, All_Changes.object, All_Changes.object_attrs, All_Changes.object_category, All_Changes.object_id, All_Changes.object_path, All_Changes.status, All_Changes.result, All_Changes.result_id, All_Changes.src, All_Changes.user, All_Changes.user_name, All_Changes.vendor_product, All_Changes.action, All_Changes.is_Auditing_Changes, All_Changes.is_not_Auditing_Changes, All_Changes.is_Endpoint_Changes, All_Changes.is_not_Endpoint_Changes, All_Changes.is_Network_Changes, All_Changes.is_not_Network_Changes, All_Changes.is_Account_Management, All_Changes.is_not_Account_Management, All_Changes.is_Instance_Changes, All_Changes.is_not_Instance_Changes, All_Changes.Endpoint_Changes.is_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes, All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes, All_Changes.Network_Changes.dest_ip_range, All_Changes.Network_Changes.dest_port_range, All_Changes.Network_Changes.direction, All_Changes.Network_Changes.protocol, All_Changes.Network_Changes.rule_action, All_Changes.Network_Changes.src_ip_range, All_Changes.Network_Changes.src_port_range, All_Changes.Network_Changes.is_Device_Restarts, All_Changes.Network_Changes.is_not_Device_Restarts, All_Changes.Account_Management.src_user_bunit, All_Changes.Account_Management.src_user_category, All_Changes.Account_Management.src_user_priority, All_Changes.Account_Management.src_user_type, All_Changes.Account_Management.dest_nt_domain, All_Changes.Account_Management.src_nt_domain, All_Changes.Account_Management.src_user, All_Changes.Account_Management.src_user_name, All_Changes.Account_Management.is_Accounts_Created, All_Changes.Account_Management.is_not_Accounts_Created, All_Changes.Account_Management.is_Accounts_Deleted, All_Changes.Account_Management.is_not_Accounts_Deleted, All_Changes.Account_Management.is_Account_Lockouts, All_Changes.Account_Management.is_not_Account_Lockouts, All_Changes.Account_Management.is_Accounts_Updated, All_Changes.Account_Management.is_not_Accounts_Updated, All_Changes.Instance_Changes.image_id, All_Changes.Instance_Changes.instance_type ]']
Audit:[timestamp=06-03-2022 17:32:24.167, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277520_941_1654277523.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277523, api_et=N/A, api_lt=1654277520.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277520.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:32:24.165, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654277520_939', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277522, api_et=1622741520.000000000, api_lt=1654277520.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741520.000000000, search_lt=1654277520.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]']
Audit:[timestamp=06-03-2022 17:32:24.161, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654277520_938', has_error_warn=false, fully_completed_search=true, total_run_time=10.33, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277522, api_et=1646328720.000000000, api_lt=1654277520.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646328720.000000000, search_lt=1654277520.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_startup_time="723", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]']
Audit:[timestamp=06-03-2022 17:32:01.847, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277520_941', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:32:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:32:01.837, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654277520_940', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:32:00 2022', apiEndTime='Fri Jun  3 17:32:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:32:01.812, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654277520_939', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:32:00 2021', apiEndTime='Fri Jun  3 17:32:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:32:01.788, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654277520_938', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:32:00 2022', apiEndTime='Fri Jun  3 17:32:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:32:01.746, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654277520_937', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_typ (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:32:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:31:54.168, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277460_936', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277502, api_et=1654273260.000000000, api_lt=1654276860.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273260.000000000, search_lt=1654276860.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:31:42.245, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277460_936', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:21:00 2022', apiEndTime='Fri Jun  3 17:21:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:31:24.181, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD5c83b6c1279a5dacb_at_1654277400_923', has_error_warn=false, fully_completed_search=true, total_run_time=49.49, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277405, api_et=N/A, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="Audit - Dataset Relation", search_startup_time="26", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_89260bd9d080bc5c", app="SA-Utils", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest /servicesNS/nobody/SA-Utils/contentinfo/_cache timeout=600 tshirt_server=local count=0 | stats count']
Audit:[timestamp=06-03-2022 17:31:24.179, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277460_935_1654277463.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277463, api_et=N/A, api_lt=1654277460.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277460.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:31:24.177, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277460_935_1654277463.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.15, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654277463, api_et=N/A, api_lt=1654277460.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277460.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:31:24.176, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654277460_932', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277462, api_et=1622741460.000000000, api_lt=1654277460.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741460.000000000, search_lt=1654277460.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_startup_time="544", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]']
Audit:[timestamp=06-03-2022 17:31:24.171, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277460_935', has_error_warn=false, fully_completed_search=true, total_run_time=14.07, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277462, api_et=N/A, api_lt=1654277460.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277460.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1197", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:31:24.169, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654277460_933', has_error_warn=false, fully_completed_search=true, total_run_time=1.85, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654277462, api_et=1646328660.000000000, api_lt=1654277460.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646328660.000000000, search_lt=1654277460.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_startup_time="1226", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]']
Audit:[timestamp=06-03-2022 17:31:24.168, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277460_935_1654277462.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.61, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654277462, api_et=N/A, api_lt=1654277460.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277460.000000000, is_realtime=0, savedsearch_name="", search_startup_time="74", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:31:24.166, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277462.606747', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277462, api_et=1622741462.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622741462.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="298", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Vulnerabilities normid= [ search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:31:24.160, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654277460_934', has_error_warn=false, fully_completed_search=true, total_run_time=10.31, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277462, api_et=1622741460.000000000, api_lt=1654277460.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741460.000000000, search_lt=1654277460.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]']
Audit:[timestamp=06-03-2022 17:31:02.420, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277462.606747', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Vulnerabilities normid= [ search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:31:02 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:31:02.009, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277460_935', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:31:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:31:01.992, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654277460_934', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:31:00 2021', apiEndTime='Fri Jun  3 17:31:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:31:01.952, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654277460_933', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:31:00 2022', apiEndTime='Fri Jun  3 17:31:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:31:01.889, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654277460_932', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:31:00 2021', apiEndTime='Fri Jun  3 17:31:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:54.176, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277400_931', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277440, api_et=1654273200.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273200.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:30:40.273, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277400_931', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:20:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:24.221, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654277400_907', has_error_warn=false, fully_completed_search=true, total_run_time=6.04, event_count=35, result_count=3, available_count=0, scan_count=35, drop_count=0, exec_time=1654277403, api_et=1622741400.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741400.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_startup_time="1417", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]']
Audit:[timestamp=06-03-2022 17:30:24.220, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277409.606733', has_error_warn=false, fully_completed_search=true, total_run_time=10.54, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277409, api_et=1622741409.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622741409.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="357", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions normid= [ search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:30:24.219, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277401.606724', has_error_warn=false, fully_completed_search=true, total_run_time=1.54, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277402, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="1018", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Authentication normid= [ search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_Successful_Authentication, Authentication.is_not_Successful_Authentication, Authentication.is_Default_Authentication, Authentication.is_not_Default_Authentication, Authentication.is_Insecure_Authentication, Authentication.is_not_Insecure_Authentication, Authentication.is_Privileged_Authentication, Authentication.is_not_Privileged_Authentication, Authentication.Default_Authentication.is_Failed_Default_Authentication, Authentication.Default_Authentication.is_not_Failed_Default_Authentication, Authentication.Default_Authentication.is_Successful_Default_Authentication, Authentication.Default_Authentication.is_not_Successful_Default_Authentication, Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:30:24.217, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654277400_927', has_error_warn=false, fully_completed_search=true, total_run_time=10.70, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277407, api_et=N/A, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_startup_time="717", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]']
Audit:[timestamp=06-03-2022 17:30:24.216, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277400_918_1654277405.6', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277405, api_et=N/A, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:30:24.215, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277406.606731', has_error_warn=false, fully_completed_search=true, total_run_time=10.87, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277406, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="642", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk", app="SA-ThreatIntelligence", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Risk normid= [ search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:30:24.214, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277403.606727', has_error_warn=false, fully_completed_search=true, total_run_time=10.92, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277403, api_et=1646328602.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1646328602.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="667", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Web normid= [ search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code] | eval backfill_start_time = relative_time(now(), "-3mon") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:30:24.212, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD56bad8d5ede1359d6_at_1654277400_920', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277405, api_et=1654189200.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654189200.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="Audit - Index Readiness", search_startup_time="396", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_f9d8a1e5b0e3efd0", app="SA-Utils", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest /services/data/indexes tshirt_server=* count=0 | eval _time=strptime(maxTime, "%Y-%m-%dT%H:%M:%S%z") | stats sum(totalEventCount) AS count, max(_time) AS _time by title | eval readiness=if(count > 0 AND _time>=relative_time(now(), "-24h@h"), 1, 0), calc_count=if(readiness==0, 0, count)  | fields title, calc_count, readiness | rename title AS index, calc_count as count | runshellscript key_field=index index_readiness_lookup | stats count']
Audit:[timestamp=06-03-2022 17:30:24.210, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5c5d72a1c7e0ef794_1654277400.606722', has_error_warn=false, fully_completed_search=true, total_run_time=1.78, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277400, api_et=1654275000.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654275000.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="threatmatch://certificate_common_name", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_954371655b696c88", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_common_name"
    | lookup "threatintel_by_certificate_common_name" value as "All_Certificates.SSL.ssl_issuer_common_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_common_name_wildcard" value as "All_Certificates.SSL.ssl_issuer_common_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_common_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_common_name','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_common_name"
    | lookup "threatintel_by_certificate_common_name" value as "All_Certificates.SSL.ssl_subject_common_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_common_name_wildcard" value as "All_Certificates.SSL.ssl_subject_common_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_common_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_common_name','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://certificate_common_name"']
Audit:[timestamp=06-03-2022 17:30:24.206, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277414.606734', has_error_warn=false, fully_completed_search=true, total_run_time=10.62, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277414, api_et=1622741414.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622741414.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="410", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit normid= [ search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:30:24.205, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277400_918', has_error_warn=false, fully_completed_search=true, total_run_time=15.08, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277404, api_et=N/A, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1218", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:30:24.203, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtQWNjZXNzUHJvdGVjdGlvbg__RMD54a1edad66ca90d80_at_1654277400_913', has_error_warn=false, fully_completed_search=true, total_run_time=1.48, event_count=1, result_count=1, available_count=0, scan_count=1, drop_count=0, exec_time=1654277403, api_et=1654275600.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654275600.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="Access - Access App Tracker - Lookup Gen", search_startup_time="2040", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-AccessProtection_admin_71c0a0e9ec5d01ab", app="SA-AccessProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Authentication"."Authentication" where "Authentication.app"!="unknown" by "Authentication.app" | rename "Authentication.app" as "app" | inputlookup append=T "access_app_tracker" | stats min("firstTime") as "firstTime",max("lastTime") as "lastTime" by "app" | runshellscript override_if_empty=false "access_app_tracker" | stats count']
Audit:[timestamp=06-03-2022 17:30:24.201, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654277400_906', has_error_warn=false, fully_completed_search=true, total_run_time=11.34, event_count=127, result_count=18, available_count=0, scan_count=790, drop_count=0, exec_time=1654277402, api_et=1622741400.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741400.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_startup_time="1406", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]']
Audit:[timestamp=06-03-2022 17:30:24.200, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD5d3ec87bd185c0ef4_at_1654277400_922', has_error_warn=false, fully_completed_search=true, total_run_time=3.33, event_count=22389, result_count=1, available_count=0, scan_count=22489, drop_count=0, exec_time=1654277406, api_et=1654189200.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654189200.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="Audit - Savedsearch Statistics - Lookup Gen", search_startup_time="1394", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_d2e291b871066f22", app="SA-Utils", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=2, eliminated_buckets=0, considered_events=22489, total_slices=20957, decompressed_slices=1497, duration.command.search.index=13, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=167, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, sourcetype_count__audittrail=22389, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search index=_audit action=search savedsearch_name=* info=completed | stats avg(total_run_time) as avg_run_time, avg(event_count) as avg_event_count, avg(result_count) as avg_result_count, count as invocations by savedsearch_name | join type=outer savedsearch_name [search index=_internal sourcetype=scheduler search_type=adhoc OR search_type="" | stats count(eval(status=="success")) as success, count(eval(status=="skipped")) as skipped by savedsearch_name] | where savedsearch_name != "" | eval update_time=now() | runshellscript key_field=savedsearch_name savedsearch_stats_lookup | stats count']
Audit:[timestamp=06-03-2022 17:30:24.199, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5ed8e405fd0717242_1654277400.606721', has_error_warn=false, fully_completed_search=true, total_run_time=2.76, event_count=2, result_count=0, available_count=0, scan_count=2, drop_count=0, exec_time=1654277400, api_et=1654275000.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654275000.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="threatmatch://user", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_37d5afbbdbe1867b", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Authentication.src"),values("Authentication.dest") from datamodel="Authentication"."Authentication" by "Authentication.src_user"
    | lookup "threatintel_by_user" value as "Authentication.src_user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "Authentication.src_user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Authentication.src,src)`
    | `sistats_values_rename(Authentication.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Authentication.src_user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Authentication.src"),values("Authentication.dest"),values("Authentication.src_user") from datamodel="Authentication"."Authentication" by "Authentication.user"
    | lookup "threatintel_by_user" value as "Authentication.user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "Authentication.user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Authentication.src,src)`
    | `sistats_values_rename(Authentication.dest,dest)`
    | `sistats_values_rename(Authentication.src_user,src_user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Authentication.user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Inventory.dest") from datamodel="Compute_Inventory"."All_Inventory" where nodename="All_Inventory.User" by "All_Inventory.User.user"
    | lookup "threatintel_by_user" value as "All_Inventory.User.user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "All_Inventory.User.user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Inventory.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Inventory.User.user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest") from datamodel="Web"."Web" by "Web.user"
    | lookup "threatintel_by_user" value as "Web.user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "Web.user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.user','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://user"']
Audit:[timestamp=06-03-2022 17:30:24.196, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD51dbc70e0e18846c9_at_1654277400_914', has_error_warn=false, fully_completed_search=true, total_run_time=1.29, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277403, api_et=N/A, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="Threat - Notable Owners - Lookup Gen", search_startup_time="1580", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a775b1da515861dc", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/authentication/users | search capabilities="can_own_notable_events" | rename title as owner | append [| makeresults | eval owner="unassigned" ] | eval _key=owner | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key owner realname | runshellscript notable_owners_lookup | stats count']
Audit:[timestamp=06-03-2022 17:30:24.195, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD51dbc70e0e18846c9_at_1654277400_914_1654277404.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.02, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277404, api_et=N/A, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_f2df6493ea859e37", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search=' | makeresults | eval owner="unassigned"']
Audit:[timestamp=06-03-2022 17:30:24.193, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD53eddd1500759c205_1654277400.606720', has_error_warn=false, fully_completed_search=true, total_run_time=3.00, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277400, api_et=1654275000.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654275000.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="threatmatch://email", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_eaa0f13d4a92e3c5", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_email"
    | lookup "threatintel_by_email" value as "All_Certificates.SSL.ssl_issuer_email" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Certificates.SSL.ssl_issuer_email" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_email','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_email"
    | lookup "threatintel_by_email" value as "All_Certificates.SSL.ssl_subject_email" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Certificates.SSL.ssl_subject_email" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_email','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.src_user"
    | lookup "threatintel_by_email" value as "All_Email.src_user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Email.src_user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.src_user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user") from datamodel="Email"."All_Email" by "All_Email.recipient"
    | lookup "threatintel_by_email" value as "All_Email.recipient" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Email.recipient" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.recipient','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://email"']
Audit:[timestamp=06-03-2022 17:30:24.192, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5b7fc89b7a285771b_at_1654277400_915', has_error_warn=false, fully_completed_search=true, total_run_time=1.72, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277403, api_et=1653670800.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1653670800.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="Threat - Risk Correlation By User - Lookup Gen", search_startup_time="2045", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_f545c8b9cfbc397d", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats summariesonly=false sum(All_Risk.calculated_risk_score) as risk_score from datamodel=Risk.All_Risk where All_Risk.risk_object_type="user" by All_Risk.risk_object | eval user=lower('All_Risk.risk_object') | `get_identity4events(user)` | eval risk_object=if(isnotnull(user_identity),lower(user_identity),user),risk_object=mvdedup(risk_object) | stats sum(risk_score) as risk_score by risk_object | runshellscript risk_correlation_by_user_lookup | stats count']
Audit:[timestamp=06-03-2022 17:30:24.190, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277400_918_1654277405.3', has_error_warn=false, fully_completed_search=true, total_run_time=10.59, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654277405, api_et=N/A, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="", search_startup_time="8", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:30:24.188, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654277400_909', has_error_warn=false, fully_completed_search=true, total_run_time=11.33, event_count=2, result_count=7, available_count=0, scan_count=7, drop_count=0, exec_time=1654277403, api_et=1622741400.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741400.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_startup_time="1556", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]']
Audit:[timestamp=06-03-2022 17:30:24.187, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654277400_910', has_error_warn=false, fully_completed_search=true, total_run_time=1.96, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654277403, api_et=1646328600.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646328600.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_startup_time="1609", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]']
Audit:[timestamp=06-03-2022 17:30:24.185, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLU5ldHdvcmtQcm90ZWN0aW9u__RMD50f26e1e038a79679_at_1654277400_919', has_error_warn=true, fully_completed_search=true, total_run_time=10.74, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277405, api_et=1654273200.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273200.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="Network - Whois Tracker - Checkpoint Gen", search_startup_time="948", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-NetworkProtection_admin_8aae8b643535904c", app="DA-ESS-NetworkProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` max(_time) as _time from datamodel=Web.Web by Web.dest | rename Web.dest as domain | `truncate_domain(domain)` | stats min(_time) as _time by domain | eval _key=sha1(domain) | dedup _key | lookup whois_tracker _key OUTPUTNEW _key as discard | where isnull(discard) | runshellscript key_field=_key append=T whois_tracker | `outputcheckpoint_whois` | stats count']
Audit:[timestamp=06-03-2022 17:30:24.185, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654277400_926', has_error_warn=false, fully_completed_search=true, total_run_time=1.01, event_count=5, result_count=3, available_count=0, scan_count=5, drop_count=0, exec_time=1654277406, api_et=N/A, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_startup_time="881", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]']
Audit:[timestamp=06-03-2022 17:30:24.182, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277400_918_1654277405.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.16, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654277405, api_et=N/A, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:30:24.181, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD591854b6694917629_at_1654277400_930', has_error_warn=false, fully_completed_search=true, total_run_time=10.50, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277410, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71_ACCELERATE_", search_startup_time="526", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=report_acceleration, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time ]']
Audit:[timestamp=06-03-2022 17:30:24.180, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654277400_924', has_error_warn=false, fully_completed_search=true, total_run_time=10.47, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277406, api_et=1654190400.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654190400.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_startup_time="507", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_d34d6d33ee94d419", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`']
Audit:[timestamp=06-03-2022 17:30:24.179, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654277400_925', has_error_warn=false, fully_completed_search=true, total_run_time=10.64, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277406, api_et=N/A, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_startup_time="575", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence", app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]']
Audit:[timestamp=06-03-2022 17:30:24.178, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD5c31bfb27acb495b2_at_1654277400_921', has_error_warn=false, fully_completed_search=true, total_run_time=10.43, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277404, api_et=N/A, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="Audit - Sourcetype Readiness - Lookup Gen", search_startup_time="367", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_8fb8b7782d6d1227", app="SA-Utils", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| metadata type=sourcetypes tshirt_server=* index=* index=_* | eval readiness=if(lastTime > now() - 86400, 1, 0), update_time=now() | fields sourcetype, readiness, update_time | dedup sourcetype | runshellscript key_field=sourcetype sourcetype_readiness_lookup | stats count']
Audit:[timestamp=06-03-2022 17:30:24.177, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5fdbe716eed5fd8d5_at_1654277400_928', has_error_warn=false, fully_completed_search=true, total_run_time=10.46, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277408, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39_ACCELERATE_", search_startup_time="321", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=report_acceleration, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized ]']
Audit:[timestamp=06-03-2022 17:30:24.174, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5a742da37541343b2_at_1654277400_912', has_error_warn=false, fully_completed_search=true, total_run_time=1.38, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277403, api_et=1653672000.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1653672000.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="Risk - 7 Day ATT&CK Tactic Threshold Exceeded - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_553873b00608ee08", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count, values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk where All_Risk.annotations.mitre_attack.mitre_tactic_id=* by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id' | where mitre_tactic_id_count >= 3 and source_count >= 4']
Audit:[timestamp=06-03-2022 17:30:24.173, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD566ab5c97239475f4_at_1654277400_916', has_error_warn=false, fully_completed_search=true, total_run_time=1.70, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277403, api_et=1653670800.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1653670800.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="Threat - Risk Correlation By System - Lookup Gen", search_startup_time="2007", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a7aa72da742377fb", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats summariesonly=false sum(All_Risk.calculated_risk_score) as risk_score from datamodel=Risk.All_Risk where All_Risk.risk_object_type="system" by All_Risk.risk_object | eval dest=lower('All_Risk.risk_object') | `get_asset(dest)` | eval dest=mvdedup(if(isnotnull(dest_asset_id),mvappend(dest,lower(dest_asset)),dest)) | stats sum(risk_score) as risk_score by dest | rename dest as risk_object | runshellscript risk_correlation_by_system_lookup | stats count']
Audit:[timestamp=06-03-2022 17:30:24.172, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654277400_908', has_error_warn=false, fully_completed_search=true, total_run_time=10.50, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277403, api_et=1622741400.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741400.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]']
Audit:[timestamp=06-03-2022 17:30:24.171, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654277400_917', has_error_warn=false, fully_completed_search=true, total_run_time=3.31, event_count=2910, result_count=1, available_count=0, scan_count=2910, drop_count=0, exec_time=1654277404, api_et=1654102800.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654102800.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="ESS - Notable Events", search_startup_time="2267", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_87db9bb7a232c62f", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=1, eliminated_buckets=0, considered_events=2910, total_slices=121, decompressed_slices=10, duration.command.search.index=2, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=131, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, sourcetype_count__stash=2910, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count']
Audit:[timestamp=06-03-2022 17:30:24.168, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD5495078187e88a4c3_at_1654277400_911', has_error_warn=false, fully_completed_search=true, total_run_time=10.71, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277403, api_et=N/A, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="Utils - User Realnames - Lookup Gen", search_startup_time="1279", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_a775b1da515861dc", app="SA-Utils", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/authentication/users | rename title as user | eval _key=user | dedup _key | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key user realname | runshellscript key_field=_key user_realnames_lookup | stats count']
Audit:[timestamp=06-03-2022 17:30:24.167, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD56090c2f26559b465_1654277400.606723', has_error_warn=false, fully_completed_search=true, total_run_time=1.11, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277400, api_et=1654275000.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654275000.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="threatmatch://registry_path", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_07e0cbca0fa6efb1", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Registry.dest"),values("Registry.user") from datamodel="Endpoint"."Registry" by "Registry.registry_path"
    | lookup "threatintel_by_registry_path" value as "Registry.registry_path" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_registry_path_wildcard" value as "Registry.registry_path" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Registry.dest,dest)`
    | `sistats_values_rename(Registry.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"registry_path",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Registry.registry_path','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://registry_path"']
Audit:[timestamp=06-03-2022 17:30:24.166, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277404.606728', has_error_warn=false, fully_completed_search=true, total_run_time=10.25, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277404, api_et=1622741403.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622741403.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="252", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Ticket_Management normid= [ search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:30:24.163, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD55392d2cd3b6dec88_at_1654277400_929', has_error_warn=false, fully_completed_search=true, total_run_time=10.68, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277408, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548_ACCELERATE_", search_startup_time="630", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=report_acceleration, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress ]']
Audit:[timestamp=06-03-2022 17:30:24.162, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVXRpbHM__RMD5d3ec87bd185c0ef4_at_1654277400_922_1654277406.7', has_error_warn=false, fully_completed_search=true, total_run_time=10.78, event_count=5563, result_count=84, available_count=0, scan_count=16790, drop_count=0, exec_time=1654277406, api_et=1654189200.000000000, api_lt=1654277400.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654189200.000000000, search_lt=1654277400.000000000, is_realtime=0, savedsearch_name="", search_startup_time="153", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_4ea944d42eb608cb", app="SA-Utils", provenance="N/A", mode="historical_batch", is_proxied=false, searched_buckets=3, eliminated_buckets=0, considered_events=16790, total_slices=11180, decompressed_slices=1926, duration.command.search.index=8, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=282, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, sourcetype_count__scheduler=5563, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| search (index=_internal sourcetype=scheduler (search_type=adhoc OR search_type="")) | stats count(eval(status=="success")) as success, count(eval(status=="skipped")) as skipped by savedsearch_name']
Audit:[timestamp=06-03-2022 17:30:24.160, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277407.606732', has_error_warn=false, fully_completed_search=true, total_run_time=10.54, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277407, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="374", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management", app="SA-ThreatIntelligence", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Incident_Management normid= [ search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:30:14.202, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277414.606734', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit normid= [ search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:30:14 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:10.022, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD591854b6694917629_at_1654277400_930', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time ]', autojoin='1', buckets=0, ttl=60, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71_ACCELERATE_", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:09.043, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277409.606733', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions normid= [ search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:30:09 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:08.008, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD55392d2cd3b6dec88_at_1654277400_929', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress ]', autojoin='1', buckets=0, ttl=60, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548_ACCELERATE_", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:07.994, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5fdbe716eed5fd8d5_at_1654277400_928', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized ]', autojoin='1', buckets=0, ttl=60, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39_ACCELERATE_", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:07.385, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277407.606732', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Incident_Management normid= [ search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="SA-ThreatIntelligence", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:06.975, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654277400_927', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:06.466, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277406.606731', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Risk normid= [ search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="SA-ThreatIntelligence", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:05.964, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654277400_926', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:05.953, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654277400_925', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_type=adhoc, is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:05.942, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654277400_924', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,mitre_tactic_id_count,mitre_technique_id_count,prestats_reserved_*,psrsvd_*,risk_object,risk_object_type,source_count', apiStartTime='Thu Jun  2 17:20:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:05.926, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD5c83b6c1279a5dacb_at_1654277400_923', search='| rest /servicesNS/nobody/SA-Utils/contentinfo/_cache timeout=600 tshirt_server=local count=0 | stats count', autojoin='1', buckets=0, ttl=3600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Audit - Dataset Relation", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:05.907, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD5d3ec87bd185c0ef4_at_1654277400_922', search='search index=_audit action=search savedsearch_name=* info=completed | stats avg(total_run_time) as avg_run_time, avg(event_count) as avg_event_count, avg(result_count) as avg_result_count, count as invocations by savedsearch_name | join type=outer savedsearch_name [search index=_internal sourcetype=scheduler search_type=adhoc OR search_type="" | stats count(eval(status=="success")) as success, count(eval(status=="skipped")) as skipped by savedsearch_name] | where savedsearch_name != "" | eval update_time=now() | runshellscript key_field=savedsearch_name savedsearch_stats_lookup | stats count', autojoin='1', buckets=0, ttl=3600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  2 17:00:00 2022', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Audit - Savedsearch Statistics - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:04.881, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD5c31bfb27acb495b2_at_1654277400_921', search='| metadata type=sourcetypes tshirt_server=* index=* index=_* | eval readiness=if(lastTime > now() - 86400, 1, 0), update_time=now() | fields sourcetype, readiness, update_time | dedup sourcetype | runshellscript key_field=sourcetype sourcetype_readiness_lookup | stats count', autojoin='1', buckets=0, ttl=3600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Audit - Sourcetype Readiness - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:04.865, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD56bad8d5ede1359d6_at_1654277400_920', search='| rest /services/data/indexes tshirt_server=* count=0 | eval _time=strptime(maxTime, "%Y-%m-%dT%H:%M:%S%z") | stats sum(totalEventCount) AS count, max(_time) AS _time by title | eval readiness=if(count > 0 AND _time>=relative_time(now(), "-24h@h"), 1, 0), calc_count=if(readiness==0, 0, count)  | fields title, calc_count, readiness | rename title AS index, calc_count as count | runshellscript key_field=index index_readiness_lookup | stats count', autojoin='1', buckets=0, ttl=3600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  2 17:00:00 2022', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Audit - Index Readiness", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:04.849, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLU5ldHdvcmtQcm90ZWN0aW9u__RMD50f26e1e038a79679_at_1654277400_919', search='| tstats `summariesonly` max(_time) as _time from datamodel=Web.Web by Web.dest | rename Web.dest as domain | `truncate_domain(domain)` | stats min(_time) as _time by domain | eval _key=sha1(domain) | dedup _key | lookup whois_tracker _key OUTPUTNEW _key as discard | where isnull(discard) | runshellscript key_field=_key append=T whois_tracker | `outputcheckpoint_whois` | stats count', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:20:00 2022', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Network - Whois Tracker - Checkpoint Gen", search_type=adhoc, is_proxied=false, app="DA-ESS-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:04.812, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277400_918', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:04.663, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277404.606728', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Ticket_Management normid= [ search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:30:03 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:03.775, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654277400_917', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Wed Jun  1 17:00:00 2022', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESS - Notable Events", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:03.700, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277403.606727', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Web normid= [ search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code] | eval backfill_start_time = relative_time(now(), "-3mon") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Mar  3 17:30:02 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:02.727, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD566ab5c97239475f4_at_1654277400_916', search='| tstats summariesonly=false sum(All_Risk.calculated_risk_score) as risk_score from datamodel=Risk.All_Risk where All_Risk.risk_object_type="system" by All_Risk.risk_object | eval dest=lower('All_Risk.risk_object') | `get_asset(dest)` | eval dest=mvdedup(if(isnotnull(dest_asset_id),mvappend(dest,lower(dest_asset)),dest)) | stats sum(risk_score) as risk_score by dest | rename dest as risk_object | runshellscript risk_correlation_by_system_lookup | stats count', autojoin='1', buckets=0, ttl=3600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri May 27 17:00:00 2022', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Risk Correlation By System - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:02.703, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5b7fc89b7a285771b_at_1654277400_915', search='| tstats summariesonly=false sum(All_Risk.calculated_risk_score) as risk_score from datamodel=Risk.All_Risk where All_Risk.risk_object_type="user" by All_Risk.risk_object | eval user=lower('All_Risk.risk_object') | `get_identity4events(user)` | eval risk_object=if(isnotnull(user_identity),lower(user_identity),user),risk_object=mvdedup(risk_object) | stats sum(risk_score) as risk_score by risk_object | runshellscript risk_correlation_by_user_lookup | stats count', autojoin='1', buckets=0, ttl=3600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri May 27 17:00:00 2022', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Risk Correlation By User - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:02.678, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD51dbc70e0e18846c9_at_1654277400_914', search='| rest tshirt_server=local count=0 /services/authentication/users | search capabilities="can_own_notable_events" | rename title as owner | append [| makeresults | eval owner="unassigned" ] | eval _key=owner | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key owner realname | runshellscript notable_owners_lookup | stats count', autojoin='1', buckets=0, ttl=1200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Notable Owners - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:02.657, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtQWNjZXNzUHJvdGVjdGlvbg__RMD54a1edad66ca90d80_at_1654277400_913', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Authentication"."Authentication" where "Authentication.app"!="unknown" by "Authentication.app" | rename "Authentication.app" as "app" | inputlookup append=T "access_app_tracker" | stats min("firstTime") as "firstTime",max("lastTime") as "lastTime" by "app" | runshellscript override_if_empty=false "access_app_tracker" | stats count', autojoin='1', buckets=0, ttl=1800, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 17:00:00 2022', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Access - Access App Tracker - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-AccessProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:02.642, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5a742da37541343b2_at_1654277400_912', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count, values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk where All_Risk.annotations.mitre_attack.mitre_tactic_id=* by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id' | where mitre_tactic_id_count >= 3 and source_count >= 4', autojoin='1', buckets=0, ttl=1200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,mitre_tactic_id_count,mitre_technique_id_count,prestats_reserved_*,psrsvd_*,risk_object,risk_object_type,source_count', apiStartTime='Fri May 27 17:20:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Risk - 7 Day ATT&CK Tactic Threshold Exceeded - Rule", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:02.617, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD5495078187e88a4c3_at_1654277400_911', search='| rest tshirt_server=local count=0 /services/authentication/users | rename title as user | eval _key=user | dedup _key | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key user realname | runshellscript key_field=_key user_realnames_lookup | stats count', autojoin='1', buckets=0, ttl=1200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Utils - User Realnames - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:02.604, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654277400_910', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:30:00 2022', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:02.555, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654277400_909', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:30:00 2021', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:02.533, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654277400_908', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:30:00 2021', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:02.468, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654277400_907', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:30:00 2021', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:02.437, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654277400_906', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:30:00 2021', apiEndTime='Fri Jun  3 17:30:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:01.996, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277401.606724', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Authentication normid= [ search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_ (truncated)', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:00.759, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD56090c2f26559b465_1654277400.606723', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Registry.dest"),values("Registry.user") from datamodel="Endpoint"."Registry" by "Registry.registry_path"
    | lookup "threatintel_by_registry_path" value as "Registry.registry_path" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_registry_path_wildcard" value as "Registry.registry_path" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Registry.dest,dest)`
    | `sistats_values_rename(Registry.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"registry_path",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Registry.registry_path','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://registry_path"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:50:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://registry_path", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:00.739, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5c5d72a1c7e0ef794_1654277400.606722', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_common_name"
    | lookup "threatintel_by_certificate_common_name" value as "All_Certificates.SSL.ssl_issuer_common_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_common_name_wildcard" value as "All_Certificates.SSL.ssl_issuer_common_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_common_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_common_name','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_common_name"
    | lookup "threatintel_by_certificate_common_name" value as "All_Certificates.SSL.ssl_subject_common_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_common_name_wildcard" value as "All_Certificates.SSL.ssl_subject_common_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_common_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_common_name','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://certificate_common_name"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:50:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://certificate_common_name", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:00.693, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5ed8e405fd0717242_1654277400.606721', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Authentication.src"),values("Authentication.dest") from datamodel="Authentication"."Authentication" by "Authentication.src_user"
    | lookup "threatintel_by_user" value as "Authentication.src_user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "Authentication.src_user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Authentication.src,src)`
    | `sistats_values_rename(Authentication.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Authentication.src_user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Authentication.src"),values("Authentication.dest"),values("Authentication.src_user") from datamodel="Authentication"."Authentication" by "Authentication.user"
    | lookup "threatintel_by_user" value as "Authentication.user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "Authentication.user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Authentication.src,src)`
    | `sistats_values_rename(Authentication.dest,dest)`
    | `sistats_values_rename(Authentication.src_user,src_user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Authentication.user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Inventory.dest") from datamodel="Compute_Inventory"."All_Inventory" where nodename="All_Inventory.User" by "All_Inventory.User.user"
    | lookup "threatintel_by_user" value as "All_Inventory.User.user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "All_Inventory.User.user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Inventory.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Inventory.User.user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest") from datamodel="Web"."Web" by "Web.user"
    | lookup "threatintel_by_user" value as "Web.user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "Web.user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.user','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://user"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:50:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://user", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:30:00.475, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD53eddd1500759c205_1654277400.606720', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_email"
    | lookup "threatintel_by_email" value as "All_Certificates.SSL.ssl_issuer_email" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Certificates.SSL.ssl_issuer_email" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_email','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_email"
    | lookup "threatintel_by_email" value as "All_Certificates.SSL.ssl_subject_email" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Certificates.SSL.ssl_subject_email" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_email','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.src_user"
    | lookup "threatintel_by_email" value as "All_Email.src_user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Email.src_user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.src_user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user") from datamodel="Email"."All_Email" by "All_Email.recipient"
    | lookup "threatintel_by_email" value as "All_Email.recipient" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Email.recipient" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.recipient','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://email"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:50:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://email", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:29:54.172, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277340_905', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277382, api_et=1654273140.000000000, api_lt=1654276740.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273140.000000000, search_lt=1654276740.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:29:54.165, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654277340_902', has_error_warn=false, fully_completed_search=true, total_run_time=37.04, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654277342, api_et=1651598940.000000000, api_lt=1654277340.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598940.000000000, search_lt=1654277340.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_startup_time="1218", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]']
Audit:[timestamp=06-03-2022 17:29:42.560, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277340_905', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:19:00 2022', apiEndTime='Fri Jun  3 17:19:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:29:24.173, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277340_904_1654277343.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.58, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654277343, api_et=N/A, api_lt=1654277340.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277340.000000000, is_realtime=0, savedsearch_name="", search_startup_time="60", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:29:24.170, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277340_904', has_error_warn=false, fully_completed_search=true, total_run_time=14.77, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277342, api_et=N/A, api_lt=1654277340.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277340.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1668", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:29:24.165, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654277340_903', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277342, api_et=1622741340.000000000, api_lt=1654277340.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741340.000000000, search_lt=1654277340.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]']
Audit:[timestamp=06-03-2022 17:29:24.164, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277340_904_1654277343.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.14, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654277343, api_et=N/A, api_lt=1654277340.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277340.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:29:24.162, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277340_904_1654277343.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277343, api_et=N/A, api_lt=1654277340.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277340.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:29:02.307, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277340_904', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:29:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:29:02.298, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654277340_903', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:29:00 2021', apiEndTime='Fri Jun  3 17:29:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:29:02.275, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654277340_902', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:29:00 2022', apiEndTime='Fri Jun  3 17:29:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:54.176, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277321.606701', has_error_warn=false, fully_completed_search=true, total_run_time=10.43, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277321, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="328", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39", app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NS44dad4abfd2e365a [search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:28:54.170, user=u001@tshirt.com, action=search, info=canceled, search_id='rt_md_1654277251.606677', has_error_warn=true, fully_completed_search=true, total_run_time=12.04, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277251, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=1, savedsearch_name="", search_startup_time="119", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_search_u001@tshirt.com_d79d8decd779a2d3", app="search", provenance="UI:Search", mode="RT_indexed", is_proxied=false, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| metadata type=sourcetypes | search totalCount > 0']
Audit:[timestamp=06-03-2022 17:28:54.161, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277280_901', has_error_warn=false, fully_completed_search=true, total_run_time=10.32, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277320, api_et=1654273080.000000000, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273080.000000000, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="511", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:28:41.280, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277321.606701', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NS44dad4abfd2e365a [search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:40.780, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277280_901', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:18:00 2022', apiEndTime='Fri Jun  3 17:18:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:24.207, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654277280_895', has_error_warn=false, fully_completed_search=true, total_run_time=10.27, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277282, api_et=1651598880.000000000, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598880.000000000, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]']
Audit:[timestamp=06-03-2022 17:28:24.205, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277280_896', has_error_warn=false, fully_completed_search=true, total_run_time=14.39, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277282, api_et=N/A, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1233", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:28:24.200, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277280_896_1654277283.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277283, api_et=N/A, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:28:24.199, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654277280_893', has_error_warn=false, fully_completed_search=true, total_run_time=11.36, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654277282, api_et=1651598880.000000000, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598880.000000000, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_startup_time="1089", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]']
Audit:[timestamp=06-03-2022 17:28:24.197, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654277280_892', has_error_warn=false, fully_completed_search=true, total_run_time=12.14, event_count=0, result_count=99, available_count=0, scan_count=0, drop_count=0, exec_time=1654277282, api_et=N/A, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_startup_time="1004", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_Successful_Authentication, Authentication.is_not_Successful_Authentication, Authentication.is_Default_Authentication, Authentication.is_not_Default_Authentication, Authentication.is_Insecure_Authentication, Authentication.is_not_Insecure_Authentication, Authentication.is_Privileged_Authentication, Authentication.is_not_Privileged_Authentication, Authentication.Default_Authentication.is_Failed_Default_Authentication, Authentication.Default_Authentication.is_not_Failed_Default_Authentication, Authentication.Default_Authentication.is_Successful_Default_Authentication, Authentication.Default_Authentication.is_not_Successful_Default_Authentication, Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication ]']
Audit:[timestamp=06-03-2022 17:28:24.195, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654277280_898', has_error_warn=false, fully_completed_search=true, total_run_time=10.20, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277283, api_et=1651598880.000000000, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598880.000000000, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_startup_time="211", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]']
Audit:[timestamp=06-03-2022 17:28:24.193, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654277280_897', has_error_warn=false, fully_completed_search=true, total_run_time=11.25, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654277283, api_et=1651598880.000000000, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598880.000000000, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_startup_time="614", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]']
Audit:[timestamp=06-03-2022 17:28:24.191, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277280.606695', has_error_warn=false, fully_completed_search=true, total_run_time=10.04, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277280, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="61", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_system_nobody_66a19ed50bd9f086", app="system", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t maintain="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem,1651598879;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint,1651598879;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes,1651598879;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry,1651598879;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services,1651598879;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution,1646328479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions,1646328479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic,1646328479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance,1651598879;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web,1646328479;" summaryprefix="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA"']
Audit:[timestamp=06-03-2022 17:28:24.188, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277280_896_1654277282.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.64, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654277282, api_et=N/A, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="", search_startup_time="87", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:28:24.186, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277280.606694', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277280, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="53", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_system_nobody_e0254f7bbfd92aa3", app="system", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize maintain="%22SUMMARY_ID%22%2C%22EARLIEST_TIME%22%2C%22REMOTE_SEARCH%22%2C%22NORM_SUMMARY_ID%22%2C%22NORM_REMOTE_SEARCH%22%0A%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548%22%2C1651536000%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20lookup%20%20aws_unauthorized_errorCodes%20errorCode%20OUTPUT%20Unauthorized%20%20%7C%20addinfo%20%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20%20keepcolorder%3Dt%20%22%22Unauthorized%22%22%20%22%22aws_account_id%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%22%22sourceIPAddress%22%22%20%22%22userName%22%22%20%7C%20prestats%20%20count%20count%28Unauthorized%29%20count%28eval%28errorCode%21%3D%22%22success%22%22%29%29%20AS%20_psef0%20by%20aws_account_id%20eventName%20region%20sourceIPAddress%20userName%22%2C%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb26032d7500783b0%22%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20lookup%20aws_unauthorized_errorCodes%20errorCode%20OUTPUT%20Unauthorized%20%7C%20addinfo%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20keepcolorder%3Dt%20%22%22Unauthorized%22%22%20%22%22aws_account_id%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%22%22sourceIPAddress%22%22%20%22%22userName%22%22%20%7C%20prestats%20count%20count%28Unauthorized%29%20count%28eval%28errorCode%21%3D%22%22success%22%22%29%29%20AS%20_psef0%20by%20aws_account_id%20eventName%20region%20sourceIPAddress%20userName%22%0A%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71%22%2C1651536000%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20lookup%20%20aws_unauthorized_errorCodes%20errorCode%20OUTPUT%20Unauthorized%20%20%7C%20addinfo%20%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20%20keepcolorder%3Dt%20%22%22Unauthorized%22%22%20%22%22_time%22%22%20%22%22aws_account_id%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%22%22sourceIPAddress%22%22%20%22%22userName%22%22%20%7C%20prestats%20%20count%20count%28Unauthorized%29%20count%28eval%28errorCode%21%3D%22%22success%22%22%29%29%20AS%20_psef0%20by%20_time%20aws_account_id%20eventName%20region%20sourceIPAddress%20userName%22%2C%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb635087639505149%22%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20lookup%20aws_unauthorized_errorCodes%20errorCode%20OUTPUT%20Unauthorized%20%7C%20addinfo%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20keepcolorder%3Dt%20%22%22Unauthorized%22%22%20%22%22_time%22%22%20%22%22aws_account_id%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%22%22sourceIPAddress%22%22%20%22%22userName%22%22%20%7C%20prestats%20count%20count%28Unauthorized%29%20count%28eval%28errorCode%21%3D%22%22success%22%22%29%29%20AS%20_psef0%20by%20_time%20aws_account_id%20eventName%20region%20sourceIPAddress%20userName%22%0A%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39%22%2C1651536000%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20eval%20%20day%3Dstrftime%28_time%2C%20%22%22%25Y-%25m-%25d%20%25z%22%22%29%20%20%7C%20addinfo%20%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20%20keepcolorder%3Dt%20%22%22aws_account_id%22%22%20%22%22day%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%7C%20prestats%20%20count%20by%20aws_account_id%20day%20errorCode%20eventName%20region%22%2C%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NS44dad4abfd2e365a%22%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20eval%20day%3Dstrftime%28_time%2C%20%22%22%25Y-%25m-%25d%20%25z%22%22%29%20%7C%20addinfo%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20keepcolorder%3Dt%20%22%22aws_account_id%22%22%20%22%22day%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%7C%20prestats%20count%20by%20aws_account_id%20day%20errorCode%20eventName%20region%22%0A" summaryprefix="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA"']
Audit:[timestamp=06-03-2022 17:28:24.183, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654277280_899', has_error_warn=false, fully_completed_search=true, total_run_time=10.24, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277284, api_et=N/A, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_startup_time="215", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]']
Audit:[timestamp=06-03-2022 17:28:24.182, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654277280_891', has_error_warn=false, fully_completed_search=true, total_run_time=2.01, event_count=0, result_count=98, available_count=0, scan_count=0, drop_count=0, exec_time=1654277282, api_et=1622741280.000000000, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741280.000000000, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_startup_time="928", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]']
Audit:[timestamp=06-03-2022 17:28:24.181, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277280_896_1654277283.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.16, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654277283, api_et=N/A, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:28:24.179, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654277280_900', has_error_warn=false, fully_completed_search=true, total_run_time=10.83, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277285, api_et=1622741280.000000000, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741280.000000000, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_startup_time="943", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis", app="SA-NetworkProtection", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]']
Audit:[timestamp=06-03-2022 17:28:24.178, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277283.606696', has_error_warn=false, fully_completed_search=true, total_run_time=10.34, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277283, api_et=1651598883.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651598883.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Processes normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:28:24.176, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277286.606697', has_error_warn=false, fully_completed_search=true, total_run_time=10.82, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277286, api_et=1622741286.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622741286.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="603", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis", app="SA-NetworkProtection", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_SA-NetworkProtection_Domain_Analysis normid= [ search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:28:24.175, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654277280_894', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277282, api_et=1651598880.000000000, api_lt=1654277280.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598880.000000000, search_lt=1654277280.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]']
Audit:[timestamp=06-03-2022 17:28:06.719, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277286.606697', search='summarize tstats=t action=probe id=DM_SA-NetworkProtection_Domain_Analysis normid= [ search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:28:06 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="SA-NetworkProtection", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:05.513, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654277280_900', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:28:00 2021', apiEndTime='Fri Jun  3 17:28:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:04.498, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654277280_899', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:28:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:03.479, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654277280_898', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:28:00 2022', apiEndTime='Fri Jun  3 17:28:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:03.463, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654277280_897', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:28:00 2022', apiEndTime='Fri Jun  3 17:28:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:03.095, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277283.606696', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Processes normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:28:03 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:02.448, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277280_896', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:28:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:02.435, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654277280_895', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:28:00 2022', apiEndTime='Fri Jun  3 17:28:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:02.426, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654277280_894', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:28:00 2022', apiEndTime='Fri Jun  3 17:28:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:02.419, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654277280_893', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:28:00 2022', apiEndTime='Fri Jun  3 17:28:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:02.413, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654277280_892', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Aut (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:28:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:02.406, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654277280_891', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:28:00 2021', apiEndTime='Fri Jun  3 17:28:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:00.252, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277280.606695', search='summarize tstats=t maintain="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem,1651598879;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint,1651598879;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes,1651598879;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry,1651598879;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services,1651598879;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution,1646328479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions,1646328479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic,1646328479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance,1651598879;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities,1622741279;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web,1646328479;" summaryprefix="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA"', autojoin='1', buckets=0, ttl=30, max_count=10000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="system", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:28:00.230, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277280.606694', search='summarize maintain="%22SUMMARY_ID%22%2C%22EARLIEST_TIME%22%2C%22REMOTE_SEARCH%22%2C%22NORM_SUMMARY_ID%22%2C%22NORM_REMOTE_SEARCH%22%0A%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548%22%2C1651536000%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20lookup%20%20aws_unauthorized_errorCodes%20errorCode%20OUTPUT%20Unauthorized%20%20%7C%20addinfo%20%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20%20keepcolorder%3Dt%20%22%22Unauthorized%22%22%20%22%22aws_account_id%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%22%22sourceIPAddress%22%22%20%22%22userName%22%22%20%7C%20prestats%20%20count%20count%28Unauthorized%29%20count%28eval%28errorCode%21%3D%22%22success%22%22%29%29%20AS%20_psef0%20by%20aws_account_id%20eventName%20region%20sourceIPAddress%20userName%22%2C%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb26032d7500783b0%22%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20lookup%20aws_unauthorized_errorCodes%20errorCode%20OUTPUT%20Unauthorized%20%7C%20addinfo%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20keepcolorder%3Dt%20%22%22Unauthorized%22%22%20%22%22aws_account_id%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%22%22sourceIPAddress%22%22%20%22%22userName%22%22%20%7C%20prestats%20count%20count%28Unauthorized%29%20count%28eval%28errorCode%21%3D%22%22success%22%22%29%29%20AS%20_psef0%20by%20aws_account_id%20eventName%20region%20sourceIPAddress%20userName%22%0A%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71%22%2C1651536000%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28% (truncated)', autojoin='1', buckets=0, ttl=30, max_count=10000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="system", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:27:54.171, user=u001@tshirt.com, action=search, info=completed, search_id='1654277262.606693', has_error_warn=false, fully_completed_search=true, total_run_time=7.31, event_count=7734, result_count=7734, available_count=7734, scan_count=40747, drop_count=0, exec_time=1654277262, api_et=1654189200.000000000, api_lt=1654277262.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654189200.000000000, search_lt=1654277262.000000000, is_realtime=0, savedsearch_name="", search_startup_time="491", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_search_u001@tshirt.com_a2cf53eba15c8143", app="search", provenance="UI:Search", mode="historical", is_proxied=false, searched_buckets=2, eliminated_buckets=0, considered_events=40747, total_slices=20954, decompressed_slices=1533, duration.command.search.index=138, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=290, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, sourcetype_count__audittrail=40202, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| from datamodel:Tshirt_Audit.Search_Activity | where user!="" AND total_run_time>1']
Audit:[timestamp=06-03-2022 17:27:54.167, user=u001@tshirt.com, action=search, info=completed, search_id='1654277253.606679', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=20, available_count=0, scan_count=0, drop_count=0, exec_time=1654277253, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="129", is_prjob=false, app="search", provenance="UI:Search", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| history | search NOT search="| history*" AND NOT search="*metadata*" AND NOT search="*loadjob*" AND NOT savedsearch_name="*" AND NOT search="search" AND NOT search="*from sid*" AND NOT search="| delete summarize=false index=* index=_**" AND NOT provenance="UI:LocateData" AND NOT provenance="UI:TableEditor" AND NOT provenance="UI:DataModel" AND NOT provenance="UI:Pivot" AND NOT provenance="UI:Dataset" | dedup search | head 100000']
Audit:[timestamp=06-03-2022 17:27:54.160, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277220_890', has_error_warn=false, fully_completed_search=true, total_run_time=10.05, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277262, api_et=1654273020.000000000, api_lt=1654276620.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273020.000000000, search_lt=1654276620.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:27:42.810, user=u001@tshirt.com, action=search, info=granted , search_id='1654277262.606693', search='| from datamodel:Tshirt_Audit.Search_Activity | where user!="" AND total_run_time>1', autojoin='1', buckets=300, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*', apiStartTime='Thu Jun  2 17:00:00 2022', apiEndTime='Fri Jun  3 17:27:42 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="search", provenance="UI:Search", mode="historical"]
Audit:[timestamp=06-03-2022 17:27:42.495, user=u001@tshirt.com, action=search, info=cancel, search_id='rt_md_1654277251.606677']
Audit:[timestamp=06-03-2022 17:27:41.886, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277220_890', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:17:00 2022', apiEndTime='Fri Jun  3 17:17:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:27:33.533, user=u001@tshirt.com, action=search, info=granted , search_id='1654277253.606679', search='| history | search NOT search="| history*" AND NOT search="*metadata*" AND NOT search="*loadjob*" AND NOT savedsearch_name="*" AND NOT search="search" AND NOT search="*from sid*" AND NOT search="| delete summarize=false index=* index=_**" AND NOT provenance="UI:LocateData" AND NOT provenance="UI:TableEditor" AND NOT provenance="UI:DataModel" AND NOT provenance="UI:Pivot" AND NOT provenance="UI:Dataset" | dedup search | head 100000', autojoin='1', buckets=300, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="search", provenance="UI:Search", mode="historical"]
Audit:[timestamp=06-03-2022 17:27:31.028, user=u001@tshirt.com, action=search, info=granted , search_id='rt_md_1654277251.606677', search='| metadata type=sourcetypes | search totalCount > 0', autojoin='1', buckets=300, ttl=600, max_count=100000, maxtime=0, enable_lookups='1', extra_fields='*', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="search", provenance="UI:Search", mode="RT_indexed"]
Audit:[timestamp=06-03-2022 17:27:24.185, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277220_889_1654277223.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.58, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654277223, api_et=N/A, api_lt=1654277220.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277220.000000000, is_realtime=0, savedsearch_name="", search_startup_time="61", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:27:24.184, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277230.606676', has_error_warn=false, fully_completed_search=true, total_run_time=1.48, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277230, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="896", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Change normid= [ search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename dest_bunit AS All_Changes.dest_bunit dest_category AS All_Changes.dest_category dest_priority AS All_Changes.dest_priority src_bunit AS All_Changes.src_bunit src_category AS All_Changes.src_category src_priority AS All_Changes.src_priority tag AS All_Changes.tag user_agent AS All_Changes.user_agent user_bunit AS All_Changes.user_bunit user_category AS All_Changes.user_category user_priority AS All_Changes.user_priority user_type AS All_Changes.user_type vendor_account AS All_Changes.vendor_account vendor_region AS All_Changes.vendor_region change_type AS All_Changes.change_type command AS All_Changes.command dest AS All_Changes.dest dvc AS All_Changes.dvc object AS All_Changes.object object_attrs AS All_Changes.object_attrs object_category AS All_Changes.object_category object_id AS All_Changes.object_id object_path AS All_Changes.object_path status AS All_Changes.status result AS All_Changes.result result_id AS All_Changes.result_id src AS All_Changes.src user AS All_Changes.user user_name AS All_Changes.user_name vendor_product AS All_Changes.vendor_product action AS All_Changes.action is_Auditing_Changes AS All_Changes.is_Auditing_Changes is_not_Auditing_Changes AS All_Changes.is_not_Auditing_Changes is_Endpoint_Changes AS All_Changes.is_Endpoint_Changes is_not_Endpoint_Changes AS All_Changes.is_not_Endpoint_Changes is_Network_Changes AS All_Changes.is_Network_Changes is_not_Network_Changes AS All_Changes.is_not_Network_Changes is_Account_Management AS All_Changes.is_Account_Management is_not_Account_Management AS All_Changes.is_not_Account_Management is_Instance_Changes AS All_Changes.is_Instance_Changes is_not_Instance_Changes AS All_Changes.is_not_Instance_Changes | fields nodename, _time, host, source, sourcetype, All_Changes.dest_bunit, All_Changes.dest_category, All_Changes.dest_priority, All_Changes.src_bunit, All_Changes.src_category, All_Changes.src_priority, All_Changes.tag, All_Changes.user_agent, All_Changes.user_bunit, All_Changes.user_category, All_Changes.user_priority, All_Changes.user_type, All_Changes.vendor_account, All_Changes.vendor_region, All_Changes.change_type, All_Changes.command, All_Changes.dest, All_Changes.dvc, All_Changes.object, All_Changes.object_attrs, All_Changes.object_category, All_Changes.object_id, All_Changes.object_path, All_Changes.status, All_Changes.result, All_Changes.result_id, All_Changes.src, All_Changes.user, All_Changes.user_name, All_Changes.vendor_product, All_Changes.action, All_Changes.is_Auditing_Changes, All_Changes.is_not_Auditing_Changes, All_Changes.is_Endpoint_Changes, All_Changes.is_not_Endpoint_Changes, All_Changes.is_Network_Changes, All_Changes.is_not_Network_Changes, All_Changes.is_Account_Management, All_Changes.is_not_Account_Management, All_Changes.is_Instance_Changes, All_Changes.is_not_Instance_Changes, All_Changes.Endpoint_Changes.is_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes, All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes, All_Changes.Network_Changes.dest_ip_range, All_Changes.Network_Changes.dest_port_range, All_Changes.Network_Changes.direction, All_Changes.Network_Changes.protocol, All_Changes.Network_Changes.rule_action, All_Changes.Network_Changes.src_ip_range, All_Changes.Network_Changes.src_port_range, All_Changes.Network_Changes.is_Device_Restarts, All_Changes.Network_Changes.is_not_Device_Restarts, All_Changes.Account_Management.src_user_bunit, All_Changes.Account_Management.src_user_category, All_Changes.Account_Management.src_user_priority, All_Changes.Account_Management.src_user_type, All_Changes.Account_Management.dest_nt_domain, All_Changes.Account_Management.src_nt_domain, All_Changes.Account_Management.src_user, All_Changes.Account_Management.src_user_name, All_Changes.Account_Management.is_Accounts_Created, All_Changes.Account_Management.is_not_Accounts_Created, All_Changes.Account_Management.is_Accounts_Deleted, All_Changes.Account_Management.is_not_Accounts_Deleted, All_Changes.Account_Management.is_Account_Lockouts, All_Changes.Account_Management.is_not_Account_Lockouts, All_Changes.Account_Management.is_Accounts_Updated, All_Changes.Account_Management.is_not_Accounts_Updated, All_Changes.Instance_Changes.image_id, All_Changes.Instance_Changes.instance_type]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:27:24.182, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277223.606675', has_error_warn=false, fully_completed_search=true, total_run_time=10.44, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277223, api_et=1646328423.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1646328423.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="527", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Resolution normid= [ search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:27:24.180, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277220_889_1654277224.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277224, api_et=N/A, api_lt=1654277220.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277220.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:27:24.176, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654277220_886', has_error_warn=false, fully_completed_search=true, total_run_time=10.32, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277222, api_et=1622741220.000000000, api_lt=1654277220.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741220.000000000, search_lt=1654277220.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]']
Audit:[timestamp=06-03-2022 17:27:24.175, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277220_889_1654277223.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.14, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654277223, api_et=N/A, api_lt=1654277220.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277220.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:27:24.172, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654277220_885', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277222, api_et=1646328420.000000000, api_lt=1654277220.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646328420.000000000, search_lt=1654277220.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]']
Audit:[timestamp=06-03-2022 17:27:24.169, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654277220_888', has_error_warn=false, fully_completed_search=true, total_run_time=10.31, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277223, api_et=1646328420.000000000, api_lt=1654277220.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646328420.000000000, search_lt=1654277220.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]']
Audit:[timestamp=06-03-2022 17:27:24.167, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654277220_887', has_error_warn=false, fully_completed_search=true, total_run_time=7.73, event_count=491, result_count=99, available_count=0, scan_count=866, drop_count=0, exec_time=1654277223, api_et=N/A, api_lt=1654277220.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277220.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_startup_time="1482", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename dest_bunit AS All_Changes.dest_bunit dest_category AS All_Changes.dest_category dest_priority AS All_Changes.dest_priority src_bunit AS All_Changes.src_bunit src_category AS All_Changes.src_category src_priority AS All_Changes.src_priority tag AS All_Changes.tag user_agent AS All_Changes.user_agent user_bunit AS All_Changes.user_bunit user_category AS All_Changes.user_category user_priority AS All_Changes.user_priority user_type AS All_Changes.user_type vendor_account AS All_Changes.vendor_account vendor_region AS All_Changes.vendor_region change_type AS All_Changes.change_type command AS All_Changes.command dest AS All_Changes.dest dvc AS All_Changes.dvc object AS All_Changes.object object_attrs AS All_Changes.object_attrs object_category AS All_Changes.object_category object_id AS All_Changes.object_id object_path AS All_Changes.object_path status AS All_Changes.status result AS All_Changes.result result_id AS All_Changes.result_id src AS All_Changes.src user AS All_Changes.user user_name AS All_Changes.user_name vendor_product AS All_Changes.vendor_product action AS All_Changes.action is_Auditing_Changes AS All_Changes.is_Auditing_Changes is_not_Auditing_Changes AS All_Changes.is_not_Auditing_Changes is_Endpoint_Changes AS All_Changes.is_Endpoint_Changes is_not_Endpoint_Changes AS All_Changes.is_not_Endpoint_Changes is_Network_Changes AS All_Changes.is_Network_Changes is_not_Network_Changes AS All_Changes.is_not_Network_Changes is_Account_Management AS All_Changes.is_Account_Management is_not_Account_Management AS All_Changes.is_not_Account_Management is_Instance_Changes AS All_Changes.is_Instance_Changes is_not_Instance_Changes AS All_Changes.is_not_Instance_Changes | fields nodename, _time, host, source, sourcetype, All_Changes.dest_bunit, All_Changes.dest_category, All_Changes.dest_priority, All_Changes.src_bunit, All_Changes.src_category, All_Changes.src_priority, All_Changes.tag, All_Changes.user_agent, All_Changes.user_bunit, All_Changes.user_category, All_Changes.user_priority, All_Changes.user_type, All_Changes.vendor_account, All_Changes.vendor_region, All_Changes.change_type, All_Changes.command, All_Changes.dest, All_Changes.dvc, All_Changes.object, All_Changes.object_attrs, All_Changes.object_category, All_Changes.object_id, All_Changes.object_path, All_Changes.status, All_Changes.result, All_Changes.result_id, All_Changes.src, All_Changes.user, All_Changes.user_name, All_Changes.vendor_product, All_Changes.action, All_Changes.is_Auditing_Changes, All_Changes.is_not_Auditing_Changes, All_Changes.is_Endpoint_Changes, All_Changes.is_not_Endpoint_Changes, All_Changes.is_Network_Changes, All_Changes.is_not_Network_Changes, All_Changes.is_Account_Management, All_Changes.is_not_Account_Management, All_Changes.is_Instance_Changes, All_Changes.is_not_Instance_Changes, All_Changes.Endpoint_Changes.is_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes, All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes, All_Changes.Network_Changes.dest_ip_range, All_Changes.Network_Changes.dest_port_range, All_Changes.Network_Changes.direction, All_Changes.Network_Changes.protocol, All_Changes.Network_Changes.rule_action, All_Changes.Network_Changes.src_ip_range, All_Changes.Network_Changes.src_port_range, All_Changes.Network_Changes.is_Device_Restarts, All_Changes.Network_Changes.is_not_Device_Restarts, All_Changes.Account_Management.src_user_bunit, All_Changes.Account_Management.src_user_category, All_Changes.Account_Management.src_user_priority, All_Changes.Account_Management.src_user_type, All_Changes.Account_Management.dest_nt_domain, All_Changes.Account_Management.src_nt_domain, All_Changes.Account_Management.src_user, All_Changes.Account_Management.src_user_name, All_Changes.Account_Management.is_Accounts_Created, All_Changes.Account_Management.is_not_Accounts_Created, All_Changes.Account_Management.is_Accounts_Deleted, All_Changes.Account_Management.is_not_Accounts_Deleted, All_Changes.Account_Management.is_Account_Lockouts, All_Changes.Account_Management.is_not_Account_Lockouts, All_Changes.Account_Management.is_Accounts_Updated, All_Changes.Account_Management.is_not_Accounts_Updated, All_Changes.Instance_Changes.image_id, All_Changes.Instance_Changes.instance_type ]']
Audit:[timestamp=06-03-2022 17:27:24.162, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277220_889', has_error_warn=false, fully_completed_search=true, total_run_time=14.54, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277223, api_et=N/A, api_lt=1654277220.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277220.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1473", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:27:10.846, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277230.606676', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Change normid= [ search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename des (truncated)', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:27:03.272, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277223.606675', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Resolution normid= [ search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Mar  3 17:27:03 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:27:02.644, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277220_889', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:27:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:27:02.634, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654277220_888', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:27:00 2022', apiEndTime='Fri Jun  3 17:27:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:27:02.625, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654277220_887', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_typ (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:27:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:27:02.620, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654277220_886', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:27:00 2021', apiEndTime='Fri Jun  3 17:27:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:27:02.607, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654277220_885', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:27:00 2022', apiEndTime='Fri Jun  3 17:27:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:26:54.162, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277160_884', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277202, api_et=1654272960.000000000, api_lt=1654276560.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272960.000000000, search_lt=1654276560.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:26:42.136, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277160_884', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:16:00 2022', apiEndTime='Fri Jun  3 17:16:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:26:24.185, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277160_883_1654277162.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.62, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654277162, api_et=N/A, api_lt=1654277160.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277160.000000000, is_realtime=0, savedsearch_name="", search_startup_time="66", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:26:24.182, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654277160_880', has_error_warn=false, fully_completed_search=true, total_run_time=1.83, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654277162, api_et=1646328360.000000000, api_lt=1654277160.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646328360.000000000, search_lt=1654277160.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_startup_time="1194", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]']
Audit:[timestamp=06-03-2022 17:26:24.173, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654277160_882', has_error_warn=false, fully_completed_search=true, total_run_time=10.30, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277162, api_et=1622741160.000000000, api_lt=1654277160.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741160.000000000, search_lt=1654277160.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]']
Audit:[timestamp=06-03-2022 17:26:24.170, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277160_883', has_error_warn=false, fully_completed_search=true, total_run_time=14.19, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277162, api_et=N/A, api_lt=1654277160.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277160.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1189", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:26:24.167, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654277160_881', has_error_warn=false, fully_completed_search=true, total_run_time=10.30, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277162, api_et=1622741160.000000000, api_lt=1654277160.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741160.000000000, search_lt=1654277160.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]']
Audit:[timestamp=06-03-2022 17:26:24.164, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277160_883_1654277162.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.14, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654277162, api_et=N/A, api_lt=1654277160.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277160.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:26:24.163, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277160_883_1654277163.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277163, api_et=N/A, api_lt=1654277160.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277160.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:26:24.161, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277164.606665', has_error_warn=false, fully_completed_search=true, total_run_time=1.51, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277164, api_et=1646328364.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1646328364.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="835", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Traffic normid= [ search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:26:04.055, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277164.606665', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Traffic normid= [ search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Mar  3 17:26:04 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:26:01.899, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277160_883', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:26:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:26:01.890, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654277160_882', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:26:00 2021', apiEndTime='Fri Jun  3 17:26:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:26:01.882, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654277160_881', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:26:00 2021', apiEndTime='Fri Jun  3 17:26:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:26:01.846, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654277160_880', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:26:00 2022', apiEndTime='Fri Jun  3 17:26:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:54.166, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277100_879', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277141, api_et=1654272900.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272900.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:25:41.266, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277100_879', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:15:00 2022', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:24.200, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654277100_875', has_error_warn=false, fully_completed_search=true, total_run_time=10.87, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277103, api_et=1654190100.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654190100.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_d34d6d33ee94d419", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`']
Audit:[timestamp=06-03-2022 17:25:24.199, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654277100_876', has_error_warn=false, fully_completed_search=true, total_run_time=10.88, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277104, api_et=N/A, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_startup_time="748", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence", app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]']
Audit:[timestamp=06-03-2022 17:25:24.198, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654277100_878', has_error_warn=false, fully_completed_search=true, total_run_time=10.76, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277106, api_et=N/A, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_startup_time="620", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]']
Audit:[timestamp=06-03-2022 17:25:24.197, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654277100_869', has_error_warn=false, fully_completed_search=true, total_run_time=11.03, event_count=0, result_count=7, available_count=0, scan_count=0, drop_count=0, exec_time=1654277103, api_et=1622741100.000000000, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741100.000000000, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_startup_time="1274", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]']
Audit:[timestamp=06-03-2022 17:25:24.195, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD52294eb1271769f26_1654277100.606646', has_error_warn=false, fully_completed_search=true, total_run_time=4.31, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277100, api_et=1654274700.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274700.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="threatmatch://domain", search_startup_time="4389", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_a4120517bfc25ed2", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_email_domain"
    | `truncate_domain_dedup(All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_issuer_email_domain_truncated)`
    | lookup "threatintel_by_domain" value as "All_Certificates.SSL.ssl_issuer_email_domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Certificates.SSL.ssl_issuer_email_domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_email_domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_email_domain"
    | `truncate_domain_dedup(All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_subject_email_domain_truncated)`
    | lookup "threatintel_by_domain" value as "All_Certificates.SSL.ssl_subject_email_domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Certificates.SSL.ssl_subject_email_domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_email_domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype") from datamodel="Domain_Analysis"."All_Domains" by "All_Domains.domain"
    | `truncate_domain_dedup(All_Domains.domain, All_Domains.domain_truncated)`
    | lookup "threatintel_by_domain" value as "All_Domains.domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Domains.domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Domains.domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype") from datamodel="Domain_Analysis"."All_Domains" by "All_Domains.resolved_domain"
    | `truncate_domain_dedup(All_Domains.resolved_domain, All_Domains.resolved_domain_truncated)`
    | lookup "threatintel_by_domain" value as "All_Domains.resolved_domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Domains.resolved_domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Domains.resolved_domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.src_user_domain"
    | `truncate_domain_dedup(All_Email.src_user_domain, All_Email.src_user_domain_truncated)`
    | lookup "threatintel_by_domain" value as "All_Email.src_user_domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Email.src_user_domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.src_user_domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.recipient_domain"
    | `truncate_domain_dedup(All_Email.recipient_domain, All_Email.recipient_domain_truncated)`
    | lookup "threatintel_by_domain" value as "All_Email.recipient_domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Email.recipient_domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.recipient_domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest"),values("Web.user") from datamodel="Web"."Web" by "Web.http_referrer_domain"
    | `truncate_domain_dedup(Web.http_referrer_domain, Web.http_referrer_domain_truncated)`
    | lookup "threatintel_by_domain" value as "Web.http_referrer_domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "Web.http_referrer_domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.dest,dest)`
    | `sistats_values_rename(Web.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.http_referrer_domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest"),values("Web.user") from datamodel="Web"."Web" by "Web.url_domain"
    | `truncate_domain_dedup(Web.url_domain, Web.url_domain_truncated)`
    | lookup "threatintel_by_domain" value as "Web.url_domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "Web.url_domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.dest,dest)`
    | `sistats_values_rename(Web.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.url_domain','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://domain"']
Audit:[timestamp=06-03-2022 17:25:24.193, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654277100_867', has_error_warn=false, fully_completed_search=true, total_run_time=5.80, event_count=35, result_count=3, available_count=0, scan_count=35, drop_count=0, exec_time=1654277103, api_et=1622741100.000000000, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741100.000000000, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_startup_time="1037", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]']
Audit:[timestamp=06-03-2022 17:25:24.189, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277101.606649', has_error_warn=false, fully_completed_search=true, total_run_time=1.03, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277101, api_et=1651598701.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651598701.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="773", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Filesystem normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product] | eval backfill_start_time = relative_time(now(), "-1mon") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:25:24.188, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277100_873_1654277103.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.96, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654277103, api_et=N/A, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="", search_startup_time="89", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:25:24.183, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654277100_866', has_error_warn=false, fully_completed_search=true, total_run_time=10.41, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277103, api_et=1622741100.000000000, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741100.000000000, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_startup_time="709", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]']
Audit:[timestamp=06-03-2022 17:25:24.182, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654277100_877', has_error_warn=false, fully_completed_search=true, total_run_time=10.88, event_count=5, result_count=3, available_count=0, scan_count=5, drop_count=0, exec_time=1654277106, api_et=N/A, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_startup_time="731", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]']
Audit:[timestamp=06-03-2022 17:25:24.180, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD56997a89005f6ba62_at_1654277100_871', has_error_warn=false, fully_completed_search=true, total_run_time=1.20, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277103, api_et=1654275300.000000000, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654275300.000000000, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="Network - IDS Category Tracker - Lookup Gen", search_startup_time="1595", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-NetworkProtection_admin_1792d24b7bd8cf59", app="SA-NetworkProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Intrusion_Detection"."IDS_Attacks" where "IDS_Attacks.category"!="unknown" by "IDS_Attacks.category","IDS_Attacks.vendor_product" | rename "IDS_Attacks.category" as "category","IDS_Attacks.vendor_product" as "vendor_product" | inputlookup append=T "ids_category_tracker" | stats min("firstTime") as "firstTime",max("lastTime") as "lastTime" by "category","vendor_product" | runshellscript override_if_empty=false "ids_category_tracker" | stats count']
Audit:[timestamp=06-03-2022 17:25:24.178, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654277100_868', has_error_warn=false, fully_completed_search=true, total_run_time=11.25, event_count=144, result_count=18, available_count=0, scan_count=501, drop_count=0, exec_time=1654277103, api_et=1622741100.000000000, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741100.000000000, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_startup_time="1201", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]']
Audit:[timestamp=06-03-2022 17:25:24.177, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277104.606652', has_error_warn=false, fully_completed_search=true, total_run_time=1.14, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277104, api_et=1646328304.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1646328304.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="926", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Web normid= [ search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code] | eval backfill_start_time = relative_time(now(), "-3mon") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:25:24.174, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277100_873_1654277104.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.19, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654277104, api_et=N/A, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="", search_startup_time="10", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:25:24.172, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5309c22a3c6331c06_1654277100.606648', has_error_warn=false, fully_completed_search=true, total_run_time=1.04, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277100, api_et=1654274700.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274700.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="threatmatch://process", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_04d1f05fbc2794ce", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Processes.dest"),values("Processes.user") from datamodel="Endpoint"."Processes" by "Processes.process_name"
    | lookup "threatintel_by_process" value as "Processes.process_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_process_wildcard" value as "Processes.process_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Processes.dest,dest)`
    | `sistats_values_rename(Processes.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"process",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Processes.process_name','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://process"']
Audit:[timestamp=06-03-2022 17:25:24.171, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654277100_872', has_error_warn=false, fully_completed_search=true, total_run_time=3.50, event_count=2905, result_count=1, available_count=0, scan_count=2905, drop_count=0, exec_time=1654277103, api_et=1654102800.000000000, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654102800.000000000, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="ESS - Notable Events", search_startup_time="2892", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_87db9bb7a232c62f", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=1, eliminated_buckets=0, considered_events=2905, total_slices=121, decompressed_slices=10, duration.command.search.index=1, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=134, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, sourcetype_count__stash=2905, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count']
Audit:[timestamp=06-03-2022 17:25:24.168, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5284e2b254ff0a39b_1654277100.606647', has_error_warn=false, fully_completed_search=true, total_run_time=1.78, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277100, api_et=1654274700.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274700.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="threatmatch://url", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_197a8104c8a91ebf", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest"),values("Web.user") from datamodel="Web"."Web" by "Web.http_referrer"
    | lookup "threatintel_by_url" value as "Web.http_referrer" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_url_wildcard" value as "Web.http_referrer" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.dest,dest)`
    | `sistats_values_rename(Web.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"url",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.http_referrer','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest"),values("Web.user") from datamodel="Web"."Web" by "Web.url"
    | lookup "threatintel_by_url" value as "Web.url" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_url_wildcard" value as "Web.url" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.dest,dest)`
    | `sistats_values_rename(Web.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"url",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.url','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://url"']
Audit:[timestamp=06-03-2022 17:25:24.166, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277100_873', has_error_warn=false, fully_completed_search=true, total_run_time=14.89, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277103, api_et=N/A, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="2188", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:25:24.163, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD518c082502f8d3a8b_at_1654277100_874', has_error_warn=true, fully_completed_search=true, total_run_time=1.15, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277103, api_et=1654272900.000000000, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272900.000000000, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="Network - IDS Attack Tracker - Lookup Gen", search_startup_time="1548", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-NetworkProtection_admin_94a87792ed651c88", app="SA-NetworkProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Intrusion_Detection"."IDS_Attacks" by "IDS_Attacks.ids_type","IDS_Attacks.signature","IDS_Attacks.vendor_product" | rename "IDS_Attacks.ids_type" as "ids_type","IDS_Attacks.signature" as "signature","IDS_Attacks.vendor_product" as "vendor_product" | eval _key=sha1('ids_type'.'signature'.'vendor_product') | dedup _key | lookup "ids_attack_tracker" "_key" OUTPUTNEW "firstTime" as "lookup_firstTime","lastTime" as "lookup_lastTime" | eval "firstTime"=min('firstTime','lookup_firstTime'),"lastTime"=max('lastTime','lookup_lastTime') | fields - "lookup_firstTime","lookup_lastTime" | runshellscript append=T key_field=_key "ids_attack_tracker" | stats count']
Audit:[timestamp=06-03-2022 17:25:24.162, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277100_873_1654277105.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277105, api_et=N/A, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:25:24.161, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654277100_870', has_error_warn=false, fully_completed_search=true, total_run_time=1.96, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654277103, api_et=1646328300.000000000, api_lt=1654277100.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646328300.000000000, search_lt=1654277100.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_startup_time="1292", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]']
Audit:[timestamp=06-03-2022 17:25:06.022, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654277100_878', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:25:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:05.999, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654277100_877', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:25:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:04.120, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277104.606652', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Web normid= [ search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code] | eval backfill_start_time = relative_time(now(), "-3mon") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Mar  3 17:25:04 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:03.974, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654277100_876', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:25:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_type=adhoc, is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:02.963, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654277100_875', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,mitre_tactic_id_count,mitre_technique_id_count,prestats_reserved_*,psrsvd_*,risk_object,risk_object_type,source_count', apiStartTime='Thu Jun  2 17:15:00 2022', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:02.950, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD518c082502f8d3a8b_at_1654277100_874', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Intrusion_Detection"."IDS_Attacks" by "IDS_Attacks.ids_type","IDS_Attacks.signature","IDS_Attacks.vendor_product" | rename "IDS_Attacks.ids_type" as "ids_type","IDS_Attacks.signature" as "signature","IDS_Attacks.vendor_product" as "vendor_product" | eval _key=sha1('ids_type'.'signature'.'vendor_product') | dedup _key | lookup "ids_attack_tracker" "_key" OUTPUTNEW "firstTime" as "lookup_firstTime","lastTime" as "lookup_lastTime" | eval "firstTime"=min('firstTime','lookup_firstTime'),"lastTime"=max('lastTime','lookup_lastTime') | fields - "lookup_firstTime","lookup_lastTime" | runshellscript append=T key_field=_key "ids_attack_tracker" | stats count', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:15:00 2022', apiEndTime='Fri Jun  3 17:25:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Network - IDS Attack Tracker - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:02.933, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277100_873', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:25:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:02.907, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654277100_872', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Wed Jun  1 17:00:00 2022', apiEndTime='Fri Jun  3 17:25:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESS - Notable Events", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:02.863, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD56997a89005f6ba62_at_1654277100_871', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Intrusion_Detection"."IDS_Attacks" where "IDS_Attacks.category"!="unknown" by "IDS_Attacks.category","IDS_Attacks.vendor_product" | rename "IDS_Attacks.category" as "category","IDS_Attacks.vendor_product" as "vendor_product" | inputlookup append=T "ids_category_tracker" | stats min("firstTime") as "firstTime",max("lastTime") as "lastTime" by "category","vendor_product" | runshellscript override_if_empty=false "ids_category_tracker" | stats count', autojoin='1', buckets=0, ttl=1800, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:55:00 2022', apiEndTime='Fri Jun  3 17:25:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Network - IDS Category Tracker - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:02.852, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654277100_870', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:25:00 2022', apiEndTime='Fri Jun  3 17:25:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:02.841, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654277100_869', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:25:00 2021', apiEndTime='Fri Jun  3 17:25:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:02.835, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654277100_868', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:25:00 2021', apiEndTime='Fri Jun  3 17:25:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:02.826, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654277100_867', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:25:00 2021', apiEndTime='Fri Jun  3 17:25:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:02.815, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654277100_866', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:25:00 2021', apiEndTime='Fri Jun  3 17:25:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:01.143, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277101.606649', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Filesystem normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product] | eval backfill_start_time = relative_time(now(), "-1mon") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:25:01 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:00.700, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5309c22a3c6331c06_1654277100.606648', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Processes.dest"),values("Processes.user") from datamodel="Endpoint"."Processes" by "Processes.process_name"
    | lookup "threatintel_by_process" value as "Processes.process_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_process_wildcard" value as "Processes.process_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Processes.dest,dest)`
    | `sistats_values_rename(Processes.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"process",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Processes.process_name','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://process"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:45:00 2022', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://process", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:00.696, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5284e2b254ff0a39b_1654277100.606647', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest"),values("Web.user") from datamodel="Web"."Web" by "Web.http_referrer"
    | lookup "threatintel_by_url" value as "Web.http_referrer" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_url_wildcard" value as "Web.http_referrer" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.dest,dest)`
    | `sistats_values_rename(Web.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"url",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.http_referrer','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest"),values("Web.user") from datamodel="Web"."Web" by "Web.url"
    | lookup "threatintel_by_url" value as "Web.url" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_url_wildcard" value as "Web.url" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.dest,dest)`
    | `sistats_values_rename(Web.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"url",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.url','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://url"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:45:00 2022', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://url", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:25:00.563, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD52294eb1271769f26_1654277100.606646', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_email_domain"
    | `truncate_domain_dedup(All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_issuer_email_domain_truncated)`
    | lookup "threatintel_by_domain" value as "All_Certificates.SSL.ssl_issuer_email_domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Certificates.SSL.ssl_issuer_email_domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_email_domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_email_domain"
    | `truncate_domain_dedup(All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_subject_email_domain_truncated)`
    | lookup "threatintel_by_domain" value as "All_Certificates.SSL.ssl_subject_email_domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Certificates.SSL.ssl_subject_email_domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_email_domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype") from datamodel="Domain_Analysis"."All_Domains" by "All_Domains.domain"
    | `truncate_domain_dedup(All_Domains.domain, All_Domains.domain_truncated)`
    | lookup "threatintel_by_domain" value as "All_Domains.domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Domains.domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Domains.domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype") from datamodel="Domain_Analysis"."All_Domains" by "All_Domains.resolved_domain"
    | `truncate_domain_dedup(All_Domains.resolved_domain, All_Domains.resolved_domain_truncated)`
    | lookup "threatintel_by_domain" value as "All_Domains.resolved_domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Domains.resolved_domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Domains.resolved_domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.src_user_domain"
    | `truncate_domain_dedup(All_Email.src_user_domain, All_Email.src_user_domain_truncated)`
    | lookup "threatintel_by_domain" value as "All_Email.src_user_domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Email.src_user_domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.src_user_domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.recipient_domain"
    | `truncate_domain_dedup(All_Email.recipient_domain, All_Email.recipient_domain_truncated)`
    | lookup "threatintel_by_domain" value as "All_Email.recipient_domain" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Email.recipient_domain_truncated" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"domain",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.recipient_domain','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest"),values("Web.user") from datamodel="Web"."Web" by "Web.http_referrer_domain"
    | `truncate_domain_dedup(Web.http_referrer_domain, Web.http_referrer_domain_trunca (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:45:00 2022', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://domain", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:24:54.165, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654277040_863', has_error_warn=false, fully_completed_search=true, total_run_time=37.07, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654277042, api_et=1651598640.000000000, api_lt=1654277040.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598640.000000000, search_lt=1654277040.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_startup_time="1207", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]']
Audit:[timestamp=06-03-2022 17:24:54.163, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277040_865', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277082, api_et=1654272840.000000000, api_lt=1654276440.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272840.000000000, search_lt=1654276440.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:24:42.164, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654277040_865', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:14:00 2022', apiEndTime='Fri Jun  3 17:14:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:24:24.176, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654277040_862', has_error_warn=false, fully_completed_search=true, total_run_time=10.31, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277042, api_et=1622741040.000000000, api_lt=1654277040.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622741040.000000000, search_lt=1654277040.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]']
Audit:[timestamp=06-03-2022 17:24:24.175, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277040_864_1654277043.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.14, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654277043, api_et=N/A, api_lt=1654277040.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277040.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:24:24.173, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277040_864_1654277043.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654277043, api_et=N/A, api_lt=1654277040.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277040.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:24:24.170, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277040_864', has_error_warn=false, fully_completed_search=true, total_run_time=14.45, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277042, api_et=N/A, api_lt=1654277040.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277040.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1461", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:24:24.164, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277040_864_1654277042.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.59, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654277042, api_et=N/A, api_lt=1654277040.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654277040.000000000, is_realtime=0, savedsearch_name="", search_startup_time="65", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:24:01.913, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654277040_864', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:24:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:24:01.903, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654277040_863', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:24:00 2022', apiEndTime='Fri Jun  3 17:24:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:24:01.882, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654277040_862', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:24:00 2021', apiEndTime='Fri Jun  3 17:24:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:54.169, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276980_861', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277020, api_et=1654272780.000000000, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272780.000000000, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:23:54.166, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654277021.606630', has_error_warn=false, fully_completed_search=true, total_run_time=10.60, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654277021, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="522", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71", app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb635087639505149 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:23:41.074, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654277021.606630', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb635087639505149 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:40.440, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276980_861', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:13:00 2022', apiEndTime='Fri Jun  3 17:13:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:24.193, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654276980_855', has_error_warn=false, fully_completed_search=true, total_run_time=12.21, event_count=0, result_count=99, available_count=0, scan_count=0, drop_count=0, exec_time=1654276982, api_et=N/A, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_startup_time="1194", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_Successful_Authentication, Authentication.is_not_Successful_Authentication, Authentication.is_Default_Authentication, Authentication.is_not_Default_Authentication, Authentication.is_Insecure_Authentication, Authentication.is_not_Insecure_Authentication, Authentication.is_Privileged_Authentication, Authentication.is_not_Privileged_Authentication, Authentication.Default_Authentication.is_Failed_Default_Authentication, Authentication.Default_Authentication.is_not_Failed_Default_Authentication, Authentication.Default_Authentication.is_Successful_Default_Authentication, Authentication.Default_Authentication.is_not_Successful_Default_Authentication, Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication ]']
Audit:[timestamp=06-03-2022 17:23:24.190, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654276980_854', has_error_warn=false, fully_completed_search=true, total_run_time=11.34, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654276982, api_et=1651598580.000000000, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598580.000000000, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_startup_time="1093", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]']
Audit:[timestamp=06-03-2022 17:23:24.189, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654276980_859', has_error_warn=false, fully_completed_search=true, total_run_time=1.81, event_count=0, result_count=98, available_count=0, scan_count=0, drop_count=0, exec_time=1654276984, api_et=1622740980.000000000, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740980.000000000, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_startup_time="561", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]']
Audit:[timestamp=06-03-2022 17:23:24.187, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276983.606625', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276983, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="349", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Certificates normid= [ search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:23:24.185, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654276980_857', has_error_warn=false, fully_completed_search=true, total_run_time=10.23, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276983, api_et=1651598580.000000000, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598580.000000000, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_startup_time="226", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]']
Audit:[timestamp=06-03-2022 17:23:24.184, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276982.606624', has_error_warn=false, fully_completed_search=true, total_run_time=10.22, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276982, api_et=1651598582.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651598582.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="227", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:23:24.182, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276980_856', has_error_warn=false, fully_completed_search=true, total_run_time=14.21, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276982, api_et=N/A, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1309", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:23:24.180, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276980_856_1654276982.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.64, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276982, api_et=N/A, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="", search_startup_time="60", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:23:24.178, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654276980_858', has_error_warn=false, fully_completed_search=true, total_run_time=10.22, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276983, api_et=N/A, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_startup_time="230", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]']
Audit:[timestamp=06-03-2022 17:23:24.175, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654276980_852', has_error_warn=false, fully_completed_search=true, total_run_time=11.30, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654276982, api_et=1651598580.000000000, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598580.000000000, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_startup_time="905", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]']
Audit:[timestamp=06-03-2022 17:23:24.173, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276986.606626', has_error_warn=false, fully_completed_search=true, total_run_time=10.76, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276986, api_et=1622740986.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622740986.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="473", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Email normid= [ search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:23:24.170, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654276980_851', has_error_warn=false, fully_completed_search=true, total_run_time=10.22, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276982, api_et=1651598580.000000000, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598580.000000000, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_startup_time="558", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]']
Audit:[timestamp=06-03-2022 17:23:24.169, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276980_856_1654276983.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.20, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276983, api_et=N/A, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:23:24.167, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654276980_853', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276982, api_et=1651598580.000000000, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598580.000000000, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]']
Audit:[timestamp=06-03-2022 17:23:24.163, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276980_856_1654276983.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276983, api_et=N/A, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:23:24.161, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654276980_860', has_error_warn=false, fully_completed_search=true, total_run_time=10.74, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276984, api_et=1622740980.000000000, api_lt=1654276980.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740980.000000000, search_lt=1654276980.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_startup_time="626", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis", app="SA-NetworkProtection", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]']
Audit:[timestamp=06-03-2022 17:23:06.011, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276986.606626', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Email normid= [ search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:23:06 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:04.194, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654276980_860', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:23:00 2021', apiEndTime='Fri Jun  3 17:23:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:04.177, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654276980_859', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:23:00 2021', apiEndTime='Fri Jun  3 17:23:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:03.414, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276983.606625', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Certificates normid= [ search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:03.108, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654276980_858', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:23:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:03.094, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654276980_857', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:23:00 2022', apiEndTime='Fri Jun  3 17:23:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:02.582, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276982.606624', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:23:02 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:02.080, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276980_856', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:23:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:02.069, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654276980_855', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Aut (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:23:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:02.064, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654276980_854', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:23:00 2022', apiEndTime='Fri Jun  3 17:23:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:02.056, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654276980_853', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:23:00 2022', apiEndTime='Fri Jun  3 17:23:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:02.045, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654276980_852', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:23:00 2022', apiEndTime='Fri Jun  3 17:23:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:23:02.022, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654276980_851', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:23:00 2022', apiEndTime='Fri Jun  3 17:23:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:22:54.169, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276962.606617', has_error_warn=false, fully_completed_search=true, total_run_time=10.60, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276962, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="520", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548", app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb26032d7500783b0 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:22:54.164, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276920_850', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276962, api_et=1654272720.000000000, api_lt=1654276320.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272720.000000000, search_lt=1654276320.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:22:42.889, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276962.606617', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb26032d7500783b0 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:22:42.532, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276920_850', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:12:00 2022', apiEndTime='Fri Jun  3 17:12:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:22:24.185, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276920_849_1654276923.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.60, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276923, api_et=N/A, api_lt=1654276920.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276920.000000000, is_realtime=0, savedsearch_name="", search_startup_time="67", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:22:24.183, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654276920_845', has_error_warn=false, fully_completed_search=true, total_run_time=10.30, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276922, api_et=1622740920.000000000, api_lt=1654276920.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740920.000000000, search_lt=1654276920.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]']
Audit:[timestamp=06-03-2022 17:22:24.181, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276922.606612', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276922, api_et=1622740922.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622740922.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Updates normid= [ search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:22:24.180, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654276920_846', has_error_warn=false, fully_completed_search=true, total_run_time=10.32, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276922, api_et=1646328120.000000000, api_lt=1654276920.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646328120.000000000, search_lt=1654276920.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_startup_time="719", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]']
Audit:[timestamp=06-03-2022 17:22:24.176, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276920_849', has_error_warn=false, fully_completed_search=true, total_run_time=14.52, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276922, api_et=N/A, api_lt=1654276920.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276920.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1542", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:22:24.175, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276920_849_1654276923.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276923, api_et=N/A, api_lt=1654276920.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276920.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:22:24.173, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276920_849_1654276923.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.15, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276923, api_et=N/A, api_lt=1654276920.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276920.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:22:24.171, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654276920_848', has_error_warn=false, fully_completed_search=true, total_run_time=7.73, event_count=482, result_count=99, available_count=0, scan_count=779, drop_count=0, exec_time=1654276922, api_et=N/A, api_lt=1654276920.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276920.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_startup_time="1491", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename dest_bunit AS All_Changes.dest_bunit dest_category AS All_Changes.dest_category dest_priority AS All_Changes.dest_priority src_bunit AS All_Changes.src_bunit src_category AS All_Changes.src_category src_priority AS All_Changes.src_priority tag AS All_Changes.tag user_agent AS All_Changes.user_agent user_bunit AS All_Changes.user_bunit user_category AS All_Changes.user_category user_priority AS All_Changes.user_priority user_type AS All_Changes.user_type vendor_account AS All_Changes.vendor_account vendor_region AS All_Changes.vendor_region change_type AS All_Changes.change_type command AS All_Changes.command dest AS All_Changes.dest dvc AS All_Changes.dvc object AS All_Changes.object object_attrs AS All_Changes.object_attrs object_category AS All_Changes.object_category object_id AS All_Changes.object_id object_path AS All_Changes.object_path status AS All_Changes.status result AS All_Changes.result result_id AS All_Changes.result_id src AS All_Changes.src user AS All_Changes.user user_name AS All_Changes.user_name vendor_product AS All_Changes.vendor_product action AS All_Changes.action is_Auditing_Changes AS All_Changes.is_Auditing_Changes is_not_Auditing_Changes AS All_Changes.is_not_Auditing_Changes is_Endpoint_Changes AS All_Changes.is_Endpoint_Changes is_not_Endpoint_Changes AS All_Changes.is_not_Endpoint_Changes is_Network_Changes AS All_Changes.is_Network_Changes is_not_Network_Changes AS All_Changes.is_not_Network_Changes is_Account_Management AS All_Changes.is_Account_Management is_not_Account_Management AS All_Changes.is_not_Account_Management is_Instance_Changes AS All_Changes.is_Instance_Changes is_not_Instance_Changes AS All_Changes.is_not_Instance_Changes | fields nodename, _time, host, source, sourcetype, All_Changes.dest_bunit, All_Changes.dest_category, All_Changes.dest_priority, All_Changes.src_bunit, All_Changes.src_category, All_Changes.src_priority, All_Changes.tag, All_Changes.user_agent, All_Changes.user_bunit, All_Changes.user_category, All_Changes.user_priority, All_Changes.user_type, All_Changes.vendor_account, All_Changes.vendor_region, All_Changes.change_type, All_Changes.command, All_Changes.dest, All_Changes.dvc, All_Changes.object, All_Changes.object_attrs, All_Changes.object_category, All_Changes.object_id, All_Changes.object_path, All_Changes.status, All_Changes.result, All_Changes.result_id, All_Changes.src, All_Changes.user, All_Changes.user_name, All_Changes.vendor_product, All_Changes.action, All_Changes.is_Auditing_Changes, All_Changes.is_not_Auditing_Changes, All_Changes.is_Endpoint_Changes, All_Changes.is_not_Endpoint_Changes, All_Changes.is_Network_Changes, All_Changes.is_not_Network_Changes, All_Changes.is_Account_Management, All_Changes.is_not_Account_Management, All_Changes.is_Instance_Changes, All_Changes.is_not_Instance_Changes, All_Changes.Endpoint_Changes.is_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes, All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes, All_Changes.Network_Changes.dest_ip_range, All_Changes.Network_Changes.dest_port_range, All_Changes.Network_Changes.direction, All_Changes.Network_Changes.protocol, All_Changes.Network_Changes.rule_action, All_Changes.Network_Changes.src_ip_range, All_Changes.Network_Changes.src_port_range, All_Changes.Network_Changes.is_Device_Restarts, All_Changes.Network_Changes.is_not_Device_Restarts, All_Changes.Account_Management.src_user_bunit, All_Changes.Account_Management.src_user_category, All_Changes.Account_Management.src_user_priority, All_Changes.Account_Management.src_user_type, All_Changes.Account_Management.dest_nt_domain, All_Changes.Account_Management.src_nt_domain, All_Changes.Account_Management.src_user, All_Changes.Account_Management.src_user_name, All_Changes.Account_Management.is_Accounts_Created, All_Changes.Account_Management.is_not_Accounts_Created, All_Changes.Account_Management.is_Accounts_Deleted, All_Changes.Account_Management.is_not_Accounts_Deleted, All_Changes.Account_Management.is_Account_Lockouts, All_Changes.Account_Management.is_not_Account_Lockouts, All_Changes.Account_Management.is_Accounts_Updated, All_Changes.Account_Management.is_not_Accounts_Updated, All_Changes.Instance_Changes.image_id, All_Changes.Instance_Changes.instance_type ]']
Audit:[timestamp=06-03-2022 17:22:24.164, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276923.606613', has_error_warn=false, fully_completed_search=true, total_run_time=10.34, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276923, api_et=1646328122.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1646328122.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="339", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Sessions normid= [ search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:22:24.163, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654276920_847', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276922, api_et=1646328120.000000000, api_lt=1654276920.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646328120.000000000, search_lt=1654276920.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]']
Audit:[timestamp=06-03-2022 17:22:03.357, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276923.606613', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Sessions normid= [ search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Mar  3 17:22:02 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:22:02.888, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276922.606612', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Updates normid= [ search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:22:02 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:22:02.292, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276920_849', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:22:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:22:02.281, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654276920_848', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_typ (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:22:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:22:02.276, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654276920_847', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:22:00 2022', apiEndTime='Fri Jun  3 17:22:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:22:02.251, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654276920_846', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:22:00 2022', apiEndTime='Fri Jun  3 17:22:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:22:02.180, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654276920_845', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:22:00 2021', apiEndTime='Fri Jun  3 17:22:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:21:54.168, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276860_844', has_error_warn=false, fully_completed_search=true, total_run_time=10.32, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276902, api_et=1654272660.000000000, api_lt=1654276260.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272660.000000000, search_lt=1654276260.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="468", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:21:42.666, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276860_844', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:11:00 2022', apiEndTime='Fri Jun  3 17:11:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:21:24.181, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654276860_842', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276862, api_et=1622740860.000000000, api_lt=1654276860.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740860.000000000, search_lt=1654276860.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]']
Audit:[timestamp=06-03-2022 17:21:24.178, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276863.606602', has_error_warn=false, fully_completed_search=true, total_run_time=10.37, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276863, api_et=1622740863.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622740863.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Malware normid= [ search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:21:24.176, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654276860_840', has_error_warn=false, fully_completed_search=true, total_run_time=1.87, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654276862, api_et=1646328060.000000000, api_lt=1654276860.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646328060.000000000, search_lt=1654276860.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_startup_time="1173", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]']
Audit:[timestamp=06-03-2022 17:21:24.175, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276860_843', has_error_warn=false, fully_completed_search=true, total_run_time=14.30, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276862, api_et=N/A, api_lt=1654276860.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276860.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1206", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:21:24.171, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276860_843_1654276863.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276863, api_et=N/A, api_lt=1654276860.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276860.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:21:24.170, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654276860_841', has_error_warn=false, fully_completed_search=true, total_run_time=10.32, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276862, api_et=1622740860.000000000, api_lt=1654276860.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740860.000000000, search_lt=1654276860.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]']
Audit:[timestamp=06-03-2022 17:21:24.168, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276860_843_1654276862.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.62, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276862, api_et=N/A, api_lt=1654276860.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276860.000000000, is_realtime=0, savedsearch_name="", search_startup_time="62", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:21:24.163, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276860_843_1654276863.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.15, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276863, api_et=N/A, api_lt=1654276860.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276860.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:21:03.087, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276863.606602', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Malware normid= [ search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:21:03 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:21:02.428, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276860_843', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:21:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:21:02.418, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654276860_842', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:21:00 2021', apiEndTime='Fri Jun  3 17:21:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:21:02.408, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654276860_841', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:21:00 2021', apiEndTime='Fri Jun  3 17:21:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:21:02.400, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654276860_840', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:21:00 2022', apiEndTime='Fri Jun  3 17:21:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:54.162, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276800_839', has_error_warn=false, fully_completed_search=true, total_run_time=10.05, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276841, api_et=1654272600.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272600.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:20:40.831, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276800_839', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:10:00 2022', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:24.213, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276805.606587', has_error_warn=false, fully_completed_search=true, total_run_time=10.70, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276805, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="457", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk", app="SA-ThreatIntelligence", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Risk normid= [ search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:20:24.211, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5fdbe716eed5fd8d5_at_1654276800_837', has_error_warn=false, fully_completed_search=true, total_run_time=10.53, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276807, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39_ACCELERATE_", search_startup_time="515", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=report_acceleration, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized ]']
Audit:[timestamp=06-03-2022 17:20:24.211, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276814.606589', has_error_warn=false, fully_completed_search=true, total_run_time=10.58, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276814, api_et=1622740814.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622740814.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="368", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity normid= [ search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:20:24.210, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD55392d2cd3b6dec88_at_1654276800_836', has_error_warn=false, fully_completed_search=true, total_run_time=10.46, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276807, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548_ACCELERATE_", search_startup_time="321", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=report_acceleration, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress ]']
Audit:[timestamp=06-03-2022 17:20:24.209, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276800_827', has_error_warn=false, fully_completed_search=true, total_run_time=15.44, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276802, api_et=N/A, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="2345", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:20:24.206, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654276800_832', has_error_warn=false, fully_completed_search=true, total_run_time=10.47, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276804, api_et=1654189800.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654189800.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_startup_time="515", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_d34d6d33ee94d419", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`']
Audit:[timestamp=06-03-2022 17:20:24.205, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD51dbc70e0e18846c9_at_1654276800_825', has_error_warn=false, fully_completed_search=true, total_run_time=1.19, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276802, api_et=N/A, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="Threat - Notable Owners - Lookup Gen", search_startup_time="1469", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a775b1da515861dc", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/authentication/users | search capabilities="can_own_notable_events" | rename title as owner | append [| makeresults | eval owner="unassigned" ] | eval _key=owner | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key owner realname | runshellscript notable_owners_lookup | stats count']
Audit:[timestamp=06-03-2022 17:20:24.204, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654276800_826', has_error_warn=false, fully_completed_search=true, total_run_time=3.72, event_count=2900, result_count=1, available_count=0, scan_count=2900, drop_count=0, exec_time=1654276802, api_et=1654102800.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654102800.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="ESS - Notable Events", search_startup_time="2962", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_87db9bb7a232c62f", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=1, eliminated_buckets=0, considered_events=2900, total_slices=121, decompressed_slices=10, duration.command.search.index=1, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=134, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, sourcetype_count__stash=2900, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count']
Audit:[timestamp=06-03-2022 17:20:24.203, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD51dbc70e0e18846c9_at_1654276800_825_1654276803.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.03, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276803, api_et=N/A, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_f2df6493ea859e37", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search=' | makeresults | eval owner="unassigned"']
Audit:[timestamp=06-03-2022 17:20:24.200, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5512a5e1102b73d8c_1654276800.606581', has_error_warn=false, fully_completed_search=true, total_run_time=2.79, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276800, api_et=1654274400.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274400.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="threatmatch://src", search_startup_time="2849", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_9f7bb060607c95c7", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("DNS.dest") from datamodel="Network_Resolution"."DNS" by "DNS.query"
    | `truncate_domain_dedup(DNS.query, DNS.query_truncated)`
    | lookup "threatintel_by_cidr" value as "DNS.query" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "DNS.query" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "DNS.query_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "DNS.query" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(DNS.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"src",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'DNS.query','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Traffic.dest"),values("All_Traffic.user") from datamodel="Network_Traffic"."All_Traffic" where "All_Traffic.action"="allowed" by "All_Traffic.src"
    | `truncate_domain_dedup(All_Traffic.src, All_Traffic.src_truncated)`
    | lookup "threatintel_by_cidr" value as "All_Traffic.src" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Traffic.src" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "All_Traffic.src_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "All_Traffic.src" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Traffic.dest,dest)`
    | `sistats_values_rename(All_Traffic.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"src",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Traffic.src','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("IDS_Attacks.dest"),values("IDS_Attacks.user") from datamodel="Intrusion_Detection"."IDS_Attacks" by "IDS_Attacks.src"
    | `truncate_domain_dedup(IDS_Attacks.src, IDS_Attacks.src_truncated)`
    | lookup "threatintel_by_cidr" value as "IDS_Attacks.src" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "IDS_Attacks.src" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "IDS_Attacks.src_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "IDS_Attacks.src" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(IDS_Attacks.dest,dest)`
    | `sistats_values_rename(IDS_Attacks.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"src",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'IDS_Attacks.src','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.dest"),values("Web.user") from datamodel="Web"."Web" by "Web.src"
    | `truncate_domain_dedup(Web.src, Web.src_truncated)`
    | lookup "threatintel_by_cidr" value as "Web.src" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "Web.src" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "Web.src_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "Web.src" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.dest,dest)`
    | `sistats_values_rename(Web.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"src",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.src','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://src"']
Audit:[timestamp=06-03-2022 17:20:24.198, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654276800_833', has_error_warn=false, fully_completed_search=true, total_run_time=10.76, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276804, api_et=N/A, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_startup_time="849", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]']
Audit:[timestamp=06-03-2022 17:20:24.196, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5a742da37541343b2_at_1654276800_824', has_error_warn=false, fully_completed_search=true, total_run_time=10.84, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276802, api_et=1653671400.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1653671400.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="Risk - 7 Day ATT&CK Tactic Threshold Exceeded - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_553873b00608ee08", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count, values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk where All_Risk.annotations.mitre_attack.mitre_tactic_id=* by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id' | where mitre_tactic_id_count >= 3 and source_count >= 4']
Audit:[timestamp=06-03-2022 17:20:24.195, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654276800_834', has_error_warn=false, fully_completed_search=true, total_run_time=1.07, event_count=5, result_count=3, available_count=0, scan_count=5, drop_count=0, exec_time=1654276805, api_et=N/A, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_startup_time="806", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]']
Audit:[timestamp=06-03-2022 17:20:24.193, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654276800_820', has_error_warn=false, fully_completed_search=true, total_run_time=10.49, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276802, api_et=1622740800.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740800.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]']
Audit:[timestamp=06-03-2022 17:20:24.192, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD56c54cc9c1045b223_1654276800.606580', has_error_warn=false, fully_completed_search=true, total_run_time=1.08, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276800, api_et=1654274400.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274400.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="threatmatch://http_user_agent", search_startup_time="1117", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_7795f28fe6b1cd8e", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest"),values("Web.user") from datamodel="Web"."Web" by "Web.http_user_agent"
    | lookup "threatintel_by_http_user_agent" value as "Web.http_user_agent" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_http_user_agent_wildcard" value as "Web.http_user_agent" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.dest,dest)`
    | `sistats_values_rename(Web.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"http_user_agent",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.http_user_agent','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://http_user_agent"']
Audit:[timestamp=06-03-2022 17:20:24.188, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654276800_819', has_error_warn=false, fully_completed_search=true, total_run_time=6.08, event_count=35, result_count=3, available_count=0, scan_count=35, drop_count=0, exec_time=1654276802, api_et=1622740800.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740800.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_startup_time="1509", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]']
Audit:[timestamp=06-03-2022 17:20:24.187, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276800_827_1654276804.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276804, api_et=N/A, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:20:24.185, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD5495078187e88a4c3_at_1654276800_823', has_error_warn=false, fully_completed_search=true, total_run_time=10.50, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276802, api_et=N/A, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="Utils - User Realnames - Lookup Gen", search_startup_time="973", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_a775b1da515861dc", app="SA-Utils", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/authentication/users | rename title as user | eval _key=user | dedup _key | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key user realname | runshellscript key_field=_key user_realnames_lookup | stats count']
Audit:[timestamp=06-03-2022 17:20:24.184, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD551cdb06b5c6a21a9_at_1654276800_831', has_error_warn=false, fully_completed_search=true, total_run_time=10.43, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276804, api_et=1654275300.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654275300.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="ES-AWS - Actions List - Lookup Gen", search_startup_time="402", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_57d89d2e67fb8485", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search `aws-index` NOT command IN ("Get*", "Describe*" "List*") | eval cloud_service_provider="aws" | inputlookup append=T actions | stats count by command, cloud_service_provider, change_type | fields - count | runshellscript override_if_empty=false actions | stats count']
Audit:[timestamp=06-03-2022 17:20:24.183, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5ee8d785f4bcf4e4c_at_1654276800_828', has_error_warn=false, fully_completed_search=true, total_run_time=1.14, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276803, api_et=1654272600.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272600.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="Network - Vulnerability Signature Reference - Lookup Gen", search_startup_time="1734", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-NetworkProtection_admin_9f4e0cc389bf07d9", app="SA-NetworkProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` min(_time) as firstTime,max(_time) as lastTime,values(Vulnerabilities.bugtraq) as bugtraq,values(Vulnerabilities.cert) as cert,values(Vulnerabilities.cve) as cve,values(Vulnerabilities.msft) as msft,values(Vulnerabilities.mskb) as mskb,values(Vulnerabilities.xref) as xref from datamodel=Vulnerabilities.Vulnerabilities by Vulnerabilities.signature,Vulnerabilities.vendor_product | `drop_dm_object_name("Vulnerabilities")` | inputlookup append=T vuln_signature_reference | `makemv(bugtraq)` | `makemv(cert)` | `makemv(cve)` | `makemv(msft)` | `makemv(mskb)` | `makemv(xref)` | stats min(firstTime) as firstTime,max(lastTime) as lastTime,values(cve) as cve,values(bugtraq) as bugtraq,values(cert) as cert,values(msft) as msft,values(mskb) as mskb,values(xref) as xref by signature,vendor_product | `makesv(bugtraq)` | `makesv(cert)` | `makesv(cve)` | `makesv(msft)` | `makesv(mskb)` | `makesv(xref)` | runshellscript override_if_empty=false vuln_signature_reference | stats count']
Audit:[timestamp=06-03-2022 17:20:24.181, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654276800_818', has_error_warn=false, fully_completed_search=true, total_run_time=11.40, event_count=129, result_count=18, available_count=0, scan_count=451, drop_count=0, exec_time=1654276802, api_et=1622740800.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740800.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_startup_time="1286", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]']
Audit:[timestamp=06-03-2022 17:20:24.179, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276803.606584', has_error_warn=false, fully_completed_search=true, total_run_time=1.23, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276803, api_et=1646328003.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1646328003.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="1043", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Web normid= [ search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code] | eval backfill_start_time = relative_time(now(), "-3mon") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:20:24.178, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276807.606588', has_error_warn=false, fully_completed_search=true, total_run_time=10.50, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276807, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="352", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence", app="DA-ESS-ThreatIntelligence", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence normid= [ search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:20:24.176, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654276800_835', has_error_warn=false, fully_completed_search=true, total_run_time=10.59, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276806, api_et=N/A, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_startup_time="542", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence", app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]']
Audit:[timestamp=06-03-2022 17:20:24.175, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD542095c95ae0ea321_1654276800.606579', has_error_warn=false, fully_completed_search=true, total_run_time=3.06, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276800, api_et=1654274400.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274400.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="threatmatch://dest", search_startup_time="3078", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_63eab2828e16d804", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("DNS.src") from datamodel="Network_Resolution"."DNS" by "DNS.answer"
    | `truncate_domain_dedup(DNS.answer, DNS.answer_truncated)`
    | lookup "threatintel_by_cidr" value as "DNS.answer" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "DNS.answer" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "DNS.answer_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "DNS.answer" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(DNS.src,src)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"dest",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'DNS.answer','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Traffic.src"),values("All_Traffic.user") from datamodel="Network_Traffic"."All_Traffic" where "All_Traffic.action"="allowed" by "All_Traffic.dest"
    | `truncate_domain_dedup(All_Traffic.dest, All_Traffic.dest_truncated)`
    | lookup "threatintel_by_cidr" value as "All_Traffic.dest" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Traffic.dest" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "All_Traffic.dest_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "All_Traffic.dest" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Traffic.src,src)`
    | `sistats_values_rename(All_Traffic.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"dest",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Traffic.dest','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("IDS_Attacks.src"),values("IDS_Attacks.user") from datamodel="Intrusion_Detection"."IDS_Attacks" by "IDS_Attacks.dest"
    | `truncate_domain_dedup(IDS_Attacks.dest, IDS_Attacks.dest_truncated)`
    | lookup "threatintel_by_cidr" value as "IDS_Attacks.dest" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "IDS_Attacks.dest" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "IDS_Attacks.dest_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "IDS_Attacks.dest" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(IDS_Attacks.src,src)`
    | `sistats_values_rename(IDS_Attacks.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"dest",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'IDS_Attacks.dest','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.user") from datamodel="Web"."Web" by "Web.dest"
    | `truncate_domain_dedup(Web.dest, Web.dest_truncated)`
    | lookup "threatintel_by_cidr" value as "Web.dest" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "Web.dest" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "Web.dest_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "Web.dest" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"dest",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.dest','threat_match_value')]
| mvexpand threat_collection_key
| stats values("sourcetype") as "sourcetype",values("src") as "src",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://dest"']
Audit:[timestamp=06-03-2022 17:20:24.173, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5cc8fbb6063874056_at_1654276800_830', has_error_warn=false, fully_completed_search=true, total_run_time=1.05, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276804, api_et=1654275300.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654275300.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="ES-AWS - Account ID List - Lookup Gen", search_startup_time="1403", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_cfa5d58970c4285c", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search `aws-index` | eval account_id = mvdedup(mvappend(aws_account_id, recipientAccountId, AwsAccountId, vendor_account)) | where account_id != "unknown" | inputlookup append=T aws_all_account_ids | stats count by account_id | fields - count | runshellscript override_if_empty=false aws_all_account_ids | stats count']
Audit:[timestamp=06-03-2022 17:20:24.170, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276800_827_1654276804.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.19, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276804, api_et=N/A, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:20:24.169, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654276800_822', has_error_warn=false, fully_completed_search=true, total_run_time=11.29, event_count=0, result_count=7, available_count=0, scan_count=0, drop_count=0, exec_time=1654276802, api_et=1622740800.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740800.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_startup_time="1442", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]']
Audit:[timestamp=06-03-2022 17:20:24.168, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654276800_821', has_error_warn=false, fully_completed_search=true, total_run_time=2.05, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654276802, api_et=1646328000.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646328000.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_startup_time="1650", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]']
Audit:[timestamp=06-03-2022 17:20:24.167, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD591854b6694917629_at_1654276800_838', has_error_warn=false, fully_completed_search=true, total_run_time=10.45, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276809, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71_ACCELERATE_", search_startup_time="313", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=report_acceleration, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time ]']
Audit:[timestamp=06-03-2022 17:20:24.165, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtRW5kcG9pbnRQcm90ZWN0aW9u__RMD5a764635f76e33232_at_1654276800_829', has_error_warn=false, fully_completed_search=true, total_run_time=1.80, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276803, api_et=1654272600.000000000, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272600.000000000, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="Endpoint - System Version Tracker - Lookup Gen", search_startup_time="1410", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-EndpointProtection_admin_b469c8a83a5f8933", app="SA-EndpointProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=15, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=39, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats summariesonly=false max("_time") as "_time" from datamodel="Compute_Inventory"."All_Inventory" where nodename="All_Inventory.OS" by "All_Inventory.dest","All_Inventory.OS.os" | rename "All_Inventory.dest" as "dest","All_Inventory.OS.os" as "os" | inputlookup append=T "system_version_tracker" | stats max("_time") as "_time" by "dest","os" | runshellscript override_if_empty=false "system_version_tracker" | stats count']
Audit:[timestamp=06-03-2022 17:20:24.164, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276800_827_1654276803.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.81, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276803, api_et=N/A, api_lt=1654276800.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276800.000000000, is_realtime=0, savedsearch_name="", search_startup_time="98", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:20:14.041, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276814.606589', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity normid= [ search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:20:14 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:09.594, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD591854b6694917629_at_1654276800_838', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time ]', autojoin='1', buckets=0, ttl=60, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71_ACCELERATE_", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:07.583, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5fdbe716eed5fd8d5_at_1654276800_837', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized ]', autojoin='1', buckets=0, ttl=60, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39_ACCELERATE_", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:07.573, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD55392d2cd3b6dec88_at_1654276800_836', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress ]', autojoin='1', buckets=0, ttl=60, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548_ACCELERATE_", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:07.373, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276807.606588', search='summarize tstats=t action=probe id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence normid= [ search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:06.594, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654276800_835', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_type=adhoc, is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:05.577, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654276800_834', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:05.016, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276805.606587', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Risk normid= [ search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="SA-ThreatIntelligence", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:04.554, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654276800_833', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:04.533, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654276800_832', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,mitre_tactic_id_count,mitre_technique_id_count,prestats_reserved_*,psrsvd_*,risk_object,risk_object_type,source_count', apiStartTime='Thu Jun  2 17:10:00 2022', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:04.493, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD551cdb06b5c6a21a9_at_1654276800_831', search='search `aws-index` NOT command IN ("Get*", "Describe*" "List*") | eval cloud_service_provider="aws" | inputlookup append=T actions | stats count by command, cloud_service_provider, change_type | fields - count | runshellscript override_if_empty=false actions | stats count', autojoin='1', buckets=0, ttl=2400, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:55:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ES-AWS - Actions List - Lookup Gen", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:03.459, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5cc8fbb6063874056_at_1654276800_830', search='search `aws-index` | eval account_id = mvdedup(mvappend(aws_account_id, recipientAccountId, AwsAccountId, vendor_account)) | where account_id != "unknown" | inputlookup append=T aws_all_account_ids | stats count by account_id | fields - count | runshellscript override_if_empty=false aws_all_account_ids | stats count', autojoin='1', buckets=0, ttl=2400, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:55:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ES-AWS - Account ID List - Lookup Gen", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:03.429, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtRW5kcG9pbnRQcm90ZWN0aW9u__RMD5a764635f76e33232_at_1654276800_829', search='| tstats summariesonly=false max("_time") as "_time" from datamodel="Compute_Inventory"."All_Inventory" where nodename="All_Inventory.OS" by "All_Inventory.dest","All_Inventory.OS.os" | rename "All_Inventory.dest" as "dest","All_Inventory.OS.os" as "os" | inputlookup append=T "system_version_tracker" | stats max("_time") as "_time" by "dest","os" | runshellscript override_if_empty=false "system_version_tracker" | stats count', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:10:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Endpoint - System Version Tracker - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-EndpointProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:03.122, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276803.606584', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Web normid= [ search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code] | eval backfill_start_time = relative_time(now(), "-3mon") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Mar  3 17:20:03 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:02.406, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5ee8d785f4bcf4e4c_at_1654276800_828', search='| tstats `summariesonly` min(_time) as firstTime,max(_time) as lastTime,values(Vulnerabilities.bugtraq) as bugtraq,values(Vulnerabilities.cert) as cert,values(Vulnerabilities.cve) as cve,values(Vulnerabilities.msft) as msft,values(Vulnerabilities.mskb) as mskb,values(Vulnerabilities.xref) as xref from datamodel=Vulnerabilities.Vulnerabilities by Vulnerabilities.signature,Vulnerabilities.vendor_product | `drop_dm_object_name("Vulnerabilities")` | inputlookup append=T vuln_signature_reference | `makemv(bugtraq)` | `makemv(cert)` | `makemv(cve)` | `makemv(msft)` | `makemv(mskb)` | `makemv(xref)` | stats min(firstTime) as firstTime,max(lastTime) as lastTime,values(cve) as cve,values(bugtraq) as bugtraq,values(cert) as cert,values(msft) as msft,values(mskb) as mskb,values(xref) as xref by signature,vendor_product | `makesv(bugtraq)` | `makesv(cert)` | `makesv(cve)` | `makesv(msft)` | `makesv(mskb)` | `makesv(xref)` | runshellscript override_if_empty=false vuln_signature_reference | stats count', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:10:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Network - Vulnerability Signature Reference - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:02.354, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276800_827', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:02.329, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654276800_826', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Wed Jun  1 17:00:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESS - Notable Events", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:02.282, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD51dbc70e0e18846c9_at_1654276800_825', search='| rest tshirt_server=local count=0 /services/authentication/users | search capabilities="can_own_notable_events" | rename title as owner | append [| makeresults | eval owner="unassigned" ] | eval _key=owner | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key owner realname | runshellscript notable_owners_lookup | stats count', autojoin='1', buckets=0, ttl=1200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Notable Owners - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:02.266, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5a742da37541343b2_at_1654276800_824', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count, values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk where All_Risk.annotations.mitre_attack.mitre_tactic_id=* by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id' | where mitre_tactic_id_count >= 3 and source_count >= 4', autojoin='1', buckets=0, ttl=1200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,mitre_tactic_id_count,mitre_technique_id_count,prestats_reserved_*,psrsvd_*,risk_object,risk_object_type,source_count', apiStartTime='Fri May 27 17:10:00 2022', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Risk - 7 Day ATT&CK Tactic Threshold Exceeded - Rule", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:02.247, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD5495078187e88a4c3_at_1654276800_823', search='| rest tshirt_server=local count=0 /services/authentication/users | rename title as user | eval _key=user | dedup _key | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key user realname | runshellscript key_field=_key user_realnames_lookup | stats count', autojoin='1', buckets=0, ttl=1200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Utils - User Realnames - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:02.236, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654276800_822', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:20:00 2021', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:02.228, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654276800_821', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:20:00 2022', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:02.216, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654276800_820', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:20:00 2021', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:02.206, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654276800_819', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:20:00 2021', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:02.197, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654276800_818', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:20:00 2021', apiEndTime='Fri Jun  3 17:20:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:00.768, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5512a5e1102b73d8c_1654276800.606581', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("DNS.dest") from datamodel="Network_Resolution"."DNS" by "DNS.query"
    | `truncate_domain_dedup(DNS.query, DNS.query_truncated)`
    | lookup "threatintel_by_cidr" value as "DNS.query" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "DNS.query" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "DNS.query_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "DNS.query" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(DNS.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"src",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'DNS.query','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Traffic.dest"),values("All_Traffic.user") from datamodel="Network_Traffic"."All_Traffic" where "All_Traffic.action"="allowed" by "All_Traffic.src"
    | `truncate_domain_dedup(All_Traffic.src, All_Traffic.src_truncated)`
    | lookup "threatintel_by_cidr" value as "All_Traffic.src" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Traffic.src" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "All_Traffic.src_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "All_Traffic.src" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Traffic.dest,dest)`
    | `sistats_values_rename(All_Traffic.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"src",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Traffic.src','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("IDS_Attacks.dest"),values("IDS_Attacks.user") from datamodel="Intrusion_Detection"."IDS_Attacks" by "IDS_Attacks.src"
    | `truncate_domain_dedup(IDS_Attacks.src, IDS_Attacks.src_truncated)`
    | lookup "threatintel_by_cidr" value as "IDS_Attacks.src" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "IDS_Attacks.src" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "IDS_Attacks.src_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "IDS_Attacks.src" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(IDS_Attacks.dest,dest)`
    | `sistats_values_rename(IDS_Attacks.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"src",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'IDS_Attacks.src','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.dest"),values("Web.user") from datamodel="Web"."Web" by "Web.src"
    | `truncate_domain_dedup(Web.src, Web.src_truncated)`
    | lookup "threatintel_by_cidr" value as "Web.src" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "Web.src" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "Web.src_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "Web.src" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.dest,dest)`
    | `sistats_values_rename(Web.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"src",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.src','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as thr (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:40:00 2022', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://src", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:00.645, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD56c54cc9c1045b223_1654276800.606580', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest"),values("Web.user") from datamodel="Web"."Web" by "Web.http_user_agent"
    | lookup "threatintel_by_http_user_agent" value as "Web.http_user_agent" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_http_user_agent_wildcard" value as "Web.http_user_agent" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.dest,dest)`
    | `sistats_values_rename(Web.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"http_user_agent",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.http_user_agent','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://http_user_agent"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:40:00 2022', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://http_user_agent", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:20:00.457, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD542095c95ae0ea321_1654276800.606579', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("DNS.src") from datamodel="Network_Resolution"."DNS" by "DNS.answer"
    | `truncate_domain_dedup(DNS.answer, DNS.answer_truncated)`
    | lookup "threatintel_by_cidr" value as "DNS.answer" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "DNS.answer" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "DNS.answer_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "DNS.answer" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(DNS.src,src)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"dest",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'DNS.answer','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Traffic.src"),values("All_Traffic.user") from datamodel="Network_Traffic"."All_Traffic" where "All_Traffic.action"="allowed" by "All_Traffic.dest"
    | `truncate_domain_dedup(All_Traffic.dest, All_Traffic.dest_truncated)`
    | lookup "threatintel_by_cidr" value as "All_Traffic.dest" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "All_Traffic.dest" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "All_Traffic.dest_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "All_Traffic.dest" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Traffic.src,src)`
    | `sistats_values_rename(All_Traffic.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"dest",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Traffic.dest','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("IDS_Attacks.src"),values("IDS_Attacks.user") from datamodel="Intrusion_Detection"."IDS_Attacks" by "IDS_Attacks.dest"
    | `truncate_domain_dedup(IDS_Attacks.dest, IDS_Attacks.dest_truncated)`
    | lookup "threatintel_by_cidr" value as "IDS_Attacks.dest" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "IDS_Attacks.dest" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "IDS_Attacks.dest_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "IDS_Attacks.dest" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(IDS_Attacks.src,src)`
    | `sistats_values_rename(IDS_Attacks.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"dest",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'IDS_Attacks.dest','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.user") from datamodel="Web"."Web" by "Web.dest"
    | `truncate_domain_dedup(Web.dest, Web.dest_truncated)`
    | lookup "threatintel_by_cidr" value as "Web.dest" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_domain" value as "Web.dest" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | lookup "threatintel_by_domain" value as "Web.dest_truncated" OUTPUT threat_collection as tc2,threat_collection_key as tck2
    | lookup "threatintel_by_system" value as "Web.dest" OUTPUT threat_collection as tc3,threat_collection_key as tck3
    | where isnotnull('tck0') OR isnotnull('tck1') OR isnotnull('tck2') OR isnotnull('tck3')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval intelzip2=mvzip('tc2','tck2',"@@")
    | eval intelzip3=mvzip('tc3','tck3',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1,intelzip2,intelzip3)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"dest",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.dest','threat_match_value')]
| mvexpand threat_collection_key
| stats values("sourcetype") as "sourcetype",values("src") as "src",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_gro (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:40:00 2022', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://dest", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:19:54.175, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276740_817', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276782, api_et=1654272540.000000000, api_lt=1654276140.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272540.000000000, search_lt=1654276140.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:19:54.170, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654276740_815', has_error_warn=false, fully_completed_search=true, total_run_time=37.06, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654276742, api_et=1651598340.000000000, api_lt=1654276740.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598340.000000000, search_lt=1654276740.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_startup_time="1259", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]']
Audit:[timestamp=06-03-2022 17:19:54.166, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276779.606569', has_error_warn=false, fully_completed_search=true, total_run_time=1.43, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276779, api_et=1651598379.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651598379.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="962", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Performance normid= [ search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:19:42.504, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276740_817', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:09:00 2022', apiEndTime='Fri Jun  3 17:09:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:19:39.703, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276779.606569', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Performance normid= [ search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modti (truncated)', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:19:39 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:19:24.178, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654276740_814', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276742, api_et=1622740740.000000000, api_lt=1654276740.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740740.000000000, search_lt=1654276740.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]']
Audit:[timestamp=06-03-2022 17:19:24.177, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276740_816_1654276742.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.60, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276742, api_et=N/A, api_lt=1654276740.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276740.000000000, is_realtime=0, savedsearch_name="", search_startup_time="80", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:19:24.175, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276740_816_1654276743.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276743, api_et=N/A, api_lt=1654276740.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276740.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:19:24.172, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276740_816', has_error_warn=false, fully_completed_search=true, total_run_time=14.55, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276742, api_et=N/A, api_lt=1654276740.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276740.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1479", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:19:24.167, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276740_816_1654276743.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.14, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276743, api_et=N/A, api_lt=1654276740.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276740.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:19:24.164, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276742.606568', has_error_warn=false, fully_completed_search=true, total_run_time=10.37, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276742, api_et=1622740742.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622740742.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Intrusion_Detection normid= [ search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:19:02.852, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276742.606568', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Intrusion_Detection normid= [ search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:19:02 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:19:02.253, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276740_816', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:19:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:19:02.241, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654276740_815', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:19:00 2022', apiEndTime='Fri Jun  3 17:19:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:19:02.176, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654276740_814', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:19:00 2021', apiEndTime='Fri Jun  3 17:19:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:54.172, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276680_813', has_error_warn=false, fully_completed_search=true, total_run_time=10.55, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276720, api_et=1654272480.000000000, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272480.000000000, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="825", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:18:40.639, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276680_813', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:08:00 2022', apiEndTime='Fri Jun  3 17:08:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:24.210, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654276680_810', has_error_warn=false, fully_completed_search=true, total_run_time=10.21, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276683, api_et=1651598280.000000000, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598280.000000000, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_startup_time="222", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]']
Audit:[timestamp=06-03-2022 17:18:24.209, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654276680_804', has_error_warn=false, fully_completed_search=true, total_run_time=11.41, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654276682, api_et=1651598280.000000000, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598280.000000000, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_startup_time="1168", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]']
Audit:[timestamp=06-03-2022 17:18:24.207, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654276680_807', has_error_warn=false, fully_completed_search=true, total_run_time=1.99, event_count=0, result_count=98, available_count=0, scan_count=0, drop_count=0, exec_time=1654276682, api_et=1622740680.000000000, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740680.000000000, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_startup_time="1153", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]']
Audit:[timestamp=06-03-2022 17:18:24.205, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276682.606552', has_error_warn=false, fully_completed_search=true, total_run_time=10.64, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276682, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="582", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39", app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NS44dad4abfd2e365a [search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:18:24.203, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276696.606555', has_error_warn=false, fully_completed_search=true, total_run_time=1.15, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276696, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="917", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Authentication normid= [ search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_Successful_Authentication, Authentication.is_not_Successful_Authentication, Authentication.is_Default_Authentication, Authentication.is_not_Default_Authentication, Authentication.is_Insecure_Authentication, Authentication.is_not_Insecure_Authentication, Authentication.is_Privileged_Authentication, Authentication.is_not_Privileged_Authentication, Authentication.Default_Authentication.is_Failed_Default_Authentication, Authentication.Default_Authentication.is_not_Failed_Default_Authentication, Authentication.Default_Authentication.is_Successful_Default_Authentication, Authentication.Default_Authentication.is_not_Successful_Default_Authentication, Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:18:24.201, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276680_808_1654276683.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276683, api_et=N/A, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:18:24.199, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276680_808', has_error_warn=false, fully_completed_search=true, total_run_time=14.38, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276682, api_et=N/A, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1288", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:18:24.198, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654276680_809', has_error_warn=false, fully_completed_search=true, total_run_time=10.24, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276683, api_et=1651598280.000000000, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598280.000000000, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_startup_time="240", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]']
Audit:[timestamp=06-03-2022 17:18:24.195, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654276680_805', has_error_warn=false, fully_completed_search=true, total_run_time=10.36, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276682, api_et=1651598280.000000000, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598280.000000000, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]']
Audit:[timestamp=06-03-2022 17:18:24.194, user=tshirt-system-user, action=search, info=canceled, search_id='1654276623.606542', has_error_warn=false, fully_completed_search=true, total_run_time=10.34, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276623, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="35", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_tshirt_archiver_nobody_6e52eadc9b716ad5", app="tshirt_archiver", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| copybuckets json="{\"vixes\": {}, \"providers\": {}}"']
Audit:[timestamp=06-03-2022 17:18:24.189, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276680_808_1654276683.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.21, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276683, api_et=N/A, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="", search_startup_time="9", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:18:24.186, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654276680_812', has_error_warn=false, fully_completed_search=true, total_run_time=10.78, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276684, api_et=1622740680.000000000, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740680.000000000, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_startup_time="642", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis", app="SA-NetworkProtection", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]']
Audit:[timestamp=06-03-2022 17:18:24.184, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276680_808_1654276682.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.63, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276682, api_et=N/A, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="", search_startup_time="75", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:18:24.183, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654276680_803', has_error_warn=false, fully_completed_search=true, total_run_time=10.31, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276682, api_et=N/A, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_startup_time="563", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]']
Audit:[timestamp=06-03-2022 17:18:24.181, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654276680_811', has_error_warn=false, fully_completed_search=true, total_run_time=12.03, event_count=0, result_count=99, available_count=0, scan_count=0, drop_count=0, exec_time=1654276684, api_et=N/A, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_startup_time="589", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_Successful_Authentication, Authentication.is_not_Successful_Authentication, Authentication.is_Default_Authentication, Authentication.is_not_Default_Authentication, Authentication.is_Insecure_Authentication, Authentication.is_not_Insecure_Authentication, Authentication.is_Privileged_Authentication, Authentication.is_not_Privileged_Authentication, Authentication.Default_Authentication.is_Failed_Default_Authentication, Authentication.Default_Authentication.is_not_Failed_Default_Authentication, Authentication.Default_Authentication.is_Successful_Default_Authentication, Authentication.Default_Authentication.is_not_Successful_Default_Authentication, Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication ]']
Audit:[timestamp=06-03-2022 17:18:24.180, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654276680_806', has_error_warn=false, fully_completed_search=true, total_run_time=11.45, event_count=13, result_count=32, available_count=0, scan_count=13, drop_count=0, exec_time=1654276682, api_et=1651598280.000000000, api_lt=1654276680.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598280.000000000, search_lt=1654276680.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_startup_time="1136", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]']
Audit:[timestamp=06-03-2022 17:18:24.176, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276694.606554', has_error_warn=false, fully_completed_search=true, total_run_time=10.69, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276694, api_et=1651598294.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651598294.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="433", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Registry normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:18:24.174, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276683.606553', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276683, api_et=1651598283.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651598283.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="287", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Services normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:18:16.496, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276696.606555', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Authentication normid= [ search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_ (truncated)', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:14.141, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276694.606554', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Registry normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:18:14 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:04.401, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654276680_812', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:18:00 2021', apiEndTime='Fri Jun  3 17:18:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:04.388, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654276680_811', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Aut (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:18:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:03.608, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276683.606553', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Services normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:18:03 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:03.371, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654276680_810', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:18:00 2022', apiEndTime='Fri Jun  3 17:18:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:03.352, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654276680_809', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:18:00 2022', apiEndTime='Fri Jun  3 17:18:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:02.745, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276682.606552', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NS44dad4abfd2e365a [search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:02.340, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276680_808', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:18:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:02.330, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654276680_807', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:18:00 2021', apiEndTime='Fri Jun  3 17:18:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:02.320, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654276680_806', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:18:00 2022', apiEndTime='Fri Jun  3 17:18:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:02.312, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654276680_805', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:18:00 2022', apiEndTime='Fri Jun  3 17:18:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:02.305, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654276680_804', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:18:00 2022', apiEndTime='Fri Jun  3 17:18:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:18:02.298, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654276680_803', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:18:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:17:54.168, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276620_802', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276662, api_et=1654272420.000000000, api_lt=1654276020.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272420.000000000, search_lt=1654276020.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:17:41.831, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276620_802', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:07:00 2022', apiEndTime='Fri Jun  3 17:07:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:17:24.180, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276620_801_1654276623.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.16, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276623, api_et=N/A, api_lt=1654276620.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276620.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:17:24.179, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654276620_798', has_error_warn=false, fully_completed_search=true, total_run_time=10.31, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276622, api_et=1622740620.000000000, api_lt=1654276620.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740620.000000000, search_lt=1654276620.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]']
Audit:[timestamp=06-03-2022 17:17:24.177, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276620_801', has_error_warn=false, fully_completed_search=true, total_run_time=14.68, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276622, api_et=N/A, api_lt=1654276620.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276620.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1519", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:17:24.171, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276620_801_1654276624.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276624, api_et=N/A, api_lt=1654276620.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276620.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:17:24.169, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654276620_797', has_error_warn=false, fully_completed_search=true, total_run_time=10.30, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276622, api_et=1646327820.000000000, api_lt=1654276620.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646327820.000000000, search_lt=1654276620.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]']
Audit:[timestamp=06-03-2022 17:17:24.168, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_c3BsdW5rX2FyY2hpdmVy__RMD5473cbac83d6c9db7_at_1654276620_800', has_error_warn=false, fully_completed_search=true, total_run_time=10.73, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276622, api_et=N/A, api_lt=1654276620.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276620.000000000, is_realtime=0, savedsearch_name="Bucket Copy Trigger", search_startup_time="423", is_prjob=false, app="tshirt_archiver", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| archivebuckets']
Audit:[timestamp=06-03-2022 17:17:24.165, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276620_801_1654276623.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.61, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276623, api_et=N/A, api_lt=1654276620.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276620.000000000, is_realtime=0, savedsearch_name="", search_startup_time="66", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:17:24.164, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654276620_799', has_error_warn=false, fully_completed_search=true, total_run_time=7.76, event_count=611, result_count=99, available_count=0, scan_count=1146, drop_count=0, exec_time=1654276623, api_et=N/A, api_lt=1654276620.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276620.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_startup_time="1545", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename dest_bunit AS All_Changes.dest_bunit dest_category AS All_Changes.dest_category dest_priority AS All_Changes.dest_priority src_bunit AS All_Changes.src_bunit src_category AS All_Changes.src_category src_priority AS All_Changes.src_priority tag AS All_Changes.tag user_agent AS All_Changes.user_agent user_bunit AS All_Changes.user_bunit user_category AS All_Changes.user_category user_priority AS All_Changes.user_priority user_type AS All_Changes.user_type vendor_account AS All_Changes.vendor_account vendor_region AS All_Changes.vendor_region change_type AS All_Changes.change_type command AS All_Changes.command dest AS All_Changes.dest dvc AS All_Changes.dvc object AS All_Changes.object object_attrs AS All_Changes.object_attrs object_category AS All_Changes.object_category object_id AS All_Changes.object_id object_path AS All_Changes.object_path status AS All_Changes.status result AS All_Changes.result result_id AS All_Changes.result_id src AS All_Changes.src user AS All_Changes.user user_name AS All_Changes.user_name vendor_product AS All_Changes.vendor_product action AS All_Changes.action is_Auditing_Changes AS All_Changes.is_Auditing_Changes is_not_Auditing_Changes AS All_Changes.is_not_Auditing_Changes is_Endpoint_Changes AS All_Changes.is_Endpoint_Changes is_not_Endpoint_Changes AS All_Changes.is_not_Endpoint_Changes is_Network_Changes AS All_Changes.is_Network_Changes is_not_Network_Changes AS All_Changes.is_not_Network_Changes is_Account_Management AS All_Changes.is_Account_Management is_not_Account_Management AS All_Changes.is_not_Account_Management is_Instance_Changes AS All_Changes.is_Instance_Changes is_not_Instance_Changes AS All_Changes.is_not_Instance_Changes | fields nodename, _time, host, source, sourcetype, All_Changes.dest_bunit, All_Changes.dest_category, All_Changes.dest_priority, All_Changes.src_bunit, All_Changes.src_category, All_Changes.src_priority, All_Changes.tag, All_Changes.user_agent, All_Changes.user_bunit, All_Changes.user_category, All_Changes.user_priority, All_Changes.user_type, All_Changes.vendor_account, All_Changes.vendor_region, All_Changes.change_type, All_Changes.command, All_Changes.dest, All_Changes.dvc, All_Changes.object, All_Changes.object_attrs, All_Changes.object_category, All_Changes.object_id, All_Changes.object_path, All_Changes.status, All_Changes.result, All_Changes.result_id, All_Changes.src, All_Changes.user, All_Changes.user_name, All_Changes.vendor_product, All_Changes.action, All_Changes.is_Auditing_Changes, All_Changes.is_not_Auditing_Changes, All_Changes.is_Endpoint_Changes, All_Changes.is_not_Endpoint_Changes, All_Changes.is_Network_Changes, All_Changes.is_not_Network_Changes, All_Changes.is_Account_Management, All_Changes.is_not_Account_Management, All_Changes.is_Instance_Changes, All_Changes.is_not_Instance_Changes, All_Changes.Endpoint_Changes.is_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes, All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes, All_Changes.Network_Changes.dest_ip_range, All_Changes.Network_Changes.dest_port_range, All_Changes.Network_Changes.direction, All_Changes.Network_Changes.protocol, All_Changes.Network_Changes.rule_action, All_Changes.Network_Changes.src_ip_range, All_Changes.Network_Changes.src_port_range, All_Changes.Network_Changes.is_Device_Restarts, All_Changes.Network_Changes.is_not_Device_Restarts, All_Changes.Account_Management.src_user_bunit, All_Changes.Account_Management.src_user_category, All_Changes.Account_Management.src_user_priority, All_Changes.Account_Management.src_user_type, All_Changes.Account_Management.dest_nt_domain, All_Changes.Account_Management.src_nt_domain, All_Changes.Account_Management.src_user, All_Changes.Account_Management.src_user_name, All_Changes.Account_Management.is_Accounts_Created, All_Changes.Account_Management.is_not_Accounts_Created, All_Changes.Account_Management.is_Accounts_Deleted, All_Changes.Account_Management.is_not_Accounts_Deleted, All_Changes.Account_Management.is_Account_Lockouts, All_Changes.Account_Management.is_not_Account_Lockouts, All_Changes.Account_Management.is_Accounts_Updated, All_Changes.Account_Management.is_not_Accounts_Updated, All_Changes.Instance_Changes.image_id, All_Changes.Instance_Changes.instance_type ]']
Audit:[timestamp=06-03-2022 17:17:24.161, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654276620_796', has_error_warn=false, fully_completed_search=true, total_run_time=10.33, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276622, api_et=1646327820.000000000, api_lt=1654276620.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646327820.000000000, search_lt=1654276620.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]']
Audit:[timestamp=06-03-2022 17:17:03.632, user=tshirt-system-user, action=search, info=cancel, search_id='1654276623.606542']
Audit:[timestamp=06-03-2022 17:17:03.623, user=tshirt-system-user, action=search, info=finalize, search_id='1654276623.606542']
Audit:[timestamp=06-03-2022 17:17:03.252, user=tshirt-system-user, action=search, info=granted , search_id='1654276623.606542', search='| copybuckets json="{\"vixes\": {}, \"providers\": {}}"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="tshirt_archiver", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:17:02.593, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276620_801', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:17:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:17:02.583, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_c3BsdW5rX2FyY2hpdmVy__RMD5473cbac83d6c9db7_at_1654276620_800', search='| archivebuckets', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:17:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Bucket Copy Trigger", search_type=adhoc, is_proxied=false, app="tshirt_archiver", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:17:02.576, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654276620_799', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_typ (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:17:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:17:02.571, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654276620_798', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:17:00 2021', apiEndTime='Fri Jun  3 17:17:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:17:02.564, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654276620_797', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:17:00 2022', apiEndTime='Fri Jun  3 17:17:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:17:02.551, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654276620_796', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:17:00 2022', apiEndTime='Fri Jun  3 17:17:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:16:54.161, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276560_795', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276602, api_et=1654272360.000000000, api_lt=1654275960.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272360.000000000, search_lt=1654275960.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:16:42.084, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276560_795', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:06:00 2022', apiEndTime='Fri Jun  3 17:06:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:16:24.181, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654276560_791', has_error_warn=false, fully_completed_search=true, total_run_time=10.32, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276562, api_et=1622740560.000000000, api_lt=1654276560.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740560.000000000, search_lt=1654276560.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]']
Audit:[timestamp=06-03-2022 17:16:24.179, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276560_794_1654276562.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.62, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276562, api_et=N/A, api_lt=1654276560.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276560.000000000, is_realtime=0, savedsearch_name="", search_startup_time="60", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:16:24.175, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276560_794', has_error_warn=false, fully_completed_search=true, total_run_time=14.20, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276562, api_et=N/A, api_lt=1654276560.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276560.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1203", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:16:24.170, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276560_794_1654276563.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276563, api_et=N/A, api_lt=1654276560.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276560.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:16:24.168, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654276560_792', has_error_warn=false, fully_completed_search=true, total_run_time=10.32, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276562, api_et=1622740560.000000000, api_lt=1654276560.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740560.000000000, search_lt=1654276560.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_startup_time="688", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]']
Audit:[timestamp=06-03-2022 17:16:24.166, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654276560_793', has_error_warn=false, fully_completed_search=true, total_run_time=1.80, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654276562, api_et=1646327760.000000000, api_lt=1654276560.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646327760.000000000, search_lt=1654276560.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_startup_time="1161", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]']
Audit:[timestamp=06-03-2022 17:16:24.164, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276560_794_1654276562.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.14, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276562, api_et=N/A, api_lt=1654276560.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276560.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:16:24.161, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276562.606532', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276562, api_et=1622740562.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622740562.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="288", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Vulnerabilities normid= [ search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:16:02.516, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276562.606532', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Vulnerabilities normid= [ search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:16:02 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:16:01.844, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276560_794', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:16:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:16:01.834, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654276560_793', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:16:00 2022', apiEndTime='Fri Jun  3 17:16:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:16:01.823, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654276560_792', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:16:00 2021', apiEndTime='Fri Jun  3 17:16:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:16:01.815, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654276560_791', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:16:00 2021', apiEndTime='Fri Jun  3 17:16:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:54.167, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276500_790', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276541, api_et=1654272300.000000000, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272300.000000000, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:15:41.259, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276500_790', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:05:00 2022', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:24.207, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5e355dcc90e717b9e_1654276500.606509', has_error_warn=false, fully_completed_search=true, total_run_time=2.66, event_count=2, result_count=0, available_count=0, scan_count=2, drop_count=0, exec_time=1654276500, api_et=1654274100.000000000, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274100.000000000, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="threatmatch://file_name", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_58246730e53f293f", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Filesystem.dest"),values("Filesystem.user") from datamodel="Endpoint"."Filesystem" by "Filesystem.file_name"
    | lookup "threatintel_by_file_name" value as "Filesystem.file_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_file_name_wildcard" value as "Filesystem.file_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Filesystem.dest,dest)`
    | `sistats_values_rename(Filesystem.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Filesystem.file_name','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.file_name"
    | lookup "threatintel_by_file_name" value as "All_Email.file_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_file_name_wildcard" value as "All_Email.file_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.file_name','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Malware_Attacks.src"),values("Malware_Attacks.dest"),values("Malware_Attacks.user") from datamodel="Malware"."Malware_Attacks" by "Malware_Attacks.file_name"
    | lookup "threatintel_by_file_name" value as "Malware_Attacks.file_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_file_name_wildcard" value as "Malware_Attacks.file_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Malware_Attacks.src,src)`
    | `sistats_values_rename(Malware_Attacks.dest,dest)`
    | `sistats_values_rename(Malware_Attacks.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Malware_Attacks.file_name','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Updates.dest") from datamodel="Updates"."Updates" by "Updates.file_name"
    | lookup "threatintel_by_file_name" value as "Updates.file_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_file_name_wildcard" value as "Updates.file_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Updates.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Updates.file_name','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://file_name"']
Audit:[timestamp=06-03-2022 17:15:24.205, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276500_784_1654276504.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.19, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276504, api_et=N/A, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:15:24.202, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654276500_789', has_error_warn=false, fully_completed_search=true, total_run_time=10.63, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276506, api_et=N/A, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_startup_time="586", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence", app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]']
Audit:[timestamp=06-03-2022 17:15:24.199, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654276500_780', has_error_warn=false, fully_completed_search=true, total_run_time=5.88, event_count=35, result_count=3, available_count=0, scan_count=35, drop_count=0, exec_time=1654276503, api_et=1622740500.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740500.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_startup_time="1070", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]']
Audit:[timestamp=06-03-2022 17:15:24.198, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276505.606519', has_error_warn=false, fully_completed_search=true, total_run_time=10.61, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276505, api_et=1622740503.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622740503.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="440", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis", app="SA-NetworkProtection", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_SA-NetworkProtection_Domain_Analysis normid= [ search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains] | eval backfill_start_time = relative_time(now(), "-1y") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:15:24.196, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654276500_779', has_error_warn=false, fully_completed_search=true, total_run_time=11.30, event_count=135, result_count=18, available_count=0, scan_count=791, drop_count=0, exec_time=1654276503, api_et=1622740500.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740500.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_startup_time="1442", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]']
Audit:[timestamp=06-03-2022 17:15:24.195, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654276500_786', has_error_warn=false, fully_completed_search=true, total_run_time=10.53, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276503, api_et=1654189500.000000000, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654189500.000000000, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_d34d6d33ee94d419", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`']
Audit:[timestamp=06-03-2022 17:15:24.192, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276500_784_1654276503.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.65, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276503, api_et=N/A, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="", search_startup_time="67", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:15:24.190, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276514.606522', has_error_warn=false, fully_completed_search=true, total_run_time=10.68, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276514, api_et=1622740514.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622740514.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="433", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit normid= [ search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:15:24.188, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276503.606514', has_error_warn=false, fully_completed_search=true, total_run_time=10.50, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276503, api_et=1622740503.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622740503.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="500", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Ticket_Management normid= [ search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:15:24.187, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276507.606520', has_error_warn=false, fully_completed_search=true, total_run_time=10.51, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276507, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="347", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management", app="SA-ThreatIntelligence", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Incident_Management normid= [ search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:15:24.186, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654276500_778', has_error_warn=false, fully_completed_search=true, total_run_time=10.32, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276503, api_et=1622740500.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740500.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_startup_time="661", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]']
Audit:[timestamp=06-03-2022 17:15:24.184, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5dec7d406fe7b18e0_1654276500.606510', has_error_warn=false, fully_completed_search=true, total_run_time=1.08, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276500, api_et=1654274100.000000000, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274100.000000000, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="threatmatch://service", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_168e76ffea97db4c", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Services.dest"),values("Services.user") from datamodel="Endpoint"."Services" by "Services.service"
    | lookup "threatintel_by_service" value as "Services.service" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_service_wildcard" value as "Services.service" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Services.dest,dest)`
    | `sistats_values_rename(Services.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"service",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Services.service','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://service"']
Audit:[timestamp=06-03-2022 17:15:24.182, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654276500_783', has_error_warn=false, fully_completed_search=true, total_run_time=3.94, event_count=2895, result_count=1, available_count=0, scan_count=2895, drop_count=0, exec_time=1654276503, api_et=1654102800.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654102800.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="ESS - Notable Events", search_startup_time="3244", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_87db9bb7a232c62f", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=1, eliminated_buckets=0, considered_events=2895, total_slices=121, decompressed_slices=10, duration.command.search.index=1, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=137, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, sourcetype_count__stash=2895, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count']
Audit:[timestamp=06-03-2022 17:15:24.180, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtQWNjZXNzUHJvdGVjdGlvbg__RMD54a1edad66ca90d80_at_1654276500_782', has_error_warn=false, fully_completed_search=true, total_run_time=1.37, event_count=1, result_count=1, available_count=0, scan_count=1, drop_count=0, exec_time=1654276503, api_et=1654274700.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274700.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="Access - Access App Tracker - Lookup Gen", search_startup_time="1940", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-AccessProtection_admin_71c0a0e9ec5d01ab", app="SA-AccessProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Authentication"."Authentication" where "Authentication.app"!="unknown" by "Authentication.app" | rename "Authentication.app" as "app" | inputlookup append=T "access_app_tracker" | stats min("firstTime") as "firstTime",max("lastTime") as "lastTime" by "app" | runshellscript override_if_empty=false "access_app_tracker" | stats count']
Audit:[timestamp=06-03-2022 17:15:24.179, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276500_784', has_error_warn=false, fully_completed_search=true, total_run_time=14.95, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276503, api_et=N/A, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1894", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:15:24.177, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654276500_777', has_error_warn=false, fully_completed_search=true, total_run_time=11.00, event_count=0, result_count=7, available_count=0, scan_count=0, drop_count=0, exec_time=1654276503, api_et=1622740500.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740500.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_startup_time="1001", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]']
Audit:[timestamp=06-03-2022 17:15:24.176, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276504.606515', has_error_warn=false, fully_completed_search=true, total_run_time=10.93, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276504, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="660", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk", app="SA-ThreatIntelligence", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Risk normid= [ search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:15:24.174, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654276500_781', has_error_warn=false, fully_completed_search=true, total_run_time=1.84, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654276503, api_et=1646327700.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646327700.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_startup_time="1361", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]']
Audit:[timestamp=06-03-2022 17:15:24.172, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654276500_787', has_error_warn=false, fully_completed_search=true, total_run_time=1.13, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276504, api_et=N/A, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_startup_time="1193", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]']
Audit:[timestamp=06-03-2022 17:15:24.168, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276500_784_1654276504.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276504, api_et=N/A, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:15:24.165, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLU5ldHdvcmtQcm90ZWN0aW9u__RMD5325f5a39ceb2c013_at_1654276500_785', has_error_warn=true, fully_completed_search=true, total_run_time=1.31, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276503, api_et=1654272300.000000000, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272300.000000000, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="Network - Whois Tracker - Lookup Gen", search_startup_time="1968", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-NetworkProtection_admin_6f1ba4d9bc3ea67a", app="DA-ESS-NetworkProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` max(_time) as _time,latest(All_Domains.resolved_domain) as resolved_domain,latest(All_Domains.created) as created from datamodel=Domain_Analysis.All_Domains by All_Domains.domain | `drop_dm_object_name("All_Domains")` | `truncate_domain(domain)` | eval _key=sha1(domain) | dedup _key | lookup whois_tracker _key OUTPUTNEW _time as lookup_time, resolved_domain as lookup_resolved_domain, created as lookup_created | eval lookup_time=if(isnum(lookup_time), lookup_time, 0), _time=max(_time, lookup_time), resolved_domain=if(_time>lookup_time, resolved_domain, lookup_resolved_domain), created=if(_time>lookup_time, created, lookup_created) | fields domain, _time, resolved_domain, created | search domain=* | runshellscript key_field=_key append=T whois_tracker | stats count']
Audit:[timestamp=06-03-2022 17:15:24.163, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5436ec4a2d17ac6f8_1654276500.606511', has_error_warn=false, fully_completed_search=true, total_run_time=1.71, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276500, api_et=1654274100.000000000, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274100.000000000, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="threatmatch://certificate_unit", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_5b1cff7f2da66858", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_unit"
    | lookup "threatintel_by_certificate_unit" value as "All_Certificates.SSL.ssl_issuer_unit" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_unit_wildcard" value as "All_Certificates.SSL.ssl_issuer_unit" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_unit",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_unit','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_unit"
    | lookup "threatintel_by_certificate_unit" value as "All_Certificates.SSL.ssl_subject_unit" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_unit_wildcard" value as "All_Certificates.SSL.ssl_subject_unit" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_unit",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_unit','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://certificate_unit"']
Audit:[timestamp=06-03-2022 17:15:24.162, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654276500_788', has_error_warn=false, fully_completed_search=true, total_run_time=10.88, event_count=5, result_count=3, available_count=0, scan_count=5, drop_count=0, exec_time=1654276506, api_et=N/A, api_lt=1654276500.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276500.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_startup_time="589", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]']
Audit:[timestamp=06-03-2022 17:15:24.161, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276509.606521', has_error_warn=false, fully_completed_search=true, total_run_time=10.56, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276509, api_et=1622740509.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622740509.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="369", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions normid= [ search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:15:14.614, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276514.606522', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit normid= [ search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:15:14 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:09.117, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276509.606521', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions normid= [ search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:15:09 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:07.063, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276507.606520', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Incident_Management normid= [ search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="SA-ThreatIntelligence", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:06.017, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654276500_789', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_type=adhoc, is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:05.990, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654276500_788', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:05.057, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276505.606519', search='summarize tstats=t action=probe id=DM_SA-NetworkProtection_Domain_Analysis normid= [ search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains] | eval backfill_start_time = relative_time(now(), "-1y") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:15:03 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="SA-NetworkProtection", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:04.100, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276504.606515', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Risk normid= [ search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="SA-ThreatIntelligence", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:03.970, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654276500_787', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:03.492, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276503.606514', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Ticket_Management normid= [ search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:15:03 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:02.960, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654276500_786', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,mitre_tactic_id_count,mitre_technique_id_count,prestats_reserved_*,psrsvd_*,risk_object,risk_object_type,source_count', apiStartTime='Thu Jun  2 17:05:00 2022', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:02.946, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLU5ldHdvcmtQcm90ZWN0aW9u__RMD5325f5a39ceb2c013_at_1654276500_785', search='| tstats `summariesonly` max(_time) as _time,latest(All_Domains.resolved_domain) as resolved_domain,latest(All_Domains.created) as created from datamodel=Domain_Analysis.All_Domains by All_Domains.domain | `drop_dm_object_name("All_Domains")` | `truncate_domain(domain)` | eval _key=sha1(domain) | dedup _key | lookup whois_tracker _key OUTPUTNEW _time as lookup_time, resolved_domain as lookup_resolved_domain, created as lookup_created | eval lookup_time=if(isnum(lookup_time), lookup_time, 0), _time=max(_time, lookup_time), resolved_domain=if(_time>lookup_time, resolved_domain, lookup_resolved_domain), created=if(_time>lookup_time, created, lookup_created) | fields domain, _time, resolved_domain, created | search domain=* | runshellscript key_field=_key append=T whois_tracker | stats count', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:05:00 2022', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Network - Whois Tracker - Lookup Gen", search_type=adhoc, is_proxied=false, app="DA-ESS-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:02.915, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276500_784', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:02.900, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654276500_783', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Wed Jun  1 17:00:00 2022', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESS - Notable Events", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:02.871, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtQWNjZXNzUHJvdGVjdGlvbg__RMD54a1edad66ca90d80_at_1654276500_782', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Authentication"."Authentication" where "Authentication.app"!="unknown" by "Authentication.app" | rename "Authentication.app" as "app" | inputlookup append=T "access_app_tracker" | stats min("firstTime") as "firstTime",max("lastTime") as "lastTime" by "app" | runshellscript override_if_empty=false "access_app_tracker" | stats count', autojoin='1', buckets=0, ttl=1800, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:45:00 2022', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Access - Access App Tracker - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-AccessProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:02.859, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654276500_781', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:15:00 2022', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:02.848, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654276500_780', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:15:00 2021', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:02.823, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654276500_779', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:15:00 2021', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:02.815, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654276500_778', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:15:00 2021', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:02.772, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654276500_777', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:15:00 2021', apiEndTime='Fri Jun  3 17:15:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:00.675, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5436ec4a2d17ac6f8_1654276500.606511', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_unit"
    | lookup "threatintel_by_certificate_unit" value as "All_Certificates.SSL.ssl_issuer_unit" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_unit_wildcard" value as "All_Certificates.SSL.ssl_issuer_unit" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_unit",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_unit','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_unit"
    | lookup "threatintel_by_certificate_unit" value as "All_Certificates.SSL.ssl_subject_unit" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_unit_wildcard" value as "All_Certificates.SSL.ssl_subject_unit" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_unit",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_unit','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://certificate_unit"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:35:00 2022', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://certificate_unit", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:00.640, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5dec7d406fe7b18e0_1654276500.606510', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Services.dest"),values("Services.user") from datamodel="Endpoint"."Services" by "Services.service"
    | lookup "threatintel_by_service" value as "Services.service" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_service_wildcard" value as "Services.service" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Services.dest,dest)`
    | `sistats_values_rename(Services.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"service",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Services.service','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://service"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:35:00 2022', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://service", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:15:00.523, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5e355dcc90e717b9e_1654276500.606509', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Filesystem.dest"),values("Filesystem.user") from datamodel="Endpoint"."Filesystem" by "Filesystem.file_name"
    | lookup "threatintel_by_file_name" value as "Filesystem.file_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_file_name_wildcard" value as "Filesystem.file_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Filesystem.dest,dest)`
    | `sistats_values_rename(Filesystem.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Filesystem.file_name','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.file_name"
    | lookup "threatintel_by_file_name" value as "All_Email.file_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_file_name_wildcard" value as "All_Email.file_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.file_name','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Malware_Attacks.src"),values("Malware_Attacks.dest"),values("Malware_Attacks.user") from datamodel="Malware"."Malware_Attacks" by "Malware_Attacks.file_name"
    | lookup "threatintel_by_file_name" value as "Malware_Attacks.file_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_file_name_wildcard" value as "Malware_Attacks.file_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Malware_Attacks.src,src)`
    | `sistats_values_rename(Malware_Attacks.dest,dest)`
    | `sistats_values_rename(Malware_Attacks.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Malware_Attacks.file_name','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Updates.dest") from datamodel="Updates"."Updates" by "Updates.file_name"
    | lookup "threatintel_by_file_name" value as "Updates.file_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_file_name_wildcard" value as "Updates.file_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Updates.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Updates.file_name','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://file_name"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:35:00 2022', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://file_name", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:14:54.165, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654276440_774', has_error_warn=false, fully_completed_search=true, total_run_time=37.02, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654276442, api_et=1651598040.000000000, api_lt=1654276440.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651598040.000000000, search_lt=1654276440.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_startup_time="1203", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]']
Audit:[timestamp=06-03-2022 17:14:54.160, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276440_776', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276482, api_et=1654272240.000000000, api_lt=1654275840.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272240.000000000, search_lt=1654275840.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:14:42.106, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276440_776', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:04:00 2022', apiEndTime='Fri Jun  3 17:04:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:14:24.176, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276440_775_1654276443.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276443, api_et=N/A, api_lt=1654276440.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276440.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:14:24.170, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654276440_773', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276442, api_et=1622740440.000000000, api_lt=1654276440.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740440.000000000, search_lt=1654276440.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]']
Audit:[timestamp=06-03-2022 17:14:24.167, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276440_775_1654276442.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.59, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276442, api_et=N/A, api_lt=1654276440.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276440.000000000, is_realtime=0, savedsearch_name="", search_startup_time="65", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:14:24.164, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276440_775', has_error_warn=false, fully_completed_search=true, total_run_time=14.45, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276442, api_et=N/A, api_lt=1654276440.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276440.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1456", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:14:24.161, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276440_775_1654276443.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.14, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276443, api_et=N/A, api_lt=1654276440.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276440.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:14:01.856, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276440_775', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:14:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:14:01.845, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654276440_774', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:14:00 2022', apiEndTime='Fri Jun  3 17:14:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:14:01.832, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654276440_773', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:14:00 2021', apiEndTime='Fri Jun  3 17:14:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:54.162, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276380_772', has_error_warn=false, fully_completed_search=true, total_run_time=10.34, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276420, api_et=1654272180.000000000, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272180.000000000, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:13:40.361, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276380_772', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:03:00 2022', apiEndTime='Fri Jun  3 17:03:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:24.189, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654276380_762', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276382, api_et=1651597980.000000000, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597980.000000000, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]']
Audit:[timestamp=06-03-2022 17:13:24.187, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276382.606488', has_error_warn=false, fully_completed_search=true, total_run_time=10.66, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276382, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="610", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71", app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb635087639505149 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:13:24.186, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276380_767_1654276383.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.18, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276383, api_et=N/A, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="", search_startup_time="9", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:13:24.184, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654276380_764', has_error_warn=false, fully_completed_search=true, total_run_time=2.01, event_count=0, result_count=98, available_count=0, scan_count=0, drop_count=0, exec_time=1654276382, api_et=1622740380.000000000, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740380.000000000, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_startup_time="1143", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]']
Audit:[timestamp=06-03-2022 17:13:24.182, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654276380_763', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276382, api_et=1651597980.000000000, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597980.000000000, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]']
Audit:[timestamp=06-03-2022 17:13:24.179, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654276380_766', has_error_warn=false, fully_completed_search=true, total_run_time=11.36, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654276382, api_et=1651597980.000000000, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597980.000000000, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_startup_time="1065", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]']
Audit:[timestamp=06-03-2022 17:13:24.176, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654276380_769', has_error_warn=false, fully_completed_search=true, total_run_time=12.05, event_count=1, result_count=99, available_count=0, scan_count=1, drop_count=0, exec_time=1654276383, api_et=N/A, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_startup_time="678", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_Successful_Authentication, Authentication.is_not_Successful_Authentication, Authentication.is_Default_Authentication, Authentication.is_not_Default_Authentication, Authentication.is_Insecure_Authentication, Authentication.is_not_Insecure_Authentication, Authentication.is_Privileged_Authentication, Authentication.is_not_Privileged_Authentication, Authentication.Default_Authentication.is_Failed_Default_Authentication, Authentication.Default_Authentication.is_not_Failed_Default_Authentication, Authentication.Default_Authentication.is_Successful_Default_Authentication, Authentication.Default_Authentication.is_not_Successful_Default_Authentication, Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication ]']
Audit:[timestamp=06-03-2022 17:13:24.174, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654276380_765', has_error_warn=false, fully_completed_search=true, total_run_time=10.30, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276382, api_et=1651597980.000000000, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597980.000000000, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]']
Audit:[timestamp=06-03-2022 17:13:24.171, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654276380_771', has_error_warn=false, fully_completed_search=true, total_run_time=10.63, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276384, api_et=1622740380.000000000, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740380.000000000, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_startup_time="724", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis", app="SA-NetworkProtection", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]']
Audit:[timestamp=06-03-2022 17:13:24.170, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276380_767_1654276383.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276383, api_et=N/A, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:13:24.168, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276380_767', has_error_warn=false, fully_completed_search=true, total_run_time=14.26, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276382, api_et=N/A, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1255", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:13:24.167, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276380_767_1654276382.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.63, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276382, api_et=N/A, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="", search_startup_time="85", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:13:24.165, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654276380_770', has_error_warn=false, fully_completed_search=true, total_run_time=11.23, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654276383, api_et=1651597980.000000000, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597980.000000000, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_startup_time="597", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]']
Audit:[timestamp=06-03-2022 17:13:24.164, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654276380_768', has_error_warn=false, fully_completed_search=true, total_run_time=10.25, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276383, api_et=N/A, api_lt=1654276380.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276380.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_startup_time="254", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]']
Audit:[timestamp=06-03-2022 17:13:24.162, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276383.606489', has_error_warn=false, fully_completed_search=true, total_run_time=10.30, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276383, api_et=1651597982.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651597982.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="321", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Processes normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:13:24.160, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276394.606490', has_error_warn=false, fully_completed_search=true, total_run_time=10.73, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276394, api_et=1651597994.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651597994.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="426", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Filesystem normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:13:14.351, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276394.606490', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Filesystem normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:13:14 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:04.118, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654276380_771', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:13:00 2021', apiEndTime='Fri Jun  3 17:13:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:03.265, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276383.606489', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Processes normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:13:02 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:03.105, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654276380_770', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:13:00 2022', apiEndTime='Fri Jun  3 17:13:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:03.093, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654276380_769', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Aut (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:13:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:03.082, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654276380_768', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:13:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:02.476, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276382.606488', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb635087639505149 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:02.075, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276380_767', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:13:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:02.064, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654276380_766', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:13:00 2022', apiEndTime='Fri Jun  3 17:13:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:02.043, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654276380_765', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:13:00 2022', apiEndTime='Fri Jun  3 17:13:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:02.029, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654276380_764', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:13:00 2021', apiEndTime='Fri Jun  3 17:13:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:02.014, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654276380_763', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:13:00 2022', apiEndTime='Fri Jun  3 17:13:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:13:01.980, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654276380_762', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:13:00 2022', apiEndTime='Fri Jun  3 17:13:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:12:54.176, user=admin, action=search, info=bad_request, search_id='rt_md_1654276013.606303', has_error_warn=true, fully_completed_search=true, total_run_time=345.07, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276013, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=1, savedsearch_name="", search_startup_time="23", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_search_admin_d79d8decd779a2d3", app="search", provenance="UI:Search", mode="RT_indexed", is_proxied=false, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| metadata type=sourcetypes | search totalCount > 0']
Audit:[timestamp=06-03-2022 17:12:54.164, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276320_761', has_error_warn=false, fully_completed_search=true, total_run_time=10.03, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276362, api_et=1654272120.000000000, api_lt=1654275720.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272120.000000000, search_lt=1654275720.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="176", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:12:42.511, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276320_761', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:02:00 2022', apiEndTime='Fri Jun  3 17:02:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:12:24.184, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654276320_758', has_error_warn=false, fully_completed_search=true, total_run_time=10.30, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276322, api_et=1622740320.000000000, api_lt=1654276320.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740320.000000000, search_lt=1654276320.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_startup_time="688", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]']
Audit:[timestamp=06-03-2022 17:12:24.182, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654276320_756', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276322, api_et=1646327520.000000000, api_lt=1654276320.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646327520.000000000, search_lt=1654276320.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]']
Audit:[timestamp=06-03-2022 17:12:24.180, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276323.606475', has_error_warn=false, fully_completed_search=true, total_run_time=10.48, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276323, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="316", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548", app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb26032d7500783b0 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:12:24.177, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654276320_759', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276322, api_et=1646327520.000000000, api_lt=1654276320.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646327520.000000000, search_lt=1654276320.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]']
Audit:[timestamp=06-03-2022 17:12:24.176, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276322.606474', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276322, api_et=1646327522.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1646327522.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="351", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Resolution normid= [ search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:12:24.175, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276320_760', has_error_warn=false, fully_completed_search=true, total_run_time=14.52, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276322, api_et=N/A, api_lt=1654276320.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276320.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1485", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:12:24.173, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276320_760_1654276323.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276323, api_et=N/A, api_lt=1654276320.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276320.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:12:24.167, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276330.606478', has_error_warn=false, fully_completed_search=true, total_run_time=1.45, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276330, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="878", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Change normid= [ search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename dest_bunit AS All_Changes.dest_bunit dest_category AS All_Changes.dest_category dest_priority AS All_Changes.dest_priority src_bunit AS All_Changes.src_bunit src_category AS All_Changes.src_category src_priority AS All_Changes.src_priority tag AS All_Changes.tag user_agent AS All_Changes.user_agent user_bunit AS All_Changes.user_bunit user_category AS All_Changes.user_category user_priority AS All_Changes.user_priority user_type AS All_Changes.user_type vendor_account AS All_Changes.vendor_account vendor_region AS All_Changes.vendor_region change_type AS All_Changes.change_type command AS All_Changes.command dest AS All_Changes.dest dvc AS All_Changes.dvc object AS All_Changes.object object_attrs AS All_Changes.object_attrs object_category AS All_Changes.object_category object_id AS All_Changes.object_id object_path AS All_Changes.object_path status AS All_Changes.status result AS All_Changes.result result_id AS All_Changes.result_id src AS All_Changes.src user AS All_Changes.user user_name AS All_Changes.user_name vendor_product AS All_Changes.vendor_product action AS All_Changes.action is_Auditing_Changes AS All_Changes.is_Auditing_Changes is_not_Auditing_Changes AS All_Changes.is_not_Auditing_Changes is_Endpoint_Changes AS All_Changes.is_Endpoint_Changes is_not_Endpoint_Changes AS All_Changes.is_not_Endpoint_Changes is_Network_Changes AS All_Changes.is_Network_Changes is_not_Network_Changes AS All_Changes.is_not_Network_Changes is_Account_Management AS All_Changes.is_Account_Management is_not_Account_Management AS All_Changes.is_not_Account_Management is_Instance_Changes AS All_Changes.is_Instance_Changes is_not_Instance_Changes AS All_Changes.is_not_Instance_Changes | fields nodename, _time, host, source, sourcetype, All_Changes.dest_bunit, All_Changes.dest_category, All_Changes.dest_priority, All_Changes.src_bunit, All_Changes.src_category, All_Changes.src_priority, All_Changes.tag, All_Changes.user_agent, All_Changes.user_bunit, All_Changes.user_category, All_Changes.user_priority, All_Changes.user_type, All_Changes.vendor_account, All_Changes.vendor_region, All_Changes.change_type, All_Changes.command, All_Changes.dest, All_Changes.dvc, All_Changes.object, All_Changes.object_attrs, All_Changes.object_category, All_Changes.object_id, All_Changes.object_path, All_Changes.status, All_Changes.result, All_Changes.result_id, All_Changes.src, All_Changes.user, All_Changes.user_name, All_Changes.vendor_product, All_Changes.action, All_Changes.is_Auditing_Changes, All_Changes.is_not_Auditing_Changes, All_Changes.is_Endpoint_Changes, All_Changes.is_not_Endpoint_Changes, All_Changes.is_Network_Changes, All_Changes.is_not_Network_Changes, All_Changes.is_Account_Management, All_Changes.is_not_Account_Management, All_Changes.is_Instance_Changes, All_Changes.is_not_Instance_Changes, All_Changes.Endpoint_Changes.is_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes, All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes, All_Changes.Network_Changes.dest_ip_range, All_Changes.Network_Changes.dest_port_range, All_Changes.Network_Changes.direction, All_Changes.Network_Changes.protocol, All_Changes.Network_Changes.rule_action, All_Changes.Network_Changes.src_ip_range, All_Changes.Network_Changes.src_port_range, All_Changes.Network_Changes.is_Device_Restarts, All_Changes.Network_Changes.is_not_Device_Restarts, All_Changes.Account_Management.src_user_bunit, All_Changes.Account_Management.src_user_category, All_Changes.Account_Management.src_user_priority, All_Changes.Account_Management.src_user_type, All_Changes.Account_Management.dest_nt_domain, All_Changes.Account_Management.src_nt_domain, All_Changes.Account_Management.src_user, All_Changes.Account_Management.src_user_name, All_Changes.Account_Management.is_Accounts_Created, All_Changes.Account_Management.is_not_Accounts_Created, All_Changes.Account_Management.is_Accounts_Deleted, All_Changes.Account_Management.is_not_Accounts_Deleted, All_Changes.Account_Management.is_Account_Lockouts, All_Changes.Account_Management.is_not_Account_Lockouts, All_Changes.Account_Management.is_Accounts_Updated, All_Changes.Account_Management.is_not_Accounts_Updated, All_Changes.Instance_Changes.image_id, All_Changes.Instance_Changes.instance_type]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:12:24.164, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276320_760_1654276323.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.15, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276323, api_et=N/A, api_lt=1654276320.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276320.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:12:24.163, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276320_760_1654276322.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.59, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276322, api_et=N/A, api_lt=1654276320.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276320.000000000, is_realtime=0, savedsearch_name="", search_startup_time="63", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:12:24.161, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654276320_757', has_error_warn=false, fully_completed_search=true, total_run_time=7.75, event_count=358, result_count=99, available_count=0, scan_count=777, drop_count=0, exec_time=1654276322, api_et=N/A, api_lt=1654276320.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276320.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_startup_time="1515", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename dest_bunit AS All_Changes.dest_bunit dest_category AS All_Changes.dest_category dest_priority AS All_Changes.dest_priority src_bunit AS All_Changes.src_bunit src_category AS All_Changes.src_category src_priority AS All_Changes.src_priority tag AS All_Changes.tag user_agent AS All_Changes.user_agent user_bunit AS All_Changes.user_bunit user_category AS All_Changes.user_category user_priority AS All_Changes.user_priority user_type AS All_Changes.user_type vendor_account AS All_Changes.vendor_account vendor_region AS All_Changes.vendor_region change_type AS All_Changes.change_type command AS All_Changes.command dest AS All_Changes.dest dvc AS All_Changes.dvc object AS All_Changes.object object_attrs AS All_Changes.object_attrs object_category AS All_Changes.object_category object_id AS All_Changes.object_id object_path AS All_Changes.object_path status AS All_Changes.status result AS All_Changes.result result_id AS All_Changes.result_id src AS All_Changes.src user AS All_Changes.user user_name AS All_Changes.user_name vendor_product AS All_Changes.vendor_product action AS All_Changes.action is_Auditing_Changes AS All_Changes.is_Auditing_Changes is_not_Auditing_Changes AS All_Changes.is_not_Auditing_Changes is_Endpoint_Changes AS All_Changes.is_Endpoint_Changes is_not_Endpoint_Changes AS All_Changes.is_not_Endpoint_Changes is_Network_Changes AS All_Changes.is_Network_Changes is_not_Network_Changes AS All_Changes.is_not_Network_Changes is_Account_Management AS All_Changes.is_Account_Management is_not_Account_Management AS All_Changes.is_not_Account_Management is_Instance_Changes AS All_Changes.is_Instance_Changes is_not_Instance_Changes AS All_Changes.is_not_Instance_Changes | fields nodename, _time, host, source, sourcetype, All_Changes.dest_bunit, All_Changes.dest_category, All_Changes.dest_priority, All_Changes.src_bunit, All_Changes.src_category, All_Changes.src_priority, All_Changes.tag, All_Changes.user_agent, All_Changes.user_bunit, All_Changes.user_category, All_Changes.user_priority, All_Changes.user_type, All_Changes.vendor_account, All_Changes.vendor_region, All_Changes.change_type, All_Changes.command, All_Changes.dest, All_Changes.dvc, All_Changes.object, All_Changes.object_attrs, All_Changes.object_category, All_Changes.object_id, All_Changes.object_path, All_Changes.status, All_Changes.result, All_Changes.result_id, All_Changes.src, All_Changes.user, All_Changes.user_name, All_Changes.vendor_product, All_Changes.action, All_Changes.is_Auditing_Changes, All_Changes.is_not_Auditing_Changes, All_Changes.is_Endpoint_Changes, All_Changes.is_not_Endpoint_Changes, All_Changes.is_Network_Changes, All_Changes.is_not_Network_Changes, All_Changes.is_Account_Management, All_Changes.is_not_Account_Management, All_Changes.is_Instance_Changes, All_Changes.is_not_Instance_Changes, All_Changes.Endpoint_Changes.is_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes, All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes, All_Changes.Network_Changes.dest_ip_range, All_Changes.Network_Changes.dest_port_range, All_Changes.Network_Changes.direction, All_Changes.Network_Changes.protocol, All_Changes.Network_Changes.rule_action, All_Changes.Network_Changes.src_ip_range, All_Changes.Network_Changes.src_port_range, All_Changes.Network_Changes.is_Device_Restarts, All_Changes.Network_Changes.is_not_Device_Restarts, All_Changes.Account_Management.src_user_bunit, All_Changes.Account_Management.src_user_category, All_Changes.Account_Management.src_user_priority, All_Changes.Account_Management.src_user_type, All_Changes.Account_Management.dest_nt_domain, All_Changes.Account_Management.src_nt_domain, All_Changes.Account_Management.src_user, All_Changes.Account_Management.src_user_name, All_Changes.Account_Management.is_Accounts_Created, All_Changes.Account_Management.is_not_Accounts_Created, All_Changes.Account_Management.is_Accounts_Deleted, All_Changes.Account_Management.is_not_Accounts_Deleted, All_Changes.Account_Management.is_Account_Lockouts, All_Changes.Account_Management.is_not_Account_Lockouts, All_Changes.Account_Management.is_Accounts_Updated, All_Changes.Account_Management.is_not_Accounts_Updated, All_Changes.Instance_Changes.image_id, All_Changes.Instance_Changes.instance_type ]']
Audit:[timestamp=06-03-2022 17:12:10.477, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276330.606478', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Change normid= [ search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename des (truncated)', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:12:03.339, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276323.606475', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb26032d7500783b0 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:12:02.966, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276322.606474', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Resolution normid= [ search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Mar  3 17:12:02 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:12:02.273, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276320_760', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:12:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:12:02.263, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654276320_759', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:12:00 2022', apiEndTime='Fri Jun  3 17:12:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:12:02.255, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654276320_758', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:12:00 2021', apiEndTime='Fri Jun  3 17:12:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:12:02.246, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654276320_757', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_typ (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:12:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:12:02.232, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654276320_756', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:12:00 2022', apiEndTime='Fri Jun  3 17:12:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:11:54.165, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276260_755', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276303, api_et=1654272060.000000000, api_lt=1654275660.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272060.000000000, search_lt=1654275660.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:11:42.702, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276260_755', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:01:00 2022', apiEndTime='Fri Jun  3 17:01:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:11:24.182, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276260_754', has_error_warn=false, fully_completed_search=true, total_run_time=14.31, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276262, api_et=N/A, api_lt=1654276260.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276260.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1237", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:11:24.179, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654276260_751', has_error_warn=false, fully_completed_search=true, total_run_time=1.86, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654276262, api_et=1646327460.000000000, api_lt=1654276260.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646327460.000000000, search_lt=1654276260.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_startup_time="1232", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]']
Audit:[timestamp=06-03-2022 17:11:24.174, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276264.606444', has_error_warn=false, fully_completed_search=true, total_run_time=1.52, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276264, api_et=1646327464.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1646327464.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="843", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Traffic normid= [ search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:11:24.171, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276260_754_1654276262.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.63, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276262, api_et=N/A, api_lt=1654276260.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276260.000000000, is_realtime=0, savedsearch_name="", search_startup_time="67", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:11:24.170, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654276260_752', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276262, api_et=1622740260.000000000, api_lt=1654276260.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740260.000000000, search_lt=1654276260.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]']
Audit:[timestamp=06-03-2022 17:11:24.166, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276260_754_1654276263.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.15, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276263, api_et=N/A, api_lt=1654276260.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276260.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:11:24.163, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276260_754_1654276263.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276263, api_et=N/A, api_lt=1654276260.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276260.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:11:24.162, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654276260_753', has_error_warn=false, fully_completed_search=true, total_run_time=10.32, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276262, api_et=1622740260.000000000, api_lt=1654276260.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740260.000000000, search_lt=1654276260.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]']
Audit:[timestamp=06-03-2022 17:11:04.624, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276264.606444', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Traffic normid= [ search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Mar  3 17:11:04 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:11:02.451, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276260_754', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:11:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:11:02.434, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654276260_753', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:11:00 2021', apiEndTime='Fri Jun  3 17:11:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:11:02.382, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654276260_752', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:11:00 2021', apiEndTime='Fri Jun  3 17:11:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:11:02.331, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654276260_751', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:11:00 2022', apiEndTime='Fri Jun  3 17:11:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:54.168, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276200_750', has_error_warn=false, fully_completed_search=true, total_run_time=10.03, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276240, api_et=1654272000.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272000.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="169", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:10:40.827, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276200_750', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 16:00:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:24.209, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtRW5kcG9pbnRQcm90ZWN0aW9u__RMD5147a7530bec00016_at_1654276200_742', has_error_warn=true, fully_completed_search=true, total_run_time=2.29, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276204, api_et=1654272000.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272000.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="Endpoint - User Account Tracker - Lookup Gen", search_startup_time="1319", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-EndpointProtection_admin_fde5f3f3d4a35307", app="SA-EndpointProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=15, eliminated_buckets=15, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=1109, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| from datamodel:"Compute_Inventory"."User" | stats min("_time") as firstTime,max("_time") as lastTime,latest("interactive") as interactive by dest,user | eval _key=sha1(dest.user) | dedup _key | lookup useraccounts_tracker _key OUTPUTNEW firstTime as lookup_firstTime, lastTime as lookup_lastTime, interactive as lookup_interactive | eval lookup_lastTime=if(isnum(lookup_lastTime), lookup_lastTime, 0), firstTime=min(firstTime, lookup_firstTime), lastTime=max(lastTime, lookup_lastTime), interactive=if(lastTime>lookup_lastTime, interactive, lookup_interactive) | fields firstTime,lastTime,dest,user,interactive | runshellscript key_field=_key append=T useraccounts_tracker| stats count']
Audit:[timestamp=06-03-2022 17:10:24.207, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD51dbc70e0e18846c9_at_1654276200_737', has_error_warn=false, fully_completed_search=true, total_run_time=1.13, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276203, api_et=N/A, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="Threat - Notable Owners - Lookup Gen", search_startup_time="1420", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a775b1da515861dc", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/authentication/users | search capabilities="can_own_notable_events" | rename title as owner | append [| makeresults | eval owner="unassigned" ] | eval _key=owner | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key owner realname | runshellscript notable_owners_lookup | stats count']
Audit:[timestamp=06-03-2022 17:10:24.206, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654276200_732', has_error_warn=false, fully_completed_search=true, total_run_time=1.96, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654276202, api_et=1646327400.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646327400.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_startup_time="1246", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]']
Audit:[timestamp=06-03-2022 17:10:24.204, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654276200_730', has_error_warn=false, fully_completed_search=true, total_run_time=6.07, event_count=35, result_count=3, available_count=0, scan_count=35, drop_count=0, exec_time=1654276202, api_et=1622740200.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740200.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_startup_time="1091", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]']
Audit:[timestamp=06-03-2022 17:10:24.202, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654276200_746', has_error_warn=false, fully_completed_search=true, total_run_time=10.69, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276206, api_et=N/A, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_startup_time="604", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]']
Audit:[timestamp=06-03-2022 17:10:24.200, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD56997a89005f6ba62_at_1654276200_738', has_error_warn=false, fully_completed_search=true, total_run_time=1.14, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276203, api_et=1654274400.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274400.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="Network - IDS Category Tracker - Lookup Gen", search_startup_time="1753", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-NetworkProtection_admin_1792d24b7bd8cf59", app="SA-NetworkProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Intrusion_Detection"."IDS_Attacks" where "IDS_Attacks.category"!="unknown" by "IDS_Attacks.category","IDS_Attacks.vendor_product" | rename "IDS_Attacks.category" as "category","IDS_Attacks.vendor_product" as "vendor_product" | inputlookup append=T "ids_category_tracker" | stats min("firstTime") as "firstTime",max("lastTime") as "lastTime" by "category","vendor_product" | runshellscript override_if_empty=false "ids_category_tracker" | stats count']
Audit:[timestamp=06-03-2022 17:10:24.199, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276205.606412', has_error_warn=false, fully_completed_search=true, total_run_time=10.54, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276205, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="359", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence", app="DA-ESS-ThreatIntelligence", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence normid= [ search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:10:24.198, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5bf3181ec0c11c49b_1654276200.606403', has_error_warn=false, fully_completed_search=true, total_run_time=3.06, event_count=9, result_count=0, available_count=0, scan_count=9, drop_count=0, exec_time=1654276200, api_et=1654273800.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273800.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="threatmatch://file_hash", search_startup_time="3130", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_3c8f63cb0464167c", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_hash"
    | lookup "threatintel_by_file_hash" value as "All_Certificates.SSL.ssl_hash" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_hash",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_hash','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Filesystem.dest"),values("Filesystem.user") from datamodel="Endpoint"."Filesystem" by "Filesystem.file_hash"
    | lookup "threatintel_by_file_hash" value as "Filesystem.file_hash" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Filesystem.dest,dest)`
    | `sistats_values_rename(Filesystem.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_hash",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Filesystem.file_hash','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.file_hash"
    | lookup "threatintel_by_file_hash" value as "All_Email.file_hash" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_hash",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.file_hash','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Malware_Attacks.src"),values("Malware_Attacks.dest"),values("Malware_Attacks.user") from datamodel="Malware"."Malware_Attacks" by "Malware_Attacks.file_hash"
    | lookup "threatintel_by_file_hash" value as "Malware_Attacks.file_hash" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Malware_Attacks.src,src)`
    | `sistats_values_rename(Malware_Attacks.dest,dest)`
    | `sistats_values_rename(Malware_Attacks.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_hash",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Malware_Attacks.file_hash','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Updates.dest") from datamodel="Updates"."Updates" by "Updates.file_hash"
    | lookup "threatintel_by_file_hash" value as "Updates.file_hash" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Updates.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_hash",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Updates.file_hash','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://file_hash"']
Audit:[timestamp=06-03-2022 17:10:24.194, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276200_740_1654276203.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.78, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276203, api_et=N/A, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="", search_startup_time="91", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:10:24.193, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5a742da37541343b2_at_1654276200_736', has_error_warn=false, fully_completed_search=true, total_run_time=10.90, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276202, api_et=1653670800.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1653670800.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Risk - 7 Day ATT&CK Tactic Threshold Exceeded - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_553873b00608ee08", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count, values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk where All_Risk.annotations.mitre_attack.mitre_tactic_id=* by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id' | where mitre_tactic_id_count >= 3 and source_count >= 4']
Audit:[timestamp=06-03-2022 17:10:24.192, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD56dc2dd36bb2e24c4_1654276200.606404', has_error_warn=false, fully_completed_search=true, total_run_time=1.13, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276200, api_et=1654273800.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273800.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="threatmatch://registry_value_text", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_e6cdf0668ea0c54d", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Registry.dest"),values("Registry.user") from datamodel="Endpoint"."Registry" by "Registry.registry_value_text"
    | lookup "threatintel_by_registry_value_text" value as "Registry.registry_value_text" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_registry_value_text_wildcard" value as "Registry.registry_value_text" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Registry.dest,dest)`
    | `sistats_values_rename(Registry.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"registry_value_text",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Registry.registry_value_text','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://registry_value_text"']
Audit:[timestamp=06-03-2022 17:10:24.189, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654276200_731', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276202, api_et=1622740200.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740200.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_startup_time="631", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]']
Audit:[timestamp=06-03-2022 17:10:24.187, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654276200_739', has_error_warn=false, fully_completed_search=true, total_run_time=3.35, event_count=2890, result_count=1, available_count=0, scan_count=2890, drop_count=0, exec_time=1654276203, api_et=1654102800.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654102800.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="ESS - Notable Events", search_startup_time="2731", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_87db9bb7a232c62f", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=1, eliminated_buckets=0, considered_events=2890, total_slices=121, decompressed_slices=10, duration.command.search.index=1, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=143, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, sourcetype_count__stash=2890, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count']
Audit:[timestamp=06-03-2022 17:10:24.186, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654276200_743', has_error_warn=false, fully_completed_search=true, total_run_time=10.41, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276204, api_et=1654189200.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654189200.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_startup_time="572", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_d34d6d33ee94d419", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`']
Audit:[timestamp=06-03-2022 17:10:24.185, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5fdbe716eed5fd8d5_at_1654276200_748', has_error_warn=false, fully_completed_search=true, total_run_time=10.47, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276207, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39_ACCELERATE_", search_startup_time="490", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=report_acceleration, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized ]']
Audit:[timestamp=06-03-2022 17:10:24.183, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD51dbc70e0e18846c9_at_1654276200_737_1654276203.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.05, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276203, api_et=N/A, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_f2df6493ea859e37", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search=' | makeresults | eval owner="unassigned"']
Audit:[timestamp=06-03-2022 17:10:24.182, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD591854b6694917629_at_1654276200_749', has_error_warn=false, fully_completed_search=true, total_run_time=10.46, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276209, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71_ACCELERATE_", search_startup_time="321", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=report_acceleration, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time ]']
Audit:[timestamp=06-03-2022 17:10:24.180, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276204.606410', has_error_warn=false, fully_completed_search=true, total_run_time=10.92, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276204, api_et=1646327404.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1646327404.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="550", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Web normid= [ search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:10:24.178, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD5495078187e88a4c3_at_1654276200_735', has_error_warn=false, fully_completed_search=true, total_run_time=10.65, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276202, api_et=N/A, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="Utils - User Realnames - Lookup Gen", search_startup_time="1053", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_a775b1da515861dc", app="SA-Utils", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/authentication/users | rename title as user | eval _key=user | dedup _key | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key user realname | runshellscript key_field=_key user_realnames_lookup | stats count']
Audit:[timestamp=06-03-2022 17:10:24.177, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtRW5kcG9pbnRQcm90ZWN0aW9u__RMD587874a5c6365af85_at_1654276200_741', has_error_warn=true, fully_completed_search=true, total_run_time=1.04, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276203, api_et=1654272000.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654272000.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="Endpoint - Malware Tracker - Lookup Gen", search_startup_time="1283", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-EndpointProtection_admin_2a45ec51f0f4c027", app="SA-EndpointProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Malware"."Malware_Attacks" by "Malware_Attacks.dest","Malware_Attacks.signature" | rename "Malware_Attacks.dest" as "dest","Malware_Attacks.signature" as "signature" | eval _key=sha1('dest'.'signature') | dedup _key | lookup "malware_tracker" "_key" OUTPUTNEW "firstTime" as "lookup_firstTime","lastTime" as "lookup_lastTime" | eval "firstTime"=min('firstTime','lookup_firstTime'),"lastTime"=max('lastTime','lookup_lastTime') | fields - "lookup_firstTime","lookup_lastTime" | runshellscript append=T key_field=_key "malware_tracker" | stats count']
Audit:[timestamp=06-03-2022 17:10:24.176, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276200_740', has_error_warn=false, fully_completed_search=true, total_run_time=15.11, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276203, api_et=N/A, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="2158", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:10:24.174, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654276200_733', has_error_warn=false, fully_completed_search=true, total_run_time=11.05, event_count=1, result_count=7, available_count=0, scan_count=8, drop_count=0, exec_time=1654276202, api_et=1622740200.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740200.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_startup_time="1213", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]']
Audit:[timestamp=06-03-2022 17:10:24.171, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276200_740_1654276204.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.15, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276204, api_et=N/A, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:10:24.169, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276200_740_1654276204.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276204, api_et=N/A, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:10:24.168, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5a335f60452fd92f6_1654276200.606402', has_error_warn=false, fully_completed_search=true, total_run_time=1.35, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276200, api_et=1654273800.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273800.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="threatmatch://certificate_serial", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_909ca41cfd6d5d0b", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_serial"
    | lookup "threatintel_by_certificate_serial" value as "All_Certificates.SSL.ssl_serial" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_serial",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_serial','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://certificate_serial"']
Audit:[timestamp=06-03-2022 17:10:24.166, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654276200_734', has_error_warn=false, fully_completed_search=true, total_run_time=11.46, event_count=124, result_count=18, available_count=0, scan_count=690, drop_count=0, exec_time=1654276202, api_et=1622740200.000000000, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740200.000000000, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_startup_time="1627", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]']
Audit:[timestamp=06-03-2022 17:10:24.163, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654276200_745', has_error_warn=false, fully_completed_search=true, total_run_time=10.90, event_count=5, result_count=3, available_count=0, scan_count=5, drop_count=0, exec_time=1654276205, api_et=N/A, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_startup_time="603", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]']
Audit:[timestamp=06-03-2022 17:10:24.162, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD55392d2cd3b6dec88_at_1654276200_747', has_error_warn=false, fully_completed_search=true, total_run_time=10.45, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276207, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548_ACCELERATE_", search_startup_time="307", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=report_acceleration, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress ]']
Audit:[timestamp=06-03-2022 17:10:24.160, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654276200_744', has_error_warn=false, fully_completed_search=true, total_run_time=10.80, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276204, api_et=N/A, api_lt=1654276200.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276200.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_startup_time="836", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence", app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]']
Audit:[timestamp=06-03-2022 17:10:09.589, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD591854b6694917629_at_1654276200_749', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time ]', autojoin='1', buckets=0, ttl=60, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71_ACCELERATE_", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:07.577, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5fdbe716eed5fd8d5_at_1654276200_748', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized ]', autojoin='1', buckets=0, ttl=60, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39_ACCELERATE_", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:07.569, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD55392d2cd3b6dec88_at_1654276200_747', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress ]', autojoin='1', buckets=0, ttl=60, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548_ACCELERATE_", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:06.695, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654276200_746', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:05.800, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276205.606412', search='summarize tstats=t action=probe id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence normid= [ search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:05.677, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654276200_745', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:04.691, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276204.606410', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Web normid= [ search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Mar  3 17:10:04 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:04.662, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654276200_744', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_type=adhoc, is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:04.644, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654276200_743', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,mitre_tactic_id_count,mitre_technique_id_count,prestats_reserved_*,psrsvd_*,risk_object,risk_object_type,source_count', apiStartTime='Thu Jun  2 17:00:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:03.621, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtRW5kcG9pbnRQcm90ZWN0aW9u__RMD5147a7530bec00016_at_1654276200_742', search='| from datamodel:"Compute_Inventory"."User" | stats min("_time") as firstTime,max("_time") as lastTime,latest("interactive") as interactive by dest,user | eval _key=sha1(dest.user) | dedup _key | lookup useraccounts_tracker _key OUTPUTNEW firstTime as lookup_firstTime, lastTime as lookup_lastTime, interactive as lookup_interactive | eval lookup_lastTime=if(isnum(lookup_lastTime), lookup_lastTime, 0), firstTime=min(firstTime, lookup_firstTime), lastTime=max(lastTime, lookup_lastTime), interactive=if(lastTime>lookup_lastTime, interactive, lookup_interactive) | fields firstTime,lastTime,dest,user,interactive | runshellscript key_field=_key append=T useraccounts_tracker| stats count', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:00:00 2022', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Endpoint - User Account Tracker - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-EndpointProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:03.570, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtRW5kcG9pbnRQcm90ZWN0aW9u__RMD587874a5c6365af85_at_1654276200_741', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Malware"."Malware_Attacks" by "Malware_Attacks.dest","Malware_Attacks.signature" | rename "Malware_Attacks.dest" as "dest","Malware_Attacks.signature" as "signature" | eval _key=sha1('dest'.'signature') | dedup _key | lookup "malware_tracker" "_key" OUTPUTNEW "firstTime" as "lookup_firstTime","lastTime" as "lookup_lastTime" | eval "firstTime"=min('firstTime','lookup_firstTime'),"lastTime"=max('lastTime','lookup_lastTime') | fields - "lookup_firstTime","lookup_lastTime" | runshellscript append=T key_field=_key "malware_tracker" | stats count', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:00:00 2022', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Endpoint - Malware Tracker - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-EndpointProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:02.547, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276200_740', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:02.521, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654276200_739', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Wed Jun  1 17:00:00 2022', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESS - Notable Events", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:02.471, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD56997a89005f6ba62_at_1654276200_738', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Intrusion_Detection"."IDS_Attacks" where "IDS_Attacks.category"!="unknown" by "IDS_Attacks.category","IDS_Attacks.vendor_product" | rename "IDS_Attacks.category" as "category","IDS_Attacks.vendor_product" as "vendor_product" | inputlookup append=T "ids_category_tracker" | stats min("firstTime") as "firstTime",max("lastTime") as "lastTime" by "category","vendor_product" | runshellscript override_if_empty=false "ids_category_tracker" | stats count', autojoin='1', buckets=0, ttl=1800, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:40:00 2022', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Network - IDS Category Tracker - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:02.450, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD51dbc70e0e18846c9_at_1654276200_737', search='| rest tshirt_server=local count=0 /services/authentication/users | search capabilities="can_own_notable_events" | rename title as owner | append [| makeresults | eval owner="unassigned" ] | eval _key=owner | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key owner realname | runshellscript notable_owners_lookup | stats count', autojoin='1', buckets=0, ttl=1200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Notable Owners - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:02.437, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5a742da37541343b2_at_1654276200_736', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count, values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk where All_Risk.annotations.mitre_attack.mitre_tactic_id=* by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id' | where mitre_tactic_id_count >= 3 and source_count >= 4', autojoin='1', buckets=0, ttl=1200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,mitre_tactic_id_count,mitre_technique_id_count,prestats_reserved_*,psrsvd_*,risk_object,risk_object_type,source_count', apiStartTime='Fri May 27 17:00:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Risk - 7 Day ATT&CK Tactic Threshold Exceeded - Rule", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:02.418, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD5495078187e88a4c3_at_1654276200_735', search='| rest tshirt_server=local count=0 /services/authentication/users | rename title as user | eval _key=user | dedup _key | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key user realname | runshellscript key_field=_key user_realnames_lookup | stats count', autojoin='1', buckets=0, ttl=1200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Utils - User Realnames - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:02.405, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654276200_734', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:10:00 2021', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:02.325, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654276200_733', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:10:00 2021', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:02.312, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654276200_732', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:10:00 2022', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:02.302, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654276200_731', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:10:00 2021', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:02.291, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654276200_730', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:10:00 2021', apiEndTime='Fri Jun  3 17:10:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:00.675, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD56dc2dd36bb2e24c4_1654276200.606404', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Registry.dest"),values("Registry.user") from datamodel="Endpoint"."Registry" by "Registry.registry_value_text"
    | lookup "threatintel_by_registry_value_text" value as "Registry.registry_value_text" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_registry_value_text_wildcard" value as "Registry.registry_value_text" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Registry.dest,dest)`
    | `sistats_values_rename(Registry.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"registry_value_text",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Registry.registry_value_text','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://registry_value_text"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:30:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://registry_value_text", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:00.635, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5bf3181ec0c11c49b_1654276200.606403', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_hash"
    | lookup "threatintel_by_file_hash" value as "All_Certificates.SSL.ssl_hash" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_hash",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_hash','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Filesystem.dest"),values("Filesystem.user") from datamodel="Endpoint"."Filesystem" by "Filesystem.file_hash"
    | lookup "threatintel_by_file_hash" value as "Filesystem.file_hash" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Filesystem.dest,dest)`
    | `sistats_values_rename(Filesystem.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_hash",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Filesystem.file_hash','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.file_hash"
    | lookup "threatintel_by_file_hash" value as "All_Email.file_hash" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_hash",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.file_hash','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Malware_Attacks.src"),values("Malware_Attacks.dest"),values("Malware_Attacks.user") from datamodel="Malware"."Malware_Attacks" by "Malware_Attacks.file_hash"
    | lookup "threatintel_by_file_hash" value as "Malware_Attacks.file_hash" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Malware_Attacks.src,src)`
    | `sistats_values_rename(Malware_Attacks.dest,dest)`
    | `sistats_values_rename(Malware_Attacks.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_hash",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Malware_Attacks.file_hash','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Updates.dest") from datamodel="Updates"."Updates" by "Updates.file_hash"
    | lookup "threatintel_by_file_hash" value as "Updates.file_hash" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Updates.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"file_hash",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Updates.file_hash','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://file_hash"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:30:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://file_hash", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:10:00.416, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5a335f60452fd92f6_1654276200.606402', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_serial"
    | lookup "threatintel_by_certificate_serial" value as "All_Certificates.SSL.ssl_serial" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_serial",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_serial','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://certificate_serial"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:30:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://certificate_serial", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:09:54.166, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654276140_727', has_error_warn=false, fully_completed_search=true, total_run_time=37.07, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654276142, api_et=1651597740.000000000, api_lt=1654276140.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597740.000000000, search_lt=1654276140.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_startup_time="1218", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]']
Audit:[timestamp=06-03-2022 17:09:54.163, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276140_729', has_error_warn=false, fully_completed_search=true, total_run_time=10.34, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276182, api_et=1654271940.000000000, api_lt=1654275540.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271940.000000000, search_lt=1654275540.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:09:42.514, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276140_729', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:59:00 2022', apiEndTime='Fri Jun  3 16:59:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:09:24.175, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276140_728_1654276143.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276143, api_et=N/A, api_lt=1654276140.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276140.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:09:24.172, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276140_728', has_error_warn=false, fully_completed_search=true, total_run_time=14.34, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276142, api_et=N/A, api_lt=1654276140.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276140.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1456", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:09:24.170, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276140_728_1654276143.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.14, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276143, api_et=N/A, api_lt=1654276140.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276140.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:09:24.168, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654276140_726', has_error_warn=false, fully_completed_search=true, total_run_time=10.26, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276142, api_et=1622740140.000000000, api_lt=1654276140.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740140.000000000, search_lt=1654276140.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_startup_time="502", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]']
Audit:[timestamp=06-03-2022 17:09:24.163, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276140_728_1654276142.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.60, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276142, api_et=N/A, api_lt=1654276140.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276140.000000000, is_realtime=0, savedsearch_name="", search_startup_time="60", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:09:02.259, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276140_728', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:09:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:09:02.244, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654276140_727', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:09:00 2022', apiEndTime='Fri Jun  3 17:09:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:09:02.231, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654276140_726', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:09:00 2021', apiEndTime='Fri Jun  3 17:09:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:54.164, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276080_725', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276121, api_et=1654271880.000000000, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271880.000000000, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:08:40.717, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276080_725', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:58:00 2022', apiEndTime='Fri Jun  3 16:58:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:24.217, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654276080_717', has_error_warn=false, fully_completed_search=true, total_run_time=12.26, event_count=0, result_count=99, available_count=0, scan_count=0, drop_count=0, exec_time=1654276082, api_et=N/A, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_startup_time="1263", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_Successful_Authentication, Authentication.is_not_Successful_Authentication, Authentication.is_Default_Authentication, Authentication.is_not_Default_Authentication, Authentication.is_Insecure_Authentication, Authentication.is_not_Insecure_Authentication, Authentication.is_Privileged_Authentication, Authentication.is_not_Privileged_Authentication, Authentication.Default_Authentication.is_Failed_Default_Authentication, Authentication.Default_Authentication.is_not_Failed_Default_Authentication, Authentication.Default_Authentication.is_Successful_Default_Authentication, Authentication.Default_Authentication.is_not_Successful_Default_Authentication, Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication ]']
Audit:[timestamp=06-03-2022 17:08:24.216, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276083.606343', has_error_warn=false, fully_completed_search=true, total_run_time=10.25, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276084, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="297", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Certificates normid= [ search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:08:24.214, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654276080_723', has_error_warn=false, fully_completed_search=true, total_run_time=11.18, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654276084, api_et=1651597680.000000000, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597680.000000000, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_startup_time="506", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]']
Audit:[timestamp=06-03-2022 17:08:24.213, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276080_720_1654276083.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.65, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276083, api_et=N/A, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="", search_startup_time="65", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:08:24.209, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276080_720', has_error_warn=false, fully_completed_search=true, total_run_time=14.43, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276082, api_et=N/A, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1464", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:08:24.208, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654276080_721', has_error_warn=false, fully_completed_search=true, total_run_time=10.21, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276083, api_et=1651597680.000000000, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597680.000000000, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_startup_time="217", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]']
Audit:[timestamp=06-03-2022 17:08:24.205, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654276080_719', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276082, api_et=1651597680.000000000, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597680.000000000, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]']
Audit:[timestamp=06-03-2022 17:08:24.204, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654276080_724', has_error_warn=false, fully_completed_search=true, total_run_time=10.75, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276084, api_et=1622740080.000000000, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740080.000000000, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_startup_time="655", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis", app="SA-NetworkProtection", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]']
Audit:[timestamp=06-03-2022 17:08:24.202, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654276080_715', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276082, api_et=1651597680.000000000, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597680.000000000, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]']
Audit:[timestamp=06-03-2022 17:08:24.198, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276080_720_1654276083.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276083, api_et=N/A, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:08:24.195, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276083.606342', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276083, api_et=1651597683.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651597683.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="295", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:08:24.191, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276080_720_1654276083.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.15, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276083, api_et=N/A, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:08:24.186, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654276080_718', has_error_warn=false, fully_completed_search=true, total_run_time=11.41, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654276082, api_et=1651597680.000000000, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597680.000000000, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_startup_time="1118", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]']
Audit:[timestamp=06-03-2022 17:08:24.185, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654276080_716', has_error_warn=false, fully_completed_search=true, total_run_time=2.06, event_count=0, result_count=98, available_count=0, scan_count=0, drop_count=0, exec_time=1654276082, api_et=1622740080.000000000, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740080.000000000, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_startup_time="1199", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]']
Audit:[timestamp=06-03-2022 17:08:24.181, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276084.606345', has_error_warn=false, fully_completed_search=true, total_run_time=1.00, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276084, api_et=1622740084.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622740084.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="737", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Email normid= [ search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:08:24.179, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654276080_722', has_error_warn=false, fully_completed_search=true, total_run_time=10.24, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276083, api_et=N/A, api_lt=1654276080.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276080.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_startup_time="211", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]']
Audit:[timestamp=06-03-2022 17:08:04.856, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276084.606345', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Email normid= [ search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:08:04 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:04.476, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654276080_724', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:08:00 2021', apiEndTime='Fri Jun  3 17:08:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:04.461, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654276080_723', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:08:00 2022', apiEndTime='Fri Jun  3 17:08:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:04.020, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276083.606343', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Certificates normid= [ search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:03.668, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276083.606342', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:08:03 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:03.447, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654276080_722', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:08:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:03.436, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654276080_721', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:08:00 2022', apiEndTime='Fri Jun  3 17:08:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:02.424, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276080_720', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:08:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:02.414, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654276080_719', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:08:00 2022', apiEndTime='Fri Jun  3 17:08:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:02.405, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654276080_718', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:08:00 2022', apiEndTime='Fri Jun  3 17:08:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:02.396, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654276080_717', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Aut (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:08:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:02.391, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654276080_716', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:08:00 2021', apiEndTime='Fri Jun  3 17:08:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:08:02.370, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654276080_715', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:08:00 2022', apiEndTime='Fri Jun  3 17:08:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:07:54.169, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276020_714', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276062, api_et=1654271820.000000000, api_lt=1654275420.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271820.000000000, search_lt=1654275420.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:07:54.161, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276062.606325', has_error_warn=false, fully_completed_search=true, total_run_time=10.60, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276062, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="520", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39", app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NS44dad4abfd2e365a [search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:07:42.205, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276062.606325', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NS44dad4abfd2e365a [search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:07:41.856, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654276020_714', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:57:00 2022', apiEndTime='Fri Jun  3 16:57:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:07:24.189, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276020_713', has_error_warn=false, fully_completed_search=true, total_run_time=14.50, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276022, api_et=N/A, api_lt=1654276020.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276020.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1470", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:07:24.187, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276020_713_1654276023.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.16, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654276023, api_et=N/A, api_lt=1654276020.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276020.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:07:24.186, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654276020_711', has_error_warn=false, fully_completed_search=true, total_run_time=10.27, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276022, api_et=1646327220.000000000, api_lt=1654276020.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646327220.000000000, search_lt=1654276020.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]']
Audit:[timestamp=06-03-2022 17:07:24.184, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276020_713_1654276024.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276024, api_et=N/A, api_lt=1654276020.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276020.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:07:24.182, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654276020_710', has_error_warn=false, fully_completed_search=true, total_run_time=10.30, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276022, api_et=1622740020.000000000, api_lt=1654276020.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622740020.000000000, search_lt=1654276020.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]']
Audit:[timestamp=06-03-2022 17:07:24.177, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654276020_709', has_error_warn=false, fully_completed_search=true, total_run_time=7.74, event_count=444, result_count=99, available_count=0, scan_count=770, drop_count=0, exec_time=1654276022, api_et=N/A, api_lt=1654276020.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276020.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_startup_time="1538", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename dest_bunit AS All_Changes.dest_bunit dest_category AS All_Changes.dest_category dest_priority AS All_Changes.dest_priority src_bunit AS All_Changes.src_bunit src_category AS All_Changes.src_category src_priority AS All_Changes.src_priority tag AS All_Changes.tag user_agent AS All_Changes.user_agent user_bunit AS All_Changes.user_bunit user_category AS All_Changes.user_category user_priority AS All_Changes.user_priority user_type AS All_Changes.user_type vendor_account AS All_Changes.vendor_account vendor_region AS All_Changes.vendor_region change_type AS All_Changes.change_type command AS All_Changes.command dest AS All_Changes.dest dvc AS All_Changes.dvc object AS All_Changes.object object_attrs AS All_Changes.object_attrs object_category AS All_Changes.object_category object_id AS All_Changes.object_id object_path AS All_Changes.object_path status AS All_Changes.status result AS All_Changes.result result_id AS All_Changes.result_id src AS All_Changes.src user AS All_Changes.user user_name AS All_Changes.user_name vendor_product AS All_Changes.vendor_product action AS All_Changes.action is_Auditing_Changes AS All_Changes.is_Auditing_Changes is_not_Auditing_Changes AS All_Changes.is_not_Auditing_Changes is_Endpoint_Changes AS All_Changes.is_Endpoint_Changes is_not_Endpoint_Changes AS All_Changes.is_not_Endpoint_Changes is_Network_Changes AS All_Changes.is_Network_Changes is_not_Network_Changes AS All_Changes.is_not_Network_Changes is_Account_Management AS All_Changes.is_Account_Management is_not_Account_Management AS All_Changes.is_not_Account_Management is_Instance_Changes AS All_Changes.is_Instance_Changes is_not_Instance_Changes AS All_Changes.is_not_Instance_Changes | fields nodename, _time, host, source, sourcetype, All_Changes.dest_bunit, All_Changes.dest_category, All_Changes.dest_priority, All_Changes.src_bunit, All_Changes.src_category, All_Changes.src_priority, All_Changes.tag, All_Changes.user_agent, All_Changes.user_bunit, All_Changes.user_category, All_Changes.user_priority, All_Changes.user_type, All_Changes.vendor_account, All_Changes.vendor_region, All_Changes.change_type, All_Changes.command, All_Changes.dest, All_Changes.dvc, All_Changes.object, All_Changes.object_attrs, All_Changes.object_category, All_Changes.object_id, All_Changes.object_path, All_Changes.status, All_Changes.result, All_Changes.result_id, All_Changes.src, All_Changes.user, All_Changes.user_name, All_Changes.vendor_product, All_Changes.action, All_Changes.is_Auditing_Changes, All_Changes.is_not_Auditing_Changes, All_Changes.is_Endpoint_Changes, All_Changes.is_not_Endpoint_Changes, All_Changes.is_Network_Changes, All_Changes.is_not_Network_Changes, All_Changes.is_Account_Management, All_Changes.is_not_Account_Management, All_Changes.is_Instance_Changes, All_Changes.is_not_Instance_Changes, All_Changes.Endpoint_Changes.is_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes, All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes, All_Changes.Network_Changes.dest_ip_range, All_Changes.Network_Changes.dest_port_range, All_Changes.Network_Changes.direction, All_Changes.Network_Changes.protocol, All_Changes.Network_Changes.rule_action, All_Changes.Network_Changes.src_ip_range, All_Changes.Network_Changes.src_port_range, All_Changes.Network_Changes.is_Device_Restarts, All_Changes.Network_Changes.is_not_Device_Restarts, All_Changes.Account_Management.src_user_bunit, All_Changes.Account_Management.src_user_category, All_Changes.Account_Management.src_user_priority, All_Changes.Account_Management.src_user_type, All_Changes.Account_Management.dest_nt_domain, All_Changes.Account_Management.src_nt_domain, All_Changes.Account_Management.src_user, All_Changes.Account_Management.src_user_name, All_Changes.Account_Management.is_Accounts_Created, All_Changes.Account_Management.is_not_Accounts_Created, All_Changes.Account_Management.is_Accounts_Deleted, All_Changes.Account_Management.is_not_Accounts_Deleted, All_Changes.Account_Management.is_Account_Lockouts, All_Changes.Account_Management.is_not_Account_Lockouts, All_Changes.Account_Management.is_Accounts_Updated, All_Changes.Account_Management.is_not_Accounts_Updated, All_Changes.Instance_Changes.image_id, All_Changes.Instance_Changes.instance_type ]']
Audit:[timestamp=06-03-2022 17:07:24.175, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276023.606308', has_error_warn=false, fully_completed_search=true, total_run_time=10.34, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276023, api_et=1646327223.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1646327223.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="342", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Sessions normid= [ search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:07:24.173, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276020_713_1654276023.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.58, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654276023, api_et=N/A, api_lt=1654276020.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654276020.000000000, is_realtime=0, savedsearch_name="", search_startup_time="61", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:07:24.166, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654276020_712', has_error_warn=false, fully_completed_search=true, total_run_time=10.33, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654276022, api_et=1646327220.000000000, api_lt=1654276020.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646327220.000000000, search_lt=1654276020.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]']
Audit:[timestamp=06-03-2022 17:07:24.164, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654276023.606307', has_error_warn=false, fully_completed_search=true, total_run_time=10.34, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276023, api_et=1622740023.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622740023.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Updates normid= [ search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:07:03.711, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276023.606308', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Sessions normid= [ search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Mar  3 17:07:03 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:07:03.245, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654276023.606307', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Updates normid= [ search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:07:03 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:07:02.621, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654276020_713', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:07:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:07:02.610, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654276020_712', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:07:00 2022', apiEndTime='Fri Jun  3 17:07:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:07:02.573, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654276020_711', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:07:00 2022', apiEndTime='Fri Jun  3 17:07:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:07:02.555, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654276020_710', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:07:00 2021', apiEndTime='Fri Jun  3 17:07:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:07:02.545, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654276020_709', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_typ (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:07:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:06:54.174, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275960_708', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654276002, api_et=1654271760.000000000, api_lt=1654275360.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271760.000000000, search_lt=1654275360.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:06:53.569, user=admin, action=search, info=granted , search_id='rt_md_1654276013.606303', search='| metadata type=sourcetypes | search totalCount > 0', autojoin='1', buckets=300, ttl=600, max_count=100000, maxtime=0, enable_lookups='1', extra_fields='*', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="search", provenance="UI:Search", mode="RT_indexed"]
Audit:[timestamp=06-03-2022 17:06:42.062, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275960_708', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:56:00 2022', apiEndTime='Fri Jun  3 16:56:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:06:24.184, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654275960_705', has_error_warn=false, fully_completed_search=true, total_run_time=10.31, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275962, api_et=1622739960.000000000, api_lt=1654275960.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739960.000000000, search_lt=1654275960.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]']
Audit:[timestamp=06-03-2022 17:06:24.181, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654275960_704', has_error_warn=false, fully_completed_search=true, total_run_time=10.30, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275962, api_et=1622739960.000000000, api_lt=1654275960.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739960.000000000, search_lt=1654275960.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]']
Audit:[timestamp=06-03-2022 17:06:24.180, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275960_707_1654275962.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275962, api_et=N/A, api_lt=1654275960.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275960.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:06:24.179, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275960_707', has_error_warn=false, fully_completed_search=true, total_run_time=14.25, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275962, api_et=N/A, api_lt=1654275960.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275960.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1200", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:06:24.172, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275960_707_1654275962.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.63, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654275962, api_et=N/A, api_lt=1654275960.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275960.000000000, is_realtime=0, savedsearch_name="", search_startup_time="60", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:06:24.171, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275962.606293', has_error_warn=false, fully_completed_search=true, total_run_time=10.36, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275962, api_et=1622739962.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622739962.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Malware normid= [ search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:06:24.166, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275960_707_1654275962.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.15, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654275962, api_et=N/A, api_lt=1654275960.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275960.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:06:24.164, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654275960_706', has_error_warn=false, fully_completed_search=true, total_run_time=1.81, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654275962, api_et=1646327160.000000000, api_lt=1654275960.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646327160.000000000, search_lt=1654275960.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_startup_time="1171", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]']
Audit:[timestamp=06-03-2022 17:06:02.486, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275962.606293', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Malware normid= [ search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:06:02 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:06:01.822, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275960_707', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:06:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:06:01.812, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654275960_706', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:06:00 2022', apiEndTime='Fri Jun  3 17:06:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:06:01.798, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654275960_705', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:06:00 2021', apiEndTime='Fri Jun  3 17:06:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:06:01.784, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654275960_704', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:06:00 2021', apiEndTime='Fri Jun  3 17:06:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:54.172, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275900_703', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275940, api_et=1654271700.000000000, api_lt=1654275300.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271700.000000000, search_lt=1654275300.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:05:40.307, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275900_703', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:55:00 2022', apiEndTime='Fri Jun  3 16:55:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:24.208, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275903.606279', has_error_warn=false, fully_completed_search=true, total_run_time=1.21, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275903, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="871", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Authentication normid= [ search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_Successful_Authentication, Authentication.is_not_Successful_Authentication, Authentication.is_Default_Authentication, Authentication.is_not_Default_Authentication, Authentication.is_Insecure_Authentication, Authentication.is_not_Insecure_Authentication, Authentication.is_Privileged_Authentication, Authentication.is_not_Privileged_Authentication, Authentication.Default_Authentication.is_Failed_Default_Authentication, Authentication.Default_Authentication.is_not_Failed_Default_Authentication, Authentication.Default_Authentication.is_Successful_Default_Authentication, Authentication.Default_Authentication.is_not_Successful_Default_Authentication, Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:05:24.205, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275900_697', has_error_warn=false, fully_completed_search=true, total_run_time=15.11, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275903, api_et=N/A, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="2304", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:05:24.202, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654275900_699', has_error_warn=false, fully_completed_search=true, total_run_time=10.80, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275903, api_et=1654188900.000000000, api_lt=1654275300.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654188900.000000000, search_lt=1654275300.000000000, is_realtime=0, savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_d34d6d33ee94d419", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`']
Audit:[timestamp=06-03-2022 17:05:24.201, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654275900_700', has_error_warn=false, fully_completed_search=true, total_run_time=10.84, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275904, api_et=N/A, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_startup_time="936", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence", app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]']
Audit:[timestamp=06-03-2022 17:05:24.200, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD56fa7da3c4e78bdad_1654275900.606276', has_error_warn=false, fully_completed_search=true, total_run_time=1.05, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275900, api_et=1654273500.000000000, api_lt=1654275300.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273500.000000000, search_lt=1654275300.000000000, is_realtime=0, savedsearch_name="threatmatch://registry_value_name", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_a9ec64794a68ef70", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Registry.dest"),values("Registry.user") from datamodel="Endpoint"."Registry" by "Registry.registry_value_name"
    | lookup "threatintel_by_registry_value_name" value as "Registry.registry_value_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_registry_value_name_wildcard" value as "Registry.registry_value_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Registry.dest,dest)`
    | `sistats_values_rename(Registry.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"registry_value_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Registry.registry_value_name','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://registry_value_name"']
Audit:[timestamp=06-03-2022 17:05:24.194, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275900_697_1654275904.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.67, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654275904, api_et=N/A, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="", search_startup_time="87", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:05:24.191, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD531f759a056775b08_1654275900.606273', has_error_warn=false, fully_completed_search=true, total_run_time=1.30, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275900, api_et=1654273500.000000000, api_lt=1654275300.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273500.000000000, search_lt=1654275300.000000000, is_realtime=0, savedsearch_name="threatmatch://process_hash", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_ad909bb5e3a90fdb", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Processes.dest"),values("Processes.user"),values("Processes.process"),values("Processes.parent_process"),values("Processes.os") from datamodel="Endpoint"."Processes" by "Processes.process_hash"
    | lookup "threatintel_by_process_hash" value as "Processes.process_hash" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Processes.dest,dest)`
    | `sistats_values_rename(Processes.user,user)`
    | `sistats_values_rename(Processes.process,process)`
    | `sistats_values_rename(Processes.parent_process,parent_process)`
    | `sistats_values_rename(Processes.os,os)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"process_hash",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Processes.process_hash','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("os") as "os",values("parent_process") as "parent_process",values("process") as "process",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "os"=mvindex('os',0,10-1)
| eval "parent_process"=mvindex('parent_process',0,10-1)
| eval "process"=mvindex('process',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://process_hash"']
Audit:[timestamp=06-03-2022 17:05:24.190, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275914.606283', has_error_warn=false, fully_completed_search=true, total_run_time=10.84, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275914, api_et=1622739914.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622739914.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="655", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity normid= [ search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:05:24.189, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654275900_693', has_error_warn=false, fully_completed_search=true, total_run_time=10.87, event_count=0, result_count=7, available_count=0, scan_count=0, drop_count=0, exec_time=1654275903, api_et=1622739900.000000000, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739900.000000000, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_startup_time="967", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]']
Audit:[timestamp=06-03-2022 17:05:24.188, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654275900_691', has_error_warn=false, fully_completed_search=true, total_run_time=11.17, event_count=168, result_count=18, available_count=0, scan_count=2999, drop_count=0, exec_time=1654275903, api_et=1622739900.000000000, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739900.000000000, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_startup_time="1185", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]']
Audit:[timestamp=06-03-2022 17:05:24.187, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD51cf26468c1f5f710_1654275900.606274', has_error_warn=false, fully_completed_search=true, total_run_time=1.86, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275900, api_et=1654273500.000000000, api_lt=1654275300.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273500.000000000, search_lt=1654275300.000000000, is_realtime=0, savedsearch_name="threatmatch://certificate_organization", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_7daeb867f5f2579b", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_organization"
    | lookup "threatintel_by_certificate_organization" value as "All_Certificates.SSL.ssl_issuer_organization" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_organization_wildcard" value as "All_Certificates.SSL.ssl_issuer_organization" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_organization",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_organization','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_organization"
    | lookup "threatintel_by_certificate_organization" value as "All_Certificates.SSL.ssl_subject_organization" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_organization_wildcard" value as "All_Certificates.SSL.ssl_subject_organization" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_organization",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_organization','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://certificate_organization"']
Audit:[timestamp=06-03-2022 17:05:24.185, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtQWNjZXNzUHJvdGVjdGlvbg__RMD540f1654a56e578da_at_1654275900_698', has_error_warn=false, fully_completed_search=true, total_run_time=1.11, event_count=1, result_count=1, available_count=0, scan_count=1, drop_count=0, exec_time=1654275903, api_et=1654271700.000000000, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271700.000000000, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="Access - Authentication Tracker - Lookup Gen", search_startup_time="1524", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-AccessProtection_admin_eb2dc8dd3080085b", app="SA-AccessProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` count from datamodel=Authentication.Authentication where Authentication.action=success Authentication.dest!=unknown Authentication.user!=unknown by _time,Authentication.dest,Authentication.user span=1s | `drop_dm_object_name("Authentication")` | stats min(_time) as firstTime,values(_time) as second2lastTime,max(_time) as lastTime by dest,user | eval dest=lower(dest),user=lower(user),_key=sha1(dest."|".user) | dedup _key | lookup access_tracker _key OUTPUTNEW firstTime as lookup_firstTime, second2lastTime as lookup_second2lastTime, lastTime as lookup_lastTime | eval firstTime=min(firstTime, lookup_firstTime),lastTime=max(lastTime, lookup_lastTime), second2lastTime=mvdedup(mvappend(second2lastTime,NULL,lookup_second2lastTime)), lastTime_vals=mvdedup(mvappend(lastTime,NULL,lookup_lastTime)) | eval `get_second2lastTime_meval(second2lastTime,lastTime_vals,lastTime)` | eventstats min(firstTime) as firstTime_user,max(lastTime) as lastTime_user by user  | fields - lastTime_vals, lookup_firstTime, lookup_lastTime, lookup_second2lastTime | runshellscript append=T key_field=_key access_tracker | stats count']
Audit:[timestamp=06-03-2022 17:05:24.183, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275900_697_1654275905.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275905, api_et=N/A, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:05:24.180, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654275900_695', has_error_warn=false, fully_completed_search=true, total_run_time=5.85, event_count=35, result_count=3, available_count=0, scan_count=35, drop_count=0, exec_time=1654275903, api_et=1622739900.000000000, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739900.000000000, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_startup_time="1081", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]']
Audit:[timestamp=06-03-2022 17:05:24.179, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654275900_701', has_error_warn=false, fully_completed_search=true, total_run_time=10.78, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275906, api_et=N/A, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_startup_time="660", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]']
Audit:[timestamp=06-03-2022 17:05:24.178, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654275900_702', has_error_warn=false, fully_completed_search=true, total_run_time=10.86, event_count=5, result_count=3, available_count=0, scan_count=5, drop_count=0, exec_time=1654275906, api_et=N/A, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_startup_time="543", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]']
Audit:[timestamp=06-03-2022 17:05:24.176, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654275900_696', has_error_warn=false, fully_completed_search=true, total_run_time=3.30, event_count=2885, result_count=1, available_count=0, scan_count=2885, drop_count=0, exec_time=1654275903, api_et=1654102800.000000000, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654102800.000000000, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="ESS - Notable Events", search_startup_time="2422", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_87db9bb7a232c62f", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=1, eliminated_buckets=0, considered_events=2885, total_slices=121, decompressed_slices=10, duration.command.search.index=1, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=126, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, sourcetype_count__stash=2885, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count']
Audit:[timestamp=06-03-2022 17:05:24.174, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275900_697_1654275905.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.17, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654275905, api_et=N/A, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:05:24.167, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD53f9e697ad5d7e63b_1654275900.606275', has_error_warn=false, fully_completed_search=true, total_run_time=1.13, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275900, api_et=1654273500.000000000, api_lt=1654275300.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273500.000000000, search_lt=1654275300.000000000, is_realtime=0, savedsearch_name="threatmatch://email_subject", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_5476ca47f67d0f16", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.subject"
    | lookup "threatintel_by_email_subject" value as "All_Email.subject" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_subject_wildcard" value as "All_Email.subject" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email_subject",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.subject','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://email_subject"']
Audit:[timestamp=06-03-2022 17:05:24.165, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654275900_692', has_error_warn=false, fully_completed_search=true, total_run_time=2.01, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654275903, api_et=1646327100.000000000, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646327100.000000000, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_startup_time="1178", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]']
Audit:[timestamp=06-03-2022 17:05:24.161, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654275900_694', has_error_warn=false, fully_completed_search=true, total_run_time=10.26, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275903, api_et=1622739900.000000000, api_lt=1654275900.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739900.000000000, search_lt=1654275900.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_startup_time="601", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]']
Audit:[timestamp=06-03-2022 17:05:14.159, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275914.606283', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity normid= [ search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:05:14 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:06.070, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654275900_702', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:06.056, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654275900_701', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:04.038, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654275900_700', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_type=adhoc, is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:03.883, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275903.606279', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Authentication normid= [ search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_ (truncated)', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:03.099, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654275900_699', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,mitre_tactic_id_count,mitre_technique_id_count,prestats_reserved_*,psrsvd_*,risk_object,risk_object_type,source_count', apiStartTime='Thu Jun  2 16:55:00 2022', apiEndTime='Fri Jun  3 16:55:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:03.074, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtQWNjZXNzUHJvdGVjdGlvbg__RMD540f1654a56e578da_at_1654275900_698', search='| tstats `summariesonly` count from datamodel=Authentication.Authentication where Authentication.action=success Authentication.dest!=unknown Authentication.user!=unknown by _time,Authentication.dest,Authentication.user span=1s | `drop_dm_object_name("Authentication")` | stats min(_time) as firstTime,values(_time) as second2lastTime,max(_time) as lastTime by dest,user | eval dest=lower(dest),user=lower(user),_key=sha1(dest."|".user) | dedup _key | lookup access_tracker _key OUTPUTNEW firstTime as lookup_firstTime, second2lastTime as lookup_second2lastTime, lastTime as lookup_lastTime | eval firstTime=min(firstTime, lookup_firstTime),lastTime=max(lastTime, lookup_lastTime), second2lastTime=mvdedup(mvappend(second2lastTime,NULL,lookup_second2lastTime)), lastTime_vals=mvdedup(mvappend(lastTime,NULL,lookup_lastTime)) | eval `get_second2lastTime_meval(second2lastTime,lastTime_vals,lastTime)` | eventstats min(firstTime) as firstTime_user,max(lastTime) as lastTime_user by user  | fields - lastTime_vals, lookup_firstTime, lookup_lastTime, lookup_second2lastTime | runshellscript append=T key_field=_key access_tracker | stats count', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 15:55:00 2022', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Access - Authentication Tracker - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-AccessProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:03.040, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275900_697', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:03.025, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654275900_696', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Wed Jun  1 17:00:00 2022', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESS - Notable Events", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:02.998, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654275900_695', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:05:00 2021', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:02.971, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654275900_694', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:05:00 2021', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:02.927, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654275900_693', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:05:00 2021', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:02.916, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654275900_692', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:05:00 2022', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:02.875, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654275900_691', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:05:00 2021', apiEndTime='Fri Jun  3 17:05:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:00.753, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD56fa7da3c4e78bdad_1654275900.606276', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Registry.dest"),values("Registry.user") from datamodel="Endpoint"."Registry" by "Registry.registry_value_name"
    | lookup "threatintel_by_registry_value_name" value as "Registry.registry_value_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_registry_value_name_wildcard" value as "Registry.registry_value_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Registry.dest,dest)`
    | `sistats_values_rename(Registry.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"registry_value_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Registry.registry_value_name','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://registry_value_name"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:25:00 2022', apiEndTime='Fri Jun  3 16:55:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://registry_value_name", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:00.666, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD53f9e697ad5d7e63b_1654275900.606275', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.subject"
    | lookup "threatintel_by_email_subject" value as "All_Email.subject" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_subject_wildcard" value as "All_Email.subject" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email_subject",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.subject','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://email_subject"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:25:00 2022', apiEndTime='Fri Jun  3 16:55:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://email_subject", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:00.651, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD51cf26468c1f5f710_1654275900.606274', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_organization"
    | lookup "threatintel_by_certificate_organization" value as "All_Certificates.SSL.ssl_issuer_organization" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_organization_wildcard" value as "All_Certificates.SSL.ssl_issuer_organization" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_organization",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_organization','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_organization"
    | lookup "threatintel_by_certificate_organization" value as "All_Certificates.SSL.ssl_subject_organization" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_organization_wildcard" value as "All_Certificates.SSL.ssl_subject_organization" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_organization",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_organization','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://certificate_organization"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:25:00 2022', apiEndTime='Fri Jun  3 16:55:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://certificate_organization", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:05:00.472, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD531f759a056775b08_1654275900.606273', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Processes.dest"),values("Processes.user"),values("Processes.process"),values("Processes.parent_process"),values("Processes.os") from datamodel="Endpoint"."Processes" by "Processes.process_hash"
    | lookup "threatintel_by_process_hash" value as "Processes.process_hash" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | where isnotnull('tck0')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval threat_collection_key='intelzip0'
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Processes.dest,dest)`
    | `sistats_values_rename(Processes.user,user)`
    | `sistats_values_rename(Processes.process,process)`
    | `sistats_values_rename(Processes.parent_process,parent_process)`
    | `sistats_values_rename(Processes.os,os)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"process_hash",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Processes.process_hash','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("os") as "os",values("parent_process") as "parent_process",values("process") as "process",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "os"=mvindex('os',0,10-1)
| eval "parent_process"=mvindex('parent_process',0,10-1)
| eval "process"=mvindex('process',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://process_hash"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:25:00 2022', apiEndTime='Fri Jun  3 16:55:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://process_hash", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:04:54.177, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275879.606263', has_error_warn=false, fully_completed_search=true, total_run_time=1.42, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275879, api_et=1651597479.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651597479.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="953", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Performance normid= [ search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:04:54.172, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654275840_688', has_error_warn=false, fully_completed_search=true, total_run_time=37.08, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654275842, api_et=1651597440.000000000, api_lt=1654275840.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597440.000000000, search_lt=1654275840.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_startup_time="1279", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]']
Audit:[timestamp=06-03-2022 17:04:54.166, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275840_690', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275882, api_et=1654271640.000000000, api_lt=1654275240.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271640.000000000, search_lt=1654275240.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:04:42.187, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275840_690', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:54:00 2022', apiEndTime='Fri Jun  3 16:54:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:04:39.412, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275879.606263', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Performance normid= [ search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modti (truncated)', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:04:39 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:04:24.177, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275842.606262', has_error_warn=false, fully_completed_search=true, total_run_time=10.31, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275842, api_et=1622739842.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622739842.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="311", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Intrusion_Detection normid= [ search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:04:24.174, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654275840_687', has_error_warn=false, fully_completed_search=true, total_run_time=10.26, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275842, api_et=1622739840.000000000, api_lt=1654275840.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739840.000000000, search_lt=1654275840.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_startup_time="554", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]']
Audit:[timestamp=06-03-2022 17:04:24.171, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275840_689_1654275842.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.60, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654275842, api_et=N/A, api_lt=1654275840.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275840.000000000, is_realtime=0, savedsearch_name="", search_startup_time="61", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:04:24.166, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275840_689_1654275842.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.15, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654275842, api_et=N/A, api_lt=1654275840.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275840.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:04:24.164, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275840_689_1654275843.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275843, api_et=N/A, api_lt=1654275840.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275840.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:04:24.161, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275840_689', has_error_warn=false, fully_completed_search=true, total_run_time=14.13, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275842, api_et=N/A, api_lt=1654275840.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275840.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1191", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:04:02.375, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275842.606262', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Intrusion_Detection normid= [ search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:04:02 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:04:01.924, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275840_689', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:04:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:04:01.912, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654275840_688', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:04:00 2022', apiEndTime='Fri Jun  3 17:04:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:04:01.833, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654275840_687', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:04:00 2021', apiEndTime='Fri Jun  3 17:04:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:54.176, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275780_686', has_error_warn=false, fully_completed_search=true, total_run_time=10.36, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275820, api_et=1654271580.000000000, api_lt=1654275180.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271580.000000000, search_lt=1654275180.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:03:40.286, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275780_686', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:53:00 2022', apiEndTime='Fri Jun  3 16:53:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:24.205, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275786.606251', has_error_warn=false, fully_completed_search=true, total_run_time=10.58, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275786, api_et=1622739786.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622739786.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="367", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis", app="SA-NetworkProtection", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_SA-NetworkProtection_Domain_Analysis normid= [ search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:03:24.204, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275780_681_1654275783.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.60, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654275783, api_et=N/A, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="", search_startup_time="61", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:03:24.201, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654275780_680', has_error_warn=false, fully_completed_search=true, total_run_time=11.32, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654275783, api_et=1651597380.000000000, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597380.000000000, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_startup_time="1057", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]']
Audit:[timestamp=06-03-2022 17:03:24.198, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275780_681_1654275784.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.16, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654275784, api_et=N/A, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:03:24.196, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275780_681', has_error_warn=false, fully_completed_search=true, total_run_time=14.55, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275783, api_et=N/A, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1496", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:03:24.194, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654275780_678', has_error_warn=false, fully_completed_search=true, total_run_time=10.27, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275783, api_et=1651597380.000000000, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597380.000000000, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]']
Audit:[timestamp=06-03-2022 17:03:24.191, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654275780_683', has_error_warn=false, fully_completed_search=true, total_run_time=12.09, event_count=0, result_count=99, available_count=0, scan_count=0, drop_count=0, exec_time=1654275784, api_et=N/A, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_startup_time="692", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_Successful_Authentication, Authentication.is_not_Successful_Authentication, Authentication.is_Default_Authentication, Authentication.is_not_Default_Authentication, Authentication.is_Insecure_Authentication, Authentication.is_not_Insecure_Authentication, Authentication.is_Privileged_Authentication, Authentication.is_not_Privileged_Authentication, Authentication.Default_Authentication.is_Failed_Default_Authentication, Authentication.Default_Authentication.is_not_Failed_Default_Authentication, Authentication.Default_Authentication.is_Successful_Default_Authentication, Authentication.Default_Authentication.is_not_Successful_Default_Authentication, Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication ]']
Audit:[timestamp=06-03-2022 17:03:24.190, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654275780_682', has_error_warn=false, fully_completed_search=true, total_run_time=10.19, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275784, api_et=1651597380.000000000, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597380.000000000, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_startup_time="246", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]']
Audit:[timestamp=06-03-2022 17:03:24.186, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654275780_685', has_error_warn=false, fully_completed_search=true, total_run_time=10.74, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275786, api_et=1622739780.000000000, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739780.000000000, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_startup_time="624", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis", app="SA-NetworkProtection", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]']
Audit:[timestamp=06-03-2022 17:03:24.185, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275794.606252', has_error_warn=false, fully_completed_search=true, total_run_time=10.67, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275794, api_et=1651597394.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651597394.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="419", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Registry normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:03:24.183, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275780_681_1654275784.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275784, api_et=N/A, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:03:24.182, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654275780_679', has_error_warn=false, fully_completed_search=true, total_run_time=11.36, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654275783, api_et=1651597380.000000000, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597380.000000000, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_startup_time="1128", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]']
Audit:[timestamp=06-03-2022 17:03:24.180, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654275780_684', has_error_warn=false, fully_completed_search=true, total_run_time=10.23, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275785, api_et=N/A, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_startup_time="211", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]']
Audit:[timestamp=06-03-2022 17:03:24.166, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275783.606250', has_error_warn=false, fully_completed_search=true, total_run_time=10.27, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275783, api_et=1651597383.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651597383.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="276", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Services normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:03:24.165, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654275780_676', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275783, api_et=1651597380.000000000, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597380.000000000, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]']
Audit:[timestamp=06-03-2022 17:03:24.160, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654275780_677', has_error_warn=false, fully_completed_search=true, total_run_time=2.01, event_count=0, result_count=98, available_count=0, scan_count=0, drop_count=0, exec_time=1654275783, api_et=1622739780.000000000, api_lt=1654275780.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739780.000000000, search_lt=1654275780.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_startup_time="1123", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]']
Audit:[timestamp=06-03-2022 17:03:14.624, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275794.606252', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Registry normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:03:14 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:06.950, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275786.606251', search='summarize tstats=t action=probe id=DM_SA-NetworkProtection_Domain_Analysis normid= [ search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:03:06 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="SA-NetworkProtection", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:06.047, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654275780_685', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:03:00 2021', apiEndTime='Fri Jun  3 17:03:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:05.021, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654275780_684', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:03:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:04.007, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654275780_683', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Aut (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:03:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:03.992, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654275780_682', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:03:00 2022', apiEndTime='Fri Jun  3 17:03:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:03.554, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275783.606250', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Services normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:03:03 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:02.936, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275780_681', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:03:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:02.925, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654275780_680', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:03:00 2022', apiEndTime='Fri Jun  3 17:03:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:02.903, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654275780_679', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:03:00 2022', apiEndTime='Fri Jun  3 17:03:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:02.880, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654275780_678', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:03:00 2022', apiEndTime='Fri Jun  3 17:03:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:02.829, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654275780_677', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:03:00 2021', apiEndTime='Fri Jun  3 17:03:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:03:02.770, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654275780_676', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 17:03:00 2022', apiEndTime='Fri Jun  3 17:03:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:02:54.174, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275762.606243', has_error_warn=false, fully_completed_search=true, total_run_time=10.61, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275762, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="528", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71", app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb635087639505149 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:02:54.169, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275720_675', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275762, api_et=1654271520.000000000, api_lt=1654275120.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271520.000000000, search_lt=1654275120.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:02:42.564, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275762.606243', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb635087639505149 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:02:42.222, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275720_675', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:52:00 2022', apiEndTime='Fri Jun  3 16:52:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:02:24.185, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275720_674', has_error_warn=false, fully_completed_search=true, total_run_time=14.60, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275722, api_et=N/A, api_lt=1654275720.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275720.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1465", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:02:24.183, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275720_674_1654275722.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.59, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654275722, api_et=N/A, api_lt=1654275720.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275720.000000000, is_realtime=0, savedsearch_name="", search_startup_time="65", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:02:24.178, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654275720_671', has_error_warn=false, fully_completed_search=true, total_run_time=10.25, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275722, api_et=1646326920.000000000, api_lt=1654275720.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646326920.000000000, search_lt=1654275720.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_startup_time="523", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]']
Audit:[timestamp=06-03-2022 17:02:24.172, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654275720_670', has_error_warn=false, fully_completed_search=true, total_run_time=10.26, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275722, api_et=1646326920.000000000, api_lt=1654275720.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646326920.000000000, search_lt=1654275720.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_startup_time="616", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]']
Audit:[timestamp=06-03-2022 17:02:24.166, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275720_674_1654275723.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.14, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654275723, api_et=N/A, api_lt=1654275720.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275720.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:02:24.164, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654275720_672', has_error_warn=false, fully_completed_search=true, total_run_time=7.72, event_count=519, result_count=99, available_count=0, scan_count=844, drop_count=0, exec_time=1654275722, api_et=N/A, api_lt=1654275720.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275720.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_startup_time="1473", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename dest_bunit AS All_Changes.dest_bunit dest_category AS All_Changes.dest_category dest_priority AS All_Changes.dest_priority src_bunit AS All_Changes.src_bunit src_category AS All_Changes.src_category src_priority AS All_Changes.src_priority tag AS All_Changes.tag user_agent AS All_Changes.user_agent user_bunit AS All_Changes.user_bunit user_category AS All_Changes.user_category user_priority AS All_Changes.user_priority user_type AS All_Changes.user_type vendor_account AS All_Changes.vendor_account vendor_region AS All_Changes.vendor_region change_type AS All_Changes.change_type command AS All_Changes.command dest AS All_Changes.dest dvc AS All_Changes.dvc object AS All_Changes.object object_attrs AS All_Changes.object_attrs object_category AS All_Changes.object_category object_id AS All_Changes.object_id object_path AS All_Changes.object_path status AS All_Changes.status result AS All_Changes.result result_id AS All_Changes.result_id src AS All_Changes.src user AS All_Changes.user user_name AS All_Changes.user_name vendor_product AS All_Changes.vendor_product action AS All_Changes.action is_Auditing_Changes AS All_Changes.is_Auditing_Changes is_not_Auditing_Changes AS All_Changes.is_not_Auditing_Changes is_Endpoint_Changes AS All_Changes.is_Endpoint_Changes is_not_Endpoint_Changes AS All_Changes.is_not_Endpoint_Changes is_Network_Changes AS All_Changes.is_Network_Changes is_not_Network_Changes AS All_Changes.is_not_Network_Changes is_Account_Management AS All_Changes.is_Account_Management is_not_Account_Management AS All_Changes.is_not_Account_Management is_Instance_Changes AS All_Changes.is_Instance_Changes is_not_Instance_Changes AS All_Changes.is_not_Instance_Changes | fields nodename, _time, host, source, sourcetype, All_Changes.dest_bunit, All_Changes.dest_category, All_Changes.dest_priority, All_Changes.src_bunit, All_Changes.src_category, All_Changes.src_priority, All_Changes.tag, All_Changes.user_agent, All_Changes.user_bunit, All_Changes.user_category, All_Changes.user_priority, All_Changes.user_type, All_Changes.vendor_account, All_Changes.vendor_region, All_Changes.change_type, All_Changes.command, All_Changes.dest, All_Changes.dvc, All_Changes.object, All_Changes.object_attrs, All_Changes.object_category, All_Changes.object_id, All_Changes.object_path, All_Changes.status, All_Changes.result, All_Changes.result_id, All_Changes.src, All_Changes.user, All_Changes.user_name, All_Changes.vendor_product, All_Changes.action, All_Changes.is_Auditing_Changes, All_Changes.is_not_Auditing_Changes, All_Changes.is_Endpoint_Changes, All_Changes.is_not_Endpoint_Changes, All_Changes.is_Network_Changes, All_Changes.is_not_Network_Changes, All_Changes.is_Account_Management, All_Changes.is_not_Account_Management, All_Changes.is_Instance_Changes, All_Changes.is_not_Instance_Changes, All_Changes.Endpoint_Changes.is_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes, All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes, All_Changes.Network_Changes.dest_ip_range, All_Changes.Network_Changes.dest_port_range, All_Changes.Network_Changes.direction, All_Changes.Network_Changes.protocol, All_Changes.Network_Changes.rule_action, All_Changes.Network_Changes.src_ip_range, All_Changes.Network_Changes.src_port_range, All_Changes.Network_Changes.is_Device_Restarts, All_Changes.Network_Changes.is_not_Device_Restarts, All_Changes.Account_Management.src_user_bunit, All_Changes.Account_Management.src_user_category, All_Changes.Account_Management.src_user_priority, All_Changes.Account_Management.src_user_type, All_Changes.Account_Management.dest_nt_domain, All_Changes.Account_Management.src_nt_domain, All_Changes.Account_Management.src_user, All_Changes.Account_Management.src_user_name, All_Changes.Account_Management.is_Accounts_Created, All_Changes.Account_Management.is_not_Accounts_Created, All_Changes.Account_Management.is_Accounts_Deleted, All_Changes.Account_Management.is_not_Accounts_Deleted, All_Changes.Account_Management.is_Account_Lockouts, All_Changes.Account_Management.is_not_Account_Lockouts, All_Changes.Account_Management.is_Accounts_Updated, All_Changes.Account_Management.is_not_Accounts_Updated, All_Changes.Instance_Changes.image_id, All_Changes.Instance_Changes.instance_type ]']
Audit:[timestamp=06-03-2022 17:02:24.162, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275720_674_1654275723.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275723, api_et=N/A, api_lt=1654275720.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275720.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:02:24.161, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654275720_673', has_error_warn=false, fully_completed_search=true, total_run_time=10.30, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275722, api_et=1622739720.000000000, api_lt=1654275720.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739720.000000000, search_lt=1654275720.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]']
Audit:[timestamp=06-03-2022 17:02:01.980, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275720_674', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:02:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:02:01.970, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD57dbad35ae85a0885_at_1654275720_673', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Updates [  search (index=* OR index=_*) ((`cim_Updates_indexes`) tag=update tag=status) | eval nodename = "Updates"| eval dest=if(isnull(dest) OR dest="","unknown",dest), signature=case(isnotnull(signature) AND signature!="",signature,isnotnull(signature_id) AND signature_id!="" AND signature_id!="unknown",signature_id,1=1,"unknown"), signature_id=case(isnotnull(signature_id) AND signature_id!="",signature_id,isnotnull(signature) AND signature!="" AND signature!="unknown",signature,1=1,"unknown"), status=if(isnull(status) OR status="","unknown",status), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Available_Updates=if(searchmatch("(status=\"available\")"),1,0), is_not_Available_Updates=1-is_Available_Updates, is_Installed_Updates=if(searchmatch("(status=\"installed\")"),1,0), is_not_Installed_Updates=1-is_Installed_Updates, is_Restart_Required_Updates=if(searchmatch("(status=\"restart_required\")"),1,0), is_not_Restart_Required_Updates=1-is_Restart_Required_Updates | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"available\")"), mvappend(nodename, "Updates.Available_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"installed\")"), mvappend(nodename, "Updates.Installed_Updates"), nodename) | eval nodename = if(nodename == "Updates" AND searchmatch("(status=\"restart_required\")"), mvappend(nodename, "Updates.Restart_Required_Updates"), nodename) | rename dest_bunit AS Updates.dest_bunit dest_category AS Updates.dest_category dest_priority AS Updates.dest_priority dest_should_update AS Updates.dest_should_update dvc AS Updates.dvc file_name AS Updates.file_name file_hash AS Updates.file_hash severity AS Updates.severity severity_id AS Updates.severity_id tag AS Updates.tag dest AS Updates.dest signature AS Updates.signature signature_id AS Updates.signature_id status AS Updates.status vendor_product AS Updates.vendor_product is_Available_Updates AS Updates.is_Available_Updates is_not_Available_Updates AS Updates.is_not_Available_Updates is_Installed_Updates AS Updates.is_Installed_Updates is_not_Installed_Updates AS Updates.is_not_Installed_Updates is_Restart_Required_Updates AS Updates.is_Restart_Required_Updates is_not_Restart_Required_Updates AS Updates.is_not_Restart_Required_Updates | fields nodename, _time, host, source, sourcetype, Updates.dest_bunit, Updates.dest_category, Updates.dest_priority, Updates.dest_should_update, Updates.dvc, Updates.file_name, Updates.file_hash, Updates.severity, Updates.severity_id, Updates.tag, Updates.dest, Updates.signature, Updates.signature_id, Updates.status, Updates.vendor_product, Updates.is_Available_Updates, Updates.is_not_Available_Updates, Updates.is_Installed_Updates, Updates.is_not_Installed_Updates, Updates.is_Restart_Required_Updates, Updates.is_not_Restart_Required_Updates ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:02:00 2021', apiEndTime='Fri Jun  3 17:02:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Updates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:02:01.944, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654275720_672', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_typ (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:02:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:02:01.940, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD55851c38d1ee9115f_at_1654275720_671', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Resolution [  search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:02:00 2022', apiEndTime='Fri Jun  3 17:02:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Resolution_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:02:01.905, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f5919e316e76d7e0_at_1654275720_670', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Sessions [  search (index=* OR index=_*) ((`cim_Network_Sessions_indexes`) tag=network tag=session) | eval nodename = "All_Sessions"| eval dest_ip=case(source LIKE "stream%" AND isnotnull(yiaddr) AND yiaddr!="",yiaddr,isnull(dest_ip) OR dest_ip="","unknown",1=1,dest_ip), dest_mac=case(source LIKE "stream%" AND isnotnull(chaddr) AND chaddr!="",chaddr,isnull(dest_mac) OR dest_mac="","unknown",1=1,dest_mac), dest_nt_host=if(isnull(dest_nt_host) OR dest_nt_host="","unknown",dest_nt_host), dest_dns=if(isnull(dest_dns) OR dest_dns="","unknown",dest_dns), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Session_Start=if(searchmatch("(tag=start)"),1,0), is_not_Session_Start=1-is_Session_Start, is_Session_End=if(searchmatch("(tag=end)"),1,0), is_not_Session_End=1-is_Session_End, is_DHCP=if(searchmatch("(tag=dhcp)"),1,0), is_not_DHCP=1-is_DHCP, is_VPN=if(searchmatch("(tag=vpn)"),1,0), is_not_VPN=1-is_VPN | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=start)"), mvappend(nodename, "All_Sessions.Session_Start"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=end)"), mvappend(nodename, "All_Sessions.Session_End"), nodename) | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=dhcp)"), mvappend(nodename, "All_Sessions.DHCP"), nodename) | rename lease_duration AS All_Sessions.DHCP.lease_duration lease_scope AS All_Sessions.DHCP.lease_scope | eval nodename = if(nodename == "All_Sessions" AND searchmatch("(tag=vpn)"), mvappend(nodename, "All_Sessions.VPN"), nodename) | rename action AS All_Sessions.action dest_bunit AS All_Sessions.dest_bunit dest_category AS All_Sessions.dest_category dest_priority AS All_Sessions.dest_priority duration AS All_Sessions.duration response_time AS All_Sessions.response_time signature AS All_Sessions.signature signature_id AS All_Sessions.signature_id src_bunit AS All_Sessions.src_bunit src_category AS All_Sessions.src_category src_dns AS All_Sessions.src_dns src_ip AS All_Sessions.src_ip src_mac AS All_Sessions.src_mac src_nt_host AS All_Sessions.src_nt_host src_priority AS All_Sessions.src_priority tag AS All_Sessions.tag user_bunit AS All_Sessions.user_bunit user_category AS All_Sessions.user_category user_priority AS All_Sessions.user_priority dest_ip AS All_Sessions.dest_ip dest_mac AS All_Sessions.dest_mac dest_nt_host AS All_Sessions.dest_nt_host dest_dns AS All_Sessions.dest_dns user AS All_Sessions.user vendor_product AS All_Sessions.vendor_product is_Session_Start AS All_Sessions.is_Session_Start is_not_Session_Start AS All_Sessions.is_not_Session_Start is_Session_End AS All_Sessions.is_Session_End is_not_Session_End AS All_Sessions.is_not_Session_End is_DHCP AS All_Sessions.is_DHCP is_not_DHCP AS All_Sessions.is_not_DHCP is_VPN AS All_Sessions.is_VPN is_not_VPN AS All_Sessions.is_not_VPN | fields nodename, _time, host, source, sourcetype, All_Sessions.action, All_Sessions.dest_bunit, All_Sessions.dest_category, All_Sessions.dest_priority, All_Sessions.duration, All_Sessions.response_time, All_Sessions.signature, All_Sessions.signature_id, All_Sessions.src_bunit, All_Sessions.src_category, All_Sessions.src_dns, All_Sessions.src_ip, All_Sessions.src_mac, All_Sessions.src_nt_host, All_Sessions.src_priority, All_Sessions.tag, All_Sessions.user_bunit, All_Sessions.user_category, All_Sessions.user_priority, All_Sessions.dest_ip, All_Sessions.dest_mac, All_Sessions.dest_nt_host, All_Sessions.dest_dns, All_Sessions.user, All_Sessions.vendor_product, All_Sessions.is_Session_Start, All_Sessions.is_not_Session_Start, All_Sessions.is_Session_End, All_Sessions.is_not_Session_End, All_Sessions.is_DHCP, All_Sessions.is_not_DHCP, All_Sessions.is_VPN, All_Sessions.is_not_VPN, All_Sessions.DHCP.lease_duration, All_Sessions.DHCP.lease_scope ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:02:00 2022', apiEndTime='Fri Jun  3 17:02:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Sessions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:01:54.171, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275703.606233', has_error_warn=false, fully_completed_search=true, total_run_time=10.61, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275703, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="535", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548", app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb26032d7500783b0 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:01:54.162, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275660_669', has_error_warn=false, fully_completed_search=true, total_run_time=10.36, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275702, api_et=1654271460.000000000, api_lt=1654275060.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271460.000000000, search_lt=1654275060.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:01:43.029, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275703.606233', search='summarize  action=probe id=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548 normid=E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb26032d7500783b0 [search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, sum(summary_chunks) AS total_summary_chunks, count(eval( summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0") )) AS buckets, sum(eval(if(summary_complete=1 OR if(isnotnull(summary_hot_done), summary_hot_done=1, summary_chunks!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, values(summary_timespan) AS timespan, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:01:42.378, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275660_669', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:51:00 2022', apiEndTime='Fri Jun  3 16:51:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:01:24.187, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275660_668', has_error_warn=false, fully_completed_search=true, total_run_time=14.20, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275662, api_et=N/A, api_lt=1654275660.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275660.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1214", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:01:24.184, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654275660_667', has_error_warn=false, fully_completed_search=true, total_run_time=10.29, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275662, api_et=1622739660.000000000, api_lt=1654275660.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739660.000000000, search_lt=1654275660.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]']
Audit:[timestamp=06-03-2022 17:01:24.182, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654275660_665', has_error_warn=false, fully_completed_search=true, total_run_time=1.76, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654275662, api_et=1646326860.000000000, api_lt=1654275660.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646326860.000000000, search_lt=1654275660.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_startup_time="1026", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]']
Audit:[timestamp=06-03-2022 17:01:24.180, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD5c83b6c1279a5dacb_at_1654275600_655', has_error_warn=false, fully_completed_search=true, total_run_time=49.52, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275607, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Audit - Dataset Relation", search_startup_time="460", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_89260bd9d080bc5c", app="SA-Utils", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest /servicesNS/nobody/SA-Utils/contentinfo/_cache timeout=600 tshirt_server=local count=0 | stats count']
Audit:[timestamp=06-03-2022 17:01:24.175, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275660_668_1654275662.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.62, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654275662, api_et=N/A, api_lt=1654275660.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275660.000000000, is_realtime=0, savedsearch_name="", search_startup_time="61", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:01:24.166, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275660_668_1654275663.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275663, api_et=N/A, api_lt=1654275660.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275660.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:01:24.164, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275662.606229', has_error_warn=false, fully_completed_search=true, total_run_time=10.30, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275662, api_et=1622739662.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622739662.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="302", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Vulnerabilities normid= [ search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:01:24.162, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275660_668_1654275663.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.14, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654275663, api_et=N/A, api_lt=1654275660.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275660.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:01:24.161, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654275660_666', has_error_warn=false, fully_completed_search=true, total_run_time=10.32, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275662, api_et=1622739660.000000000, api_lt=1654275660.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739660.000000000, search_lt=1654275660.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]']
Audit:[timestamp=06-03-2022 17:01:02.833, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275662.606229', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Vulnerabilities normid= [ search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:01:02 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:01:02.140, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275660_668', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:01:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:01:02.129, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5cefc72a72dd5ee92_at_1654275660_667', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Vulnerabilities [  search (index=* OR index=_*) ((`cim_Vulnerabilities_indexes`) tag=vulnerability tag=report) | eval nodename = "Vulnerabilities"| eval bugtraq=if(isnotnull(bugtraq) AND bugtraq!="",lower(bugtraq),null()), category=if(isnull(category) OR category="","unknown",category), cert=if(isnotnull(cert) AND cert!="",lower(cert),null()), cve=if(isnotnull(cve) AND cve!="",lower(cve),null()), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), msft=if(isnotnull(msft) AND msft!="",lower(msft),null()), mskb=if(isnotnull(mskb) AND mskb!="",lower(mskb),null()), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), xref=if(isnotnull(xref) AND xref!="",lower(xref),null())| eval is_High_Critical_Vulnerabilities=if(searchmatch("((severity=\"high\" OR severity=\"critical\"))"),1,0), is_not_High_Critical_Vulnerabilities=1-is_High_Critical_Vulnerabilities, is_Medium_Vulnerabilities=if(searchmatch("(severity=\"medium\")"),1,0), is_not_Medium_Vulnerabilities=1-is_Medium_Vulnerabilities, is_Low_Informational_Vulnerabilities=if(searchmatch("((severity=\"low\" OR severity=\"informational\"))"),1,0), is_not_Low_Informational_Vulnerabilities=1-is_Low_Informational_Vulnerabilities | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"high\" OR severity=\"critical\"))"), mvappend(nodename, "Vulnerabilities.High_Critical_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("(severity=\"medium\")"), mvappend(nodename, "Vulnerabilities.Medium_Vulnerabilities"), nodename) | eval nodename = if(nodename == "Vulnerabilities" AND searchmatch("((severity=\"low\" OR severity=\"informational\"))"), mvappend(nodename, "Vulnerabilities.Low_Informational_Vulnerabilities"), nodename) | rename cvss AS Vulnerabilities.cvss dest_bunit AS Vulnerabilities.dest_bunit dest_category AS Vulnerabilities.dest_category dest_priority AS Vulnerabilities.dest_priority dvc_bunit AS Vulnerabilities.dvc_bunit dvc_category AS Vulnerabilities.dvc_category dvc_priority AS Vulnerabilities.dvc_priority severity_id AS Vulnerabilities.severity_id signature_id AS Vulnerabilities.signature_id tag AS Vulnerabilities.tag url AS Vulnerabilities.url user AS Vulnerabilities.user user_bunit AS Vulnerabilities.user_bunit user_category AS Vulnerabilities.user_category user_priority AS Vulnerabilities.user_priority bugtraq AS Vulnerabilities.bugtraq category AS Vulnerabilities.category cert AS Vulnerabilities.cert cve AS Vulnerabilities.cve dest AS Vulnerabilities.dest dvc AS Vulnerabilities.dvc msft AS Vulnerabilities.msft mskb AS Vulnerabilities.mskb severity AS Vulnerabilities.severity signature AS Vulnerabilities.signature vendor_product AS Vulnerabilities.vendor_product xref AS Vulnerabilities.xref is_High_Critical_Vulnerabilities AS Vulnerabilities.is_High_Critical_Vulnerabilities is_not_High_Critical_Vulnerabilities AS Vulnerabilities.is_not_High_Critical_Vulnerabilities is_Medium_Vulnerabilities AS Vulnerabilities.is_Medium_Vulnerabilities is_not_Medium_Vulnerabilities AS Vulnerabilities.is_not_Medium_Vulnerabilities is_Low_Informational_Vulnerabilities AS Vulnerabilities.is_Low_Informational_Vulnerabilities is_not_Low_Informational_Vulnerabilities AS Vulnerabilities.is_not_Low_Informational_Vulnerabilities | fields nodename, _time, host, source, sourcetype, Vulnerabilities.cvss, Vulnerabilities.dest_bunit, Vulnerabilities.dest_category, Vulnerabilities.dest_priority, Vulnerabilities.dvc_bunit, Vulnerabilities.dvc_category, Vulnerabilities.dvc_priority, Vulnerabilities.severity_id, Vulnerabilities.signature_id, Vulnerabilities.tag, Vulnerabilities.url, Vulnerabilities.user, Vulnerabilities.user_bunit, Vulnerabilities.user_category, Vulnerabilities.user_priority, Vulnerabilities.bugtraq, Vulnerabilities.category, Vulnerabilities.cert, Vulnerabilities.cve, Vulnerabilities.dest, Vulnerabilities.dvc, Vulnerabilities.msft, Vulnerabilities.mskb, Vulnerabilities.severity, Vulnerabilities.signature, Vulnerabilities.vendor_product, Vulnerabilities.xref, Vulnerabilities.is_High_Critical_Vulnerabilities, Vulnerabilities.is_not_High_Critical_Vulnerabilities, Vulnerabilities.is_Medium_Vulnerabilities, Vulnerabilities.is_not_Medium_Vulnerabilities, Vulnerabilities.is_Low_Informational_Vulnerabilities, Vulnerabilities.is_not_Low_Informational_Vulnerabilities ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:01:00 2021', apiEndTime='Fri Jun  3 17:01:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Vulnerabilities_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:01:02.090, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e95b3ad8791dbdcc_at_1654275660_666', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Malware [  search (index=* OR index=_*) ((`cim_Malware_indexes`) tag=malware tag=attack) | eval nodename = "Malware_Attacks"| eval action=if(isnull(action) OR action="","unknown",action), category=if(isnull(category) OR category="","unknown",category), date=strftime(_time, "%m-%d-%Y"), dest=if(isnull(dest) OR dest="","unknown",dest), dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), severity=if(isnull(severity) OR severity="","unknown",severity), signature=if(isnull(signature) OR signature="","unknown",signature), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Allowed_Malware=if(searchmatch("(action=\"allowed\")"),1,0), is_not_Allowed_Malware=1-is_Allowed_Malware, is_Blocked_Malware=if(searchmatch("(action=\"blocked\")"),1,0), is_not_Blocked_Malware=1-is_Blocked_Malware, is_Deferred_Malware=if(searchmatch("(action=\"deferred\")"),1,0), is_not_Deferred_Malware=1-is_Deferred_Malware | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"allowed\")"), mvappend(nodename, "Malware_Attacks.Allowed_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"blocked\")"), mvappend(nodename, "Malware_Attacks.Blocked_Malware"), nodename) | eval nodename = if(nodename == "Malware_Attacks" AND searchmatch("(action=\"deferred\")"), mvappend(nodename, "Malware_Attacks.Deferred_Malware"), nodename) | rename dest_bunit AS Malware_Attacks.dest_bunit dest_category AS Malware_Attacks.dest_category dest_priority AS Malware_Attacks.dest_priority dest_requires_av AS Malware_Attacks.dest_requires_av file_hash AS Malware_Attacks.file_hash file_name AS Malware_Attacks.file_name file_path AS Malware_Attacks.file_path severity_id AS Malware_Attacks.severity_id signature_id AS Malware_Attacks.signature_id src AS Malware_Attacks.src src_bunit AS Malware_Attacks.src_bunit src_category AS Malware_Attacks.src_category src_priority AS Malware_Attacks.src_priority src_user AS Malware_Attacks.src_user tag AS Malware_Attacks.tag url AS Malware_Attacks.url user_bunit AS Malware_Attacks.user_bunit user_category AS Malware_Attacks.user_category user_priority AS Malware_Attacks.user_priority action AS Malware_Attacks.action category AS Malware_Attacks.category date AS Malware_Attacks.date dest AS Malware_Attacks.dest dest_nt_domain AS Malware_Attacks.dest_nt_domain severity AS Malware_Attacks.severity signature AS Malware_Attacks.signature user AS Malware_Attacks.user vendor_product AS Malware_Attacks.vendor_product is_Allowed_Malware AS Malware_Attacks.is_Allowed_Malware is_not_Allowed_Malware AS Malware_Attacks.is_not_Allowed_Malware is_Blocked_Malware AS Malware_Attacks.is_Blocked_Malware is_not_Blocked_Malware AS Malware_Attacks.is_not_Blocked_Malware is_Deferred_Malware AS Malware_Attacks.is_Deferred_Malware is_not_Deferred_Malware AS Malware_Attacks.is_not_Deferred_Malware | fields nodename, _time, host, source, sourcetype, Malware_Attacks.dest_bunit, Malware_Attacks.dest_category, Malware_Attacks.dest_priority, Malware_Attacks.dest_requires_av, Malware_Attacks.file_hash, Malware_Attacks.file_name, Malware_Attacks.file_path, Malware_Attacks.severity_id, Malware_Attacks.signature_id, Malware_Attacks.src, Malware_Attacks.src_bunit, Malware_Attacks.src_category, Malware_Attacks.src_priority, Malware_Attacks.src_user, Malware_Attacks.tag, Malware_Attacks.url, Malware_Attacks.user_bunit, Malware_Attacks.user_category, Malware_Attacks.user_priority, Malware_Attacks.action, Malware_Attacks.category, Malware_Attacks.date, Malware_Attacks.dest, Malware_Attacks.dest_nt_domain, Malware_Attacks.severity, Malware_Attacks.signature, Malware_Attacks.user, Malware_Attacks.vendor_product, Malware_Attacks.is_Allowed_Malware, Malware_Attacks.is_not_Allowed_Malware, Malware_Attacks.is_Blocked_Malware, Malware_Attacks.is_not_Blocked_Malware, Malware_Attacks.is_Deferred_Malware, Malware_Attacks.is_not_Deferred_Malware ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:01:00 2021', apiEndTime='Fri Jun  3 17:01:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Malware_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:01:02.053, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5dbc859cde34b3bc6_at_1654275660_665', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Network_Traffic [  search (index=* OR index=_*) ((`cim_Network_Traffic_indexes`) tag=network tag=communicate) | eval nodename = "All_Traffic"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="","unknown",dest), dest_port=if(isnum(dest_port),dest_port,0), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), packets=case(isnum(packets),packets,isnum(packets_in) AND isnum(packets_out),packets_in+packets_out,1=1,null()), packets_in=case(isnum(packets_in),packets_in,isnum(packets) AND isnum(packets_out),packets-packets_out,1=1,null()), packets_out=case(isnum(packets_out),packets_out,isnum(packets) AND isnum(packets_in),packets-packets_in,1=1,null()), rule=if(isnull(rule) OR rule="","unknown",rule), src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), transport=if(isnull(transport) OR transport="","unknown",lower(transport)), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Traffic_By_Action=if(searchmatch("(action=*)"),1,0), is_not_Traffic_By_Action=1-is_Traffic_By_Action | eval nodename = if(nodename == "All_Traffic" AND searchmatch("(action=*)"), mvappend(nodename, "All_Traffic.Traffic_By_Action"), nodename)| eval is_Allowed_Traffic=if(searchmatch("(action=allowed)"),1,0), is_not_Allowed_Traffic=1-is_Allowed_Traffic, is_Blocked_Traffic=if(searchmatch("(action=blocked)"),1,0), is_not_Blocked_Traffic=1-is_Blocked_Traffic | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=allowed)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Allowed_Traffic"), nodename) | eval nodename = if(nodename == "All_Traffic.Traffic_By_Action" AND searchmatch("(action=blocked)"), mvappend(nodename, "All_Traffic.Traffic_By_Action.Blocked_Traffic"), nodename) | rename is_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_Allowed_Traffic is_not_Allowed_Traffic AS All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic is_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_Blocked_Traffic is_not_Blocked_Traffic AS All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic | rename app AS All_Traffic.app channel AS All_Traffic.channel dest_bunit AS All_Traffic.dest_bunit dest_category AS All_Traffic.dest_category dest_interface AS All_Traffic.dest_interface dest_ip AS All_Traffic.dest_ip dest_mac AS All_Traffic.dest_mac dest_priority AS All_Traffic.dest_priority dest_translated_ip AS All_Traffic.dest_translated_ip dest_translated_port AS All_Traffic.dest_translated_port dest_zone AS All_Traffic.dest_zone direction AS All_Traffic.direction duration AS All_Traffic.duration dvc_ip AS All_Traffic.dvc_ip dvc_bunit AS All_Traffic.dvc_bunit dvc_category AS All_Traffic.dvc_category dvc_mac AS All_Traffic.dvc_mac dvc_priority AS All_Traffic.dvc_priority dvc_zone AS All_Traffic.dvc_zone flow_id AS All_Traffic.flow_id icmp_code AS All_Traffic.icmp_code icmp_type AS All_Traffic.icmp_type process_id AS All_Traffic.process_id protocol AS All_Traffic.protocol protocol_version AS All_Traffic.protocol_version response_time AS All_Traffic.response_time session_id AS All_Traffic.session_id src_bunit AS All_Traffic.src_bunit src_category AS All_Traffic.src_category src_interface AS All_Traffic.src_interface src_ip AS All_Traffic.src_ip src_mac AS All_Traffic.src_mac src_priority AS All_Traffic.src_priority src_translated_ip AS All_Traffic.src_translated_ip src_translated_port AS All_Traffic.src_translated_port src_zone AS All_Traffic.src_zone ssid AS All_Traffic.ssid tag AS All_Traffic.tag tcp_flag AS All_Traffic.tcp_flag tos AS All_Traffic.tos ttl AS All_Traffic.ttl user_bunit AS All_Traffic.user_bunit user_category AS All_Traffic.user_category user_priority AS All_Traffic.user_priority vlan AS All_Traffic.vlan wifi AS All_Traffic.wifi vendor_account AS All_Traffic.vendor_account action AS All_Traffic.action bytes AS All_Traffic.bytes bytes_in AS All_Traffic.bytes_in bytes_out AS All_Traffic.bytes_out dest AS All_Traffic.dest dest_port AS All_Traffic.dest_port dvc AS All_Traffic.dvc packets AS All_Traffic.packets packets_in AS All_Traffic.packets_in packets_out AS All_Traffic.packets_out rule AS All_Traffic.rule src AS All_Traffic.src src_port AS All_Traffic.src_port transport AS All_Traffic.transport user AS All_Traffic.user vendor_product AS All_Traffic.vendor_product is_Traffic_By_Action AS All_Traffic.is_Traffic_By_Action is_not_Traffic_By_Action AS All_Traffic.is_not_Traffic_By_Action | fields nodename, _time, host, source, sourcetype, All_Traffic.app, All_Traffic.channel, All_Traffic.dest_bunit, All_Traffic.dest_category, All_Traffic.dest_interface, All_Traffic.dest_ip, All_Traffic.dest_mac, All_Traffic.dest_priority, All_Traffic.dest_translated_ip, All_Traffic.dest_translated_port, All_Traffic.dest_zone, All_Traffic.direction, All_Traffic.duration, All_Traffic.dvc_ip, All_Traffic.dvc_bunit, All_Traffic.dvc_category, All_Traffic.dvc_mac, All_Traffic.dvc_priority, All_Traffic.dvc_zone, All_Traffic.flow_id, All_Traffic.icmp_code, All_Traffic.icmp_type, All_Traffic.process_id, All_Traffic.protocol, All_Traffic.protocol_version, All_Traffic.response_time, All_Traffic.session_id, All_Traffic.src_bunit, All_Traffic.src_category, All_Traffic.src_interface, All_Traffic.src_ip, All_Traffic.src_mac, All_Traffic.src_priority, All_Traffic.src_translated_ip, All_Traffic.src_translated_port, All_Traffic.src_zone, All_Traffic.ssid, All_Traffic.tag, All_Traffic.tcp_flag, All_Traffic.tos, All_Traffic.ttl, All_Traffic.user_bunit, All_Traffic.user_category, All_Traffic.user_priority, All_Traffic.vlan, All_Traffic.wifi, All_Traffic.vendor_account, All_Traffic.action, All_Traffic.bytes, All_Traffic.bytes_in, All_Traffic.bytes_out, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.packets, All_Traffic.packets_in, All_Traffic.packets_out, All_Traffic.rule, All_Traffic.src, All_Traffic.src_port, All_Traffic.transport, All_Traffic.user, All_Traffic.vendor_product, All_Traffic.is_Traffic_By_Action, All_Traffic.is_not_Traffic_By_Action, All_Traffic.Traffic_By_Action.is_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_not_Allowed_Traffic, All_Traffic.Traffic_By_Action.is_Blocked_Traffic, All_Traffic.Traffic_By_Action.is_not_Blocked_Traffic ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:01:00 2022', apiEndTime='Fri Jun  3 17:01:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Network_Traffic_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:54.182, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275600_664', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275640, api_et=1654271400.000000000, api_lt=1654275000.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271400.000000000, search_lt=1654275000.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 17:00:40.417, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275600_664', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:50:00 2022', apiEndTime='Fri Jun  3 16:50:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:24.239, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654275600_659', has_error_warn=false, fully_completed_search=true, total_run_time=1.23, event_count=5, result_count=3, available_count=0, scan_count=5, drop_count=0, exec_time=1654275608, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_startup_time="1058", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]']
Audit:[timestamp=06-03-2022 17:00:24.235, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtRW5kcG9pbnRQcm90ZWN0aW9u__RMD58643e1297baf93a0_at_1654275600_649', has_error_warn=true, fully_completed_search=true, total_run_time=10.61, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275605, api_et=1654271400.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271400.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Endpoint - Update Signature Reference - Lookup Gen", search_startup_time="1094", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-EndpointProtection_admin_71e81abc833213ee", app="SA-EndpointProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| from datamodel:"Updates"."Updates" | eval signature_zip=mvzip(signature,signature_id) | mvexpand signature_zip | rex field=signature_zip "(?<signature>.*)\,(?<signature_id>.*)" | stats min(_time) as firstTime,max(_time) as lastTime,latest(signature) as signature by signature_id,vendor_product | inputlookup append=T update_signature_reference_lookup | eval _time=lastTime | stats min(firstTime) as firstTime,max(lastTime) as lastTime,latest(signature) as signature by signature_id,vendor_product | runshellscript override_if_empty=false update_signature_reference_lookup | stats count']
Audit:[timestamp=06-03-2022 17:00:24.234, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275609.606214', has_error_warn=false, fully_completed_search=true, total_run_time=10.58, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275609, api_et=1622739609.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622739609.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="404", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions normid= [ search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:00:24.232, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275600_648_1654275605.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.63, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654275605, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="", search_startup_time="86", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 17:00:24.228, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5ed8e405fd0717242_1654275600.606203', has_error_warn=false, fully_completed_search=true, total_run_time=2.71, event_count=2, result_count=0, available_count=0, scan_count=2, drop_count=0, exec_time=1654275600, api_et=1654273200.000000000, api_lt=1654275000.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273200.000000000, search_lt=1654275000.000000000, is_realtime=0, savedsearch_name="threatmatch://user", search_startup_time="2835", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_37d5afbbdbe1867b", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Authentication.src"),values("Authentication.dest") from datamodel="Authentication"."Authentication" by "Authentication.src_user"
    | lookup "threatintel_by_user" value as "Authentication.src_user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "Authentication.src_user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Authentication.src,src)`
    | `sistats_values_rename(Authentication.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Authentication.src_user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Authentication.src"),values("Authentication.dest"),values("Authentication.src_user") from datamodel="Authentication"."Authentication" by "Authentication.user"
    | lookup "threatintel_by_user" value as "Authentication.user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "Authentication.user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Authentication.src,src)`
    | `sistats_values_rename(Authentication.dest,dest)`
    | `sistats_values_rename(Authentication.src_user,src_user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Authentication.user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Inventory.dest") from datamodel="Compute_Inventory"."All_Inventory" where nodename="All_Inventory.User" by "All_Inventory.User.user"
    | lookup "threatintel_by_user" value as "All_Inventory.User.user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "All_Inventory.User.user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Inventory.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Inventory.User.user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest") from datamodel="Web"."Web" by "Web.user"
    | lookup "threatintel_by_user" value as "Web.user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "Web.user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.user','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://user"']
Audit:[timestamp=06-03-2022 17:00:24.226, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275607.606213', has_error_warn=false, fully_completed_search=true, total_run_time=10.88, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275608, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="738", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk", app="SA-ThreatIntelligence", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Risk normid= [ search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:00:24.224, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654275600_633', has_error_warn=false, fully_completed_search=true, total_run_time=10.90, event_count=0, result_count=7, available_count=0, scan_count=0, drop_count=0, exec_time=1654275602, api_et=1622739600.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739600.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_startup_time="1166", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]']
Audit:[timestamp=06-03-2022 17:00:24.223, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275603.606207', has_error_warn=false, fully_completed_search=true, total_run_time=1.25, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275603, api_et=1646326803.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1646326803.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="848", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Web normid= [ search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code] | eval backfill_start_time = relative_time(now(), "-3mon") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:00:24.221, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654275600_637', has_error_warn=false, fully_completed_search=true, total_run_time=10.46, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275603, api_et=1622739600.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739600.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]']
Audit:[timestamp=06-03-2022 17:00:24.219, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVXRpbHM__RMD5d597c4bb3413497c_at_1654275600_656_1654275607.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.05, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275607, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_7f2c93900586b39d", app="SA-Utils", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search=' | rest "/services/admin/inputstatus/ExecProcessor:exec%20commands" tshirt_server=local']
Audit:[timestamp=06-03-2022 17:00:24.218, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD5d597c4bb3413497c_at_1654275600_656', has_error_warn=false, fully_completed_search=true, total_run_time=10.12, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275607, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Audit - Script Errors", search_startup_time="550", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_71b5810d40cc35c5", app="SA-Utils", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest /services/admin/inputstatus/ModularInputs:modular%20input%20commands tshirt_server=local count=0 | append [| rest /services/admin/inputstatus/ExecProcessor:exec%20commands tshirt_server=local count=0] | fields inputs* | transpose | rex field=column "inputs(?<script>\S+)(?:\s\((?<stanza>[^\(]+)\))?\.(?<key>(exit status description)|(time closed)|(time opened))" | eval value=coalesce('row 1', 'row 2'), stanza=coalesce(stanza, "default"), started=if(key=="time opened", value, started), stopped=if(key=="time closed", value, stopped) | rex field=value "exited\s+with\s+code\s+(?<exit_status>\d+)" | stats first(started) as started, first(stopped) as stopped, first(exit_status) as exit_status by script, stanza | eval errmsg=case(exit_status=="0", null(), isnotnull(exit_status), "A script exited abnormally with exit status: "+exit_status, isnull(started) or isnotnull(stopped), "A script is in an unknown state"), ignore=if(`script_error_msg_ignore`, 1, 0) | where isnotnull(errmsg) AND ignore=0']
Audit:[timestamp=06-03-2022 17:00:24.216, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654275600_634', has_error_warn=false, fully_completed_search=true, total_run_time=11.30, event_count=125, result_count=18, available_count=0, scan_count=424, drop_count=0, exec_time=1654275602, api_et=1622739600.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739600.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_startup_time="1157", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]']
Audit:[timestamp=06-03-2022 17:00:24.215, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275600_648', has_error_warn=false, fully_completed_search=true, total_run_time=14.76, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275605, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1355", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 17:00:24.212, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD56bad8d5ede1359d6_at_1654275600_652', has_error_warn=false, fully_completed_search=true, total_run_time=10.17, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275606, api_et=1654189200.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654189200.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Audit - Index Readiness", search_startup_time="492", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_f9d8a1e5b0e3efd0", app="SA-Utils", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest /services/data/indexes tshirt_server=* count=0 | eval _time=strptime(maxTime, "%Y-%m-%dT%H:%M:%S%z") | stats sum(totalEventCount) AS count, max(_time) AS _time by title | eval readiness=if(count > 0 AND _time>=relative_time(now(), "-24h@h"), 1, 0), calc_count=if(readiness==0, 0, count)  | fields title, calc_count, readiness | rename title AS index, calc_count as count | runshellscript key_field=index index_readiness_lookup | stats count']
Audit:[timestamp=06-03-2022 17:00:24.211, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD55392d2cd3b6dec88_at_1654275600_663', has_error_warn=false, fully_completed_search=true, total_run_time=10.47, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275610, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548_ACCELERATE_", search_startup_time="323", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=report_acceleration, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress ]']
Audit:[timestamp=06-03-2022 17:00:24.211, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5cc8fbb6063874056_at_1654275600_651', has_error_warn=false, fully_completed_search=true, total_run_time=10.52, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275606, api_et=1654274100.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274100.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="ES-AWS - Account ID List - Lookup Gen", search_startup_time="767", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_cfa5d58970c4285c", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search `aws-index` | eval account_id = mvdedup(mvappend(aws_account_id, recipientAccountId, AwsAccountId, vendor_account)) | where account_id != "unknown" | inputlookup append=T aws_all_account_ids | stats count by account_id | fields - count | runshellscript override_if_empty=false aws_all_account_ids | stats count']
Audit:[timestamp=06-03-2022 17:00:24.210, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275600_648_1654275606.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275606, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 17:00:24.207, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5d0450ab7e3bde7e7_at_1654275600_640', has_error_warn=false, fully_completed_search=true, total_run_time=1.35, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275603, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Threat - Refresh Governance - Administrative", search_startup_time="1565", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_70a2c5902e92cbb2", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/alerts/governance/_reload']
Audit:[timestamp=06-03-2022 17:00:24.205, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654275600_647', has_error_warn=false, fully_completed_search=true, total_run_time=3.14, event_count=2880, result_count=1, available_count=0, scan_count=2880, drop_count=0, exec_time=1654275605, api_et=1654102800.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654102800.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="ESS - Notable Events", search_startup_time="2185", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_87db9bb7a232c62f", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=1, eliminated_buckets=0, considered_events=2880, total_slices=121, decompressed_slices=10, duration.command.search.index=1, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=135, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, sourcetype_count__stash=2880, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count']
Audit:[timestamp=06-03-2022 17:00:24.204, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654275600_636', has_error_warn=false, fully_completed_search=true, total_run_time=5.99, event_count=35, result_count=3, available_count=0, scan_count=35, drop_count=0, exec_time=1654275603, api_et=1622739600.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739600.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_startup_time="1322", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]']
Audit:[timestamp=06-03-2022 17:00:24.203, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275601.606204', has_error_warn=false, fully_completed_search=true, total_run_time=1.05, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275601, api_et=1651597201.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651597201.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="778", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Filesystem normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product] | eval backfill_start_time = relative_time(now(), "-1mon") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:00:24.202, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275604.606208', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275604, api_et=1622739603.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622739603.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="282", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Ticket_Management normid= [ search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:00:24.201, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5b97703d59f97cebd_at_1654275600_642', has_error_warn=false, fully_completed_search=true, total_run_time=1.33, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275603, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Threat - Refresh Reviewstatuses - Administrative", search_startup_time="1502", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_05fc7e2948e3eee2", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/alerts/reviewstatuses/_reload']
Audit:[timestamp=06-03-2022 17:00:24.199, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5a742da37541343b2_at_1654275600_639', has_error_warn=false, fully_completed_search=true, total_run_time=10.93, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275603, api_et=1653670200.000000000, api_lt=1654275000.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1653670200.000000000, search_lt=1654275000.000000000, is_realtime=0, savedsearch_name="Risk - 7 Day ATT&CK Tactic Threshold Exceeded - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_553873b00608ee08", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count, values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk where All_Risk.annotations.mitre_attack.mitre_tactic_id=* by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id' | where mitre_tactic_id_count >= 3 and source_count >= 4']
Audit:[timestamp=06-03-2022 17:00:24.199, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD5495078187e88a4c3_at_1654275600_638', has_error_warn=false, fully_completed_search=true, total_run_time=10.68, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275603, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Utils - User Realnames - Lookup Gen", search_startup_time="1244", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_a775b1da515861dc", app="SA-Utils", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/authentication/users | rename title as user | eval _key=user | dedup _key | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key user realname | runshellscript key_field=_key user_realnames_lookup | stats count']
Audit:[timestamp=06-03-2022 17:00:24.198, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD591854b6694917629_at_1654275600_662', has_error_warn=false, fully_completed_search=true, total_run_time=10.70, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275610, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71_ACCELERATE_", search_startup_time="664", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=report_acceleration, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time ]']
Audit:[timestamp=06-03-2022 17:00:24.197, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654275600_658', has_error_warn=false, fully_completed_search=true, total_run_time=10.94, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275607, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_startup_time="1058", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]']
Audit:[timestamp=06-03-2022 17:00:24.196, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD551cdb06b5c6a21a9_at_1654275600_650', has_error_warn=false, fully_completed_search=true, total_run_time=1.17, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275605, api_et=1654274100.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654274100.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="ES-AWS - Actions List - Lookup Gen", search_startup_time="1413", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_57d89d2e67fb8485", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search `aws-index` NOT command IN ("Get*", "Describe*" "List*") | eval cloud_service_provider="aws" | inputlookup append=T actions | stats count by command, cloud_service_provider, change_type | fields - count | runshellscript override_if_empty=false actions | stats count']
Audit:[timestamp=06-03-2022 17:00:24.194, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD566ab5c97239475f4_at_1654275600_646', has_error_warn=false, fully_completed_search=true, total_run_time=1.36, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275605, api_et=1653670800.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1653670800.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Threat - Risk Correlation By System - Lookup Gen", search_startup_time="1488", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a7aa72da742377fb", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats summariesonly=false sum(All_Risk.calculated_risk_score) as risk_score from datamodel=Risk.All_Risk where All_Risk.risk_object_type="system" by All_Risk.risk_object | eval dest=lower('All_Risk.risk_object') | `get_asset(dest)` | eval dest=mvdedup(if(isnotnull(dest_asset_id),mvappend(dest,lower(dest_asset)),dest)) | stats sum(risk_score) as risk_score by dest | rename dest as risk_object | runshellscript risk_correlation_by_system_lookup | stats count']
Audit:[timestamp=06-03-2022 17:00:24.193, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275600_648_1654275606.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.17, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654275606, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="", search_startup_time="7", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 17:00:24.192, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5c5d72a1c7e0ef794_1654275600.606201', has_error_warn=false, fully_completed_search=true, total_run_time=1.93, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275600, api_et=1654273200.000000000, api_lt=1654275000.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273200.000000000, search_lt=1654275000.000000000, is_realtime=0, savedsearch_name="threatmatch://certificate_common_name", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_954371655b696c88", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_common_name"
    | lookup "threatintel_by_certificate_common_name" value as "All_Certificates.SSL.ssl_issuer_common_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_common_name_wildcard" value as "All_Certificates.SSL.ssl_issuer_common_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_common_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_common_name','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_common_name"
    | lookup "threatintel_by_certificate_common_name" value as "All_Certificates.SSL.ssl_subject_common_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_common_name_wildcard" value as "All_Certificates.SSL.ssl_subject_common_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_common_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_common_name','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://certificate_common_name"']
Audit:[timestamp=06-03-2022 17:00:24.190, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5ae60495d9bee537e_at_1654275600_644', has_error_warn=false, fully_completed_search=true, total_run_time=1.15, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275604, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Risk - Refresh Risk Factors - Administrative", search_startup_time="784", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_2ac859b9901733cd", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/alerts/risk_factors/_reload']
Audit:[timestamp=06-03-2022 17:00:24.189, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654275600_657', has_error_warn=false, fully_completed_search=true, total_run_time=10.42, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275607, api_et=1654188600.000000000, api_lt=1654275000.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654188600.000000000, search_lt=1654275000.000000000, is_realtime=0, savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_d34d6d33ee94d419", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`']
Audit:[timestamp=06-03-2022 17:00:24.188, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275614.606216', has_error_warn=false, fully_completed_search=true, total_run_time=10.69, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275614, api_et=1622739614.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1622739614.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="481", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit normid= [ search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:00:24.187, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVXRpbHM__RMD5d3ec87bd185c0ef4_at_1654275600_654_1654275607.3', has_error_warn=false, fully_completed_search=true, total_run_time=10.83, event_count=5447, result_count=84, available_count=0, scan_count=16445, drop_count=0, exec_time=1654275607, api_et=1654189200.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654189200.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="", search_startup_time="146", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_4ea944d42eb608cb", app="SA-Utils", provenance="N/A", mode="historical_batch", is_proxied=false, searched_buckets=3, eliminated_buckets=0, considered_events=16445, total_slices=11138, decompressed_slices=1885, duration.command.search.index=10, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=279, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, sourcetype_count__scheduler=5447, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| search (index=_internal sourcetype=scheduler (search_type=adhoc OR search_type="")) | stats count(eval(status=="success")) as success, count(eval(status=="skipped")) as skipped by savedsearch_name']
Audit:[timestamp=06-03-2022 17:00:24.186, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD51dbc70e0e18846c9_at_1654275600_643_1654275604.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.04, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275604, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_f2df6493ea859e37", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search=' | makeresults | eval owner="unassigned"']
Audit:[timestamp=06-03-2022 17:00:24.184, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD5c31bfb27acb495b2_at_1654275600_653', has_error_warn=false, fully_completed_search=true, total_run_time=10.13, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275607, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Audit - Sourcetype Readiness - Lookup Gen", search_startup_time="247", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_8fb8b7782d6d1227", app="SA-Utils", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| metadata type=sourcetypes tshirt_server=* index=* index=_* | eval readiness=if(lastTime > now() - 86400, 1, 0), update_time=now() | fields sourcetype, readiness, update_time | dedup sourcetype | runshellscript key_field=sourcetype sourcetype_readiness_lookup | stats count']
Audit:[timestamp=06-03-2022 17:00:24.183, user=admin, action=search, info=completed, search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5fdbe716eed5fd8d5_at_1654275600_661', has_error_warn=false, fully_completed_search=true, total_run_time=10.82, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275609, api_et=1651536000.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651536000.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39_ACCELERATE_", search_startup_time="882", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39", app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=report_acceleration, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized ]']
Audit:[timestamp=06-03-2022 17:00:24.182, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD53eddd1500759c205_1654275600.606200', has_error_warn=false, fully_completed_search=true, total_run_time=3.11, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275600, api_et=1654273200.000000000, api_lt=1654275000.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273200.000000000, search_lt=1654275000.000000000, is_realtime=0, savedsearch_name="threatmatch://email", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_eaa0f13d4a92e3c5", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_email"
    | lookup "threatintel_by_email" value as "All_Certificates.SSL.ssl_issuer_email" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Certificates.SSL.ssl_issuer_email" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_email','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_email"
    | lookup "threatintel_by_email" value as "All_Certificates.SSL.ssl_subject_email" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Certificates.SSL.ssl_subject_email" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_email','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.src_user"
    | lookup "threatintel_by_email" value as "All_Email.src_user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Email.src_user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.src_user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user") from datamodel="Email"."All_Email" by "All_Email.recipient"
    | lookup "threatintel_by_email" value as "All_Email.recipient" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Email.recipient" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.recipient','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://email"']
Audit:[timestamp=06-03-2022 17:00:24.181, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654275600_660', has_error_warn=false, fully_completed_search=true, total_run_time=10.74, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275609, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_startup_time="637", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence", app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]']
Audit:[timestamp=06-03-2022 17:00:24.180, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654275600_635', has_error_warn=false, fully_completed_search=true, total_run_time=2.06, event_count=0, result_count=74, available_count=0, scan_count=0, drop_count=0, exec_time=1654275603, api_et=1646326800.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1646326800.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_startup_time="1581", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]']
Audit:[timestamp=06-03-2022 17:00:24.168, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5b7fc89b7a285771b_at_1654275600_645', has_error_warn=false, fully_completed_search=true, total_run_time=1.29, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275605, api_et=1653670800.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1653670800.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Threat - Risk Correlation By User - Lookup Gen", search_startup_time="1540", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_f545c8b9cfbc397d", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats summariesonly=false sum(All_Risk.calculated_risk_score) as risk_score from datamodel=Risk.All_Risk where All_Risk.risk_object_type="user" by All_Risk.risk_object | eval user=lower('All_Risk.risk_object') | `get_identity4events(user)` | eval risk_object=if(isnotnull(user_identity),lower(user_identity),user),risk_object=mvdedup(risk_object) | stats sum(risk_score) as risk_score by risk_object | runshellscript risk_correlation_by_user_lookup | stats count']
Audit:[timestamp=06-03-2022 17:00:24.166, user=tshirt-system-user, action=search, info=completed, search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD56090c2f26559b465_1654275600.606202', has_error_warn=false, fully_completed_search=true, total_run_time=1.13, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275600, api_et=1654273200.000000000, api_lt=1654275000.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273200.000000000, search_lt=1654275000.000000000, is_realtime=0, savedsearch_name="threatmatch://registry_path", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ThreatIntelligence_nobody_07e0cbca0fa6efb1", app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Registry.dest"),values("Registry.user") from datamodel="Endpoint"."Registry" by "Registry.registry_path"
    | lookup "threatintel_by_registry_path" value as "Registry.registry_path" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_registry_path_wildcard" value as "Registry.registry_path" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Registry.dest,dest)`
    | `sistats_values_rename(Registry.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"registry_path",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Registry.registry_path','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://registry_path"']
Audit:[timestamp=06-03-2022 17:00:24.165, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtQWNjZXNzUHJvdGVjdGlvbg__RMD54a1edad66ca90d80_at_1654275600_641', has_error_warn=false, fully_completed_search=true, total_run_time=1.29, event_count=1, result_count=1, available_count=0, scan_count=1, drop_count=0, exec_time=1654275603, api_et=1654273800.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654273800.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Access - Access App Tracker - Lookup Gen", search_startup_time="1869", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-AccessProtection_admin_71c0a0e9ec5d01ab", app="SA-AccessProtection", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Authentication"."Authentication" where "Authentication.app"!="unknown" by "Authentication.app" | rename "Authentication.app" as "app" | inputlookup append=T "access_app_tracker" | stats min("firstTime") as "firstTime",max("lastTime") as "lastTime" by "app" | runshellscript override_if_empty=false "access_app_tracker" | stats count']
Audit:[timestamp=06-03-2022 17:00:24.164, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVXRpbHM__RMD5d3ec87bd185c0ef4_at_1654275600_654', has_error_warn=false, fully_completed_search=true, total_run_time=3.26, event_count=21931, result_count=1, available_count=0, scan_count=22027, drop_count=0, exec_time=1654275607, api_et=1654189200.000000000, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654189200.000000000, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Audit - Savedsearch Statistics - Lookup Gen", search_startup_time="1104", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-Utils_admin_d2e291b871066f22", app="SA-Utils", provenance="scheduler", mode="historical_batch", is_proxied=false, searched_buckets=2, eliminated_buckets=0, considered_events=22027, total_slices=20925, decompressed_slices=1465, duration.command.search.index=17, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=200, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, sourcetype_count__audittrail=21931, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='search index=_audit action=search savedsearch_name=* info=completed | stats avg(total_run_time) as avg_run_time, avg(event_count) as avg_event_count, avg(result_count) as avg_result_count, count as invocations by savedsearch_name | join type=outer savedsearch_name [search index=_internal sourcetype=scheduler search_type=adhoc OR search_type="" | stats count(eval(status=="success")) as success, count(eval(status=="skipped")) as skipped by savedsearch_name] | where savedsearch_name != "" | eval update_time=now() | runshellscript key_field=savedsearch_name savedsearch_stats_lookup | stats count']
Audit:[timestamp=06-03-2022 17:00:24.163, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD51dbc70e0e18846c9_at_1654275600_643', has_error_warn=false, fully_completed_search=true, total_run_time=1.22, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275603, api_et=N/A, api_lt=1654275600.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275600.000000000, is_realtime=0, savedsearch_name="Threat - Notable Owners - Lookup Gen", search_startup_time="1543", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a775b1da515861dc", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/authentication/users | search capabilities="can_own_notable_events" | rename title as owner | append [| makeresults | eval owner="unassigned" ] | eval _key=owner | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key owner realname | runshellscript notable_owners_lookup | stats count']
Audit:[timestamp=06-03-2022 17:00:24.161, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275609.606215', has_error_warn=false, fully_completed_search=true, total_run_time=10.57, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275609, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="371", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management", app="SA-ThreatIntelligence", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Incident_Management normid= [ search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 17:00:14.106, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275614.606216', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit normid= [ search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:00:14 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:10.176, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD55392d2cd3b6dec88_at_1654275600_663', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress ]', autojoin='1', buckets=0, ttl=60, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548_ACCELERATE_", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:10.163, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD591854b6694917629_at_1654275600_662', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"), (region="**") )` | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | stats count count(eval(errorCode!="success")) as errors count(Unauthorized) as Unauthorized by eventName region aws_account_id userName sourceIPAddress _time ]', autojoin='1', buckets=0, ttl=60, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71_ACCELERATE_", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:09.825, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275609.606215', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Incident_Management normid= [ search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="SA-ThreatIntelligence", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:09.145, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5fdbe716eed5fd8d5_at_1654275600_661', search='| summarize override=partial timespan= max_summary_size=52428800 max_summary_ratio=0.1 max_disabled_buckets=2 max_time=3600 [ search `aws-cloudtrail((aws_account_id="*"),  (region="**") )` | eval day=strftime(_time, "%Y-%m-%d %z") | stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, "%Y-%m-%d %z") | eval response=if(errorCode=="success","success", "error") | lookup aws_unauthorized_errorCodes errorCode OUTPUT Unauthorized | eval response=if(Unauthorized=="true", "unauthorized", response) | fields - day errorCode Unauthorized ]', autojoin='1', buckets=0, ttl=60, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 00:00:00 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39_ACCELERATE_", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:09.130, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD561ef7423405d3912_at_1654275600_660', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_DA-ESS-ThreatIntelligence_Threat_Intelligence [  search (index=* OR index=_*) (index=threat_activity) | eval nodename = "Threat_Activity"| eval dest=case(isnull(dest) OR dest="","unknown",mvcount(dest)=1,split(dest,"|"),1=1,dest), orig_sourcetype=if(mvcount(orig_sourcetype)=1,split(orig_sourcetype,"|"),orig_sourcetype), src=case(isnull(src) OR src="","unknown",mvcount(src)=1,split(src,"|"),1=1,src), src_user=case(isnull(src_user) OR src_user="","unknown",mvcount(src_user)=1,split(src_user,"|"),1=1,src_user), user=case(isnull(user) OR user="","unknown",mvcount(user)=1,split(user,"|"),1=1,user) | rename dest_bunit AS Threat_Activity.dest_bunit dest_category AS Threat_Activity.dest_category dest_priority AS Threat_Activity.dest_priority src_bunit AS Threat_Activity.src_bunit src_category AS Threat_Activity.src_category src_priority AS Threat_Activity.src_priority src_user_bunit AS Threat_Activity.src_user_bunit src_user_category AS Threat_Activity.src_user_category src_user_priority AS Threat_Activity.src_user_priority threat_match_field AS Threat_Activity.threat_match_field threat_match_value AS Threat_Activity.threat_match_value threat_collection AS Threat_Activity.threat_collection threat_collection_key AS Threat_Activity.threat_collection_key threat_key AS Threat_Activity.threat_key user_bunit AS Threat_Activity.user_bunit user_category AS Threat_Activity.user_category user_priority AS Threat_Activity.user_priority dest AS Threat_Activity.dest orig_sourcetype AS Threat_Activity.orig_sourcetype src AS Threat_Activity.src src_user AS Threat_Activity.src_user user AS Threat_Activity.user | fields nodename, _time, host, source, sourcetype, Threat_Activity.dest_bunit, Threat_Activity.dest_category, Threat_Activity.dest_priority, Threat_Activity.src_bunit, Threat_Activity.src_category, Threat_Activity.src_priority, Threat_Activity.src_user_bunit, Threat_Activity.src_user_category, Threat_Activity.src_user_priority, Threat_Activity.threat_match_field, Threat_Activity.threat_match_value, Threat_Activity.threat_collection, Threat_Activity.threat_collection_key, Threat_Activity.threat_key, Threat_Activity.user_bunit, Threat_Activity.user_category, Threat_Activity.user_priority, Threat_Activity.dest, Threat_Activity.orig_sourcetype, Threat_Activity.src, Threat_Activity.src_user, Threat_Activity.user ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence_ACCELERATE_", search_type=adhoc, is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:09.026, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275609.606214', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions normid= [ search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:00:09 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:08.135, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD59abc6ea17b28cb29_at_1654275600_659', search='| summarize tstats=t override=partial manual_rebuilds=f max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Incident_Management [  search (index=* OR index=_*) (`get_notable_index`) | eval nodename = "Notable_Events_Meta"| eval rule_id=replace(_bkt,".*~(.+)","\1")."@@".index."@@".md5(_time._raw), orig_tag=if(mvcount(orig_tag)==1 AND orig_tag LIKE "%|%",split(orig_tag, "|"),orig_tag) | rename tag AS Notable_Events_Meta.tag rule_id AS Notable_Events_Meta.rule_id orig_tag AS Notable_Events_Meta.orig_tag | fields nodename, _time, host, source, sourcetype, Notable_Events_Meta.tag, Notable_Events_Meta.rule_id, Notable_Events_Meta.orig_tag ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Incident_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:08.019, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275607.606213', search='summarize tstats=t action=probe id=DM_SA-ThreatIntelligence_Risk normid= [ search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="SA-ThreatIntelligence", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:07.247, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD53e331fc1b7a17595_at_1654275600_658', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-ThreatIntelligence_Risk [  search (index=* OR index=_*) index=risk | eval tag=mvdedup(mvappend(tag,NULL,orig_tag)), governance_lookup_type="default" | lookup governance_lookup savedsearch as source, lookup_type as governance_lookup_type OUTPUT governance, control | eval governance_lookup_type="tag" | lookup governance_lookup savedsearch as source, tag, lookup_type as governance_lookup_type OUTPUT governance as governance_tag, control as control_tag | eval "governance"=mvappend('governance',NULL,'governance_tag'),"control"=mvappend('control',NULL,'control_tag') | fields - governance_lookup_type,governance_tag,control_tag  | eval nodename = "All_Risk"| eval description=case(isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown"), risk_object=if(isnull(risk_object),"unknown",risk_object), risk_object_type=if(isnull(risk_object_type),"unknown",risk_object_type), risk_score=if(isnull(risk_score),0,risk_score), threat_object_type=if(isnotnull(threat_object) AND isnull(threat_object_type),"unknown",threat_object_type), risk_factor_add=0.0, risk_factor_add_matched="", risk_factor_mult=if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical",2.5,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high",2.0,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational",0.1,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low",0.2,1.0)*if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium",1.0,1.0), risk_factor_mult_matched=mvappend(if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="critical","Critical Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="high","High Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="informational","Informational Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="low","Low Severity Alert",null),if(match('source',"Threat - Amazon GuardDuty and AWS Security Hub.*- Risk Gen - Rule") AND 'severity'="medium","Medium Severity Alert",null),null), calculated_risk_score=(risk_score + risk_factor_add) * risk_factor_mult, risk_message=case(isnotnull(risk_message),risk_message,isnotnull(description),description,isnotnull(savedsearch_description),savedsearch_description,1=1,"unknown") | rename analyticstories AS All_Risk.analyticstories annotations AS All_Risk.annotations annotations._all AS All_Risk.annotations._all annotations._frameworks AS All_Risk.annotations._frameworks annotations.cis20 AS All_Risk.annotations.cis20 annotations.kill_chain_phases AS All_Risk.annotations.kill_chain_phases annotations.mitre_attack AS All_Risk.annotations.mitre_attack annotations.mitre_attack.mitre_description AS All_Risk.annotations.mitre_attack.mitre_description annotations.mitre_attack.mitre_detection AS All_Risk.annotations.mitre_attack.mitre_detection annotations.mitre_attack.mitre_tactic AS All_Risk.annotations.mitre_attack.mitre_tactic annotations.mitre_attack.mitre_tactic_id AS All_Risk.annotations.mitre_attack.mitre_tactic_id annotations.mitre_attack.mitre_technique AS All_Risk.annotations.mitre_attack.mitre_technique annotations.mitre_attack.mitre_technique_id AS All_Risk.annotations.mitre_attack.mitre_technique_id annotations.mitre_attack.mitre_threat_group_name AS All_Risk.annotations.mitre_attack.mitre_threat_group_name annotations.nist AS All_Risk.annotations.nist control AS All_Risk.control creator AS All_Risk.creator dest AS All_Risk.dest dest_bunit AS All_Risk.dest_bunit dest_category AS All_Risk.dest_category dest_priority AS All_Risk.dest_priority governance AS All_Risk.governance risk_object_bunit AS All_Risk.risk_object_bunit risk_object_category AS All_Risk.risk_object_category risk_object_priority AS All_Risk.risk_object_priority savedsearch_description AS All_Risk.savedsearch_description src AS All_Risk.src src_bunit AS All_Risk.src_bunit src_category AS All_Risk.src_category src_priority AS All_Risk.src_priority tag AS All_Risk.tag threat_object AS All_Risk.threat_object user AS All_Risk.user user_bunit AS All_Risk.user_bunit user_category AS All_Risk.user_category user_priority AS All_Risk.user_priority description AS All_Risk.description risk_object AS All_Risk.risk_object risk_object_type AS All_Risk.risk_object_type risk_score AS All_Risk.risk_score threat_object_type AS All_Risk.threat_object_type risk_factor_add AS All_Risk.risk_factor_add risk_factor_add_matched AS All_Risk.risk_factor_add_matched risk_factor_mult AS All_Risk.risk_factor_mult risk_factor_mult_matched AS All_Risk.risk_factor_mult_matched calculated_risk_score AS All_Risk.calculated_risk_score risk_message AS All_Risk.risk_message | fields nodename, _time, host, source, sourcetype, All_Risk.analyticstories, All_Risk.annotations, All_Risk.annotations._all, All_Risk.annotations._frameworks, All_Risk.annotations.cis20, All_Risk.annotations.kill_chain_phases, All_Risk.annotations.mitre_attack, All_Risk.annotations.mitre_attack.mitre_description, All_Risk.annotations.mitre_attack.mitre_detection, All_Risk.annotations.mitre_attack.mitre_tactic, All_Risk.annotations.mitre_attack.mitre_tactic_id, All_Risk.annotations.mitre_attack.mitre_technique, All_Risk.annotations.mitre_attack.mitre_technique_id, All_Risk.annotations.mitre_attack.mitre_threat_group_name, All_Risk.annotations.nist, All_Risk.control, All_Risk.creator, All_Risk.dest, All_Risk.dest_bunit, All_Risk.dest_category, All_Risk.dest_priority, All_Risk.governance, All_Risk.risk_object_bunit, All_Risk.risk_object_category, All_Risk.risk_object_priority, All_Risk.savedsearch_description, All_Risk.src, All_Risk.src_bunit, All_Risk.src_category, All_Risk.src_priority, All_Risk.tag, All_Risk.threat_object, All_Risk.user, All_Risk.user_bunit, All_Risk.user_category, All_Risk.user_priority, All_Risk.description, All_Risk.risk_object, All_Risk.risk_object_type, All_Risk.risk_score, All_Risk.threat_object_type, All_Risk.risk_factor_add, All_Risk.risk_factor_add_matched, All_Risk.risk_factor_mult, All_Risk.risk_factor_mult_matched, All_Risk.calculated_risk_score, All_Risk.risk_message ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-ThreatIntelligence_Risk_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:07.232, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5e7c781cc80abe499_at_1654275600_657', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id', risk_threshold=100 | where risk_score > $risk_threshold$ | `get_risk_severity(risk_score)`', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,mitre_tactic_id_count,mitre_technique_id_count,prestats_reserved_*,psrsvd_*,risk_object,risk_object_type,source_count', apiStartTime='Thu Jun  2 16:50:00 2022', apiEndTime='Fri Jun  3 16:50:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Risk - 24 Hour Risk Threshold Exceeded - Rule", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:07.208, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD5d597c4bb3413497c_at_1654275600_656', search='| rest /services/admin/inputstatus/ModularInputs:modular%20input%20commands tshirt_server=local count=0 | append [| rest /services/admin/inputstatus/ExecProcessor:exec%20commands tshirt_server=local count=0] | fields inputs* | transpose | rex field=column "inputs(?<script>\S+)(?:\s\((?<stanza>[^\(]+)\))?\.(?<key>(exit status description)|(time closed)|(time opened))" | eval value=coalesce('row 1', 'row 2'), stanza=coalesce(stanza, "default"), started=if(key=="time opened", value, started), stopped=if(key=="time closed", value, stopped) | rex field=value "exited\s+with\s+code\s+(?<exit_status>\d+)" | stats first(started) as started, first(stopped) as stopped, first(exit_status) as exit_status by script, stanza | eval errmsg=case(exit_status=="0", null(), isnotnull(exit_status), "A script exited abnormally with exit status: "+exit_status, isnull(started) or isnotnull(stopped), "A script is in an unknown state"), ignore=if(`script_error_msg_ignore`, 1, 0) | where isnotnull(errmsg) AND ignore=0', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='prestats_reserved_*,psrsvd_*,script,stanza', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Audit - Script Errors", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:07.021, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD5c83b6c1279a5dacb_at_1654275600_655', search='| rest /servicesNS/nobody/SA-Utils/contentinfo/_cache timeout=600 tshirt_server=local count=0 | stats count', autojoin='1', buckets=0, ttl=3600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Audit - Dataset Relation", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:07.009, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD5d3ec87bd185c0ef4_at_1654275600_654', search='search index=_audit action=search savedsearch_name=* info=completed | stats avg(total_run_time) as avg_run_time, avg(event_count) as avg_event_count, avg(result_count) as avg_result_count, count as invocations by savedsearch_name | join type=outer savedsearch_name [search index=_internal sourcetype=scheduler search_type=adhoc OR search_type="" | stats count(eval(status=="success")) as success, count(eval(status=="skipped")) as skipped by savedsearch_name] | where savedsearch_name != "" | eval update_time=now() | runshellscript key_field=savedsearch_name savedsearch_stats_lookup | stats count', autojoin='1', buckets=0, ttl=3600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  2 17:00:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Audit - Savedsearch Statistics - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:06.989, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD5c31bfb27acb495b2_at_1654275600_653', search='| metadata type=sourcetypes tshirt_server=* index=* index=_* | eval readiness=if(lastTime > now() - 86400, 1, 0), update_time=now() | fields sourcetype, readiness, update_time | dedup sourcetype | runshellscript key_field=sourcetype sourcetype_readiness_lookup | stats count', autojoin='1', buckets=0, ttl=3600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Audit - Sourcetype Readiness - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:05.965, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD56bad8d5ede1359d6_at_1654275600_652', search='| rest /services/data/indexes tshirt_server=* count=0 | eval _time=strptime(maxTime, "%Y-%m-%dT%H:%M:%S%z") | stats sum(totalEventCount) AS count, max(_time) AS _time by title | eval readiness=if(count > 0 AND _time>=relative_time(now(), "-24h@h"), 1, 0), calc_count=if(readiness==0, 0, count)  | fields title, calc_count, readiness | rename title AS index, calc_count as count | runshellscript key_field=index index_readiness_lookup | stats count', autojoin='1', buckets=0, ttl=3600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  2 17:00:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Audit - Index Readiness", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:05.944, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5cc8fbb6063874056_at_1654275600_651', search='search `aws-index` | eval account_id = mvdedup(mvappend(aws_account_id, recipientAccountId, AwsAccountId, vendor_account)) | where account_id != "unknown" | inputlookup append=T aws_all_account_ids | stats count by account_id | fields - count | runshellscript override_if_empty=false aws_all_account_ids | stats count', autojoin='1', buckets=0, ttl=2400, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:35:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ES-AWS - Account ID List - Lookup Gen", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:04.928, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD551cdb06b5c6a21a9_at_1654275600_650', search='search `aws-index` NOT command IN ("Get*", "Describe*" "List*") | eval cloud_service_provider="aws" | inputlookup append=T actions | stats count by command, cloud_service_provider, change_type | fields - count | runshellscript override_if_empty=false actions | stats count', autojoin='1', buckets=0, ttl=2400, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:35:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ES-AWS - Actions List - Lookup Gen", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:04.915, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtRW5kcG9pbnRQcm90ZWN0aW9u__RMD58643e1297baf93a0_at_1654275600_649', search='| from datamodel:"Updates"."Updates" | eval signature_zip=mvzip(signature,signature_id) | mvexpand signature_zip | rex field=signature_zip "(?<signature>.*)\,(?<signature_id>.*)" | stats min(_time) as firstTime,max(_time) as lastTime,latest(signature) as signature by signature_id,vendor_product | inputlookup append=T update_signature_reference_lookup | eval _time=lastTime | stats min(firstTime) as firstTime,max(lastTime) as lastTime,latest(signature) as signature by signature_id,vendor_product | runshellscript override_if_empty=false update_signature_reference_lookup | stats count', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 15:50:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Endpoint - Update Signature Reference - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-EndpointProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:04.875, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275600_648', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:04.859, user=admin, action=search, info=granted , search_id='scheduler__admin__TshirtEnterpriseSecuritySuite__RMD5a6d54b4f1c421eaa_at_1654275600_647', search='search `notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), "-24h@h"),"current", 1=1, "historical") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | runshellscript es_notable_events | stats count', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Wed Jun  1 17:00:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESS - Notable Events", search_type=adhoc, is_proxied=false, app="TshirtEnterpriseSecuritySuite", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:04.830, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD566ab5c97239475f4_at_1654275600_646', search='| tstats summariesonly=false sum(All_Risk.calculated_risk_score) as risk_score from datamodel=Risk.All_Risk where All_Risk.risk_object_type="system" by All_Risk.risk_object | eval dest=lower('All_Risk.risk_object') | `get_asset(dest)` | eval dest=mvdedup(if(isnotnull(dest_asset_id),mvappend(dest,lower(dest_asset)),dest)) | stats sum(risk_score) as risk_score by dest | rename dest as risk_object | runshellscript risk_correlation_by_system_lookup | stats count', autojoin='1', buckets=0, ttl=3600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri May 27 17:00:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Risk Correlation By System - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:04.799, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5b7fc89b7a285771b_at_1654275600_645', search='| tstats summariesonly=false sum(All_Risk.calculated_risk_score) as risk_score from datamodel=Risk.All_Risk where All_Risk.risk_object_type="user" by All_Risk.risk_object | eval user=lower('All_Risk.risk_object') | `get_identity4events(user)` | eval risk_object=if(isnotnull(user_identity),lower(user_identity),user),risk_object=mvdedup(risk_object) | stats sum(risk_score) as risk_score by risk_object | runshellscript risk_correlation_by_user_lookup | stats count', autojoin='1', buckets=0, ttl=3600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri May 27 17:00:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Risk Correlation By User - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:04.391, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275604.606208', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Ticket_Management normid= [ search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Jun  3 17:00:03 2021', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:03.762, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5ae60495d9bee537e_at_1654275600_644', search='| rest tshirt_server=local count=0 /services/alerts/risk_factors/_reload', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Risk - Refresh Risk Factors - Administrative", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:03.080, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275603.606207', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Web normid= [ search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code] | eval backfill_start_time = relative_time(now(), "-3mon") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Thu Mar  3 17:00:03 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:02.736, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD51dbc70e0e18846c9_at_1654275600_643', search='| rest tshirt_server=local count=0 /services/authentication/users | search capabilities="can_own_notable_events" | rename title as owner | append [| makeresults | eval owner="unassigned" ] | eval _key=owner | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key owner realname | runshellscript notable_owners_lookup | stats count', autojoin='1', buckets=0, ttl=1200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Notable Owners - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:02.717, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5b97703d59f97cebd_at_1654275600_642', search='| rest tshirt_server=local count=0 /services/alerts/reviewstatuses/_reload', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Refresh Reviewstatuses - Administrative", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:02.699, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtQWNjZXNzUHJvdGVjdGlvbg__RMD54a1edad66ca90d80_at_1654275600_641', search='| tstats summariesonly=true min("_time") as "firstTime",max("_time") as "lastTime" from datamodel="Authentication"."Authentication" where "Authentication.app"!="unknown" by "Authentication.app" | rename "Authentication.app" as "app" | inputlookup append=T "access_app_tracker" | stats min("firstTime") as "firstTime",max("lastTime") as "lastTime" by "app" | runshellscript override_if_empty=false "access_app_tracker" | stats count', autojoin='1', buckets=0, ttl=1800, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:30:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Access - Access App Tracker - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-AccessProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:02.679, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5d0450ab7e3bde7e7_at_1654275600_640', search='| rest tshirt_server=local count=0 /services/alerts/governance/_reload', autojoin='1', buckets=0, ttl=7200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Refresh Governance - Administrative", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:02.660, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD5a742da37541343b2_at_1654275600_639', search='| tstats `summariesonly` sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count, values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk where All_Risk.annotations.mitre_attack.mitre_tactic_id=* by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name("All_Risk")` | eval "annotations.mitre_attack"='annotations.mitre_attack.mitre_technique_id' | where mitre_tactic_id_count >= 3 and source_count >= 4', autojoin='1', buckets=0, ttl=1200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,mitre_tactic_id_count,mitre_technique_id_count,prestats_reserved_*,psrsvd_*,risk_object,risk_object_type,source_count', apiStartTime='Fri May 27 16:50:00 2022', apiEndTime='Fri Jun  3 16:50:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Risk - 7 Day ATT&CK Tactic Threshold Exceeded - Rule", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:02.627, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVXRpbHM__RMD5495078187e88a4c3_at_1654275600_638', search='| rest tshirt_server=local count=0 /services/authentication/users | rename title as user | eval _key=user | dedup _key | eval realname=if(isnull(realname) or realname="", null(), realname) | table _key user realname | runshellscript key_field=_key user_realnames_lookup | stats count', autojoin='1', buckets=0, ttl=1200, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Utils - User Realnames - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-Utils", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:02.608, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fed6f9304b53adba_at_1654275600_637', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Ticket_Management [  search (index=* OR index=_*) ((`cim_Ticket_Management_indexes`) tag=ticketing) | eval nodename = "All_Ticket_Management"| eval dest=if(isnull(dest) OR dest="","unknown",dest), ticket_id=if(isnull(ticket_id) OR ticket_id="","unknown",ticket_id)| eval is_Change=if(searchmatch("(tag=change)"),1,0), is_not_Change=1-is_Change, is_Incident=if(searchmatch("(tag=incident)"),1,0), is_not_Incident=1-is_Incident, is_Problem=if(searchmatch("(tag=problem)"),1,0), is_not_Problem=1-is_Problem | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=change)"), mvappend(nodename, "All_Ticket_Management.Change"), nodename)| eval change=if(isnull(change) OR change="","unknown",change) | rename change AS All_Ticket_Management.Change.change | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=incident)"), mvappend(nodename, "All_Ticket_Management.Incident"), nodename)| eval incident=if(isnull(incident) OR incident="","unknown",incident) | rename incident AS All_Ticket_Management.Incident.incident | eval nodename = if(nodename == "All_Ticket_Management" AND searchmatch("(tag=problem)"), mvappend(nodename, "All_Ticket_Management.Problem"), nodename)| eval problem=if(isnull(problem) OR problem="","unknown",problem) | rename problem AS All_Ticket_Management.Problem.problem | rename affect_dest AS All_Ticket_Management.affect_dest comments AS All_Ticket_Management.comments description AS All_Ticket_Management.description dest_bunit AS All_Ticket_Management.dest_bunit dest_category AS All_Ticket_Management.dest_category dest_priority AS All_Ticket_Management.dest_priority priority AS All_Ticket_Management.priority severity AS All_Ticket_Management.severity severity_id AS All_Ticket_Management.severity_id tshirt_id AS All_Ticket_Management.tshirt_id tshirt_realm AS All_Ticket_Management.tshirt_realm src_user AS All_Ticket_Management.src_user src_user_bunit AS All_Ticket_Management.src_user_bunit src_user_category AS All_Ticket_Management.src_user_category src_user_priority AS All_Ticket_Management.src_user_priority status AS All_Ticket_Management.status tag AS All_Ticket_Management.tag time_submitted AS All_Ticket_Management.time_submitted user AS All_Ticket_Management.user user_bunit AS All_Ticket_Management.user_bunit user_category AS All_Ticket_Management.user_category user_priority AS All_Ticket_Management.user_priority dest AS All_Ticket_Management.dest ticket_id AS All_Ticket_Management.ticket_id is_Change AS All_Ticket_Management.is_Change is_not_Change AS All_Ticket_Management.is_not_Change is_Incident AS All_Ticket_Management.is_Incident is_not_Incident AS All_Ticket_Management.is_not_Incident is_Problem AS All_Ticket_Management.is_Problem is_not_Problem AS All_Ticket_Management.is_not_Problem | fields nodename, _time, host, source, sourcetype, All_Ticket_Management.affect_dest, All_Ticket_Management.comments, All_Ticket_Management.description, All_Ticket_Management.dest_bunit, All_Ticket_Management.dest_category, All_Ticket_Management.dest_priority, All_Ticket_Management.priority, All_Ticket_Management.severity, All_Ticket_Management.severity_id, All_Ticket_Management.tshirt_id, All_Ticket_Management.tshirt_realm, All_Ticket_Management.src_user, All_Ticket_Management.src_user_bunit, All_Ticket_Management.src_user_category, All_Ticket_Management.src_user_priority, All_Ticket_Management.status, All_Ticket_Management.tag, All_Ticket_Management.time_submitted, All_Ticket_Management.user, All_Ticket_Management.user_bunit, All_Ticket_Management.user_category, All_Ticket_Management.user_priority, All_Ticket_Management.dest, All_Ticket_Management.ticket_id, All_Ticket_Management.is_Change, All_Ticket_Management.is_not_Change, All_Ticket_Management.is_Incident, All_Ticket_Management.is_not_Incident, All_Ticket_Management.is_Problem, All_Ticket_Management.is_not_Problem, All_Ticket_Management.Change.change, All_Ticket_Management.Incident.incident, All_Ticket_Management.Problem.problem ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:00:00 2021', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Ticket_Management_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:02.533, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5f2009d42688fb897_at_1654275600_636', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions [  search (index=* OR index=_*) (tag=modaction) | eval nodename = "Modular_Actions"| eval action_name=case(isnotnull(action_name) AND action_name!="",action_name,sourcetype="tshirtd" AND isnotnull(action) AND action!="",action,1=1,"unknown"), signature=if(isnull(signature) OR signature="","unknown",signature), sid=if(isnull(sid) OR sid="","unknown",sid), user=if(isnotnull(user) AND user!="",user,owner), worker=if(isnotnull(worker) AND worker!="","unknown",worker)| eval is_Modular_Action_Invocations=if(searchmatch("(tag=invocation)"),1,0), is_not_Modular_Action_Invocations=1-is_Modular_Action_Invocations | eval nodename = if(nodename == "Modular_Actions" AND searchmatch("(tag=invocation)"), mvappend(nodename, "Modular_Actions.Modular_Action_Invocations"), nodename) | rename app AS Modular_Actions.app action_mode AS Modular_Actions.action_mode action_status AS Modular_Actions.action_status component AS Modular_Actions.component duration AS Modular_Actions.duration rid AS Modular_Actions.rid orig_sid AS Modular_Actions.orig_sid orig_rid AS Modular_Actions.orig_rid search_name AS Modular_Actions.search_name user_bunit AS Modular_Actions.user_bunit user_category AS Modular_Actions.user_category user_priority AS Modular_Actions.user_priority action_name AS Modular_Actions.action_name signature AS Modular_Actions.signature sid AS Modular_Actions.sid user AS Modular_Actions.user worker AS Modular_Actions.worker is_Modular_Action_Invocations AS Modular_Actions.is_Modular_Action_Invocations is_not_Modular_Action_Invocations AS Modular_Actions.is_not_Modular_Action_Invocations | fields nodename, _time, host, source, sourcetype, Modular_Actions.app, Modular_Actions.action_mode, Modular_Actions.action_status, Modular_Actions.component, Modular_Actions.duration, Modular_Actions.rid, Modular_Actions.orig_sid, Modular_Actions.orig_rid, Modular_Actions.search_name, Modular_Actions.user_bunit, Modular_Actions.user_category, Modular_Actions.user_priority, Modular_Actions.action_name, Modular_Actions.signature, Modular_Actions.sid, Modular_Actions.user, Modular_Actions.worker, Modular_Actions.is_Modular_Action_Invocations, Modular_Actions.is_not_Modular_Action_Invocations ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:00:00 2021', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:02.505, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD554e4d8a17d0ef86d_at_1654275600_635', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Web [  search (index=* OR index=_*) ((`cim_Web_indexes`) tag=web) | eval nodename = "Web"| eval action=if(isnull(action) OR action="","unknown",action), bytes=case(isnum(bytes),bytes,isnum(bytes_in) AND isnum(bytes_out),bytes_in+bytes_out,1=1,null()), bytes_in=case(isnum(bytes_in),bytes_in,isnum(bytes) AND isnum(bytes_out),bytes-bytes_out,1=1,null()), bytes_out=case(isnum(bytes_out),bytes_out,isnum(bytes) AND isnum(bytes_in),bytes-bytes_in,1=1,null()), dest=if(isnull(dest) OR dest="" OR dest="-","unknown",dest), http_content_type=if(isnull(http_content_type) OR http_content_type="" OR http_content_type="-","unknown",http_content_type), http_method=if(isnull(http_method) OR http_method="" OR http_method="-","unknown",http_method), http_referrer=if(isnull(http_referrer) OR http_referrer="" OR http_referrer="-","unknown",http_referrer) | rex field=http_referrer "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<http_referrer_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval http_user_agent=if(isnull(http_user_agent) OR http_user_agent="" OR http_user_agent="-","unknown",http_user_agent), http_user_agent_length=len(http_user_agent), src=if(isnull(src) OR src="" OR src="-","unknown",src), status=if(isnull(status) OR status="" OR status="-","unknown",status), url=if(isnull(url) OR url="" OR url="-","unknown",url) | rex field=url "^(?:http|https|ftp):\\/\\/(?:[a-zA-Z0-9\\.\\-]+(?::[a-zA-Z0-9]+)?@)?(?<url_domain>[^\\/:]+)(?::[0-9]+)?" max_match=1 | eval url_length=len(url), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Proxy=if(searchmatch("(tag=proxy)"),1,0), is_not_Proxy=1-is_Proxy, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage | eval nodename = if(nodename == "Web" AND searchmatch("(tag=proxy)"), mvappend(nodename, "Web.Proxy"), nodename) | eval nodename = if(nodename == "Web" AND searchmatch("(tag=storage)"), mvappend(nodename, "Web.Storage"), nodename) | rename storage_name AS Web.Storage.storage_name operation AS Web.Storage.operation error_code AS Web.Storage.error_code | rename app AS Web.app cached AS Web.cached category AS Web.category cookie AS Web.cookie dest_bunit AS Web.dest_bunit dest_category AS Web.dest_category dest_port AS Web.dest_port dest_priority AS Web.dest_priority duration AS Web.duration response_time AS Web.response_time site AS Web.site src_bunit AS Web.src_bunit src_category AS Web.src_category src_priority AS Web.src_priority tag AS Web.tag uri_path AS Web.uri_path uri_query AS Web.uri_query user_bunit AS Web.user_bunit user_category AS Web.user_category user_priority AS Web.user_priority action AS Web.action bytes AS Web.bytes bytes_in AS Web.bytes_in bytes_out AS Web.bytes_out dest AS Web.dest http_content_type AS Web.http_content_type http_method AS Web.http_method http_referrer AS Web.http_referrer http_referrer_domain AS Web.http_referrer_domain http_user_agent AS Web.http_user_agent http_user_agent_length AS Web.http_user_agent_length src AS Web.src status AS Web.status url AS Web.url url_domain AS Web.url_domain url_length AS Web.url_length user AS Web.user vendor_product AS Web.vendor_product is_Proxy AS Web.is_Proxy is_not_Proxy AS Web.is_not_Proxy is_Storage AS Web.is_Storage is_not_Storage AS Web.is_not_Storage | fields nodename, _time, host, source, sourcetype, Web.app, Web.cached, Web.category, Web.cookie, Web.dest_bunit, Web.dest_category, Web.dest_port, Web.dest_priority, Web.duration, Web.response_time, Web.site, Web.src_bunit, Web.src_category, Web.src_priority, Web.tag, Web.uri_path, Web.uri_query, Web.user_bunit, Web.user_category, Web.user_priority, Web.action, Web.bytes, Web.bytes_in, Web.bytes_out, Web.dest, Web.http_content_type, Web.http_method, Web.http_referrer, Web.http_referrer_domain, Web.http_user_agent, Web.http_user_agent_length, Web.src, Web.status, Web.url, Web.url_domain, Web.url_length, Web.user, Web.vendor_product, Web.is_Proxy, Web.is_not_Proxy, Web.is_Storage, Web.is_not_Storage, Web.Storage.storage_name, Web.Storage.operation, Web.Storage.error_code ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Mar  3 17:00:00 2022', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Web_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:02.489, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD59cba5de3e5a67614_at_1654275600_634', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit [  search (index=* OR index=_*) (index=_audit action=search search_id=*) | eval nodename = "Search_Activity"| rex field=_raw "user=(?<user>[^,]+), action" max_match=1 | eval datamodel=case(match(savedsearch_name, "_ACCELERATE_DM_.*"), replace(savedsearch_name, "_ACCELERATE_DM_(.*)_ACCELERATE_", "\1"), match(search, "'?(\|\s+)?summarize.*?id=DM_"), replace(search, "'?(?:\|\s)?summarize.*?id=DM_([^\s]+).*", "\1"), 1=1, null()), search_id=trim(search_id, "'"), savedsearch_name=if(savedsearch_name="",null(),savedsearch_name), search=if(isnull(search) OR search="",null(),search), search_type=case(isnotnull(search_type) AND NOT search_type LIKE "case(%",search_type,savedsearch_name LIKE "_ACCELERATE_DM%", "dm_acceleration", search_id LIKE "scheduler%", "scheduled", search_id LIKE "rt%", "realtime", search_id LIKE "subsearch%", "subsearch", (search_id LIKE "SummaryDirector%" OR search_id LIKE "summarize_SummaryDirector%"), "summary_director", 1=1, "adhoc"), search_alias=case(isnotnull(datamodel) AND search_id LIKE "SummaryDirector%",datamodel." Data Model Summary Director",isnotnull(datamodel),datamodel." Data Model Acceleration",isnotnull(savedsearch_name),savedsearch_name,1=1,null())| eval is_Acceleration_Jobs=if(searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"),1,0), is_not_Acceleration_Jobs=1-is_Acceleration_Jobs, is_Adhoc_Jobs=if(searchmatch("(search_type=\"adhoc\")"),1,0), is_not_Adhoc_Jobs=1-is_Adhoc_Jobs, is_Failed_Jobs=if(searchmatch("(info=\"failed\")"),1,0), is_not_Failed_Jobs=1-is_Failed_Jobs, is_Realtime_Jobs=if(searchmatch("(search_type=\"realtime\")"),1,0), is_not_Realtime_Jobs=1-is_Realtime_Jobs, is_Scheduled_Jobs=if(searchmatch("(search_type=\"scheduled\")"),1,0), is_not_Scheduled_Jobs=1-is_Scheduled_Jobs, is_Subsearch_Jobs=if(searchmatch("(search_type=\"subsearch\")"),1,0), is_not_Subsearch_Jobs=1-is_Subsearch_Jobs | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"dm_acceleration\" OR search_type=\"summary_director\")"), mvappend(nodename, "Search_Activity.Acceleration_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"adhoc\")"), mvappend(nodename, "Search_Activity.Adhoc_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(info=\"failed\")"), mvappend(nodename, "Search_Activity.Failed_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"realtime\")"), mvappend(nodename, "Search_Activity.Realtime_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"scheduled\")"), mvappend(nodename, "Search_Activity.Scheduled_Jobs"), nodename) | eval nodename = if(nodename == "Search_Activity" AND searchmatch("(search_type=\"subsearch\")"), mvappend(nodename, "Search_Activity.Subsearch_Jobs"), nodename) | rename info AS Search_Activity.info search_et AS Search_Activity.search_et search_lt AS Search_Activity.search_lt total_run_time AS Search_Activity.total_run_time user_bunit AS Search_Activity.user_bunit user_category AS Search_Activity.user_category user_priority AS Search_Activity.user_priority user AS Search_Activity.user datamodel AS Search_Activity.datamodel search_id AS Search_Activity.search_id savedsearch_name AS Search_Activity.savedsearch_name search AS Search_Activity.search search_type AS Search_Activity.search_type search_alias AS Search_Activity.search_alias is_Acceleration_Jobs AS Search_Activity.is_Acceleration_Jobs is_not_Acceleration_Jobs AS Search_Activity.is_not_Acceleration_Jobs is_Adhoc_Jobs AS Search_Activity.is_Adhoc_Jobs is_not_Adhoc_Jobs AS Search_Activity.is_not_Adhoc_Jobs is_Failed_Jobs AS Search_Activity.is_Failed_Jobs is_not_Failed_Jobs AS Search_Activity.is_not_Failed_Jobs is_Realtime_Jobs AS Search_Activity.is_Realtime_Jobs is_not_Realtime_Jobs AS Search_Activity.is_not_Realtime_Jobs is_Scheduled_Jobs AS Search_Activity.is_Scheduled_Jobs is_not_Scheduled_Jobs AS Search_Activity.is_not_Scheduled_Jobs is_Subsearch_Jobs AS Search_Activity.is_Subsearch_Jobs is_not_Subsearch_Jobs AS Search_Activity.is_not_Subsearch_Jobs | fields nodename, _time, host, source, sourcetype, Search_Activity.info, Search_Activity.search_et, Search_Activity.search_lt, Search_Activity.total_run_time, Search_Activity.user_bunit, Search_Activity.user_category, Search_Activity.user_priority, Search_Activity.user, Search_Activity.datamodel, Search_Activity.search_id, Search_Activity.savedsearch_name, Search_Activity.search, Search_Activity.search_type, Search_Activity.search_alias, Search_Activity.is_Acceleration_Jobs, Search_Activity.is_not_Acceleration_Jobs, Search_Activity.is_Adhoc_Jobs, Search_Activity.is_not_Adhoc_Jobs, Search_Activity.is_Failed_Jobs, Search_Activity.is_not_Failed_Jobs, Search_Activity.is_Realtime_Jobs, Search_Activity.is_not_Realtime_Jobs, Search_Activity.is_Scheduled_Jobs, Search_Activity.is_not_Scheduled_Jobs, Search_Activity.is_Subsearch_Jobs, Search_Activity.is_not_Subsearch_Jobs ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:00:00 2021', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:02.469, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5d055c6aa87889902_at_1654275600_633', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity [  search (index=* OR index=_*) (index=_internal sourcetype=tshirt_web_access method=GET status=200) app=* view=* | eval nodename = "View_Activity" | rename app AS View_Activity.app spent AS View_Activity.spent uri AS View_Activity.uri user AS View_Activity.user user_bunit AS View_Activity.user_bunit user_category AS View_Activity.user_category user_priority AS View_Activity.user_priority view AS View_Activity.view | fields nodename, _time, host, source, sourcetype, View_Activity.app, View_Activity.spent, View_Activity.uri, View_Activity.user, View_Activity.user_bunit, View_Activity.user_category, View_Activity.user_priority, View_Activity.view ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 17:00:00 2021', apiEndTime='Fri Jun  3 17:00:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:01.240, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275601.606204', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Filesystem normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product] | eval backfill_start_time = relative_time(now(), "-1mon") | where (bucket_is_hot = 1 OR bucket_lt >= backfill_start_time)  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 17:00:01 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:00.803, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5ed8e405fd0717242_1654275600.606203', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Authentication.src"),values("Authentication.dest") from datamodel="Authentication"."Authentication" by "Authentication.src_user"
    | lookup "threatintel_by_user" value as "Authentication.src_user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "Authentication.src_user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Authentication.src,src)`
    | `sistats_values_rename(Authentication.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Authentication.src_user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Authentication.src"),values("Authentication.dest"),values("Authentication.src_user") from datamodel="Authentication"."Authentication" by "Authentication.user"
    | lookup "threatintel_by_user" value as "Authentication.user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "Authentication.user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Authentication.src,src)`
    | `sistats_values_rename(Authentication.dest,dest)`
    | `sistats_values_rename(Authentication.src_user,src_user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Authentication.user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Inventory.dest") from datamodel="Compute_Inventory"."All_Inventory" where nodename="All_Inventory.User" by "All_Inventory.User.user"
    | lookup "threatintel_by_user" value as "All_Inventory.User.user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "All_Inventory.User.user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Inventory.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Inventory.User.user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("Web.src"),values("Web.dest") from datamodel="Web"."Web" by "Web.user"
    | lookup "threatintel_by_user" value as "Web.user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_user_wildcard" value as "Web.user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Web.src,src)`
    | `sistats_values_rename(Web.dest,dest)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"user",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Web.user','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://user"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:20:00 2022', apiEndTime='Fri Jun  3 16:50:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://user", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:00.767, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD56090c2f26559b465_1654275600.606202', search='| tstats prestats=true summariesonly=true values("sourcetype"),values("Registry.dest"),values("Registry.user") from datamodel="Endpoint"."Registry" by "Registry.registry_path"
    | lookup "threatintel_by_registry_path" value as "Registry.registry_path" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_registry_path_wildcard" value as "Registry.registry_path" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(Registry.dest,dest)`
    | `sistats_values_rename(Registry.user,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"registry_path",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'Registry.registry_path','threat_match_value')
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://registry_path"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:20:00 2022', apiEndTime='Fri Jun  3 16:50:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://registry_path", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:00.671, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD5c5d72a1c7e0ef794_1654275600.606201', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_common_name"
    | lookup "threatintel_by_certificate_common_name" value as "All_Certificates.SSL.ssl_issuer_common_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_common_name_wildcard" value as "All_Certificates.SSL.ssl_issuer_common_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_common_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_common_name','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_common_name"
    | lookup "threatintel_by_certificate_common_name" value as "All_Certificates.SSL.ssl_subject_common_name" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_certificate_common_name_wildcard" value as "All_Certificates.SSL.ssl_subject_common_name" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"certificate_common_name",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_common_name','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://certificate_common_name"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:20:00 2022', apiEndTime='Fri Jun  3 16:50:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://certificate_common_name", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 17:00:00.485, user=tshirt-system-user, action=search, info=granted , search_id='_c3BsdW5rLXN5c3RlbS11c2Vy__nobody_REEtRVNTLVRocmVhdEludGVsbGlnZW5jZQ__RMD53eddd1500759c205_1654275600.606200', search='| multisearch [
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_subject_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_issuer_email"
    | lookup "threatintel_by_email" value as "All_Certificates.SSL.ssl_issuer_email" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Certificates.SSL.ssl_issuer_email" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_subject_email,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_issuer_email','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Certificates.src"),values("All_Certificates.dest"),values("All_Certificates.SSL.ssl_issuer_email") from datamodel="Certificates"."All_Certificates" where nodename="All_Certificates.SSL" by "All_Certificates.SSL.ssl_subject_email"
    | lookup "threatintel_by_email" value as "All_Certificates.SSL.ssl_subject_email" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Certificates.SSL.ssl_subject_email" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Certificates.src,src)`
    | `sistats_values_rename(All_Certificates.dest,dest)`
    | `sistats_values_rename(All_Certificates.SSL.ssl_issuer_email,src_user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Certificates.SSL.ssl_subject_email','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.recipient") from datamodel="Email"."All_Email" by "All_Email.src_user"
    | lookup "threatintel_by_email" value as "All_Email.src_user" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Email.src_user" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.recipient,user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.src_user','threat_match_value')
][
    | tstats prestats=true summariesonly=true values("sourcetype"),values("All_Email.src"),values("All_Email.dest"),values("All_Email.src_user") from datamodel="Email"."All_Email" by "All_Email.recipient"
    | lookup "threatintel_by_email" value as "All_Email.recipient" OUTPUT threat_collection as tc0,threat_collection_key as tck0
    | lookup "threatintel_by_email_wildcard" value as "All_Email.recipient" OUTPUT threat_collection as tc1,threat_collection_key as tck1
    | where isnotnull('tck0') OR isnotnull('tck1')
    | eval intelzip0=mvzip('tc0','tck0',"@@")
    | eval intelzip1=mvzip('tc1','tck1',"@@")
    | eval threat_collection_key=mvappend(intelzip0,intelzip1)
    | `sistats_values_rename(sourcetype,sourcetype)`
    | `sistats_values_rename(All_Email.src,src)`
    | `sistats_values_rename(All_Email.dest,dest)`
    | `sistats_values_rename(All_Email.src_user,src_user)`
    | eval "threat_match_field"=if(isnull('threat_match_field'),"email",'threat_match_field')
    | eval "threat_match_value"=if(isnull('threat_match_value'),'All_Email.recipient','threat_match_value')]
| mvexpand threat_collection_key
| stats values("dest") as "dest",values("sourcetype") as "sourcetype",values("src") as "src",values("src_user") as "src_user",values("user") as "user" by threat_match_field,threat_match_value,threat_collection_key
| rex field=threat_collection_key "^(?<threat_collection>.*)@@(?<threat_collection_key>.*)$"
| eval "dest"=mvindex('dest',0,10-1)
| eval "sourcetype"=mvindex('sourcetype',0,10-1)
| eval "src"=mvindex('src',0,10-1)
| eval "src_user"=mvindex('src_user',0,10-1)
| eval "user"=mvindex('user',0,10-1)
| eval certificate_intel_key=if(threat_collection="certificate_intel",'threat_collection_key',null())
| eval email_intel_key=if(threat_collection="email_intel",'threat_collection_key',null())
| eval file_intel_key=if(threat_collection="file_intel",'threat_collection_key',null())
| eval http_intel_key=if(threat_collection="http_intel",'threat_collection_key',null())
| eval ip_intel_key=if(threat_collection="ip_intel",'threat_collection_key',null())
| eval process_intel_key=if(threat_collection="process_intel",'threat_collection_key',null())
| eval registry_intel_key=if(threat_collection="registry_intel",'threat_collection_key',null())
| eval service_intel_key=if(threat_collection="service_intel",'threat_collection_key',null())
| eval user_intel_key=if(threat_collection="user_intel",'threat_collection_key',null())
| lookup "certificate_intel" _key as "certificate_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "email_intel" _key as "email_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "file_intel" _key as "file_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "http_intel" _key as "http_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "ip_intel" _key as "ip_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "process_intel" _key as "process_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "registry_intel" _key as "registry_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "service_intel" _key as "service_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup "user_intel" _key as "user_intel_key" OUTPUTNEW "description","threat_key","weight","disabled"
| lookup threat_group_intel _key as threat_key OUTPUTNEW description,weight
| eval weight=if(isnum(weight),weight,60)
| fields - intelzip*,"certificate_intel_key","email_intel_key","file_intel_key","http_intel_key","ip_intel_key","process_intel_key","registry_intel_key","service_intel_key","user_intel_key"
| `threatintel_runshellscript_exclusions`
| dedup threat_match_field,threat_match_value,threat_key
| collectthreat source="threatmatch://email"', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Fri Jun  3 16:20:00 2022', apiEndTime='Fri Jun  3 16:50:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="threatmatch://email", is_proxied=false, app="DA-ESS-ThreatIntelligence", provenance="N/A", mode="historical"]
Audit:[timestamp=06-03-2022 16:59:54.172, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654275540_630', has_error_warn=false, fully_completed_search=true, total_run_time=37.08, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654275542, api_et=1651597140.000000000, api_lt=1654275540.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597140.000000000, search_lt=1654275540.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_startup_time="1222", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]']
Audit:[timestamp=06-03-2022 16:59:54.168, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275540_632', has_error_warn=false, fully_completed_search=true, total_run_time=10.35, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275582, api_et=1654271340.000000000, api_lt=1654274940.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271340.000000000, search_lt=1654274940.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 16:59:42.570, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275540_632', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:49:00 2022', apiEndTime='Fri Jun  3 16:49:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:59:24.179, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275540_631', has_error_warn=false, fully_completed_search=true, total_run_time=14.62, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275542, api_et=N/A, api_lt=1654275540.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275540.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1469", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 16:59:24.177, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275540_631_1654275543.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.60, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654275543, api_et=N/A, api_lt=1654275540.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275540.000000000, is_realtime=0, savedsearch_name="", search_startup_time="60", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 16:59:24.176, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654275540_629', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275542, api_et=1622739540.000000000, api_lt=1654275540.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739540.000000000, search_lt=1654275540.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_startup_time="510", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]']
Audit:[timestamp=06-03-2022 16:59:24.172, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275540_631_1654275543.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.14, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654275543, api_et=N/A, api_lt=1654275540.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275540.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 16:59:24.163, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275540_631_1654275543.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275543, api_et=N/A, api_lt=1654275540.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275540.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 16:59:02.315, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275540_631', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 16:59:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:59:02.305, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5534aac642f80d961_at_1654275540_630', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Performance [  search (index=* OR index=_*) ((`cim_Performance_indexes`) tag=performance (tag=cpu OR tag=facilities OR tag=memory OR tag=storage OR tag=network OR (tag=os ((tag=time tag=synchronize) OR tag=uptime)))) | eval nodename = "All_Performance"| eval dest=if(isnull(dest) OR dest="","unknown",dest)| eval is_CPU=if(searchmatch("(tag=cpu)"),1,0), is_not_CPU=1-is_CPU, is_Facilities=if(searchmatch("(tag=facilities)"),1,0), is_not_Facilities=1-is_Facilities, is_Memory=if(searchmatch("(tag=memory)"),1,0), is_not_Memory=1-is_Memory, is_Storage=if(searchmatch("(tag=storage)"),1,0), is_not_Storage=1-is_Storage, is_Network=if(searchmatch("(tag=network)"),1,0), is_not_Network=1-is_Network, is_OS=if(searchmatch("(tag=os)"),1,0), is_not_OS=1-is_OS | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=cpu)"), mvappend(nodename, "All_Performance.CPU"), nodename) | rename cpu_load_mhz AS All_Performance.CPU.cpu_load_mhz cpu_load_percent AS All_Performance.CPU.cpu_load_percent cpu_time AS All_Performance.CPU.cpu_time cpu_user_percent AS All_Performance.CPU.cpu_user_percent | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=facilities)"), mvappend(nodename, "All_Performance.Facilities"), nodename) | rename temperature AS All_Performance.Facilities.temperature power AS All_Performance.Facilities.power fan_speed AS All_Performance.Facilities.fan_speed | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=memory)"), mvappend(nodename, "All_Performance.Memory"), nodename) | rename mem AS All_Performance.Memory.mem mem_committed AS All_Performance.Memory.mem_committed mem_free AS All_Performance.Memory.mem_free mem_used AS All_Performance.Memory.mem_used swap AS All_Performance.Memory.swap swap_free AS All_Performance.Memory.swap_free swap_used AS All_Performance.Memory.swap_used | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=storage)"), mvappend(nodename, "All_Performance.Storage"), nodename) | rename array AS All_Performance.Storage.array blocksize AS All_Performance.Storage.blocksize cluster AS All_Performance.Storage.cluster fd_max AS All_Performance.Storage.fd_max fd_used AS All_Performance.Storage.fd_used latency AS All_Performance.Storage.latency mount AS All_Performance.Storage.mount parent AS All_Performance.Storage.parent read_blocks AS All_Performance.Storage.read_blocks read_latency AS All_Performance.Storage.read_latency read_ops AS All_Performance.Storage.read_ops storage AS All_Performance.Storage.storage storage_free AS All_Performance.Storage.storage_free storage_free_percent AS All_Performance.Storage.storage_free_percent storage_used AS All_Performance.Storage.storage_used storage_used_percent AS All_Performance.Storage.storage_used_percent write_blocks AS All_Performance.Storage.write_blocks write_latency AS All_Performance.Storage.write_latency write_ops AS All_Performance.Storage.write_ops | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Performance.Network"), nodename) | rename thruput AS All_Performance.Network.thruput thruput_max AS All_Performance.Network.thruput_max | eval nodename = if(nodename == "All_Performance" AND searchmatch("(tag=os)"), mvappend(nodename, "All_Performance.OS"), nodename)| eval is_Timesync=if(searchmatch("(tag=time tag=synchronize)"),1,0), is_not_Timesync=1-is_Timesync, is_Uptime=if(searchmatch("(tag=uptime)"),1,0), is_not_Uptime=1-is_Uptime | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=time tag=synchronize)"), mvappend(nodename, "All_Performance.OS.Timesync"), nodename)| eval action=case(isnotnull(action) AND action!="",action,tag="success","success",tag="failure","failure",1=1,"unknown") | rename action AS All_Performance.OS.Timesync.action | eval nodename = if(nodename == "All_Performance.OS" AND searchmatch("(tag=uptime)"), mvappend(nodename, "All_Performance.OS.Uptime"), nodename)| eval uptime=if(isnull(uptime) OR uptime="","unknown",uptime) | rename uptime AS All_Performance.OS.Uptime.uptime | rename signature AS All_Performance.OS.signature signature_id AS All_Performance.OS.signature_id is_Timesync AS All_Performance.OS.is_Timesync is_not_Timesync AS All_Performance.OS.is_not_Timesync is_Uptime AS All_Performance.OS.is_Uptime is_not_Uptime AS All_Performance.OS.is_not_Uptime | rename dest_bunit AS All_Performance.dest_bunit dest_category AS All_Performance.dest_category dest_priority AS All_Performance.dest_priority dest_should_timesync AS All_Performance.dest_should_timesync dest_should_update AS All_Performance.dest_should_update hypervisor_id AS All_Performance.hypervisor_id resource_type AS All_Performance.resource_type tag AS All_Performance.tag dest AS All_Performance.dest is_CPU AS All_Performance.is_CPU is_not_CPU AS All_Performance.is_not_CPU is_Facilities AS All_Performance.is_Facilities is_not_Facilities AS All_Performance.is_not_Facilities is_Memory AS All_Performance.is_Memory is_not_Memory AS All_Performance.is_not_Memory is_Storage AS All_Performance.is_Storage is_not_Storage AS All_Performance.is_not_Storage is_Network AS All_Performance.is_Network is_not_Network AS All_Performance.is_not_Network is_OS AS All_Performance.is_OS is_not_OS AS All_Performance.is_not_OS | fields nodename, _time, host, source, sourcetype, All_Performance.dest_bunit, All_Performance.dest_category, All_Performance.dest_priority, All_Performance.dest_should_timesync, All_Performance.dest_should_update, All_Performance.hypervisor_id, All_Performance.resource_type, All_Performance.tag, All_Performance.dest, All_Performance.is_CPU, All_Performance.is_not_CPU, All_Performance.is_Facilities, All_Performance.is_not_Facilities, All_Performance.is_Memory, All_Performance.is_not_Memory, All_Performance.is_Storage, All_Performance.is_not_Storage, All_Performance.is_Network, All_Performance.is_not_Network, All_Performance.is_OS, All_Performance.is_not_OS, All_Performance.CPU.cpu_load_mhz, All_Performance.CPU.cpu_load_percent, All_Performance.CPU.cpu_time, All_Performance.CPU.cpu_user_percent, All_Performance.Facilities.temperature, All_Performance.Facilities.power, All_Performance.Facilities.fan_speed, All_Performance.Memory.mem, All_Performance.Memory.mem_committed, All_Performance.Memory.mem_free, All_Performance.Memory.mem_used, All_Performance.Memory.swap, All_Performance.Memory.swap_free, All_Performance.Memory.swap_used, All_Performance.Storage.array, All_Performance.Storage.blocksize, All_Performance.Storage.cluster, All_Performance.Storage.fd_max, All_Performance.Storage.fd_used, All_Performance.Storage.latency, All_Performance.Storage.mount, All_Performance.Storage.parent, All_Performance.Storage.read_blocks, All_Performance.Storage.read_latency, All_Performance.Storage.read_ops, All_Performance.Storage.storage, All_Performance.Storage.storage_free, All_Performance.Storage.storage_free_percent, All_Performance.Storage.storage_used, All_Performance.Storage.storage_used_percent, All_Performance.Storage.write_blocks, All_Performance.Storage.write_latency, All_Performance.Storage.write_ops, All_Performance.Network.thruput, All_Performance.Network.thruput_max, All_Performance.OS.signature, All_Performance.OS.signature_id, All_Performance.OS.is_Timesync, All_Performance.OS.is_not_Timesync, All_Performance.OS.is_Uptime, All_Performance.OS.is_not_Uptime, All_Performance.OS.Timesync.action, All_Performance.OS.Uptime.uptime ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 16:59:00 2022', apiEndTime='Fri Jun  3 16:59:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Performance_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:59:02.288, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5eddd0618b168fff8_at_1654275540_629', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Intrusion_Detection [  search (index=* OR index=_*) ((`cim_Intrusion_Detection_indexes`) tag=ids tag=attack) | eval nodename = "IDS_Attacks"| eval dvc=if(isnull(dvc) OR dvc="","unknown",dvc), ids_type=if(isnull(ids_type) OR ids_type="","unknown",ids_type), category=if(isnull(category) OR category="","unknown",category), signature=if(isnull(signature) OR signature="","unknown",signature), severity=if(isnull(severity) OR severity="","unknown",severity), src=if(isnull(src) OR src="","unknown",src), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Application_IDS_Attacks=if(searchmatch("(ids_type=\"application\")"),1,0), is_not_Application_IDS_Attacks=1-is_Application_IDS_Attacks, is_Host_IDS_Attacks=if(searchmatch("(ids_type=\"host\")"),1,0), is_not_Host_IDS_Attacks=1-is_Host_IDS_Attacks, is_Network_IDS_Attacks=if(searchmatch("(ids_type=\"network\")"),1,0), is_not_Network_IDS_Attacks=1-is_Network_IDS_Attacks | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"application\")"), mvappend(nodename, "IDS_Attacks.Application_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"host\")"), mvappend(nodename, "IDS_Attacks.Host_IDS_Attacks"), nodename) | eval nodename = if(nodename == "IDS_Attacks" AND searchmatch("(ids_type=\"network\")"), mvappend(nodename, "IDS_Attacks.Network_IDS_Attacks"), nodename) | rename action AS IDS_Attacks.action dest_bunit AS IDS_Attacks.dest_bunit dest_category AS IDS_Attacks.dest_category dest_port AS IDS_Attacks.dest_port dest_priority AS IDS_Attacks.dest_priority dvc_bunit AS IDS_Attacks.dvc_bunit dvc_category AS IDS_Attacks.dvc_category dvc_priority AS IDS_Attacks.dvc_priority file_hash AS IDS_Attacks.file_hash file_name AS IDS_Attacks.file_name file_path AS IDS_Attacks.file_path severity_id AS IDS_Attacks.severity_id signature_id AS IDS_Attacks.signature_id src_bunit AS IDS_Attacks.src_bunit src_category AS IDS_Attacks.src_category src_port AS IDS_Attacks.src_port src_priority AS IDS_Attacks.src_priority transport AS IDS_Attacks.transport tag AS IDS_Attacks.tag user_bunit AS IDS_Attacks.user_bunit user_category AS IDS_Attacks.user_category user_priority AS IDS_Attacks.user_priority dvc AS IDS_Attacks.dvc ids_type AS IDS_Attacks.ids_type category AS IDS_Attacks.category signature AS IDS_Attacks.signature severity AS IDS_Attacks.severity src AS IDS_Attacks.src dest AS IDS_Attacks.dest user AS IDS_Attacks.user vendor_product AS IDS_Attacks.vendor_product is_Application_IDS_Attacks AS IDS_Attacks.is_Application_IDS_Attacks is_not_Application_IDS_Attacks AS IDS_Attacks.is_not_Application_IDS_Attacks is_Host_IDS_Attacks AS IDS_Attacks.is_Host_IDS_Attacks is_not_Host_IDS_Attacks AS IDS_Attacks.is_not_Host_IDS_Attacks is_Network_IDS_Attacks AS IDS_Attacks.is_Network_IDS_Attacks is_not_Network_IDS_Attacks AS IDS_Attacks.is_not_Network_IDS_Attacks | fields nodename, _time, host, source, sourcetype, IDS_Attacks.action, IDS_Attacks.dest_bunit, IDS_Attacks.dest_category, IDS_Attacks.dest_port, IDS_Attacks.dest_priority, IDS_Attacks.dvc_bunit, IDS_Attacks.dvc_category, IDS_Attacks.dvc_priority, IDS_Attacks.file_hash, IDS_Attacks.file_name, IDS_Attacks.file_path, IDS_Attacks.severity_id, IDS_Attacks.signature_id, IDS_Attacks.src_bunit, IDS_Attacks.src_category, IDS_Attacks.src_port, IDS_Attacks.src_priority, IDS_Attacks.transport, IDS_Attacks.tag, IDS_Attacks.user_bunit, IDS_Attacks.user_category, IDS_Attacks.user_priority, IDS_Attacks.dvc, IDS_Attacks.ids_type, IDS_Attacks.category, IDS_Attacks.signature, IDS_Attacks.severity, IDS_Attacks.src, IDS_Attacks.dest, IDS_Attacks.user, IDS_Attacks.vendor_product, IDS_Attacks.is_Application_IDS_Attacks, IDS_Attacks.is_not_Application_IDS_Attacks, IDS_Attacks.is_Host_IDS_Attacks, IDS_Attacks.is_not_Host_IDS_Attacks, IDS_Attacks.is_Network_IDS_Attacks, IDS_Attacks.is_not_Network_IDS_Attacks ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 16:59:00 2021', apiEndTime='Fri Jun  3 16:59:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Intrusion_Detection_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:54.164, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275480_628', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275521, api_et=1654271280.000000000, api_lt=1654274880.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271280.000000000, search_lt=1654274880.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 16:58:40.775, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275480_628', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:48:00 2022', apiEndTime='Fri Jun  3 16:48:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:24.209, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654275480_621', has_error_warn=false, fully_completed_search=true, total_run_time=10.28, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275482, api_et=1651597080.000000000, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597080.000000000, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]']
Audit:[timestamp=06-03-2022 16:58:24.206, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275480_623_1654275483.4', has_error_warn=false, fully_completed_search=true, total_run_time=10.01, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275483, api_et=N/A, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="", search_startup_time="5", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_5275d60d4ba99084", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key']
Audit:[timestamp=06-03-2022 16:58:24.204, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654275480_626', has_error_warn=false, fully_completed_search=true, total_run_time=10.22, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275483, api_et=N/A, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_startup_time="215", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]']
Audit:[timestamp=06-03-2022 16:58:24.202, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654275480_625', has_error_warn=false, fully_completed_search=true, total_run_time=11.25, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654275483, api_et=1651597080.000000000, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597080.000000000, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_startup_time="614", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]']
Audit:[timestamp=06-03-2022 16:58:24.201, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275480.606179', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275480, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_system_nobody_e0254f7bbfd92aa3", app="system", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize maintain="%22SUMMARY_ID%22%2C%22EARLIEST_TIME%22%2C%22REMOTE_SEARCH%22%2C%22NORM_SUMMARY_ID%22%2C%22NORM_REMOTE_SEARCH%22%0A%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548%22%2C1651536000%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20lookup%20%20aws_unauthorized_errorCodes%20errorCode%20OUTPUT%20Unauthorized%20%20%7C%20addinfo%20%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20%20keepcolorder%3Dt%20%22%22Unauthorized%22%22%20%22%22aws_account_id%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%22%22sourceIPAddress%22%22%20%22%22userName%22%22%20%7C%20prestats%20%20count%20count%28Unauthorized%29%20count%28eval%28errorCode%21%3D%22%22success%22%22%29%29%20AS%20_psef0%20by%20aws_account_id%20eventName%20region%20sourceIPAddress%20userName%22%2C%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb26032d7500783b0%22%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20lookup%20aws_unauthorized_errorCodes%20errorCode%20OUTPUT%20Unauthorized%20%7C%20addinfo%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20keepcolorder%3Dt%20%22%22Unauthorized%22%22%20%22%22aws_account_id%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%22%22sourceIPAddress%22%22%20%22%22userName%22%22%20%7C%20prestats%20count%20count%28Unauthorized%29%20count%28eval%28errorCode%21%3D%22%22success%22%22%29%29%20AS%20_psef0%20by%20aws_account_id%20eventName%20region%20sourceIPAddress%20userName%22%0A%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71%22%2C1651536000%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20lookup%20%20aws_unauthorized_errorCodes%20errorCode%20OUTPUT%20Unauthorized%20%20%7C%20addinfo%20%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20%20keepcolorder%3Dt%20%22%22Unauthorized%22%22%20%22%22_time%22%22%20%22%22aws_account_id%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%22%22sourceIPAddress%22%22%20%22%22userName%22%22%20%7C%20prestats%20%20count%20count%28Unauthorized%29%20count%28eval%28errorCode%21%3D%22%22success%22%22%29%29%20AS%20_psef0%20by%20_time%20aws_account_id%20eventName%20region%20sourceIPAddress%20userName%22%2C%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb635087639505149%22%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20lookup%20aws_unauthorized_errorCodes%20errorCode%20OUTPUT%20Unauthorized%20%7C%20addinfo%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20keepcolorder%3Dt%20%22%22Unauthorized%22%22%20%22%22_time%22%22%20%22%22aws_account_id%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%22%22sourceIPAddress%22%22%20%22%22userName%22%22%20%7C%20prestats%20count%20count%28Unauthorized%29%20count%28eval%28errorCode%21%3D%22%22success%22%22%29%29%20AS%20_psef0%20by%20_time%20aws_account_id%20eventName%20region%20sourceIPAddress%20userName%22%0A%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_f044fc7e97237f39%22%2C1651536000%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20eval%20%20day%3Dstrftime%28_time%2C%20%22%22%25Y-%25m-%25d%20%25z%22%22%29%20%20%7C%20addinfo%20%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20%20keepcolorder%3Dt%20%22%22aws_account_id%22%22%20%22%22day%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%7C%20prestats%20%20count%20by%20aws_account_id%20day%20errorCode%20eventName%20region%22%2C%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NS44dad4abfd2e365a%22%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20eval%20day%3Dstrftime%28_time%2C%20%22%22%25Y-%25m-%25d%20%25z%22%22%29%20%7C%20addinfo%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20keepcolorder%3Dt%20%22%22aws_account_id%22%22%20%22%22day%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%7C%20prestats%20count%20by%20aws_account_id%20day%20errorCode%20eventName%20region%22%0A" summaryprefix="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA"']
Audit:[timestamp=06-03-2022 16:58:24.198, user=admin, action=search, info=completed, search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275480_623', has_error_warn=false, fully_completed_search=true, total_run_time=14.23, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275482, api_et=N/A, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_startup_time="1278", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_4e3bcfef65220a5c", app="SA-ThreatIntelligence", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count']
Audit:[timestamp=06-03-2022 16:58:24.195, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275480_623_1654275482.1', has_error_warn=false, fully_completed_search=true, total_run_time=10.61, event_count=0, result_count=1571, available_count=0, scan_count=0, drop_count=0, exec_time=1654275482, api_et=N/A, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="", search_startup_time="61", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_fce7a634e80c39ad", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations']
Audit:[timestamp=06-03-2022 16:58:24.194, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275480_623_1654275483.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.22, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654275483, api_et=N/A, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 16:58:24.193, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654275480_622', has_error_warn=false, fully_completed_search=true, total_run_time=10.30, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275482, api_et=1651597080.000000000, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597080.000000000, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]']
Audit:[timestamp=06-03-2022 16:58:24.192, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654275480_618', has_error_warn=false, fully_completed_search=true, total_run_time=11.28, event_count=0, result_count=32, available_count=0, scan_count=0, drop_count=0, exec_time=1654275482, api_et=1651597080.000000000, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597080.000000000, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_startup_time="964", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]']
Audit:[timestamp=06-03-2022 16:58:24.187, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275480.606180', has_error_warn=false, fully_completed_search=true, total_run_time=10.06, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275480, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_system_nobody_ec87746f0ab6cffc", app="system", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t maintain="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem,1651597079;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint,1651597079;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes,1651597079;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry,1651597079;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services,1651597079;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution,1646326679;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions,1646326679;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic,1646326679;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance,1651597079;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web,1646326679;" summaryprefix="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA"']
Audit:[timestamp=06-03-2022 16:58:24.186, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654275480_624', has_error_warn=false, fully_completed_search=true, total_run_time=12.06, event_count=0, result_count=99, available_count=0, scan_count=0, drop_count=0, exec_time=1654275483, api_et=N/A, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_startup_time="674", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Authentication.is_not_Failed_Authentication, Authentication.is_Successful_Authentication, Authentication.is_not_Successful_Authentication, Authentication.is_Default_Authentication, Authentication.is_not_Default_Authentication, Authentication.is_Insecure_Authentication, Authentication.is_not_Insecure_Authentication, Authentication.is_Privileged_Authentication, Authentication.is_not_Privileged_Authentication, Authentication.Default_Authentication.is_Failed_Default_Authentication, Authentication.Default_Authentication.is_not_Failed_Default_Authentication, Authentication.Default_Authentication.is_Successful_Default_Authentication, Authentication.Default_Authentication.is_not_Successful_Default_Authentication, Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication, Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication, Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication ]']
Audit:[timestamp=06-03-2022 16:58:24.185, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654275480_620', has_error_warn=false, fully_completed_search=true, total_run_time=10.32, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275482, api_et=1651597080.000000000, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1651597080.000000000, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]']
Audit:[timestamp=06-03-2022 16:58:24.182, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654275480_627', has_error_warn=false, fully_completed_search=true, total_run_time=10.73, event_count=0, result_count=0, available_count=0, scan_count=0, drop_count=0, exec_time=1654275484, api_et=1622739480.000000000, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739480.000000000, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_startup_time="632", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis", app="SA-NetworkProtection", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]']
Audit:[timestamp=06-03-2022 16:58:24.181, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654275480_619', has_error_warn=false, fully_completed_search=true, total_run_time=1.99, event_count=0, result_count=98, available_count=0, scan_count=0, drop_count=0, exec_time=1654275482, api_et=1622739480.000000000, api_lt=1654275480.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1622739480.000000000, search_lt=1654275480.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_startup_time="961", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]']
Audit:[timestamp=06-03-2022 16:58:24.177, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275483.606181', has_error_warn=false, fully_completed_search=true, total_run_time=10.27, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275483, api_et=1651597083.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1651597083.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="274", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Processes normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 16:58:04.535, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U0EtTmV0d29ya1Byb3RlY3Rpb24__RMD5d5956908d7791c1c_at_1654275480_627', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_SA-NetworkProtection_Domain_Analysis [  search (index=* OR index=_*) (index=whois sourcetype=Whois:*) | eval nodename = "All_Domains"| eval domain=if(isnull(domain),"unknown",domain), nameservers=if(isnull(nameservers),"unknown",nameservers), registrant=if(isnull(registrant),"unknown",registrant), registrar=if(isnull(registrar),"unknown",registrar), resolved_domain=if(isnull(resolved_domain),"unknown",resolved_domain)| eval is_Missing_Extractions_All_Domains=if(searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"),1,0), is_not_Missing_Extractions_All_Domains=1-is_Missing_Extractions_All_Domains | eval nodename = if(nodename == "All_Domains" AND searchmatch("((domain=\"unknown\"  OR nameservers=\"unknown\" OR registrant=\"unknown\" OR created!=* OR expires!=* OR updated!=*))"), mvappend(nodename, "All_Domains.Missing_Extractions_All_Domains"), nodename) | rename created AS All_Domains.created expires AS All_Domains.expires retrieved AS All_Domains.retrieved tag AS All_Domains.tag updated AS All_Domains.updated domain AS All_Domains.domain nameservers AS All_Domains.nameservers registrant AS All_Domains.registrant registrar AS All_Domains.registrar resolved_domain AS All_Domains.resolved_domain is_Missing_Extractions_All_Domains AS All_Domains.is_Missing_Extractions_All_Domains is_not_Missing_Extractions_All_Domains AS All_Domains.is_not_Missing_Extractions_All_Domains | fields nodename, _time, host, source, sourcetype, All_Domains.created, All_Domains.expires, All_Domains.retrieved, All_Domains.tag, All_Domains.updated, All_Domains.domain, All_Domains.nameservers, All_Domains.registrant, All_Domains.registrar, All_Domains.resolved_domain, All_Domains.is_Missing_Extractions_All_Domains, All_Domains.is_not_Missing_Extractions_All_Domains ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 16:58:00 2021', apiEndTime='Fri Jun  3 16:58:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_SA-NetworkProtection_Domain_Analysis_ACCELERATE_", search_type=adhoc, is_proxied=false, app="SA-NetworkProtection", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:03.523, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58983ee28ca85f23b_at_1654275480_626', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Certificates [  search (index=* OR index=_*) ((`cim_Certificates_indexes`) tag=certificate) | eval nodename = "All_Certificates"| eval is_SSL=if(searchmatch("((tag=ssl OR tag=tls))"),1,0), is_not_SSL=1-is_SSL | eval nodename = if(nodename == "All_Certificates" AND searchmatch("((tag=ssl OR tag=tls))"), mvappend(nodename, "All_Certificates.SSL"), nodename)| eval ssl_hash=if(isnull(ssl_hash) OR ssl_hash="","unknown",ssl_hash), ssl_issuer=if(isnull(ssl_issuer) OR ssl_issuer="","unknown",ssl_issuer), ssl_issuer_common_name=if(isnull(ssl_issuer_common_name) OR ssl_issuer_common_name="","unknown",ssl_issuer_common_name) | rex field=ssl_issuer_email "^.*@(?<ssl_issuer_email_domain>.+)$" max_match=1 | eval ssl_subject=if(isnull(ssl_subject) OR ssl_subject="","unknown",ssl_subject), ssl_subject_common_name=if(isnull(ssl_subject_common_name) OR ssl_subject_common_name="","unknown",ssl_subject_common_name) | rex field=ssl_subject_email "^.*@(?<ssl_subject_email_domain>.+)$" max_match=1 | eval ssl_validity_window=if(isnum(ssl_end_time) AND isnum(ssl_start_time),ssl_end_time-ssl_start_time,null()), ssl_is_valid=case(match(ssl_is_valid, "^(1|[Tt]|[Tt][Rr][Uu][Ee])$"),1,match(ssl_is_valid, "^(0|[Ff]|[Ff][Aa][Ll][Ss][Ee])$"),0,isnum(ssl_end_time) AND isnum(ssl_start_time) AND _time>=ssl_start_time AND _time<=ssl_end_time,1,isnum(ssl_end_time) AND isnum(ssl_start_time),0,1=1,null()) | rename ssl_end_time AS All_Certificates.SSL.ssl_end_time ssl_engine AS All_Certificates.SSL.ssl_engine ssl_issuer_email AS All_Certificates.SSL.ssl_issuer_email ssl_issuer_locality AS All_Certificates.SSL.ssl_issuer_locality ssl_issuer_state AS All_Certificates.SSL.ssl_issuer_state ssl_issuer_organization AS All_Certificates.SSL.ssl_issuer_organization ssl_issuer_unit AS All_Certificates.SSL.ssl_issuer_unit ssl_issuer_street AS All_Certificates.SSL.ssl_issuer_street ssl_name AS All_Certificates.SSL.ssl_name ssl_policies AS All_Certificates.SSL.ssl_policies ssl_publickey AS All_Certificates.SSL.ssl_publickey ssl_publickey_algorithm AS All_Certificates.SSL.ssl_publickey_algorithm ssl_serial AS All_Certificates.SSL.ssl_serial ssl_session_id AS All_Certificates.SSL.ssl_session_id ssl_signature_algorithm AS All_Certificates.SSL.ssl_signature_algorithm ssl_start_time AS All_Certificates.SSL.ssl_start_time ssl_subject_email AS All_Certificates.SSL.ssl_subject_email ssl_subject_locality AS All_Certificates.SSL.ssl_subject_locality ssl_subject_state AS All_Certificates.SSL.ssl_subject_state ssl_subject_organization AS All_Certificates.SSL.ssl_subject_organization ssl_subject_unit AS All_Certificates.SSL.ssl_subject_unit ssl_subject_street AS All_Certificates.SSL.ssl_subject_street ssl_version AS All_Certificates.SSL.ssl_version ssl_hash AS All_Certificates.SSL.ssl_hash ssl_issuer AS All_Certificates.SSL.ssl_issuer ssl_issuer_common_name AS All_Certificates.SSL.ssl_issuer_common_name ssl_issuer_email_domain AS All_Certificates.SSL.ssl_issuer_email_domain ssl_subject AS All_Certificates.SSL.ssl_subject ssl_subject_common_name AS All_Certificates.SSL.ssl_subject_common_name ssl_subject_email_domain AS All_Certificates.SSL.ssl_subject_email_domain ssl_validity_window AS All_Certificates.SSL.ssl_validity_window ssl_is_valid AS All_Certificates.SSL.ssl_is_valid | rename dest AS All_Certificates.dest dest_bunit AS All_Certificates.dest_bunit dest_category AS All_Certificates.dest_category dest_port AS All_Certificates.dest_port dest_priority AS All_Certificates.dest_priority duration AS All_Certificates.duration response_time AS All_Certificates.response_time src AS All_Certificates.src src_bunit AS All_Certificates.src_bunit src_category AS All_Certificates.src_category src_port AS All_Certificates.src_port src_priority AS All_Certificates.src_priority tag AS All_Certificates.tag transport AS All_Certificates.transport is_SSL AS All_Certificates.is_SSL is_not_SSL AS All_Certificates.is_not_SSL | fields nodename, _time, host, source, sourcetype, All_Certificates.dest, All_Certificates.dest_bunit, All_Certificates.dest_category, All_Certificates.dest_port, All_Certificates.dest_priority, All_Certificates.duration, All_Certificates.response_time, All_Certificates.src, All_Certificates.src_bunit, All_Certificates.src_category, All_Certificates.src_port, All_Certificates.src_priority, All_Certificates.tag, All_Certificates.transport, All_Certificates.is_SSL, All_Certificates.is_not_SSL, All_Certificates.SSL.ssl_end_time, All_Certificates.SSL.ssl_engine, All_Certificates.SSL.ssl_issuer_email, All_Certificates.SSL.ssl_issuer_locality, All_Certificates.SSL.ssl_issuer_state, All_Certificates.SSL.ssl_issuer_organization, All_Certificates.SSL.ssl_issuer_unit, All_Certificates.SSL.ssl_issuer_street, All_Certificates.SSL.ssl_name, All_Certificates.SSL.ssl_policies, All_Certificates.SSL.ssl_publickey, All_Certificates.SSL.ssl_publickey_algorithm, All_Certificates.SSL.ssl_serial, All_Certificates.SSL.ssl_session_id, All_Certificates.SSL.ssl_signature_algorithm, All_Certificates.SSL.ssl_start_time, All_Certificates.SSL.ssl_subject_email, All_Certificates.SSL.ssl_subject_locality, All_Certificates.SSL.ssl_subject_state, All_Certificates.SSL.ssl_subject_organization, All_Certificates.SSL.ssl_subject_unit, All_Certificates.SSL.ssl_subject_street, All_Certificates.SSL.ssl_version, All_Certificates.SSL.ssl_hash, All_Certificates.SSL.ssl_issuer, All_Certificates.SSL.ssl_issuer_common_name, All_Certificates.SSL.ssl_issuer_email_domain, All_Certificates.SSL.ssl_subject, All_Certificates.SSL.ssl_subject_common_name, All_Certificates.SSL.ssl_subject_email_domain, All_Certificates.SSL.ssl_validity_window, All_Certificates.SSL.ssl_is_valid ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 16:58:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Certificates_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:03.513, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD52e6a25c41903acf0_at_1654275480_625', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Filesystem [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=filesystem | eval nodename = "Filesystem"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), file_hash=if(isnull(file_hash) OR file_hash="","unknown",file_hash), file_name=if(isnull(file_name) OR file_name="","unknown",file_name), file_path=if(isnull(file_path) OR file_path="","unknown",file_path), file_acl=if(isnull(file_acl) OR file_acl="","unknown",file_acl), file_size=if(isnum(file_size),file_size,null()), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Filesystem.dest_bunit dest_category AS Filesystem.dest_category dest_priority AS Filesystem.dest_priority dest_requires_av AS Filesystem.dest_requires_av dest_should_timesync AS Filesystem.dest_should_timesync dest_should_update AS Filesystem.dest_should_update file_access_time AS Filesystem.file_access_time file_create_time AS Filesystem.file_create_time file_modify_time AS Filesystem.file_modify_time process_guid AS Filesystem.process_guid process_id AS Filesystem.process_id tag AS Filesystem.tag user_bunit AS Filesystem.user_bunit user_category AS Filesystem.user_category user_priority AS Filesystem.user_priority action AS Filesystem.action dest AS Filesystem.dest file_hash AS Filesystem.file_hash file_name AS Filesystem.file_name file_path AS Filesystem.file_path file_acl AS Filesystem.file_acl file_size AS Filesystem.file_size user AS Filesystem.user vendor_product AS Filesystem.vendor_product | fields nodename, _time, host, source, sourcetype, Filesystem.dest_bunit, Filesystem.dest_category, Filesystem.dest_priority, Filesystem.dest_requires_av, Filesystem.dest_should_timesync, Filesystem.dest_should_update, Filesystem.file_access_time, Filesystem.file_create_time, Filesystem.file_modify_time, Filesystem.process_guid, Filesystem.process_id, Filesystem.tag, Filesystem.user_bunit, Filesystem.user_category, Filesystem.user_priority, Filesystem.action, Filesystem.dest, Filesystem.file_hash, Filesystem.file_name, Filesystem.file_path, Filesystem.file_acl, Filesystem.file_size, Filesystem.user, Filesystem.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 16:58:00 2022', apiEndTime='Fri Jun  3 16:58:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Filesystem_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:03.479, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5fe51f0ad1d9fe444_at_1654275480_624', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Authentication [  search (index=* OR index=_*) ((`cim_Authentication_indexes`) tag=authentication NOT (action=success user=*$)) | eval nodename = "Authentication"| eval action=if(isnull(action) OR action="","unknown",action), app=if(isnull(app) OR app="",sourcetype,app), src=if(isnull(src) OR src="","unknown",src), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user)| eval is_Failed_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Authentication=1-is_Failed_Authentication, is_Successful_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Authentication=1-is_Successful_Authentication, is_Default_Authentication=if(searchmatch("(tag=\"default\")"),1,0), is_not_Default_Authentication=1-is_Default_Authentication, is_Insecure_Authentication=if(searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"),1,0), is_not_Insecure_Authentication=1-is_Insecure_Authentication, is_Privileged_Authentication=if(searchmatch("(tag=\"privileged\")"),1,0), is_not_Privileged_Authentication=1-is_Privileged_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Failed_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Successful_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"default\")"), mvappend(nodename, "Authentication.Default_Authentication"), nodename)| eval is_Failed_Default_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Default_Authentication=1-is_Failed_Default_Authentication, is_Successful_Default_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Default_Authentication=1-is_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Default_Authentication.Failed_Default_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Default_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Default_Authentication.Successful_Default_Authentication"), nodename) | rename is_Failed_Default_Authentication AS Authentication.Default_Authentication.is_Failed_Default_Authentication is_not_Failed_Default_Authentication AS Authentication.Default_Authentication.is_not_Failed_Default_Authentication is_Successful_Default_Authentication AS Authentication.Default_Authentication.is_Successful_Default_Authentication is_not_Successful_Default_Authentication AS Authentication.Default_Authentication.is_not_Successful_Default_Authentication | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"insecure\" OR tag=\"cleartext\")"), mvappend(nodename, "Authentication.Insecure_Authentication"), nodename) | eval nodename = if(nodename == "Authentication" AND searchmatch("(tag=\"privileged\")"), mvappend(nodename, "Authentication.Privileged_Authentication"), nodename)| eval is_Failed_Privileged_Authentication=if(searchmatch("(action=\"failure\")"),1,0), is_not_Failed_Privileged_Authentication=1-is_Failed_Privileged_Authentication, is_Successful_Privileged_Authentication=if(searchmatch("(action=\"success\")"),1,0), is_not_Successful_Privileged_Authentication=1-is_Successful_Privileged_Authentication | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"failure\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Failed_Privileged_Authentication"), nodename) | eval nodename = if(nodename == "Authentication.Privileged_Authentication" AND searchmatch("(action=\"success\")"), mvappend(nodename, "Authentication.Privileged_Authentication.Successful_Privileged_Authentication"), nodename) | rename is_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Failed_Privileged_Authentication is_not_Failed_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Failed_Privileged_Authentication is_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_Successful_Privileged_Authentication is_not_Successful_Privileged_Authentication AS Authentication.Privileged_Authentication.is_not_Successful_Privileged_Authentication | rename authentication_method AS Authentication.authentication_method authentication_service AS Authentication.authentication_service dest_bunit AS Authentication.dest_bunit dest_category AS Authentication.dest_category dest_nt_domain AS Authentication.dest_nt_domain dest_priority AS Authentication.dest_priority duration AS Authentication.duration reason AS Authentication.reason response_time AS Authentication.response_time signature AS Authentication.signature signature_id AS Authentication.signature_id src_bunit AS Authentication.src_bunit src_category AS Authentication.src_category src_nt_domain AS Authentication.src_nt_domain src_priority AS Authentication.src_priority src_user_bunit AS Authentication.src_user_bunit src_user_category AS Authentication.src_user_category src_user_id AS Authentication.src_user_id src_user_priority AS Authentication.src_user_priority src_user_role AS Authentication.src_user_role src_user_type AS Authentication.src_user_type tag AS Authentication.tag user_agent AS Authentication.user_agent user_bunit AS Authentication.user_bunit user_category AS Authentication.user_category user_id AS Authentication.user_id user_priority AS Authentication.user_priority user_role AS Authentication.user_role user_type AS Authentication.user_type vendor_account AS Authentication.vendor_account action AS Authentication.action app AS Authentication.app src AS Authentication.src src_user AS Authentication.src_user dest AS Authentication.dest user AS Authentication.user is_Failed_Authentication AS Authentication.is_Failed_Authentication is_not_Failed_Authentication AS Authentication.is_not_Failed_Authentication is_Successful_Authentication AS Authentication.is_Successful_Authentication is_not_Successful_Authentication AS Authentication.is_not_Successful_Authentication is_Default_Authentication AS Authentication.is_Default_Authentication is_not_Default_Authentication AS Authentication.is_not_Default_Authentication is_Insecure_Authentication AS Authentication.is_Insecure_Authentication is_not_Insecure_Authentication AS Authentication.is_not_Insecure_Authentication is_Privileged_Authentication AS Authentication.is_Privileged_Authentication is_not_Privileged_Authentication AS Authentication.is_not_Privileged_Authentication | fields nodename, _time, host, source, sourcetype, Authentication.authentication_method, Authentication.authentication_service, Authentication.dest_bunit, Authentication.dest_category, Authentication.dest_nt_domain, Authentication.dest_priority, Authentication.duration, Authentication.reason, Authentication.response_time, Authentication.signature, Authentication.signature_id, Authentication.src_bunit, Authentication.src_category, Authentication.src_nt_domain, Authentication.src_priority, Authentication.src_user_bunit, Authentication.src_user_category, Authentication.src_user_id, Authentication.src_user_priority, Authentication.src_user_role, Authentication.src_user_type, Authentication.tag, Authentication.user_agent, Authentication.user_bunit, Authentication.user_category, Authentication.user_id, Authentication.user_priority, Authentication.user_role, Authentication.user_type, Authentication.vendor_account, Authentication.action, Authentication.app, Authentication.src, Authentication.src_user, Authentication.dest, Authentication.user, Authentication.is_Failed_Authentication, Aut (truncated)', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 16:58:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Authentication_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:03.175, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275483.606181', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Endpoint.Processes normid= [ search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ', autojoin='0', buckets=0, ttl=30, max_count=50000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='Tue May  3 16:58:03 2022', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="Tshirt_SA_CIM", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:02.467, user=admin, action=search, info=granted , search_id='scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275480_623', search='| rest tshirt_server=local count=0 "/servicesNS/-/-/saved/searches?listDefaultActionArgs=1" | where match('action.correlationsearch.enabled', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.notable', "1|[Tt]|[Tt][Rr][Uu][Ee]") OR match('action.risk', "1|[Tt]|[Tt][Rr][Uu][Ee]") | join type=left title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=savedsearch* AND annotations=*" | eval title=replace(title, "savedsearch://", "") | table title,annotations] | join type=left max=0 title [| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")] | eval analyticstories=split(analyticstories, "@@") | eval annotations=case(isnotnull('action.correlationsearch.annotations') AND 'action.correlationsearch.annotations'!="",'action.correlationsearch.annotations',isnotnull(annotations) AND annotations!="",annotations,1=1,null()),rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest tshirt_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="",null(),security_domain),severity=if(severity="",null(),severity),rule_name=if(rule_name="",null(),rule_name),description=if(description="",null(),description),rule_title=if(rule_title="",null(),rule_title),rule_description=if(rule_description="",null(),rule_description),drilldown_name=if(drilldown_name="",null(),drilldown_name),drilldown_search=if(drilldown_search="",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="",null(),drilldown_latest_offset),default_status=if(default_status="",null(),default_status),default_owner=if(default_owner="",null(),default_owner),default_disposition=if(default_disposition="",null(),default_disposition),next_steps=if(next_steps="",null(),next_steps),investigation_profiles=if(investigation_profiles="",null(),investigation_profiles),extract_artifacts=if(extract_artifacts="",null(),extract_artifacts),recommended_actions=if(recommended_actions="",null(),recommended_actions),analyticstories=if(analyticstories="",null(),analyticstories) | appendpipe [ where _key LIKE "%\"%" | eval _key=replace(_key, "\"", "_") ] | stats first(annotations) as annotations,first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_artifacts) as extract_artifacts,first(recommended_actions) as recommended_actions,values(analyticstories) as analyticstories by _key | runshellscript correlationsearches_lookup append=T key_field=_key | stats count', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='Fri Jun  3 16:58:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="Threat - Correlation Searches - Lookup Gen", search_type=adhoc, is_proxied=false, app="SA-ThreatIntelligence", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:02.453, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ba43509e6e89712f_at_1654275480_622', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Processes [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=process tag=report | eval process_integrity_level=lower(process_integrity_level)  | eval nodename = "Processes"| eval dest=if(isnull(dest) OR dest="","unknown",dest), original_file_name=if(isnull(original_file_name) OR original_file_name="","unknown",original_file_name), parent_process=if(isnull(parent_process) OR parent_process="","unknown",parent_process), parent_process_name=case(isnotnull(parent_process_name) AND parent_process_name!="",parent_process_name,isnotnull(parent_process) AND parent_process!="",replace(parent_process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), process=if(isnull(process) OR process="","unknown",process), process_name=case(isnotnull(process_name) AND process_name!="",process_name,isnotnull(process) AND process!="",replace(process,"^\s*([^\s]+).*","\1"),1=1,"unknown"), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename action AS Processes.action cpu_load_percent AS Processes.cpu_load_percent dest_bunit AS Processes.dest_bunit dest_category AS Processes.dest_category dest_is_expected AS Processes.dest_is_expected dest_priority AS Processes.dest_priority dest_requires_av AS Processes.dest_requires_av dest_should_timesync AS Processes.dest_should_timesync dest_should_update AS Processes.dest_should_update mem_used AS Processes.mem_used os AS Processes.os parent_process_exec AS Processes.parent_process_exec parent_process_id AS Processes.parent_process_id parent_process_guid AS Processes.parent_process_guid parent_process_path AS Processes.parent_process_path process_current_directory AS Processes.process_current_directory process_exec AS Processes.process_exec process_hash AS Processes.process_hash process_guid AS Processes.process_guid process_id AS Processes.process_id process_integrity_level AS Processes.process_integrity_level process_path AS Processes.process_path tag AS Processes.tag user_id AS Processes.user_id user_bunit AS Processes.user_bunit user_category AS Processes.user_category user_priority AS Processes.user_priority dest AS Processes.dest original_file_name AS Processes.original_file_name parent_process AS Processes.parent_process parent_process_name AS Processes.parent_process_name process AS Processes.process process_name AS Processes.process_name user AS Processes.user vendor_product AS Processes.vendor_product | fields nodename, _time, host, source, sourcetype, Processes.action, Processes.cpu_load_percent, Processes.dest_bunit, Processes.dest_category, Processes.dest_is_expected, Processes.dest_priority, Processes.dest_requires_av, Processes.dest_should_timesync, Processes.dest_should_update, Processes.mem_used, Processes.os, Processes.parent_process_exec, Processes.parent_process_id, Processes.parent_process_guid, Processes.parent_process_path, Processes.process_current_directory, Processes.process_exec, Processes.process_hash, Processes.process_guid, Processes.process_id, Processes.process_integrity_level, Processes.process_path, Processes.tag, Processes.user_id, Processes.user_bunit, Processes.user_category, Processes.user_priority, Processes.dest, Processes.original_file_name, Processes.parent_process, Processes.parent_process_name, Processes.process, Processes.process_name, Processes.user, Processes.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 16:58:00 2022', apiEndTime='Fri Jun  3 16:58:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Processes_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:02.411, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5e277da1025d52e49_at_1654275480_621', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=listening tag=port | eval transport=if(isnull(transport) OR transport="","unknown",transport),dest_port=if(isnull(dest_port) OR dest_port="",0,dest_port),transport_dest_port=mvzip(transport,dest_port,"/") | mvexpand transport_dest_port  | eval nodename = "Ports"| eval src=if(isnull(src) OR src="","unknown",src), src_port=if(isnum(src_port),src_port,0), dest=if(isnull(dest) OR dest="","unknown",dest), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename creation_time AS Ports.creation_time dest_bunit AS Ports.dest_bunit dest_category AS Ports.dest_category dest_port AS Ports.dest_port dest_priority AS Ports.dest_priority dest_requires_av AS Ports.dest_requires_av dest_should_timesync AS Ports.dest_should_timesync dest_should_update AS Ports.dest_should_update process_guid AS Ports.process_guid process_id AS Ports.process_id src_bunit AS Ports.src_bunit src_category AS Ports.src_category src_priority AS Ports.src_priority src_requires_av AS Ports.src_requires_av src_should_timesync AS Ports.src_should_timesync src_should_update AS Ports.src_should_update state AS Ports.state tag AS Ports.tag transport AS Ports.transport transport_dest_port AS Ports.transport_dest_port user_bunit AS Ports.user_bunit user_category AS Ports.user_category user_priority AS Ports.user_priority src AS Ports.src src_port AS Ports.src_port dest AS Ports.dest user AS Ports.user vendor_product AS Ports.vendor_product | fields nodename, _time, host, source, sourcetype, Ports.creation_time, Ports.dest_bunit, Ports.dest_category, Ports.dest_port, Ports.dest_priority, Ports.dest_requires_av, Ports.dest_should_timesync, Ports.dest_should_update, Ports.process_guid, Ports.process_id, Ports.src_bunit, Ports.src_category, Ports.src_priority, Ports.src_requires_av, Ports.src_should_timesync, Ports.src_should_update, Ports.state, Ports.tag, Ports.transport, Ports.transport_dest_port, Ports.user_bunit, Ports.user_category, Ports.user_priority, Ports.src, Ports.src_port, Ports.dest, Ports.user, Ports.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 16:58:00 2022', apiEndTime='Fri Jun  3 16:58:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:02.403, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5021246a350b56653_at_1654275480_620', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Services [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=service tag=report | eval nodename = "Services"| eval dest=if(isnull(dest) OR dest="","unknown",dest), service=if(isnull(service) OR service="","unknown",service), service_name=if(isnull(service_name) OR service_name="","unknown",service_name), service_id=if(isnull(service_id) OR service_id="","unknown",service_id), start_mode=if(isnull(start_mode) OR start_mode="","unknown",start_mode), status=if(isnull(status) OR status="","unknown",status), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename description AS Services.description dest_bunit AS Services.dest_bunit dest_category AS Services.dest_category dest_is_expected AS Services.dest_is_expected dest_priority AS Services.dest_priority dest_requires_av AS Services.dest_requires_av dest_should_timesync AS Services.dest_should_timesync dest_should_update AS Services.dest_should_update process_guid AS Services.process_guid process_id AS Services.process_id service_dll AS Services.service_dll service_dll_path AS Services.service_dll_path service_dll_hash AS Services.service_dll_hash service_dll_signature_exists AS Services.service_dll_signature_exists service_dll_signature_verified AS Services.service_dll_signature_verified service_exec AS Services.service_exec service_hash AS Services.service_hash service_path AS Services.service_path service_signature_exists AS Services.service_signature_exists service_signature_verified AS Services.service_signature_verified tag AS Services.tag user_bunit AS Services.user_bunit user_category AS Services.user_category user_priority AS Services.user_priority dest AS Services.dest service AS Services.service service_name AS Services.service_name service_id AS Services.service_id start_mode AS Services.start_mode status AS Services.status user AS Services.user vendor_product AS Services.vendor_product | fields nodename, _time, host, source, sourcetype, Services.description, Services.dest_bunit, Services.dest_category, Services.dest_is_expected, Services.dest_priority, Services.dest_requires_av, Services.dest_should_timesync, Services.dest_should_update, Services.process_guid, Services.process_id, Services.service_dll, Services.service_dll_path, Services.service_dll_hash, Services.service_dll_signature_exists, Services.service_dll_signature_verified, Services.service_exec, Services.service_hash, Services.service_path, Services.service_signature_exists, Services.service_signature_verified, Services.tag, Services.user_bunit, Services.user_category, Services.user_priority, Services.dest, Services.service, Services.service_name, Services.service_id, Services.start_mode, Services.status, Services.user, Services.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 16:58:00 2022', apiEndTime='Fri Jun  3 16:58:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Services_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:02.367, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD58f78d3aa3bcb464b_at_1654275480_619', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Email [  search (index=* OR index=_*) ((`cim_Email_indexes`) tag=email) | eval nodename = "All_Email"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), src=if(isnull(src) OR src="","unknown",src), recipient=if(isnull(recipient) OR recipient="","unknown",recipient) | rex field=recipient "^.*@(?<recipient_domain>.+)$" max_match=1 | eval recipient_count=case(isnum(recipient_count),recipient_count,isnotnull(recipient),mvcount(recipient),1=1,1), src_user=if(isnull(src_user) OR src_user="","unknown",src_user) | rex field=src_user "^.*@(?<src_user_domain>.+)$" max_match=1 | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown")| eval is_Delivery=if(searchmatch("(tag=delivery)"),1,0), is_not_Delivery=1-is_Delivery, is_Content=if(searchmatch("(tag=content)"),1,0), is_not_Content=1-is_Content, is_Filtering=if(searchmatch("(tag=filter)"),1,0), is_not_Filtering=1-is_Filtering | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=delivery)"), mvappend(nodename, "All_Email.Delivery"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=content)"), mvappend(nodename, "All_Email.Content"), nodename) | eval nodename = if(nodename == "All_Email" AND searchmatch("(tag=filter)"), mvappend(nodename, "All_Email.Filtering"), nodename) | rename filter_action AS All_Email.Filtering.filter_action filter_score AS All_Email.Filtering.filter_score signature AS All_Email.Filtering.signature signature_extra AS All_Email.Filtering.signature_extra signature_id AS All_Email.Filtering.signature_id | rename delay AS All_Email.delay dest_bunit AS All_Email.dest_bunit dest_category AS All_Email.dest_category dest_priority AS All_Email.dest_priority duration AS All_Email.duration file_hash AS All_Email.file_hash file_name AS All_Email.file_name file_size AS All_Email.file_size internal_message_id AS All_Email.internal_message_id message_id AS All_Email.message_id message_info AS All_Email.message_info orig_dest AS All_Email.orig_dest orig_recipient AS All_Email.orig_recipient orig_src AS All_Email.orig_src protocol AS All_Email.protocol process AS All_Email.process process_id AS All_Email.process_id recipient_status AS All_Email.recipient_status response_time AS All_Email.response_time retries AS All_Email.retries return_addr AS All_Email.return_addr size AS All_Email.size src_bunit AS All_Email.src_bunit src_category AS All_Email.src_category src_priority AS All_Email.src_priority src_user_bunit AS All_Email.src_user_bunit src_user_category AS All_Email.src_user_category src_user_priority AS All_Email.src_user_priority status_code AS All_Email.status_code subject AS All_Email.subject tag AS All_Email.tag url AS All_Email.url user AS All_Email.user user_bunit AS All_Email.user_bunit user_category AS All_Email.user_category user_priority AS All_Email.user_priority xdelay AS All_Email.xdelay xref AS All_Email.xref action AS All_Email.action dest AS All_Email.dest src AS All_Email.src recipient AS All_Email.recipient recipient_domain AS All_Email.recipient_domain recipient_count AS All_Email.recipient_count src_user AS All_Email.src_user src_user_domain AS All_Email.src_user_domain vendor_product AS All_Email.vendor_product is_Delivery AS All_Email.is_Delivery is_not_Delivery AS All_Email.is_not_Delivery is_Content AS All_Email.is_Content is_not_Content AS All_Email.is_not_Content is_Filtering AS All_Email.is_Filtering is_not_Filtering AS All_Email.is_not_Filtering | fields nodename, _time, host, source, sourcetype, All_Email.delay, All_Email.dest_bunit, All_Email.dest_category, All_Email.dest_priority, All_Email.duration, All_Email.file_hash, All_Email.file_name, All_Email.file_size, All_Email.internal_message_id, All_Email.message_id, All_Email.message_info, All_Email.orig_dest, All_Email.orig_recipient, All_Email.orig_src, All_Email.protocol, All_Email.process, All_Email.process_id, All_Email.recipient_status, All_Email.response_time, All_Email.retries, All_Email.return_addr, All_Email.size, All_Email.src_bunit, All_Email.src_category, All_Email.src_priority, All_Email.src_user_bunit, All_Email.src_user_category, All_Email.src_user_priority, All_Email.status_code, All_Email.subject, All_Email.tag, All_Email.url, All_Email.user, All_Email.user_bunit, All_Email.user_category, All_Email.user_priority, All_Email.xdelay, All_Email.xref, All_Email.action, All_Email.dest, All_Email.src, All_Email.recipient, All_Email.recipient_domain, All_Email.recipient_count, All_Email.src_user, All_Email.src_user_domain, All_Email.vendor_product, All_Email.is_Delivery, All_Email.is_not_Delivery, All_Email.is_Content, All_Email.is_not_Content, All_Email.is_Filtering, All_Email.is_not_Filtering, All_Email.Filtering.filter_action, All_Email.Filtering.filter_score, All_Email.Filtering.signature, All_Email.Filtering.signature_extra, All_Email.Filtering.signature_id ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Thu Jun  3 16:58:00 2021', apiEndTime='Fri Jun  3 16:58:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Email_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:02.356, user=tshirt-system-user, action=search, info=granted , search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD50ac557aafae73b89_at_1654275480_618', search='| summarize tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Endpoint.Registry [  search (index=* OR index=_*) (`cim_Endpoint_indexes`) tag=endpoint tag=registry | eval nodename = "Registry"| eval action=if(isnull(action) OR action="","unknown",action), dest=if(isnull(dest) OR dest="","unknown",dest), registry_path=if(isnull(registry_path) OR registry_path="","unknown",registry_path), registry_key_name=if(isnull(registry_key_name) OR registry_key_name="","unknown",registry_key_name), registry_value_data=if(isnull(registry_value_data) OR registry_value_data="","unknown",registry_value_data), registry_value_name=if(isnull(registry_value_name) OR registry_value_name="","unknown",registry_value_name), registry_value_type=if(isnull(registry_value_type) OR registry_value_type="","unknown",registry_value_type), user=if(isnull(user) OR user="","unknown",user), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename dest_bunit AS Registry.dest_bunit dest_category AS Registry.dest_category dest_priority AS Registry.dest_priority dest_requires_av AS Registry.dest_requires_av dest_should_timesync AS Registry.dest_should_timesync dest_should_update AS Registry.dest_should_update process_guid AS Registry.process_guid process_id AS Registry.process_id registry_hive AS Registry.registry_hive registry_value_text AS Registry.registry_value_text status AS Registry.status tag AS Registry.tag user_bunit AS Registry.user_bunit user_category AS Registry.user_category user_priority AS Registry.user_priority action AS Registry.action dest AS Registry.dest registry_path AS Registry.registry_path registry_key_name AS Registry.registry_key_name registry_value_data AS Registry.registry_value_data registry_value_name AS Registry.registry_value_name registry_value_type AS Registry.registry_value_type user AS Registry.user vendor_product AS Registry.vendor_product | fields nodename, _time, host, source, sourcetype, Registry.dest_bunit, Registry.dest_category, Registry.dest_priority, Registry.dest_requires_av, Registry.dest_should_timesync, Registry.dest_should_update, Registry.process_guid, Registry.process_id, Registry.registry_hive, Registry.registry_value_text, Registry.status, Registry.tag, Registry.user_bunit, Registry.user_category, Registry.user_priority, Registry.action, Registry.dest, Registry.registry_path, Registry.registry_key_name, Registry.registry_value_data, Registry.registry_value_name, Registry.registry_value_type, Registry.user, Registry.vendor_product ]', autojoin='1', buckets=0, ttl=600, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='', apiStartTime='Tue May  3 16:58:00 2022', apiEndTime='Fri Jun  3 16:58:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Endpoint.Registry_ACCELERATE_", search_type=adhoc, is_proxied=false, app="Tshirt_SA_CIM", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:00.353, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275480.606180', search='summarize tstats=t maintain="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_DA-ESS-ThreatIntelligence_Threat_Intelligence,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-NetworkProtection_Domain_Analysis,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Incident_Management,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_SA-ThreatIntelligence_Risk,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Authentication,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Certificates,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change,0;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Email,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Filesystem,1651597079;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint,1651597079;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Processes,1651597079;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Registry,1651597079;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Endpoint.Services,1651597079;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Intrusion_Detection,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Malware,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution,1646326679;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Sessions,1646326679;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Traffic,1646326679;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Performance,1651597079;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.Modular_Actions,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Tshirt_Audit.View_Activity,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Ticket_Management,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Updates,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Vulnerabilities,1622739479;E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Web,1646326679;" summaryprefix="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA"', autojoin='1', buckets=0, ttl=30, max_count=10000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="system", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 16:58:00.325, user=tshirt-system-user, action=search, info=granted , search_id='SummaryDirector_1654275480.606179', search='summarize maintain="%22SUMMARY_ID%22%2C%22EARLIEST_TIME%22%2C%22REMOTE_SEARCH%22%2C%22NORM_SUMMARY_ID%22%2C%22NORM_REMOTE_SEARCH%22%0A%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_4912519826ee0548%22%2C1651536000%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20lookup%20%20aws_unauthorized_errorCodes%20errorCode%20OUTPUT%20Unauthorized%20%20%7C%20addinfo%20%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20%20keepcolorder%3Dt%20%22%22Unauthorized%22%22%20%22%22aws_account_id%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%22%22sourceIPAddress%22%22%20%22%22userName%22%22%20%7C%20prestats%20%20count%20count%28Unauthorized%29%20count%28eval%28errorCode%21%3D%22%22success%22%22%29%29%20AS%20_psef0%20by%20aws_account_id%20eventName%20region%20sourceIPAddress%20userName%22%2C%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_NSb26032d7500783b0%22%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsAccountId%22%22%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20aws_account_id%3D%22%22%2A%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudtrail%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%22%22%20%29%20AND%20%28%20%28%20awsRegion%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Aconfig%3Anotification%22%22%20%29%20AND%20%28%20%28%20%22%22configurationItem.awsRegion%22%22%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20AND%20%28%20%28%20Region%3D%22%22%2A%2A%22%22%20%29%20%29%20%29%20OR%20%28%20region%3D%22%22%2A%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20OR%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Adescription%22%22%20%29%20OR%20%28%20sourcetype%3D%22%22aws%3Ametadata%22%22%20%29%20%29%20%7C%20litsearch%20index%3Daws_security%20aws_account_id%3D%22%22%2A%22%22%20region%3D%22%22%2A%2A%22%22%20%7C%20lookup%20aws_unauthorized_errorCodes%20errorCode%20OUTPUT%20Unauthorized%20%7C%20addinfo%20type%3Dcount%20label%3Dprereport_events%20%7C%20fields%20keepcolorder%3Dt%20%22%22Unauthorized%22%22%20%22%22aws_account_id%22%22%20%22%22errorCode%22%22%20%22%22eventName%22%22%20%22%22prestats_reserved_%2A%22%22%20%22%22psrsvd_%2A%22%22%20%22%22region%22%22%20%22%22sourceIPAddress%22%22%20%22%22userName%22%22%20%7C%20prestats%20count%20count%28Unauthorized%29%20count%28eval%28errorCode%21%3D%22%22success%22%22%29%29%20AS%20_psef0%20by%20aws_account_id%20eventName%20region%20sourceIPAddress%20userName%22%0A%22E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_TshirtEnterpriseSecuritySuite_admin_e62ed18993c76d71%22%2C1651536000%2C%22litsearch%20index%3Daws_security%20%28%20%28%20%28%20%28%20sourcetype%3D%22%22aws%3Abilling%22%22%20%29%20AND%20%28%20%28%20PayerAccountId%3D%22%22%2A%22%22%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatch%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28%20sourcetype%3D%22%22aws%3Acloudwatchlogs%3Avpcflow%22%22%20%29%20AND%20%28%20%28%20%28%20account_id%3D%22%22%2A%22%22%20OR%20sourcetype%3D%22%22aws%3Aconfig%3Arule%22%22%20OR%20sourcetype%3D%22%22aws%3Ainspector%22%22%20%29%20%29%20%29%20%29%20OR%20%28%20%28% (truncated)', autojoin='1', buckets=0, ttl=30, max_count=10000, maxtime=8640000, enable_lookups='0', extra_fields='', apiStartTime='ZERO_TIME', apiEndTime='ZERO_TIME', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="", is_proxied=false, app="system", provenance="summary_director", mode="historical"]
Audit:[timestamp=06-03-2022 16:57:54.168, user=admin, action=search, info=completed, search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275420_617', has_error_warn=false, fully_completed_search=true, total_run_time=10.57, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275463, api_et=1654271220.000000000, api_lt=1654274820.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=1654271220.000000000, search_lt=1654274820.000000000, is_realtime=0, savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_startup_time="0", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DA-ESS-ContentUpdate_admin_f2df6493ea859e37", app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| makeresults 
|  eval test="suppression"']
Audit:[timestamp=06-03-2022 16:57:42.835, user=admin, action=search, info=granted , search_id='scheduler__admin_REEtRVNTLUNvbnRlbnRVcGRhdGU__RMD5d48eb7a4c54f66fd_at_1654275420_617', search='| makeresults 
|  eval test="suppression"', autojoin='1', buckets=0, ttl=120, max_count=500000, maxtime=8640000, enable_lookups='1', extra_fields='*,_*,annotations,host,prestats_reserved_*,psrsvd_*,source,sourcetype', apiStartTime='Fri Jun  3 15:47:00 2022', apiEndTime='Fri Jun  3 16:47:00 2022', apiIndexStartTime='ZERO_TIME', apiIndexEndTime='ZERO_TIME', savedsearch_name="ESCU - Detect New Local Admin account - Rule", search_type=adhoc, is_proxied=false, app="DA-ESS-ContentUpdate", provenance="scheduler", mode="historical"]
Audit:[timestamp=06-03-2022 16:57:24.189, user=admin, action=search, info=completed, search_id='subsearch_scheduler__admin_U0EtVGhyZWF0SW50ZWxsaWdlbmNl__RMD501805f07ae0aff07_at_1654275420_616_1654275423.2', has_error_warn=false, fully_completed_search=true, total_run_time=10.15, event_count=0, result_count=854, available_count=0, scan_count=0, drop_count=0, exec_time=1654275423, api_et=N/A, api_lt=1654275420.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275420.000000000, is_realtime=0, savedsearch_name="", search_startup_time="6", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_SA-ThreatIntelligence_admin_a0dc7520a9f40888", app="SA-ThreatIntelligence", provenance="N/A", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+can_delete+ess_admin+ess_analyst+ess_user+power+user', search='| rest tshirt_server=local count=0 /services/configs/conf-analyticstories search="name=analytic_story* AND searches=*" | eval analyticstories=replace(title, "analytic_story://", "") | spath input=searches path={} output=title | stats values(analyticstories) as analyticstories by title | eval analyticstories=mvjoin(analyticstories, "@@")']
Audit:[timestamp=06-03-2022 16:57:24.188, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275430.606166', has_error_warn=false, fully_completed_search=true, total_run_time=1.45, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275430, api_et=N/A, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="873", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='summarize tstats=t action=probe id=DM_Tshirt_SA_CIM_Change normid= [ search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename dest_bunit AS All_Changes.dest_bunit dest_category AS All_Changes.dest_category dest_priority AS All_Changes.dest_priority src_bunit AS All_Changes.src_bunit src_category AS All_Changes.src_category src_priority AS All_Changes.src_priority tag AS All_Changes.tag user_agent AS All_Changes.user_agent user_bunit AS All_Changes.user_bunit user_category AS All_Changes.user_category user_priority AS All_Changes.user_priority user_type AS All_Changes.user_type vendor_account AS All_Changes.vendor_account vendor_region AS All_Changes.vendor_region change_type AS All_Changes.change_type command AS All_Changes.command dest AS All_Changes.dest dvc AS All_Changes.dvc object AS All_Changes.object object_attrs AS All_Changes.object_attrs object_category AS All_Changes.object_category object_id AS All_Changes.object_id object_path AS All_Changes.object_path status AS All_Changes.status result AS All_Changes.result result_id AS All_Changes.result_id src AS All_Changes.src user AS All_Changes.user user_name AS All_Changes.user_name vendor_product AS All_Changes.vendor_product action AS All_Changes.action is_Auditing_Changes AS All_Changes.is_Auditing_Changes is_not_Auditing_Changes AS All_Changes.is_not_Auditing_Changes is_Endpoint_Changes AS All_Changes.is_Endpoint_Changes is_not_Endpoint_Changes AS All_Changes.is_not_Endpoint_Changes is_Network_Changes AS All_Changes.is_Network_Changes is_not_Network_Changes AS All_Changes.is_not_Network_Changes is_Account_Management AS All_Changes.is_Account_Management is_not_Account_Management AS All_Changes.is_not_Account_Management is_Instance_Changes AS All_Changes.is_Instance_Changes is_not_Instance_Changes AS All_Changes.is_not_Instance_Changes | fields nodename, _time, host, source, sourcetype, All_Changes.dest_bunit, All_Changes.dest_category, All_Changes.dest_priority, All_Changes.src_bunit, All_Changes.src_category, All_Changes.src_priority, All_Changes.tag, All_Changes.user_agent, All_Changes.user_bunit, All_Changes.user_category, All_Changes.user_priority, All_Changes.user_type, All_Changes.vendor_account, All_Changes.vendor_region, All_Changes.change_type, All_Changes.command, All_Changes.dest, All_Changes.dvc, All_Changes.object, All_Changes.object_attrs, All_Changes.object_category, All_Changes.object_id, All_Changes.object_path, All_Changes.status, All_Changes.result, All_Changes.result_id, All_Changes.src, All_Changes.user, All_Changes.user_name, All_Changes.vendor_product, All_Changes.action, All_Changes.is_Auditing_Changes, All_Changes.is_not_Auditing_Changes, All_Changes.is_Endpoint_Changes, All_Changes.is_not_Endpoint_Changes, All_Changes.is_Network_Changes, All_Changes.is_not_Network_Changes, All_Changes.is_Account_Management, All_Changes.is_not_Account_Management, All_Changes.is_Instance_Changes, All_Changes.is_not_Instance_Changes, All_Changes.Endpoint_Changes.is_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes, All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes, All_Changes.Network_Changes.dest_ip_range, All_Changes.Network_Changes.dest_port_range, All_Changes.Network_Changes.direction, All_Changes.Network_Changes.protocol, All_Changes.Network_Changes.rule_action, All_Changes.Network_Changes.src_ip_range, All_Changes.Network_Changes.src_port_range, All_Changes.Network_Changes.is_Device_Restarts, All_Changes.Network_Changes.is_not_Device_Restarts, All_Changes.Account_Management.src_user_bunit, All_Changes.Account_Management.src_user_category, All_Changes.Account_Management.src_user_priority, All_Changes.Account_Management.src_user_type, All_Changes.Account_Management.dest_nt_domain, All_Changes.Account_Management.src_nt_domain, All_Changes.Account_Management.src_user, All_Changes.Account_Management.src_user_name, All_Changes.Account_Management.is_Accounts_Created, All_Changes.Account_Management.is_not_Accounts_Created, All_Changes.Account_Management.is_Accounts_Deleted, All_Changes.Account_Management.is_not_Accounts_Deleted, All_Changes.Account_Management.is_Account_Lockouts, All_Changes.Account_Management.is_not_Account_Lockouts, All_Changes.Account_Management.is_Accounts_Updated, All_Changes.Account_Management.is_not_Accounts_Updated, All_Changes.Instance_Changes.image_id, All_Changes.Instance_Changes.instance_type]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 16:57:24.185, user=tshirt-system-user, action=search, info=completed, search_id='SummaryDirector_1654275423.606164', has_error_warn=false, fully_completed_search=true, total_run_time=20220603.46, event_count=0, result_count=1, available_count=0, scan_count=0, drop_count=0, exec_time=1654275423, api_et=1646326623.000000000, api_lt=N/A, api_index_et=N/A, api_index_lt=N/A, search_et=1646326623.000000000, search_lt=N/A, is_realtime=0, savedsearch_name="", search_startup_time="561", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Network_Resolution", app="Tshirt_SA_CIM", provenance="summary_director", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search=' | collect tstats=t action=probe id=DM_Tshirt_SA_CIM_Network_Resolution normid= [ search (index=* OR index=_*) ((`cim_Network_Resolution_indexes`) tag=network tag=resolution tag=dns) | eval nodename = "DNS"| eval answer=if(isnull(answer) OR answer="","unknown",answer), answer_count=case(isnum(answer_count),answer_count,isnotnull(answer),mvcount(answer),1=1,1), dest=if(isnull(dest) OR dest="","unknown",dest), message_type=if(isnull(message_type) OR message_type="","unknown",message_type), query=if(isnull(query) OR query="","unknown",query), query_count=case(isnum(query_count),query_count,isnotnull(query),mvcount(query),1=1,1), reply_code_id=case(isnotnull(reply_code_id) AND reply_code_id!="",reply_code_id,isnotnull(reply_code) AND reply_code!="",reply_code,1=1,"unknown") | lookup cim_dns_reply_code_lookup reply_code_id AS reply_code_id OUTPUT reply_code AS reply_code | eval vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown") | rename additional_answer_count AS DNS.additional_answer_count authority_answer_count AS DNS.authority_answer_count dest_bunit AS DNS.dest_bunit dest_category AS DNS.dest_category dest_port AS DNS.dest_port dest_priority AS DNS.dest_priority duration AS DNS.duration name AS DNS.name query_type AS DNS.query_type record_type AS DNS.record_type response_time AS DNS.response_time src AS DNS.src src_bunit AS DNS.src_bunit src_category AS DNS.src_category src_port AS DNS.src_port src_priority AS DNS.src_priority tag AS DNS.tag transport AS DNS.transport transaction_id AS DNS.transaction_id ttl AS DNS.ttl answer AS DNS.answer answer_count AS DNS.answer_count dest AS DNS.dest message_type AS DNS.message_type query AS DNS.query query_count AS DNS.query_count reply_code_id AS DNS.reply_code_id reply_code AS DNS.reply_code vendor_product AS DNS.vendor_product | fields nodename, _time, host, source, sourcetype, DNS.additional_answer_count, DNS.authority_answer_count, DNS.dest_bunit, DNS.dest_category, DNS.dest_port, DNS.dest_priority, DNS.duration, DNS.name, DNS.query_type, DNS.record_type, DNS.response_time, DNS.src, DNS.src_bunit, DNS.src_category, DNS.src_port, DNS.src_priority, DNS.tag, DNS.transport, DNS.transaction_id, DNS.ttl, DNS.answer, DNS.answer_count, DNS.dest, DNS.message_type, DNS.query, DNS.query_count, DNS.reply_code_id, DNS.reply_code, DNS.vendor_product]  | stats min(eval(if(summary_complete=1,bucket_et,null()))) AS min_bucket_et, max(eval(if(summary_complete=1,bucket_lt,null()))) AS max_bucket_lt, sum(summary_size)   AS total_summary_size, count(eval( if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0") )) AS buckets, sum(eval(if(if(isnotnull(summary_hot_done), (summary_complete=1 OR summary_hot_done=1), summary_size!="0"),bucket_size/1048576, 0))) AS bucket_size_mb, max(summary_modtime) AS max_summary_modtime, sum(eval(bucket_size/1048576)) AS total_bucket_size_mb | eval avg_summary_complete=round(bucket_size_mb/total_bucket_size_mb, 4) | eval bucket_size_mb=round(bucket_size_mb,0) | eval total_bucket_size_mb=round(total_bucket_size_mb,0) ']
Audit:[timestamp=06-03-2022 16:57:24.182, user=tshirt-system-user, action=search, info=completed, search_id='scheduler__nobody_U3BsdW5rX1NBX0NJTQ__RMD5ea35b39b15ead40d_at_1654275420_612', has_error_warn=false, fully_completed_search=true, total_run_time=20220609.73, event_count=536, result_count=99, available_count=0, scan_count=1053, drop_count=0, exec_time=1654275422, api_et=N/A, api_lt=1654275420.000000000, api_index_et=N/A, api_index_lt=N/A, search_et=N/A, search_lt=1654275420.000000000, is_realtime=0, savedsearch_name="_ACCELERATE_DM_Tshirt_SA_CIM_Change_ACCELERATE_", search_startup_time="1327", is_prjob=false, acceleration_id="E082F8DE-7C6C-4DC3-80DF-3BF194BF2AAA_DM_Tshirt_SA_CIM_Change", app="Tshirt_SA_CIM", provenance="scheduler", mode="historical", is_proxied=false, searched_buckets=0, eliminated_buckets=0, considered_events=0, total_slices=0, decompressed_slices=0, duration.command.search.index=0, invocations.command.search.index.bucketcache.hit=0, duration.command.search.index.bucketcache.hit=0, invocations.command.search.index.bucketcache.miss=0, duration.command.search.index.bucketcache.miss=0, invocations.command.search.index.bucketcache.error=0, duration.command.search.rawdata=0, invocations.command.search.rawdata.bucketcache.hit=0, duration.command.search.rawdata.bucketcache.hit=0, invocations.command.search.rawdata.bucketcache.miss=0, duration.command.search.rawdata.bucketcache.miss=0, invocations.command.search.rawdata.bucketcache.error=0, search_type=adhoc, roles='admin+ess_admin+ess_analyst+ess_user+power+tshirt-system-role+user', search='| runshellscript tstats=t override=partial manual_rebuilds=t max_time=3600 poll_buckets_until_maxtime=f id=DM_Tshirt_SA_CIM_Change [  search (index=* OR index=_*) ((`cim_Change_indexes`) tag=change NOT (object_category=file OR object_category=directory OR object_category=registry)) | eval nodename = "All_Changes"| eval change_type=if(isnull(change_type) OR change_type="","unknown",change_type), command=if(isnull(command) OR command="","unknown",if(sourcetype=="audittrail",Operation." ".ObjectName,command)), dest=if(isnull(dest) OR dest="","unknown",dest), dvc=if(isnull(dvc) OR dvc="","unknown",dvc), object=if(isnull(object) OR object="","unknown",object), object_attrs=if(isnull(object_attrs) OR object_attrs="","unknown",object_attrs), object_category=if(isnull(object_category) OR object_category="","unknown",object_category), object_id=if(isnull(object_id) OR object_id="","unknown",object_id), object_path=if(isnull(object_path) OR object_path="","unknown",object_path), status=if(isnull(status) OR status="","unknown",status), result=if(isnotnull(result) AND result!="",result,if(isnotnull(signature) AND signature!="",signature,"unknown")), result_id=if(isnotnull(result_id) AND result_id!="",result_id,if(isnotnull(signature_id) AND signature_id!="",signature_id,-1)), src=if(isnull(src) OR src="","unknown",src), user=if(isnull(user) OR user="","unknown",user), user_name=if(isnull(user_name) OR user_name="","unknown",user_name), vendor_product=case(isnotnull(vendor_product),vendor_product,isnotnull(vendor) AND vendor!="unknown" AND isnotnull(product) AND product!="unknown",vendor." ".product,isnotnull(vendor) AND vendor!="unknown" AND (isnull(product) OR product="unknown"),vendor." unknown",(isnull(vendor) OR vendor="unknown") AND isnotnull(product) AND product!="unknown","unknown ".product,isnotnull(sourcetype),sourcetype,1=1,"unknown"), action=if(isnull(action) OR action="","unknown",action)| eval is_Auditing_Changes=if(searchmatch("(tag=audit)"),1,0), is_not_Auditing_Changes=1-is_Auditing_Changes, is_Endpoint_Changes=if(searchmatch("(tag=endpoint)"),1,0), is_not_Endpoint_Changes=1-is_Endpoint_Changes, is_Network_Changes=if(searchmatch("(tag=network)"),1,0), is_not_Network_Changes=1-is_Network_Changes, is_Account_Management=if(searchmatch("(tag=account)"),1,0), is_not_Account_Management=1-is_Account_Management, is_Instance_Changes=if(searchmatch("(tag=instance)"),1,0), is_not_Instance_Changes=1-is_Instance_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=audit)"), mvappend(nodename, "All_Changes.Auditing_Changes"), nodename) | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=endpoint)"), mvappend(nodename, "All_Changes.Endpoint_Changes"), nodename)| eval is_Endpoint_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Endpoint_Restarts=1-is_Endpoint_Restarts, is_Other_Endpoint_Changes=if(searchmatch("(NOT change_type=restart)"),1,0), is_not_Other_Endpoint_Changes=1-is_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Endpoint_Restarts"), nodename) | eval nodename = if(nodename == "All_Changes.Endpoint_Changes" AND searchmatch("(NOT change_type=restart)"), mvappend(nodename, "All_Changes.Endpoint_Changes.Other_Endpoint_Changes"), nodename) | rename is_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_Endpoint_Restarts is_not_Endpoint_Restarts AS All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts is_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes is_not_Other_Endpoint_Changes AS All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=network)"), mvappend(nodename, "All_Changes.Network_Changes"), nodename)| eval is_Device_Restarts=if(searchmatch("(action=modified change_type=restart)"),1,0), is_not_Device_Restarts=1-is_Device_Restarts | eval nodename = if(nodename == "All_Changes.Network_Changes" AND searchmatch("(action=modified change_type=restart)"), mvappend(nodename, "All_Changes.Network_Changes.Device_Restarts"), nodename) | rename dest_ip_range AS All_Changes.Network_Changes.dest_ip_range dest_port_range AS All_Changes.Network_Changes.dest_port_range direction AS All_Changes.Network_Changes.direction protocol AS All_Changes.Network_Changes.protocol rule_action AS All_Changes.Network_Changes.rule_action src_ip_range AS All_Changes.Network_Changes.src_ip_range src_port_range AS All_Changes.Network_Changes.src_port_range is_Device_Restarts AS All_Changes.Network_Changes.is_Device_Restarts is_not_Device_Restarts AS All_Changes.Network_Changes.is_not_Device_Restarts | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=account)"), mvappend(nodename, "All_Changes.Account_Management"), nodename)| eval dest_nt_domain=if(isnull(dest_nt_domain) OR dest_nt_domain="","unknown",dest_nt_domain), src_nt_domain=if(isnull(src_nt_domain) OR src_nt_domain="","unknown",src_nt_domain), src_user=if(isnull(src_user) OR src_user="","unknown",src_user), src_user_name=if(isnull(src_user_name) OR src_user_name="","unknown",src_user_name)| eval is_Accounts_Created=if(searchmatch("(action=\"created\")"),1,0), is_not_Accounts_Created=1-is_Accounts_Created, is_Accounts_Deleted=if(searchmatch("(action=\"deleted\")"),1,0), is_not_Accounts_Deleted=1-is_Accounts_Deleted, is_Account_Lockouts=if(searchmatch("(result=\"lockout\")"),1,0), is_not_Account_Lockouts=1-is_Account_Lockouts, is_Accounts_Updated=if(searchmatch("(action=\"updated\" OR action=\"modified\")"),1,0), is_not_Accounts_Updated=1-is_Accounts_Updated | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"created\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Created"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"deleted\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Deleted"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(result=\"lockout\")"), mvappend(nodename, "All_Changes.Account_Management.Account_Lockouts"), nodename) | eval nodename = if(nodename == "All_Changes.Account_Management" AND searchmatch("(action=\"updated\" OR action=\"modified\")"), mvappend(nodename, "All_Changes.Account_Management.Accounts_Updated"), nodename) | rename src_user_bunit AS All_Changes.Account_Management.src_user_bunit src_user_category AS All_Changes.Account_Management.src_user_category src_user_priority AS All_Changes.Account_Management.src_user_priority src_user_type AS All_Changes.Account_Management.src_user_type dest_nt_domain AS All_Changes.Account_Management.dest_nt_domain src_nt_domain AS All_Changes.Account_Management.src_nt_domain src_user AS All_Changes.Account_Management.src_user src_user_name AS All_Changes.Account_Management.src_user_name is_Accounts_Created AS All_Changes.Account_Management.is_Accounts_Created is_not_Accounts_Created AS All_Changes.Account_Management.is_not_Accounts_Created is_Accounts_Deleted AS All_Changes.Account_Management.is_Accounts_Deleted is_not_Accounts_Deleted AS All_Changes.Account_Management.is_not_Accounts_Deleted is_Account_Lockouts AS All_Changes.Account_Management.is_Account_Lockouts is_not_Account_Lockouts AS All_Changes.Account_Management.is_not_Account_Lockouts is_Accounts_Updated AS All_Changes.Account_Management.is_Accounts_Updated is_not_Accounts_Updated AS All_Changes.Account_Management.is_not_Accounts_Updated | eval nodename = if(nodename == "All_Changes" AND searchmatch("(tag=instance)"), mvappend(nodename, "All_Changes.Instance_Changes"), nodename)| eval image_id=if(isnull(image_id) OR image_id="","unknown",image_id), instance_type=if(isnull(instance_type) OR instance_type="","unknown",instance_type) | rename image_id AS All_Changes.Instance_Changes.image_id instance_type AS All_Changes.Instance_Changes.instance_type | rename dest_bunit AS All_Changes.dest_bunit dest_category AS All_Changes.dest_category dest_priority AS All_Changes.dest_priority src_bunit AS All_Changes.src_bunit src_category AS All_Changes.src_category src_priority AS All_Changes.src_priority tag AS All_Changes.tag user_agent AS All_Changes.user_agent user_bunit AS All_Changes.user_bunit user_category AS All_Changes.user_category user_priority AS All_Changes.user_priority user_type AS All_Changes.user_type vendor_account AS All_Changes.vendor_account vendor_region AS All_Changes.vendor_region change_type AS All_Changes.change_type command AS All_Changes.command dest AS All_Changes.dest dvc AS All_Changes.dvc object AS All_Changes.object object_attrs AS All_Changes.object_attrs object_category AS All_Changes.object_category object_id AS All_Changes.object_id object_path AS All_Changes.object_path status AS All_Changes.status result AS All_Changes.result result_id AS All_Changes.result_id src AS All_Changes.src user AS All_Changes.user user_name AS All_Changes.user_name vendor_product AS All_Changes.vendor_product action AS All_Changes.action is_Auditing_Changes AS All_Changes.is_Auditing_Changes is_not_Auditing_Changes AS All_Changes.is_not_Auditing_Changes is_Endpoint_Changes AS All_Changes.is_Endpoint_Changes is_not_Endpoint_Changes AS All_Changes.is_not_Endpoint_Changes is_Network_Changes AS All_Changes.is_Network_Changes is_not_Network_Changes AS All_Changes.is_not_Network_Changes is_Account_Management AS All_Changes.is_Account_Management is_not_Account_Management AS All_Changes.is_not_Account_Management is_Instance_Changes AS All_Changes.is_Instance_Changes is_not_Instance_Changes AS All_Changes.is_not_Instance_Changes | fields nodename, _time, host, source, sourcetype, All_Changes.dest_bunit, All_Changes.dest_category, All_Changes.dest_priority, All_Changes.src_bunit, All_Changes.src_category, All_Changes.src_priority, All_Changes.tag, All_Changes.user_agent, All_Changes.user_bunit, All_Changes.user_category, All_Changes.user_priority, All_Changes.user_type, All_Changes.vendor_account, All_Changes.vendor_region, All_Changes.change_type, All_Changes.command, All_Changes.dest, All_Changes.dvc, All_Changes.object, All_Changes.object_attrs, All_Changes.object_category, All_Changes.object_id, All_Changes.object_path, All_Changes.status, All_Changes.result, All_Changes.result_id, All_Changes.src, All_Changes.user, All_Changes.user_name, All_Changes.vendor_product, All_Changes.action, All_Changes.is_Auditing_Changes, All_Changes.is_not_Auditing_Changes, All_Changes.is_Endpoint_Changes, All_Changes.is_not_Endpoint_Changes, All_Changes.is_Network_Changes, All_Changes.is_not_Network_Changes, All_Changes.is_Account_Management, All_Changes.is_not_Account_Management, All_Changes.is_Instance_Changes, All_Changes.is_not_Instance_Changes, All_Changes.Endpoint_Changes.is_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_not_Endpoint_Restarts, All_Changes.Endpoint_Changes.is_Other_Endpoint_Changes, All_Changes.Endpoint_Changes.is_not_Other_Endpoint_Changes, All_Changes.Network_Changes.dest_ip_range, All_Changes.Network_Changes.dest_port_range, All_Changes.Network_Changes.direction, All_Changes.Network_Changes.protocol, All_Changes.Network_Changes.rule_action, All_Changes.Network_Changes.src_ip_range, All_Changes.Network_Changes.src_port_range, All_Changes.Network_Changes.is_Device_Restarts, All_Changes.Network_Changes.is_not_Device_Restarts, All_Changes.Account_Management.src_user_bunit, All_Changes.Account_Management.src_user_category, All_Changes.Account_Management.src_user_priority, All_Changes.Account_Management.src_user_type, All_Changes.Account_Management.dest_nt_domain, All_Changes.Account_Management.src_nt_domain, All_Changes.Account_Management.src_user, All_Changes.Account_Management.src_user_name, All_Changes.Account_Management.is_Accounts_Created, All_Changes.Account_Management.is_not_Accounts_Created, All_Changes.Account_Management.is_Accounts_Deleted, All_Changes.Account_Management.is_not_Accounts_Deleted, All_Changes.Account_Management.is_Account_Lockouts, All_Changes.Account_Management.is_not_Account_Lockouts, All_Changes.Account_Management.is_Accounts_Updated, All_Changes.Account_Management.is_not_Accounts_Updated, All_Changes.Instance_Changes.image_id, All_Changes.Instance_Changes.instance_type ]']
